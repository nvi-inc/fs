FTN4,X
C@WVABT 
C 
      SUBROUTINE WVABT(IP),WVR UPROC RESET C#870115:04:47#
C 
C      WVABT aborts a pending data or point request to the WVR
C 
C   INPUT VARIABLES:
C 
      DIMENSION IP(1) 
C             -Parameters from QUIKR
C      IP(1)  -Class number of input buffer 
C      IP(2-5)-Not used 
C 
C   OUTPUT VARIABLES: 
C 
C      IP(1) - Class number 
C      IP(2) - Number of records
C      IP(3) - Error number 
C      IP(4) - Who we are 
C 
C 
C 2.5  SUBROUTINE INTERFACE 
C 
C   CALLING SUBROUTINE: QUIKR 
C   CALLED SUBROUTINES: CHARACTER STRING UTILITIES
C 
C 3.  LOCAL VARIABLES 
C 
      DIMENSION IBUF(20),IBUF2(20)
C               - Class buffer
      DIMENSION IREG(2) 
C               - Registers from EXEX calls 
      EQUIVALENCE (REG,IREG(1)) 
C 4.  CONSTANTS USED
C 
C 5.  INITIALIZED VARIABLES 
C 
      DATA ILEN/40/ 
C 
C 6.  PROGRAMMER (ARIES)RBM 
C     CREATED    800820 
C# LAST COMPC'ED  870115:04:47   #
C 
C     PROGRAM STRUCTURE 
C 
C     1. WVABT is a write only command to the radiometer. An
C     equal sign or any other parameters following the command will 
C     be bitterly complained about. 
C 
      ICLCM=IP(1) 
      IF(ICLCM.NE.0)GO TO 100 
      IERR=-1 
      GO TO 990 
C 
C     1.1 Get the command buffer. 
C 
  100 REG= EXEC(21,ICLCM,IBUF,-ILEN)
      NCHAR = MIN0(IREG(2),ILEN)
      NCH = ISCNC(IBUF,1,NCHAR,75B) 
      IF (NCH.EQ.0) GOTO 300
      IERR=-101 
      GOTO 990
C 
C 
C     3. Get the buffer to send to the WVR. 
C 
300   CALL AB2WV(IBUF,ICLASS,NREC)
C 
C 
C     5. All MATCN requests are scheduled here. 
C 
  500 CALL EXEC(23,6HMATCN ,ICLASS,NREC)
      CALL RMPAR(IP)
      IF (IP(3).LT.0) GOTO 999
      IF (IP(1).EQ.0) GOTO 999
C 
C     6. Prepare output buffer
C 
      REG=EXEC(21,ICLCM,IBUF2,-ILEN)
C                   Get original command
      NCHAR=MIN0(IREG(2),ILEN)
      NCH=NCHAR+1 
      NCH=ICHMV(IBUF2,NCH,2H/ ,1,1) 
C                   Append / to indicate response 
      DO 620 I=1,IP(2)
        IF (I.NE.1) NCH=MCOMA(IBUF2,NCH)
        REG=EXEC(21,IP(1),IBUF,-ILEN) 
C                   Get response buffer from MATCN
        NCHAR=MIN0(IREG(2),ILEN)
        NCH=ICHMV(IBUF2,NCH,IBUF(2),1,NCHAR-2)
C                   Move response into output buffer
620     CONTINUE
C 
C     7. Send buffer to SAM 
C 
      ICLASS=0
      IERR=0
      NCH=NCH-1 
      CALL EXEC(20,0,IBUF2,-NCH,2HFS,0,ICLASS)
C 
C     9. Exit 
C 
  990 IP(1)=ICLASS
      IP(2)=1 
      IP(3)=IERR
      IP(4)=2HQW
999   RETURN
      END 
