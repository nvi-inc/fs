FTN4,A
C@ISHDM 
C 
        FUNCTION ISHDM(ITYPE,IXCOL,I1,I2,I3,I4,I5)
     .,C#870115:05:48    FORM SCREEN LINE DUMB=1.1# 
C 
C     ISHDM 
C 
C 1.  NAME PROGRAM SPECIFICATION
C 
C 1.1.   ISHDM
C               THIS ROUTINE FORMATS DISPLAYS FOR 264x TERMINALS USING
C     INVERSE VIDEO WHEN REQUESTED.  THIS ROUTINE HANDLES COLUMN POSITIONING
C     AND WILL DISPLAY ASCII,CONVERTED BINARY INTEGERS, CONVERTED REAL
C     NUMBER USING A FORM OF THE FORTRAN Fn.m DISPLAY.  ASTONOMICAL 
C     ANGLES CAN ALSO BE FORMATTED AND DISPLAYED.  AN ENTRY IS ALSO PROVIDED
C     TO CALL A FUNCTION TO FORMAT AND CONVERT OTHER SYSTEM PARAMETERS. 
C     THE VALUE OF ISHDM AT THE COMPLETION OF A CALL WILL 
C     BE THE NUMBER OF REMAINING CHARACTERS IN THE BUFFER FOR 
C     DISPLAYING MORE INFORMATION ON THE SCREEN.
C 
C 
C 1.2.   RESTRICTIONS - limits on use of routine
C 
C 1.3.   REFERENCES - document cited
C 
C 2.  NAME INTERFACE
C 
C 2.1.   CALLING SEQUENCE: NLEFT=ISHDM(ITYPE,IXCOL,I1,I2,I3,I4,I5)
C 
C     INPUT VARIABLES:
C 
C       GLOBAL DEFS REFERENCED: "name'(local name if different)' ...
C 
C****   ITYPE=IVID*100B+IGO 
C 
C               THE MEANING AND USEAGE OF IVID IS DETERMINED BY THE VALUE 
C               OF IGO WHICH IS EXPLAINED IN THE FOLLOWING
C 
C       IGO     - DETERMINES THE FUNCTION PERFORMED BY THIS ROUTINE AND 
C                 DETERMINES THE MEANING OF THE REST OF THE PARAMETERS FOR
C                 THIS CALL.  THE CURRENTLY IMPLEMENTED LIST OF IGO VALUES
C                 AND THEIR EFFECT FOLLOWS WITH THE USEAGE OF OTHER 
C                 PARAMETERS AS GROUPED BELOW.
C 
C       0       - RESET ALL DISPLAY PARAMETERS AND FILL THE BUFFER WITH 
C                 BLANKS
C 
C               IXCOL     - IF THIS VARIABLE HAS THE VALUE 100000B THE FIRST
C                         2 CHARACTERS INSERTED INTO THE BUFFER WILL
C                         CLEAR THE LINE PRIOR TO WRITTING ANY NEW
C                         INFORMATION ON THE LINE 
C 
C       1-62    THE SECOND PARAMETER AND IVID ARE USED IN EXACTLY THE SAME
C               MANNER AND THE EXPLAINATION FOR THIS RANGE IS NOW GIVEN 
C 
C       IVID    - 0 NOTHING IS DONE 
C               - 1 INVERSE VIDEO IS TURNED ON PRIOR TO INSERTING THE 
C                   INFORMATION IN THE BUFFER AND TURNED OFF AFTER
C                   THE CURRENT REQUEST HAS BEEN COMPLETED. 
C               - 2 INVERSE VIDEO IS TURNED ON PRIOR TO INSERTING THE 
C                   THE CURRENT INFORMATION AND IS LEFT ON UPON EXIT. 
C               - 3 NORMAL VIDEO IS TURNED ON AFTER THE INFORMATION HAS 
C                   BEEN INSERTED.
C  **NOTE**     (SEE WARNING ON USE OF THIS OPTION AND NEGATIVE IXCOL)
C 
C       IXCOL   - >0 MOVE TO A POINT IN THE BUFFER TO DISPLAY THIS REQUEST
C                 TO APPEAR IN COLUMN IXCOL.  IT IS POSSIBLE TO FILL
C                 LOCATIONS ON THE SCREEN SEREIALLY FROM THE LEFT 
C                 SINCE ESC CONTROL SEQUENCES DO NOT CAUSE THE CURSOR TO
C                 MOVE, BUT DO INCREASE THE NUMBER OF CHARACTERS THAT ARE 
C                 SENT TO THE DISPLAY FOR CONTROL OF THE FORMATTED
C                 INFORMATION.  IF THE REQUESTED POSITION HAS BEEN PASSED 
C                 THE INFORMATION WILL BE DISPLAY IN THE NEXT AVAILBLE
C                 SCREEN POSITION.
C 
C               - =0 DISPLAY THE INFORMATION IN THE NEXT AVAILBLE POSITION
C                 ON THE SCREEN AND UPDATE THE INTERNAL INFORMATION TO
C                 KEEP TRACK OF WHERE THIS ENDS.  THIS FIELD WILL BE
C                 TREATED AS BELONGING TO THE LAST POSITIVE FIELD FOR 
C                 INTERNAL BOOKKEEPING PURPOSES.
C 
C               - <0 BACK UP IN THE BUFFER THIS NUMBER OF POSITIONS AND 
C                 OVERLAY THE INFORMATION ALREADY ADDED WITH THIS DISPLAY 
C                 AND INCLUDE THE INFORMATION ADDED TO BE PART OF THE LAST
C  **WARNING**    FIELD ENTERED WITH A POSITIVE IXCOL.  (**WARNING**  THIS
C  **WARNING**    OPTION SHOULD NOT BE USED AFTER A HIGHLIGHTED FIELD 
C  **WARNING**    UNLESS THE USER HAS STUDIED HOW THE BUFFER FILLING
C  **WARNING**    IS HANDLED BY THIS ROUTINE AND IS CERTAIN HE KNOWS
C  **WARNING**    WHAT HE WANTS TO DO  **WARNING**) 
C 
C       1       - INSERT INTO THE BUFFER I1 CHARACTERS AS GIVEN IN THE
C                 HIGH ORDER BYTE OF I2 FOR DISPLAY ON THE SCREEN 
C 
C       2       - MOVE THE STRING OF I2 CHARACTERS POINTED TO BY I1 TO THE
C                 BUFFER FOR DISPLAY STARTING IN COLUMN IXCOL AS GIVEN IN 1 
C 
C       3       - DISPLAY THE INTEGER I1 CONVERTED BY IAS2B 
C                 WITH THE FORMAT AS SPECIFIED IN I2 USED AS THE 4th
C                 PARAMETER IN THE CALL TO IB2AS (SEE ROUTINE &IAS2B FOR
C                 DETAILS IN THE USE OF THIS PARAMETER).
C 
C       4       - DISPLAY THE REAL VARIABLE GIVEN IN I1 ASSUMING IT TO BE 
C                 A FLOATING POINT NUMBER USING THE ROUTINE IR2AS WITH
C                 I2 & I3 AS IR2AS'S 4th AND 5th PARAMETER. (SEE &IR2AS 
C                 FOR DETAILS ON THE 4th &5th PARAMETER ON THE OUTPUT). 
C 
C       5       - DISPLAY THE ASTRONOMICAL ANGLE GIVEN BY PARAMETERS I1-I4
C                 VIA ROUTINE IFAMS USING I5 AS IFAMS 7th PARAMETER 
C                 (SEE &IFAMS FOR DETAILS AND USES).
C 
C       20      - CALL THE FUNCTION GIVEN BY I1 WITH PARAMETERS I2 & I3 
C                 USED AS ITS FIRST AND SECOND PARAMETER AND GIVE I1
C                 ACCESS TO THE BUFFER (LINE) IN PARAMETER 3 AND THE
C                 NEXT POSITION TO USE (NCHAR) IN PARAMETER 4 AND THE 
C                 UPPER LIMIT ON THE BUFFER IN PARAMETER 5.  HENCE THE
C                 FOLLOWING CALL TO THE FUNCTION REFERED BY I1 WILL BE MADE 
C 
C                       NCHAR=I1(I2,I3,LINE,NCHAR,IBLIM)
C 
C                 IT IS EXPECTED THAT I1 WILL RETURN THE NEXT USEABLE 
C                 LOCATION IN LINE AFTER IT HAS FINISHED ADDING CHARACTERS
C                 TO LINE.
C 
C       63      - DISPLAY THE CONTENTS OF THE BUFFER THAT HAVE BEEN 
C                 CONSTRUCTED UP UNTIL NOW ON THE LOGICAL UNIT GIVEN BY 
C                 THE ABSOLUTE VALUE OF IXCOL.  AFTER DISPLAYING THE
C                 INFORMATION CLEAR THE REST OF THE LINE OF THE DISPLAY 
C                 AND LEAVE THE CURSOR ON THE NEXT LINE.
C 
C 
C     OUTPUT VARIABLES: 
C 
C       GLOBAL DEFS REFERENCED: "name'(local name if different)' ...
C 
C       ISHDM   - THE NUMBER OF CHARACTERS AVAILABLE FOR USE IN THE 
C                 BUFFER IN CONSTRUCTING THE CURRENT DISPLAY LINE 
C                 (NOTE 0 MEANS INTERNAL BUFFER IS FULL AND NEW 
C                 REQUESTS OTHER THAN WRITING THE BUFFER OR RESETTING   
C                 WILL BE IGNORED)
C 
C 2.2.   COMMON BLOCKS USED 
C 
C 2.3.   DATA BASE ACCESSES 
C 
C 2.4.   EXTERNAL INPUT/OUTPUT
C 
C 2.5.   SUBROUTINE INTERFACE:
C 
C     CALLING SUBROUTINES: SUB1, SUB2, ... (not required for utilities) 
C 
C     CALLED SUBROUTINES: SUB1, SUB2, ... (includes segments scheduled) 
C 
C 3.  LOCAL VARIABLES 
C 
C       GLOBAL DEFS REFERENCED: "name'(local name if different)' ...
C 
C 
        DIMENSION LINE(85)
C 
C       LINE    - INTERNAL BUFFER FOR SCREEN DISPLAY
C       IRGA    - CONTENTS OF A REG WHERE REG WAS RETURNED FROM FUNCTION
C                 CALL TO A ROUTINE 
C 
C       IRGB    - CONTENTS OF B-REG WHERE REG WAS RETURNED FROM FUNCTION
C                 CALL TO A ROUTINE 
C 
        DIMENSION IREG(2) 
C 
C       IREG    - DUMMY REGISTER RETREIVAL AID
C 
        EQUIVALENCE (REG,IREG(1),IRGA),(IREG(2),IRGB) 
C 
C 4.  CONSTANTS USED
C 
        DATA IBLIM/160/ 
C 
C       IBLIM   - THE MAXIMUM NUMBER OF CHARACTERS THAT MAY BE WRITTEN INTO 
C                 BUFFER LINE AT ONE TIME 
C 
C 5.  INITIALIZED VARIABLES 
C 
C 6.  PROGRAMMER: LEE N. FOSTER 
C     LAST MODIFIED:
C# LAST COMPC'ED  870115:05:48urrent date) #
C 
C     PROGRAM STRUCTURE 
C 
C               6.1  INITIALIZE VARIABLES 
C 
        INP=IGNPS(IND)
        IGO=IAND(ITYPE,77B) 
C****   IVID=IAND(ITYPE/100B,77B) 
        ICOL=IABS(IXCOL)
        IF(IGO .EQ. 63)GO TO 63000
        IF(IGO .NE. 0)GO TO 100 
        CALL IFILL(LINE,1,160,2H  ) 
        NCHAR=1 
        NCHO=1
        IOCOL=1 
        ISHDM=IBLIM 
        GO TO 99999 
100    CONTINUE 
C 
C               CHECK FOR OFF SCREEN OR BUFFER FILLED 
C 
        IF(             ICOL .LE. 80
     C          .AND.   NCHAR .LT. IBLIM)GO TO 110
C 
        ISHDM=MAX0(IBLIM-NCHAR+1,0) 
C 
        GO TO 99999 
C 
110     CONTINUE
C 
        IF(IXCOL .GT. 0)NCHAR=INPOS(LINE,ICOL,IOCOL,NCHO,NCHAR) 
        IF(IXCOL .LT. 0)NCHAR=NCHAR-ICOL
        IG1=IGO-18
        GO TO (999,19999),IG1 
999   CONTINUE
C****   IF(IAND(IVID+1,2) .NE. 0)NCHAR=IVON(LINE,NCHAR) 
        GO TO (1000,2000,3000,4000,5000),IGO
1000    CONTINUE
        CALL IFILL(LINE,NCHAR,NCHAR+I1-1,I2)
        NCHAR=NCHAR+I1
        GO TO 19000 
2000   CONTINUE 
        NCHAR=ICHMV(LINE,NCHAR,I1,1,I2) 
        GO TO 19000 
3000   CONTINUE 
        NCHAR=IB2AS(I1,LINE,NCHAR,I2)+NCHAR 
        GO TO 19000 
4000   CONTINUE 
        NCHAR=IR2AS(I1,LINE,NCHAR,I2,I3)+NCHAR
        GO TO 19000 
5000   CONTINUE 
        NCHAR=IFAMS(LINE,NCHAR,I1,I2,I3,I4,I5)
        GO TO 19000 
19000   CONTINUE
C****   IF(IAND(IVID,1) .EQ. 1)NCHAR=IVOFF(LINE,NCHAR)
        GO TO 99990 
19999   CONTINUE
        IF(IGO .NE. 20)GO TO 99990
        NCHAR=I1(I2,I3,LINE,NCHAR,IBLIM)
        GO TO 99990 
63000   CONTINUE
        IF(IGO .NE. 63)GO TO 99990
C 
C               IF I1 SET TO 100000B (TRUE) CLEAR LINE FIRST
C 
C****   IF(I2 .EQ. 100000B)CALL CLLIN(ICOL,0) 
        CALL EXEC(2,IXCOL,LINE,1-NCHAR) 
C****   CALL CLLIN(ICOL,1)
        GO TO 99990 
99990   CONTINUE
        ISHDM=IBLIM-NCHAR+1 
99999   CONTINUE
C 
        RETURN
        END 
        END$
