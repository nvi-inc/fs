#!/bin/sh
# This is the installation script for Field System version 8.2, for root only
#
echo "******************************************************************"
echo "*  This is the INSTALLATION script for Field System version 8.2  *"
echo "*  Refer to instructions in the Update Notice.                   *"
echo "******************************************************************"
echo "\nCAUTION: This script will REMOVE all files in the following "
echo "         directories and their subdirectories before restoring "
echo "         the standard distributed files from the floppy:"
echo "                /usr2/fs" 
echo "                /usr2/control"
echo "                /usr2/sched"
echo "                /usr2/proc"
echo "                /usr2/log"
echo "                /usr2/st"
echo "\nIf you want to update only the Field System software, use"
echo "the fsupdate.82 script instead."
echo "\nDo you wish to continue with the complete INSTALLATION? (y=yes, n=no) : \c" 
badans=true
while [ "$badans" = "true" ]
do
  read ans
  case "$ans" in
    y|yes) echo "\nO.K. Continuing with install ... "
           badans=false
           ;;
    n|no)  echo "\nO.K. Exiting."
           exit
           ;;
    *)     echo "\nPlease answer with y=yes or n=no : \c"
  esac
done
#
echo "Uncompressing cpio archive"
cd /tmp/fsdist
ulimit 409600
/usr/bin/X11/uncompress fs.cpio.Z
#
echo "Removing any old directories"
rm -rf /usr2/fs
rm -rf /usr2/control
rm -rf /usr2/sched
rm -rf /usr2/proc
rm -rf /usr2/log
rm -rf /usr2/st
#
echo "Restoring FS files"
cd /usr2
cpio -icmud < /tmp/fsdist/fs.cpio
#
echo "Setting permissions"
cd /usr2
find fs -print |xargs chown prog
find fs -print |xargs chgrp code
find fs -print |xargs chmod a+r,ug+w,o-w 
#
echo "Making setb"
cd /usr2/fs/setb
cc -o setb setb.c
./setb setb
#
echo "Creating station directories and copying default station files"
cd /usr2/fs/st.default
find control sched proc oper prog dos -print | cpio -pmdu /usr2
#
echo "Creating log directory"
cd /usr2
mkdir log
#
echo "Setting permissions on station directories and files"
cd /usr2
find control sched proc log oper -print |xargs chown oper
find control sched proc log oper -print |xargs chgrp other
find control sched proc log oper -print |xargs chmod a+rw 
find oper -print |xargs chmod go-w 
find dos  -print |xargs chown dos
find dos  -print |xargs chgrp other
find dos  -print |xargs chmod a+r,u+w,go-w 
find prog -print |xargs chown prog
find prog -print |xargs chgrp code
find prog -print |xargs chmod a+r,u+w,go-w 
#
echo "Installing Field System boot rc2 scripts"
cd /usr2/fs/misc
find . -name Szz\* -print |cpio -pmdu /etc/rc2.d
cd /etc/rc2.d
chown root Szz*
chgrp root Szz*
chmod a+rw,go-w Szz*
#
echo "Installing Field System Xresources"
mv /usr/lib/X11/xdm/Xresources /usr/lib/X11/xdm/Xresources.org
cd /usr2/fs/misc
find . -name Xresources -print |cpio -pmdu /usr/lib/X11/xdm
cd /usr/lib/X11/xdm
chown root Xresources
chgrp root Xresources
chmod a+rw,go-w Xresources
#
echo "Done."
