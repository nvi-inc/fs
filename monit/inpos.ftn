FTN77,I,Y
$ALIAS /FSCOM/ , NOALLOCATE
$CDS ON
        FUNCTION INPOS(LINE,ICOL,IOCOL,NCHO,NCHN) 
     C,C#870115:05:49    CURSOR BOOK KEEPER V=1.0#
C 
C           THIS FUNCTION RETURNS THE NEW BUFFER POSITION FOR INSERTING   
C       CHARACTERS IN THE BUFFER TO PUT THE CHARACTERS ON THE SCREEN IN   
C       COLUMN POSITION ICOL.  THE POSITION OF THE CURSOR ON THE SCREEN   
C      WHEN NCHO-1 CHARACTERS HAD BEEN WRITTEN TO THE DEVICE IS ASSUMED 
C      TO BE IOCOL UPON ENTRY.  UPON EXIT IOCOL WILL BE ICOL UNLESS THE 
C      NUMBER OF CHARACTERS WRITTEN TO THE SCREEN BY ADDING NCHN-1-NCHO 
C      CHARACTERS HAS PLACED IT PAST THERE IN WHICH CASE IOCOL WILL 
C      REFLECT THE ACTUAL POSITION IT WILL BE DISPLAYED ON THE SCREEN 
C 
C       INPUT PARAMETERS
C 
C       LINE    - THE BUFFER BEING FILLED 
C 
C       ICOL    - THE COLUMN THAT SHOULD NEXT BE WRITTEN TO 
C 
C       IOCOL   - THE COLUMN WRITTEN TO WHEN NCHO-1 CHARACTERS HAD BEEN 
C                 WRITTEN TO THE SCREEN 
C 
C       NCHO    - THE NEXT POSITION TO BE FILLED IN THE BUFFER
C 
C       NCHN    - THE NEW NEXT POSITION TO BE USED IN THE BUFFER
C 
C 
C       OUTPUT PARAMETERS 
C 
C       INPOS   - THE POSITION IN THE BUFFER TO BE USED TO PLACE THE
C                 NEXT CHARACTERS AT OR AFTER ICOL. 
C 
C       IOCOL   - THE POSITION AT WHICH THE INFORMATION WILL BE PLACED
C                 (NOTE IOCOL WILL BE GE ICOL  -- GREATER ONLY IF THE 
C                 CURSOR HAS ALREADY PASSED COLUMN ICOL)
C 
C       NCHO    - NCHN OR THE NEXT POSITION IN THE BUFFER THAT COULD
C                 BE USED.
C 
        DIMENSION LINE(1) 
C 
C               GET COLUMN POSITION ON CHARACTER COUNT
C 
        IOCOL=NCHN-NCHO+IOCOL 
C 
C               BACK UP 4 FOR PRE-ENHANCEMENT 
C 
        IF(ICHCM(LINE,NCHO,4H&d@,1,3) .EQ. 0)IOCOL=IOCOL-4 
C 
C               BACK UP 4 FOR DE-ENHANCMENT 
C 
        IF(ICHCM(LINE,NCHN-4,4H&d@,1,4) .EQ. 0)IOCOL=IOCOL-4 
C 
C               GET NEXT BUFFER LOC/CHAR POSITION - GREATER OF THESE
C 
        INPOS=MAX0(NCHN+ICOL-IOCOL,NCHN)
C 
C               UPDATE START OF CURRENT BUFFER
C 
        NCHO=INPOS
C 
C               UPDATE START OF VURRENT WRITE ON SCREEN 
C 
        IOCOL=INPOS-NCHN+IOCOL
99999   RETURN
        END 
        END$
