<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="author" content="E. Himwich, J. Quick">
<title>FS DBBC3 Operations Manual</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book">
<div id="header">
<h1>FS DBBC3 Operations Manual</h1>
<div class="details">
<span id="author" class="author">E. Himwich, J. Quick</span><br>
<span id="revdate">Version 5.2.10 - December 2023</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_dbbc3_related_commands">2. DBBC3 related commands</a></li>
<li><a href="#_fs_dbbc3_channel_and_if_labels">3. FS DBBC3 channel and IF labels</a></li>
<li><a href="#_configuring_the_dbbc3">4. Configuring the DBBC3</a>
<ul class="sectlevel2">
<li><a href="#_local_configuration_changes">4.1. Local configuration changes</a>
<ul class="sectlevel3">
<li><a href="#_ethernet_configuration">4.1.1. Ethernet configuration</a></li>
<li><a href="#_changing_thread_numbers">4.1.2. Changing thread numbers</a></li>
</ul>
</li>
<li><a href="#_setting_the_experiment_mode_configuration">4.2. Setting the experiment mode configuration</a>
<ul class="sectlevel3">
<li><a href="#_setting_the_core3h_board_configuration">4.2.1. Setting the Core3H board configuration</a></li>
</ul>
</li>
<li><a href="#_checking_the_mode">4.3. Checking the mode</a></li>
</ul>
</li>
<li><a href="#_if_target_levels">5. IF target levels</a></li>
<li><a href="#_multicast_time_outs">6. Multicast time-outs</a></li>
<li><a href="#_firmware_version_checking">7. Firmware version checking</a></li>
<li><a href="#_control_files">8. Control files</a>
<ul class="sectlevel2">
<li><a href="#_equip_ctl">8.1. equip.ctl</a></li>
<li><a href="#_dbbc3_ctl">8.2. dbbc3.ctl</a></li>
<li><a href="#_dbbad_ctl">8.3. dbbad.ctl</a></li>
<li><a href="#_skedf_ctl">8.4. skedf.ctl</a></li>
</ul>
</li>
<li><a href="#_tsys_monitor_display">9. Tsys monitor display</a>
<ul class="sectlevel2">
<li><a href="#_modes">9.1. Modes</a></li>
<li><a href="#_tsys_values">9.2. Tsys values</a>
<ul class="sectlevel3">
<li><a href="#_continuous_calibration">9.2.1. Continuous calibration</a></li>
<li><a href="#_legacy_noncontinuous_calibration">9.2.2. Legacy (noncontinuous) calibration</a></li>
</ul>
</li>
<li><a href="#_commands">9.3. Commands</a></li>
</ul>
</li>
<li><a href="#_checking_dbbc3_time">10. Checking DBBC3 time</a></li>
<li><a href="#_setting_fs_time">11. Setting FS time</a></li>
<li><a href="#_multicast_logging">12. Multicast logging</a></li>
<li><a href="#_drudg_support">13. drudg support</a></li>
<li><a href="#_configuring_the_fs_for_use_with_a_dbbc3">Appendix A: Configuring the FS for use with a DBBC3</a></li>
<li><a href="#_dbbc3_specific_environment_variables">Appendix B: DBBC3 specific environment variables</a>
<ul class="sectlevel2">
<li><a href="#_determining_what_values_to_use">B.1. Determining what values to use</a></li>
<li><a href="#_swaps_of_tpi_and_gain_values">B.2. Swaps of TPI and gain values</a></li>
<li><a href="#_other_options">B.3. Other options</a></li>
</ul>
</li>
<li><a href="#_verifying_polarity_and_usblsb_tpi_swaps">Appendix C: Verifying polarity and USB/LSB TPI swaps</a>
<ul class="sectlevel2">
<li><a href="#_continuous_calibration_polarity">C.1. Continuous calibration polarity</a></li>
<li><a href="#_usblsb_tpi_swap_status">C.2. USB/LSB TPI swap status</a></li>
</ul>
</li>
<li><a href="#_minimizing_the_use_of_setup_procedures">Appendix D: Minimizing the use of setup procedures</a></li>
<li><a href="#_thread_procedure">Appendix E: Thread procedure</a></li>
<li><a href="#_recorder_tuning">Appendix F: Recorder tuning</a>
<ul class="sectlevel2">
<li><a href="#_mk5c_configfb_config_procedure">F.1. mk5c_config/fb_config procedure</a></li>
<li><a href="#_default_fs_configuration">F.2. Default FS configuration</a>
<ul class="sectlevel3">
<li><a href="#_flexbuff_recorder">F.2.1. FlexBuff recorder</a></li>
<li><a href="#_mark_5c_recorder">F.2.2. Mark 5C recorder</a></li>
</ul>
</li>
<li><a href="#_overriding_the_defaults">F.3. Overriding the defaults</a>
<ul class="sectlevel3">
<li><a href="#_changing_net_protocol">F.3.1. Changing net_protocol</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_alternate_core3h_board_configuration_method">Appendix G: Alternate Core3H board configuration method</a>
<ul class="sectlevel2">
<li><a href="#_configure_core3h_boards">G.1. Configure Core3H boards</a>
<ul class="sectlevel3">
<li><a href="#_the_configuration_details">G.1.1. The configuration details</a></li>
</ul>
</li>
<li><a href="#_sync_time">G.2. Sync time</a></li>
<li><a href="#_start_data_transmission">G.3. Start data transmission</a></li>
<li><a href="#_check_the_mode">G.4. Check the mode</a></li>
</ul>
</li>
<li><a href="#_handling_other_vdif_frame_payload_sizes">Appendix H: Handling other VDIF frame payload sizes</a>
<ul class="sectlevel2">
<li><a href="#_determine_the_other_settings">H.1. Determine the other settings</a></li>
<li><a href="#_update_the_snap_procedures">H.2. Update the SNAP procedures</a></li>
<li><a href="#_command_the_devices">H.3. Command the devices</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document describes FS DBBC3 support in the latest FS version,
<em>10.2</em>. It outlines the features and model for FS operations with the
DBBC3. Some <strong>NOTE</strong>s are included to describe how support in FS
<em>10.1</em> is different. Versions before <em>10.1</em> had minimal support for
DBBC3s and are not covered here.</p>
</div>
<div class="paragraph">
<p>The FS supports the DDC_E, DDC_U, and DDC_V personalities.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In FS <em>10.1</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Support for the DDC_E personality is not available.</p>
</li>
<li>
<p>Support for DDC_V versions other than <em>v124</em> is not available and
even for <em>v24</em> is only correct for very early releases.</p>
</li>
<li>
<p>T<sub>sys</sub> <em>fivpt</em>, and <em>onoff</em> support for polarities other than <code>2</code>
may not be correct.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The appendix <a href="#_configuring_the_fs_for_use_with_a_dbbc3">Configuring the FS for use with a DBBC3</a> gives the
steps for customizing the FS. The appendix
<a href="#_dbbc3_specific_environment_variables">DBBC3 specific environment variables</a> explains the use of those
variables. The appendix <a href="#_verifying_polarity_and_usblsb_tpi_swaps">Verifying polarity and USB/LSB TPI swaps</a>
provides methods for checking those two specific issues.</p>
</div>
<div class="paragraph">
<p>Additional appendices, <a href="#_minimizing_the_use_of_setup_procedures">Minimizing the use of setup procedures</a>,
<a href="#_thread_procedure">Thread procedure</a>, and <a href="#_recorder_tuning">Recorder tuning</a> describe features that
intended primarily for use with the DBBC3, but can be used with other
systems.</p>
</div>
<div class="paragraph">
<p>Support for several items that utilize the multicast data, including
the T<sub>sys</sub> monitor display and multicast data logging, is built on
DBBC3 multicast unpacking software developed by Dave Horsley (Hobart)
using his C <code>struct</code> packing and unpacking code generator
(<a href="https://github.com/dehorsley/packgen" class="bare">https://github.com/dehorsley/packgen</a>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dbbc3_related_commands">2. DBBC3 related commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following SNAP commands support DBBC3s. You can access information
on the details of the commands with <code>help=<em>command</em></code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>bbc<em>nnn</em></code>&#8201;&#8212;&#8201;<code><em>nnn</em></code> from <code>001</code> to <code>128</code>&#8201;&#8212;&#8201;BBC setup and monitoring</p>
</li>
<li>
<p><code>bbc_gain</code>&#8201;&#8212;&#8201;Setup and monitor BBC gains</p>
</li>
<li>
<p><code>cont_cal</code>&#8201;&#8212;&#8201;Setup and monitor continuous calibration configuration</p>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
The syntax of this command is different than the DBBC2
version. Most significantly, the <code><em>samples</em></code> parameter has been moved.
The meanings of the <code><em>frequency</em></code> and <code><em>option</em></code> parameters are
changed somewhat. There are additional parameters for T<sub>sys</sub>
filtering.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For FS <em>10.1</em>, operation was only tested with polarity <code>2</code> and
for early releases of DDC_U and DDC_V firmware. That support was
discovered to be incompatible with some later DDC_V <em>v124</em> releases.
There were also no T<sub>sys</sub> filtering parameters.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>core3h</code>&#8201;&#8212;&#8201;Low-level communication with Core3H boards</p>
</li>
<li>
<p><code>core3h_mode</code>&#8201;&#8212;&#8201;Setup and monitoring of Core3H boards</p>
<div class="paragraph">
<p>This command has an unusually large number of features, which are
described in its help page. You don&#8217;t need to be familiar will all the
features if you only use it as described in the
<a href="#_setting_the_experiment_mode_configuration">Setting the experiment mode configuration</a> section below.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
For the DDC_E and DDC_U personalities, the Core3H board uses
up to two Ethernet outputs per board. The first output is used for the
first eight BBCs; the second, for up to an additional eight. In the
DDC_E personality, only the first eight BBCs are available. For each
output that is active, the number of channels must be a power of two,
from 1 to 16, and all channels must use either only one-bit sampling
or only two-bit sampling. If both outputs are in use for a board, they
must use the same number of channels and bits per channel.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An unusual feature of this command is that instead of having just the
two typical <em>monitor</em> and <em>command</em> forms, it has <em>monitor</em>,
<em>checking</em>, and <em>force</em> forms. The latter is most similar to the
typical command form, but rarely used.</p>
</div>
<details>
<summary class="title">Click here for more details on the command forms</summary>
<div class="content">
<div class="ulist disc">
<ul class="disc">
<li>
<p>Monitor form</p>
<div class="paragraph">
<p>The monitor form is similar to the monitor form for other commands,
which usually have no parameters and show the actual hardware
configuration. That will work for <code>core3h_mode</code>, which will query all
the boards. In addition, you can query a single board by specifying
its number as the first parameter.</p>
</div>
</li>
<li>
<p>Checking form</p>
<div class="paragraph">
<p>The checking mode is an unusual feature of this command. Like a
traditional command form, it is used with parameters to define the
board configuration, but doesn&#8217;t command the board with them. Instead,
it compares them to the board&#8217;s configuration to see if they agree.
Any deviations are reported as errors. The actual configuration is
reported in the same format as the monitor form. This form is used to
check the configuration.</p>
</div>
</li>
<li>
<p>Force form</p>
<div class="paragraph">
<p>The force form is similar to the checking mode, but a literal <code>force</code>
is specified as the sixth parameter. In this case the board is
actually configured. However, this is not recommended for operational
use, except as part of determining the correct setup from a schedule,
as described in the <a href="#_setting_the_boot_configuration_for_the_mode">Setting the boot configuration for the mode</a>
subsection  below. The force form is most similar to the traditional
command form.</p>
</div>
</li>
</ul>
</div>
</div>
</details>
</li>
<li>
<p><code>dbbc3</code>&#8201;&#8212;&#8201;Low-level DBBC3 communication</p>
</li>
<li>
<p><code>fb_mode</code>&#8201;&#8212;&#8201;Setting the FlexBuff recording mode&#8201;&#8212;&#8201;An alias for <code>mk5c_mode</code></p>
</li>
<li>
<p><code>fivept</code>&#8201;&#8212;&#8201;Pointing measurements</p>
</li>
<li>
<p><code>if</code>&#8201;&#8212;&#8201;This command was expanded to have <code><em>condition</em></code>s for
whether each possible DBBC3 BBC and IF is active and whether the DBBC3
firmware is <code>DDC</code>.</p>
<div class="paragraph">
<p>Usage examples can be found in the <code>iread</code>, <code>bread</code>, and <code>caltsys</code>
procedures in the default <em>/usr2/fs/st.default/d3fbstation.prc</em>
procedure library.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In <em>10.1</em>, <code>DDC</code> is not available as a <code><em>condition</em></code> for the
DBBC3 and <code>caltsys</code> is not included.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>if<em>x</em></code>&#8201;&#8212;&#8201;<code><em>x</em></code> from <code>a</code> to <code>h</code>&#8201;&#8212;&#8201;IF CoMo setup and monitoring</p>
</li>
<li>
<p><code>iftp<em>x</em></code>&#8201;&#8212;&#8201;<code><em>x</em></code> from <code>a</code> to <code>h</code>&#8201;&#8212;&#8201;IF CoMo total power monitoring</p>
</li>
<li>
<p><code>mcast_time</code>&#8201;&#8212;&#8201;display of multicast time information</p>
</li>
<li>
<p><code>onoff</code>&#8201;&#8212;&#8201;SEFD and antenna calibration measurements</p>
</li>
<li>
<p><code>setup_proc</code>&#8201;&#8212;&#8201;Conditional execution of setup procedure</p>
<div class="paragraph">
<p>This command does not have a specific DDBC3 aspect to it, but its use
for DBBC3s is important because the setup procedures for DBBC3 racks
are very time consuming and their execution needs to be limited. This
command is added by <em>drudg</em> to <em>.snp</em> files if selected by the
<code>setup_proc</code> option in <em>skedf.ctl</em> control file. Please see the
<a href="#_minimizing_the_use_of_setup_procedures">Minimizing the use of setup procedures</a> appendix for more details.</p>
</div>
</li>
<li>
<p><code>tpi</code>, <code>tpical</code>, <code>tpdiff</code>, <code>tpzero</code>, <code>caltemp</code> and <code>tsys</code>&#8201;&#8212;&#8201;Support
non-continuous calibrations T<sub>sys</sub> measurements.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If FS  <em>10.1</em>, <code>formbbc</code> and <code>formif</code> are not supported as
mnemonics to specify DBBC3 detectors for channels/IFs that are
configured for recording.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>tpicd</code>&#8201;&#8212;&#8201;TPI (multicast) recording control daemon setup</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_fs_dbbc3_channel_and_if_labels">3. FS DBBC3 channel and IF labels</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The DBBC3 channel labels are of the form <code><em>nnns</em></code>, where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><em>nnn</em></code> is the BBC number, <code>000</code>-<code>128</code></p>
</li>
<li>
<p><code><em>s</em></code> is the side-band, <code>l</code> or <code>u</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, <code>032u</code> is BBC 32 upper side-band.</p>
</div>
<div class="paragraph">
<p>The DBBC3 IF labels are of the form <code>i<em>x</em></code>, where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><em>x</em></code> is the IF, <code>a</code>-<code>h</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, <code>id</code> is IF D.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_the_dbbc3">4. Configuring the DBBC3</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section assumes that when the DBBC3 is booted, it is set-up
according to either the &#8220;Setting up the DBBC3 for DDC_E mode&#8221;,
&#8220;Setting up the DBBC3 for DDC_U mode&#8221;, or &#8220;Setting up the DBBC3 for
DDC_V mode&#8221; document, as appropriate.</p>
</div>
<div class="sect2">
<h3 id="_local_configuration_changes">4.1. Local configuration changes</h3>
<div class="paragraph">
<p>This subsection covers changes that may be needed for experiments but
aren&#8217;t conveyed by the schedule file, yet. Some examples are given
below.</p>
</div>
<div class="sect3">
<h4 id="_ethernet_configuration">4.1.1. Ethernet configuration</h4>
<div class="paragraph">
<p>The Ethernet configuration of a Core3H board can be set in the DBBC3 boot
configuration file. It can be changed on demand with a predefined SNAP
procedure with contents such as:</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
If you place non-private IP address or FQDNs in your SNAP
procedures, they will be visible to anyone who can access your log
files, e.g., on a log server. Even if this does not violate your local
IT policies, it should probably be avoided. If possible, use only
private addresses.
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre>core3h=1,tengbcfg eth0 ip=192.168.1.16 gateway=192.168.1.1 nm=27
core3h=1,tengbcfg eth1 ip=192.168.1.17 gateway=192.168.1.1 nm=27
core3h=1,tengbarp eth0 2 00:60:dd:44:47:60
core3h=1,tengbarp eth1 3 00:60:dd:44:47:61
core3h=1,destination 0 192.168.1.2:46220
core3h=1,destination 1 192.168.1.3:46221</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The above example is for one board. Settings for multiple boards
can be combined in one procedure or one procedure can call a separate
sub-procedure for each board.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
A reset and sync is not required for Ethernet configuration
changes.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_changing_thread_numbers">4.1.2. Changing thread numbers</h4>
<div class="paragraph">
<p>The following command changes the thread numbers on Core3H board <code>1</code>
for <em>eth0</em> to <code>3</code> (<code>196608/65536</code>) and <em>eth1</em> to <code>4</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>core3h=1,regupdate vdif_header 3 196608 0x03FF0000</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_setting_the_experiment_mode_configuration">4.2. Setting the experiment mode configuration</h3>
<div class="paragraph">
<p>Setting the experiment mode configuration is broken into two parts:
setting the Core3H board configuration which is covered in
<a href="#_setting_the_core3h_board_configuration">Setting the Core3H board configuration</a> subsection below, and
setting the rest of the configuration, which happens implicitly when
using the <a href="#_checking_the_mode">Checking the mode</a> subsection farther below.</p>
</div>
<div class="sect3">
<h4 id="_setting_the_core3h_board_configuration">4.2.1. Setting the Core3H board configuration</h4>
<div class="paragraph">
<p>Currently, the recommended method for configuring the mode for the
Core3H boards is from the DBBC3 boot configuration. This is because
that is the only safe method for syncing the boards, which is required
for changing Core3H settings that vary with the mode. A consequence is
that only one mode that changes the Core3H mode related settings can
be used per experiment.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
You can change the Ethernet configuration as described above in
the <a href="#_ethernet_configuration">Ethernet configuration</a> subsection above after the boot as long
as you don&#8217;t change any <code>destination</code>s that are set to <code>none</code>
according to the procedure below.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
An alternate method for setting the mode configuration can be
found in the appendix <a href="#_alternate_core3h_board_configuration_method">Alternate Core3H board configuration method</a>,
but at this time it not recommended. Even when it is recommended, it
requires manual steps and takes so long that schedules are still
effectively limited to one mode.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can determine the values for your boot configuration yourself, but
this can be complicated for an arbitrary schedule unless it uses a
well known mode. The method provided in the
<a href="#_setting_the_boot_configuration_for_the_mode">Setting the boot configuration for the mode</a> subsection below can
be used to determine the correct Core3H board boot configuration for
an arbitrary mode from a schedule. It is not entirely automatic, but
will provide the needed information in a fairly straightforward
format.</p>
</div>
<div class="sect4">
<h5 id="_setting_the_boot_configuration_for_the_mode">4.2.1.1. Setting the boot configuration for the mode</h5>
<div class="paragraph">
<p>This subsection assumes your boot configuration sets up the DBBC3
except for the details of the observing mode. The non-Core3H board
mode configuration is handled by the <em>drudg</em> generated setup procedure
outside of the boot configuration, e.g., by use of the method in the
<a href="#_checking_the_mode">Checking the mode</a> subsection below. The following procedure can be
use to set the boot configuration of the Core3H boards for the
schedule mode:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>drudg</em> the schedule to make the <em>.prc</em> (and <em>.snp</em>) file. For this
example, the schedule is <code>r5012</code> for station <code>Kk</code>.</p>
</li>
<li>
<p>Make sure the DBBC3 has the firmware personality and version that
you will use for the observation loaded and that <em>equip.ctl</em> and
<em>dbbc3.ctl</em> agree with what is in the DBBC3.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Although some modes can be observed with either the
DDC_E/DDC_U or DDC_V personalities, the setup is different. The setup
for DDC_E/DDC_U will not work for DDC_V, and vice-versa. This
procedure will give you a personality, and possibly version, specific
setup.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Start the FS</p>
</li>
<li>
<p>Open a <em>new</em> log. You may like to use a log file name related to the
schedule. Just be sure that each time you use this method you are
making a new log file. For example:</p>
<div class="literalblock">
<div class="content">
<pre>log=r5012</pre>
</div>
</div>
</li>
<li>
<p>Open the experiment procedure library. For example:</p>
<div class="literalblock">
<div class="content">
<pre>proc=r5012kk</pre>
</div>
</div>
</li>
<li>
<p>Enable <code>echo</code> output:</p>
<div class="literalblock">
<div class="content">
<pre>echo=on</pre>
</div>
</div>
</li>
<li>
<p>Execute the normal Core3H setup procedure, perhaps <code>core3h01</code>, with the
<code>force</code> parameter. For example:</p>
<div class="literalblock">
<div class="content">
<pre>core3h01=force</pre>
</div>
</div>
<div class="paragraph">
<p>This command will generate an error when it tries to start with data
transmission without the boards being re-synced. This is normal and
benign in the current context (but not generally).</p>
</div>
</li>
<li>
<p>Disable <code>echo</code> output:</p>
<div class="literalblock">
<div class="content">
<pre>echo=off</pre>
</div>
</div>
</li>
<li>
<p>Close the log file by switching back to the default</p>
<div class="literalblock">
<div class="content">
<pre>log=station</pre>
</div>
</div>
</li>
<li>
<p>Extract the needed information with the shell command::</p>
<div class="literalblock">
<div class="content">
<pre>core3h_conf /usr2/log/r5012.log</pre>
</div>
</div>
<div class="paragraph">
<p>The information  will be displayed as a series of lines starting with
the Core3H board number they apply to and a comma. An example of the
output for board <code>1</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>1,vsi_samplerate 128000000 2
1,splitmode on
1,vsi_bitmask 0xcccccccc
1,reset
1,vdif_frame 2 8 8000 ct=off</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
If you did not open a new log before executing the Core3H setup
procedure, you can use the <em>last</em> series of these lines. Be sure you
start from lowest numbered board used in this mode.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Edit the displayed commands (after the comma) into the corresponding
Core3H configuration files.</p>
<div class="paragraph">
<p>The files are usually called <em>ddc_E_core3H_&lt;N&gt;.fila10g</em>,
<em>ddc_U_core3H_&lt;N&gt;.fila10g</em>, and <em>ddc_V_core3H_&lt;N&gt;.fila10g</em>,
depending the personality you are using and how many Core3H boards you
have, <em>&lt;N&gt;</em> running from <code>1</code> to a maximum of <code>8</code>.</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>For <em>only</em> the boards with commands shown in the output:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>In the appropriate file, place the commands in the order shown,
starting just after the <code>inputselect</code> command, deleting any existing
lines with the same commands.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
You may be able to copy-and-paste on the DBBC3 using the builtin
editor and using <em>putty</em> to connect to the FS machine.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<a href="#note">NOTE</a><a id="note"></a>: If you need to change the VDIF payload
size, you can make the change directly in the <code>vdif_frame</code> commands
that you enter, replacing <code>8000</code> with your value. Please also read the
introductory part of the <a href="#_handling_other_vdif_frame_payload_sizes">Handling other VDIF frame payload sizes</a>
appendix for information about the error messages that changing the
payload size will cause. (You will also need to modify the payload
size used by the recorder with an additional <code>jive5ab=VDIF_&#8230;&#8203;</code> , as
described in that same section.)
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Set the <code>destination</code> lines.</p>
<div class="paragraph">
<p>Inspect the <code>core3h01</code> procedure to determine which masks are non-zero
for each board. They appear in the order <code>mask2,mask1</code> in the
<code>core3h_mode</code> command lines. Please be aware that the default (null)
value for <code>mask2</code> is zero; while for <code>mask1</code> it is non-zero. <em>drudg</em>
will insert an explicit zero only for <code>mask1</code>.</p>
</div>
<div class="paragraph">
<p>For a given board, if only <code>mask1</code> has a non-zero value, set the
<code>destination</code> for output <code>1</code> to <code>none</code>. If only <code>mask2</code> has a non-zero
value set the <code>destination</code> for output <code>0</code> to <code>none</code>. For all masks
that have a non-zero mask, make sure the corresponding outputs (<code>0</code>
for <code>mask1</code>, <code>1</code> for <code>mask2</code>) have an <code><em>IP</em>:<em>port</em></code> set for the
<code>destination</code>.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
For DDC_V, you do not have to set <code>destination 1 none</code>. It is
disabled by the firmware regardless of how it is set and the FS
ignores it.
</td>
</tr>
</table>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Use <code>start vdif</code> after the <code>timesync</code> command, removing any <code>stop</code>
command that may be present.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For boards with no commands shown in the output:</p>
<div class="paragraph">
<p>Use <code>stop</code> after the <code>timesync</code> command, removing any <code>start vdif</code>
command that may be present.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Reboot the DBBC3 with this configuration.</p>
</li>
<li>
<p>Verify the configuration of the Core3H boards.</p>
<div class="paragraph">
<p>Using the same procedure library, enter:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>core3h01</pre>
</div>
</div>
<div class="paragraph">
<p>There should be no errors reported. If any errors are reported, use
the error messages to determine what needs to be fixed in your boot
configuration files and try again, repeating until there are no
errors.</p>
</div>
</li>
<li>
<p>Proceed to the <a href="#_checking_the_mode">Checking the mode</a> subsection below. In addition
to checking the configuration of the Core3H boards, it configures the
non-Core3H board settings for the mode.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_checking_the_mode">4.3. Checking the mode</h3>
<div class="paragraph">
<p>Before observing, it is essential to check that the mode has been
configured correctly. This will implicitly set the non-Core3H
board aspects of the observing mode, which is also essential.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The IF target levels need to verified for each observing
mode. Please see <a href="#_if_target_levels">IF target levels</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The setup procedure can be executed (without the <code>force</code> parameter) to
check that the setup is correct. Assuming the schedule procedure
library has already been opened as described in the
<a href="#_setting_the_boot_configuration_for_the_mode">Setting the boot configuration for the mode</a> subsection above (or
<a href="#_configure_core3h_boards">Configure Core3H boards</a> subsection below), then for example use:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>setup01</pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Verify that no errors are reported when it is executed. If
there are errors, the data may not be recorded properly. This is how
the setup is checked within a schedule. This also checks that the
personality and firmware version agree with the FS control files.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
There can be a lot of log output from a setup procedure, which
can make it hard to identify errors. If you use the <code>erchk</code> window,
which only lists errors, it should be easier to identify them. If you
don&#8217;t already have that window setup (it is more generally useful
anyway), directions are include in the
<a href="#_configuring_the_fs_for_use_with_a_dbbc3">Configuring the FS for use with a DBBC3</a> section below.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you only want to check the Core3H configuration, you can use the
corresponding Core3H configuration procedure instead. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>core3h01</pre>
</div>
</div>
<div class="paragraph">
<p>This is not recommended for checking the mode, since it does not
configure the non-Core3H board aspects of the observing mode to verify
that there is no error when commanding them.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_if_target_levels">5. IF target levels</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Due to the very wide input bandpass (4 GHz) of the DBBC3, it is very
important have the correct IF target levels. If they are too high, the
samplers will saturate, which which will result in gain compression
and loss of VLBI sensitivity. The nominal target for 4 GHz BW input
signal is 32000 counts. For a 1 GHz BW input signal around 22000 might
be good. For 0.5 GHZ input BW signal, 10000 may be realistic.</p>
</div>
<div class="paragraph">
<p>If you use continuous calibration, you can check for compression by
adjusting the target level for each IF while watching the
<a href="#_tsys_monitor_display">Tsys monitor display</a> for that IF. Once setup for a mode, reduce
the target level for that IF from 32000 until the BBC T<sub>sys</sub> values
reach a reasonable minimum. If you use <em>legacy</em> (noncontinuous)
calibration, you can do the same, but you will need to use the
<code>caltsys</code> procedure to check T<sub>sys</sub>. The <code>onoff</code> command can also be
useful for this, adjusting to get the <code>Comp</code> (compression) value close
to unity. You can also use a noise source to measure the change in TPI
levels, with the gains locked, at different operating levels and find
the highest value before it becomes non-linear. All of these methods
rely on avoiding gain compression for the TPI counts. It is expected
that eliminating compression for them will do the same for the VLBI
data.</p>
</div>
<div class="paragraph">
<p>If you find you need to set target levels other than <code>32000</code> and there
are values that will work for all your bands and modes per IF, you can
set them for <em>drudg</em> using the <code>dbbc_if_target</code> option in <em>skedf.ctl</em>.
See <em>st.default/control/skedf.ctl</em>
(<a href="https://github.com/nvi-inc/fs/blob/main/st.default/control/skedf.ctl" class="bare">https://github.com/nvi-inc/fs/blob/main/st.default/control/skedf.ctl</a>)
for more information. If you cannot use the same targets for each
mode, you will need to modify the IF setup procedures provided by
<em>drudg</em> for some cases. We are hoping to have a feature in a future
release that will better automate this. If you need such a feature,
please contact Ed to explain what is needed for your case.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_multicast_time_outs">6. Multicast time-outs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The DBBC3 provides multicast packets, nominally, every second. They
provides a wealth of data including for amplitude calibration. A
subset of the data is logged, as described in the
<a href="#_multicast_logging">Multicast logging</a> section below. Sometimes no data may be received
for one or more seconds. The FS reports each missing packet as
a multicast <em>time-out</em>.</p>
</div>
<div class="paragraph">
<p>Generally speaking, the <code>Time</code> value in the T<sub>sys</sub> monitor display
will be shown in inverse video for each time-out (but it can be
inverse for other reasons as well). Except when <code>data_valid</code> is <code>off</code>
(see below), the FS will report an error for the first time-out that
occurs after there have been none in the last 60 read attempts. After
the initial report, it will give a summary error report of the
time-outs in batches of 60 attempts, ending with a report of no
time-outs for 60 attempts, when that occurs.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In FS <em>10.1</em>, each time-out is reported individually, i.e.,
there is no summary.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When <code>data_valid</code> is <code>off</code>, the FS will only report a time-out if it
does not appear to be associated with DBBC3 command usage.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
We believe that there will be no &#8220;extra&#8221; reports caused by
DBBC3 commands when <code>data_valid</code> is <code>off</code>. However, we cannot be sure
every case has been caught. There is some chance that there will be
extra reports one to three seconds after the most recent DBBC3
communication. Please contact Ed about this if you encounter it. It is
easier to fix if you have a, even if only intermittently, repeatable
example.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When <code>data_valid</code> is <code>on</code>, i.e., during recording or eVLBI, the FS
will report any loss of multicast messages, even if DBBC3 commands
were used.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
You should avoid use of DBBC3 commands when <code>data_valid</code> is
<code>on</code>, i.e., during a scan, since they may cause loss of calibration
data.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There seems to be three primary causes of time-outs:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The DBBC3 is busy&#8201;&#8212;&#8201;Some DBBC3 commands, particularly those
associated with the Core3H boards, appear to inhibit the generation of
multicast when they are being processed. These are not reported as an
error when <code>data_valid</code> is <code>off</code> because they are expected and of
limited consequence. They are reported when <code>data_valid</code> is <code>on</code> since
they cause loss of calibration data.</p>
</li>
<li>
<p>Network traffic conflicts&#8201;&#8212;&#8201;How this affects the multicast is not
clear. If there is significant other traffic on the network, there may
be <em>collisions</em> that cause packets to be dropped.</p>
</li>
<li>
<p>Overrun of the 1 PPS&#8201;&#8212;&#8201;It appears that the generation of the
multicast is triggered by the 1 PPS. If the generation takes so long
that it overruns the next 1 PPS, making the packet <em>late</em>. That
appears to inhibit the generation of the packet for the next second.
Whether or not this happens seems to depend on the number of Core3H
boards, the firmware version, the DBBC3 CPU speed. There seem to be
three regimes for this:</p>
<div class="openblock">
<div class="content">
<div class="ulist disc">
<ul class="disc">
<li>
<p>No overruns&#8201;&#8212;&#8201;This is the typical case.</p>
</li>
<li>
<p>Intermittent overruns&#8201;&#8212;&#8201;This may happen if the packet generation
usually finishes close to but before the next 1 PPS. There seems to be
a variable delay of up to about an additional 0.25 seconds that can
cause packets to be late.</p>
</li>
<li>
<p>Consistent overruns&#8201;&#8212;&#8201;This occurs when the packet generation always
overruns at least the next 1 PPS. This will cause a time-out every
other read attempt if just the next 1 PPS is overrun consistently.
For example, this is known to happen for <code>DDC_U</code> <em>v126</em> with eight
Core3H boards, for at least some CPUs/clock-speeds.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Usually, log entries for late packets will have a timestamp
centiseconds (0.01 seconds) of <code>19</code> or less.</p>
</div>
<div class="paragraph">
<p>The late arrival time will also be visible in the <code>Arrival</code> time of
<em>monit7</em> and in the last field,<code><em>hsecs</em></code> (centiseconds), of the
<code>mcast_time/0</code> output, if you happen to catch them for the late
packet. For <em>monit7</em>, late arrival times are shown in inverse video.
For consistent overruns, the arrival times may, or may not, be before
the late arrival limit used by <em>monit7</em>.</p>
</div>
<div class="paragraph">
<p>When a late packet occurs, an inverse video <code>Time</code> value will occur
before the time-out. This happens because when the packet arrives
late, data from the previous packet has already been displayed again
with the time unchanged (inverse because it did not advance). In the
update for the <em>next</em> second, the data from the late packet is
displayed (along with the late arrival time, which is inverse video).
The <code>Time</code> value will not be inverse video because the late packet,
usually, has a different time.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The limit <em>monit7</em> uses for late arrival times can be adjusted
with the <code>-l</code> command line option.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In FS <em>10.1</em>, arrival times are not shown in the <em>monit7</em> window
and there was no <code>-l</code> option.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_firmware_version_checking">7. Firmware version checking</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The FS checks that the DBBC3 firmware being used agrees with what is
in the FS control files, <em>equip.ctl</em> and <em>dbbc3.ctl</em>. The personality,
DDC_E, DDC_U, or DDC_V, is checked first. If the personality agrees,
the version for that personality is then checked. If there is a
mismatch, the discrepancy is reported along with the string received
from DBBC3.</p>
</div>
<div class="paragraph">
<p>If one of these errors is detected, you should either load the correct
firmware/version into the DBBC3 and/or correct the FS control files.
What is appropriate depends on what you are trying to do. Ignoring, or
masking off the display of, the errors is not recommended.</p>
</div>
<div class="paragraph">
<p>The checks are made in two different situations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Multicast data</p>
<div class="paragraph">
<p>The version information is checked for each multicast reception. (If
there is no multicast being received, these errors will not be
reported this way.) The minimum reporting interval is one minute, but
can be increased up to 10 minutes with the environment variable
<code>FS_DBBC3_MULTICAST_VERSION_ERROR_MINUTES</code>. Please see the
<a href="#_other_options">Other options</a> section of the
<a href="#_dbbc3_specific_environment_variables">DBBC3 specific environment variables</a> appendix below for the
details.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In FS <em>10.1</em>, the interval for reporting version errors detected
with the multicast data is 20 seconds and cannot be adjusted.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If for some reason you wish to ignore this very persistent error
information, you can use the <code>tnx</code> to suppress it from being
displayed. It will still be logged, As an example, if you are getting
the errors <code>dn  -30</code> and <code>dn  -37</code> you can stop them from being
displayed with:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>tnx=dn,-30
tnx=dn,-37</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Suppressing the display of this error information will <em>not</em>
prevent possible loss of data and/or other error messages if the
firmware/version in the FS control files doesn&#8217;t agree with what is
loaded in the DBBC3.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Use of the <code>core3h_mode</code> command</p>
<div class="paragraph">
<p>The <code>core3h_mode</code> command checks the version in the two cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For <code>core3h_mode=end</code> commands, with or without the <code>force</code>
parameter being used.</p>
<div class="paragraph">
<p>This command is the last command executed by <em>drudg</em> generated Core3H
setup procedures. A firmware/version error will be nearly, in some
cases actually, the last error shown. That should help make it easier
to identify.</p>
</div>
</li>
<li>
<p>A <code>core3h=<em>n</em>,&#8230;&#8203;,force</code> command.</p>
<div class="paragraph">
<p>An error is reported for these commands in case one of them is used by
itself. This also maintains the historical precedent of checking the
version whenever the formatter is configured.</p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_control_files">8. Control files</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_equip_ctl">8.1. equip.ctl</h3>
<div class="paragraph">
<p>For DBBC3 use, the rack type in <em>equip.ctl</em> should be <code>dbbc3_ddc_e</code>
<code>dbbc3_ddc_u</code>, or <code>dbbc3_ddc_v</code> depending on the firmware that is
loaded.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For FS <em>10.1</em>, <code>dbbc3_ddc_e</code> is not supported.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_dbbc3_ctl">8.2. dbbc3.ctl</h3>
<div class="paragraph">
<p>The DBBC3 specific control file parameters are in the <em>dbbc3.ctl</em>
control file. An example of the contents is:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In FS <em>10.1</em>, the second non-comment (and its associated
preceding comment) line below, for the DDC_E firmware version, is not
present.
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre>* Two fields: BBCs/IF (8, 12, 16 or nominal (U:16,EV:8)), IFs (1-8)
  nominal 8
* DDC_E firmware version (v121 or later, but DDC_E starts at v126)
  v126
* DDC_U firmware version (v121 or later, but DDC_U starts at v125)
  v125
* DDC_V firmware version (v121 or later, but DDC_V starts at v124)
  v124
* mcast delay 0-99 centiseconds
  57
* setcl board
  1
* DBBC3 clock rate, &gt;= 0, but DDC only supports 128
  128</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The use of <code>nominal</code> for BBCs/IF is recommended.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_dbbad_ctl">8.3. dbbad.ctl</h3>
<div class="paragraph">
<p>The <em>dbbad.ctl</em> file was expanded for use with DBBC3s. For the DBBC3
it can now include the multicast address, port, and the interface. If
the last three parameters are omitted, receiving multicast data is
disabled. If there are only comments in the file or the file is empty,
use of a DBBC3 will be disabled. An example of the contents (commented
out) is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>*dbbad.ctl example file
* one uncommented line with up to six fields:
*    host(IP address or name)
*    port(4000)
*    time-out(centiseconds)
*    multicast address
*    multicast port
*    multicast interface
* If there are no uncommented lines, DBBC(2)/DBBC3 access is disabled.
* For DBBC(2), the first three fields are required and no more can be used.
* For DBBC3, there must be either the first three fields or all six. If the
*    final three are missing, multicast reception is disabled.
* Using an IP address instead of a name avoids name server problems.
* DBBC2 example:
*  192.168.1.2 4000 500
* DBBC3 example:
*  192.168.1.2 4000 800 224.0.0.19 25000 eno2</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_skedf_ctl">8.4. skedf.ctl</h3>
<div class="paragraph">
<p>The <em>skedf.ctl</em> file now includes new options and expansion of some
options for DBBC3 support. The are listed in the <a href="#_drudg_support">drudg support</a>
section below. More discussion of the two new DBBC3 related options
can be found in the <a href="#_minimizing_the_use_of_setup_procedures">Minimizing the use of setup procedures</a> and the
<a href="#_thread_procedure">Thread procedure</a> appendices below. The details of the syntax for
all the options is available in the
<em>/usr2/fs/st.defaul/control/skedf.ctl</em> example file.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tsys_monitor_display">9. Tsys monitor display</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The T<sub>sys</sub> monitor display (<em>monit7</em>) is organized per IF and updates
at a 1 Hz rate. The displayed information includes: LO, time,
multicast arrival time, time difference between DBBC3 and the FS, PPS
delay, T<sub>sys</sub> and polarization for each IF/Core3H board as well as BBC
frequencies and T<sub>sys</sub> values. By default the display will cycle
through the appropriate IFs, dwelling for two seconds on each. It is
designed to provide useful information without operator intervention.
The operator can adjust the display as desired using the features
described in the <a href="#_commands">Commands</a> subsection below.</p>
</div>
<div class="paragraph">
<p><em>monit7</em> has three command line options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-h</code>&#8201;&#8212;&#8201;print command line option help output</p>
</li>
<li>
<p><code>-l <em>n</em></code>&#8201;&#8212;&#8201;change the <em>late</em> arrival time limit from <code>20</code> to <code><em>n</em></code>
centiseconds. The range is <code>0</code>-<code>100</code>, <code>0</code> disables late arrival
processing, <code>100</code> marks all packets as late. Arrival times <em>less</em> than
the limit are considered late. The interpretation of arrival times is
discussed in the section <a href="#_multicast_time_outs">Multicast time-outs</a> above under
&#8220;Intermittent overruns.&#8221;</p>
</li>
<li>
<p><code>-r</code>&#8201;&#8212;&#8201;reverse the foreground colors (swapping white and black)
for cyan, green, yellow, red, and blue backgrounds.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If there is an error when the options are parsed, an explanatory
message is printed, then the program pauses for 10 seconds before
terminating. This gives the user a chance to see the message if the
window it is in closes automatically when the program ends.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In FS <em>10.1</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The polarization and the multicast arrival time are not shown. In
place of the arrival time, the VDIF epoch is shown as <code>--</code>. The epoch
was expected to be available but has not been included in the
multicast yet.</p>
</li>
<li>
<p>For DDC_V firmware versions after <em>v124</em>, <code>Time</code> is incorrectly
shown as <code>00:00:01</code> on the first day of the current VDIF epoch and
<code>DBBC3-FS</code> is shown as dollar signs (too big to fit). Normally for
DDC_V firmware no time would be available. There was a
misunderstanding about whether it would be included for these later
versions.</p>
</li>
<li>
<p>There were no command line options for <em>monit7</em>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Except for <code>Time</code>, the DBBC3 based data are from the previous second&#8217;s
multicast. (Hence for continuous calibration, the T<sub>sys</sub> values are
from two seconds in the past.) For DDC_V firmware, time is not
available in the multicast so the message arrival second is used
instead.</p>
</div>
<div class="paragraph">
<p>If the system is operating normally, <code>Time</code> shows a value one second
more than for the previous second&#8217;s multicast to avoid confusion with
times displayed in other windows. (Logged values of the time are the
raw received values.) This leads to the somewhat odd situation that
for a Core3H board that is not synced, with non-DDC_V firmware, its
<code>Time</code> value will be shown as <code>00:00:01</code> on the first day of the
current VDIF epoch.</p>
</div>
<div class="paragraph">
<p>The <code>Time</code> value is shown with inverse video if it is not changing,
i.e., it is not advancing. Typically, this happens for multicast
time-outs, but may also occur for non-DDC_V firmware for other
reasons. An example of the latter is if one or more of the Core3H
boards is not synced. When the time is inverse video due to a lost (or
<em>late</em>, see below) message, the data displayed will be from the last
received message, i.e., it will be stale.</p>
</div>
<div class="paragraph">
<p>The <code>DBBC3-FS</code> time difference, in seconds (positive if the DBBC3 time
is later than the FS), is shown in inverse video if it is not zero.
For DDC_V firmware, <code>DBBC3-FS</code> is shown as <code>------</code>.</p>
</div>
<div class="paragraph">
<p>The <code>Arrival</code> value is the centiseconds (the 0.01 seconds) of the
arrival time of the multicast message. Generally values of <code>20</code>-<code>99</code>
indicate that the message arrived on-time in the second it is for.
Values of <code>0</code>-<code>19</code> generally indicate that the message arrived <em>late</em>,
i.e., are from the previous second, and are shown in inverse video. If
the multicast was late, the <code>Time</code> and the <code>DBBC3-FS</code> values are
increased by one to compensate. The limit in <em>monit7</em> for when an
arrival time is considered late can be adjusted with the <code>-l</code> command
line option.</p>
</div>
<div class="paragraph">
<p>If a message is late in arriving, the time will be shown in inverse
because there is no new data available when the display is updated.
The late message inhibits the DBBC3&#8217;s next multicast causing it to be
lost. The late message will be displayed in its place. That will
display a new <code>Time</code> value, removing the inverse video. In this case,
as well as for a message that is simply missing, <code>Time</code> will be
inverse for one cycle. Unlike for a simply missing message, it will be
inverse before the loss of the message is detected.</p>
</div>
<div class="paragraph">
<p>If the LO and its polarization are defined for the displayed IF, the
polarization will be shown as <code>(L)</code> or <code>(R)</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>(L)</code> or <code>(R)</code> are displayed regardless of what polarization
pair is in use: Left/Right, Horizontal/Vertical, or X/Y.  Following
the usual alphabetical order convention within a pair: <code>LR</code>, <code>HV</code>, and
<code>XY</code>, you can assume: <code>L</code>=<code>H</code>=<code>X</code> and <code>R</code>=<code>V</code>=<code>Y</code>. Until the FS is
updated to recognize pairs other than Left/Right, you need to know
which pair is active to interpret what is shown.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In FS <em>10.1</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The polarization is not shown.</p>
</li>
<li>
<p>The late packet arrival processing and <em>monit7</em> command line switch
<code>-l</code> are not included.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_modes">9.1. Modes</h3>
<div class="paragraph">
<p>The T<sub>sys</sub> monitor display has three modes that affect how T<sub>sys</sub> data
is displayed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Rec</code> shows IFs with channels configured for recording</p>
<div class="paragraph">
<p>Only BBC T<sub>sys</sub> fields for channels being recorded are populated.
This is intended for normal observing.</p>
</div>
</li>
<li>
<p><code>Def</code> shows IFs with defined LO values</p>
<div class="paragraph">
<p>All BBC T<sub>sys</sub> fields on defined IFs are populated. This may be useful
for pointing or calibration runs.</p>
</div>
</li>
<li>
<p><code>All</code> shows all IFs</p>
<div class="paragraph">
<p>If no IFs are defined and no channels are being recorded (e.g., at FS
startup), T<sub>sys</sub> fields for all side-bands are blank.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, if any channels are configured for recording (selected by
the bit masks in the <code>core3h_mode</code> commands), the display will go into
the <code>Rec</code> mode. If there are no channels being recorded, but there are
LOs defined for some IFs, it will go into the <code>Def</code> mode. If neither
the <code>Rec</code> nor <code>Def</code> mode is triggered, it will go into the <code>All</code> mode
and automatically change to one of other modes as appropriate. It is
also possible to change to the <code>All</code> mode from <code>Rec</code> or <code>Def</code> with a
single character (<code>l</code>) command. Another <code>l</code> will toggle the display
back to the appropriate non-<code>All</code> mode. The current mode is displayed
in the upper right hand corner.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
During the transition of configuring the Core3H board between
<code>core3h_mode=begin</code> and <code>core3h_mode=end</code>, which channels are being
recorded is not fully defined. The T<sub>sys</sub> display will show the most
recently selected channels (new or old) to avoid having the values
disappear momentarily if the old configuration is re-commanded.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_tsys_values">9.2. Tsys values</h3>
<div class="paragraph">
<p>There are two regimes, described below: <a href="#_continuous_calibration">Continuous calibration</a> and
<a href="#_legacy_noncontinuous_calibration">Legacy (noncontinuous) calibration</a>.</p>
</div>
<div class="sect3">
<h4 id="_continuous_calibration">9.2.1. Continuous calibration</h4>
<div class="paragraph">
<p>For all displayed (non-blank) BBC T<sub>sys</sub> fields, the values will be
shown if they can be calculated. If they can&#8217;t be, a hint, in inverse
video, for the cause of the problem will be displayed in the
corresponding field instead. There may be more than one issue, but
only the first encountered is reported. The order is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>N bbc</code>&#8201;&#8212;&#8201;the BBC is not configured</p>
</li>
<li>
<p><code>N lo </code>&#8201;&#8212;&#8201;the LO is not defined</p>
</li>
<li>
<p><code>Ntcal</code>&#8201;&#8212;&#8201;no T<sub>cal</sub> value was found</p>
</li>
<li>
<p><code>N cal</code>&#8201;&#8212;&#8201;continuous calibration not enabled (and a legacy
measurement has not been made yet)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Finite values outside of the range, <code>-999.</code> to <code>999.9</code>, which won&#8217;t
fit in the available field width, are displayed as dollar signs,
<code>$$$$$</code>.</p>
</div>
<div class="paragraph">
<p>The T<sub>sys</sub> values are calculated using the averaging and filtering
methods described in <code><strong>help=cont_cal</strong></code>. Negative (including
out-of-range) values as shown in inverse video, unless colorization
for filtering overrides that (see below). Invalid and out-of-range
data are always shown whenever they occur.</p>
</div>
<div class="paragraph">
<p>Invalid data is shown with a cyan background. The cases are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the BBC &#8220;on&#8221; and/or &#8220;off&#8221; TPI values overflow (<code>65536</code>),
<code>ovrfl</code> is shown.</p>
</li>
<li>
<p>If the &#8220;on&#8221; and &#8220;off&#8221; TPI values are zero, <code>tpi=0</code> is shown.</p>
</li>
<li>
<p>If the &#8220;off&#8221; TPI value is zero, <code>off=0</code> is shown.</p>
</li>
<li>
<p>If the &#8220;on&#8221; TPI value is zero, <code>&#160;on=0</code> is shown.</p>
</li>
<li>
<p>If the &#8220;on&#8221; and &#8220;off&#8221; TPI values are equal (and not zero),
<code>&#160;inf&#160;</code> is shown.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If filtering is in use, there is a green background when 1-2 values
have been rejected, or <em>clipped</em>, in a row; yellow, 3-5; red; 6 or
more. Once in the red clipping zone, you may also see the background
transition to blue for one cycle to show there has been auto-reset
(see <code><strong>help=cont_cal</strong></code> for information on auto-reset). Invalid results
(infinity, overflow, and the &#8220;off&#8221; and/or &#8220;on&#8221; values being zero)
and out-of-range positive and negative values are still displayed as
such and are not included in the clipped count.</p>
</div>
<div class="paragraph">
<p>For certain reverse video terminals, for example with the normal FS
<code>black</code>/<code>linen</code> settings for foreground/background, the white and back
foreground colors are swapped when the background is cyan, green,
yellow. red, and blue. To get the intended foreground colors, you can
use the <code>-r</code> command line switch with <em>monit7</em>. Unfortunately, it is
not possible for <em>monit7</em> to detect the need for this automatically.
If colors are not available for the terminal, inverse video is used
instead.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In FS <em>10.1</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Nccal</code> is used in place of <code>N cal</code> and only applied to
continuous calibration.</p>
</li>
<li>
<p>Averaging and filtering are not available.</p>
</li>
<li>
<p>All invalid values (negative, infinity, overflow) are displayed as
dollar signs.</p>
</li>
<li>
<p>&#8220;off&#8221; and/or &#8220;on&#8221; TPI values being zero are not identified as
invalid.</p>
</li>
<li>
<p>The <em>monit7</em> command line switch <code>-r</code> is not available.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_diagnosing_problems">9.2.1.1. Diagnosing problems</h5>
<div class="paragraph">
<p>With the way T<sub>sys</sub> data is displayed, certain problems can be readily
identified as the values update:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All, or most, values are negative&#8201;&#8212;&#8201;the calibration polarity is
incorrect</p>
</li>
<li>
<p>All, or most, values are very large positive or negative values,
including dollar signs, perhaps with some <code>&#160;inf&#160;</code> mixed in&#8201;&#8212;&#8201;the diode is not firing. You may also see some clipping and
auto-resets if you are using filtering and have significant RFI.</p>
</li>
<li>
<p>Some fields have <code>overfl</code>&#8201;&#8212;&#8201;the gain is set too high for those BBCs</p>
</li>
<li>
<p><code>off=0</code> is seen&#8201;&#8212;&#8201;the FS has continuous calibration set to &#8220;on&#8221;,
but the DBBC3 has it &#8220;off&#8221; (legacy).</p>
</li>
<li>
<p><code>&#160;on=0</code> is seen&#8201;&#8212;&#8201;the FS has continuous calibration set to
&#8220;on&#8221;, but the DBBC3 has it &#8220;off&#8221; and the DBBC3 has polarity <code>2</code>.</p>
</li>
<li>
<p><code>tpi=0</code> is seen&#8201;&#8212;&#8201;This may appear in some situations when the
DBBC3 firmware is being reloaded.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Turning off averaging (setting the <code><em>samples</em></code> parameter of <code>cont_cal</code>
to <code>0</code>), can be useful for troubleshooting. You will see the T<sub>sys</sub>
values calculated sample-by-sample with no averaging or filtering.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In FS <em>10.1</em>, the error conditions that are identified are all
shown as dollar signs and thus cannot be distinguished. The most
likely problems in that case are the polarity being wrong or the noise
diode not firing. The T<sub>sys</sub> values being unrealistically low could be
a symptom of the FS having continuous calibration &#8220;on&#8221;, but the
DBBC3 having it &#8220;off&#8221;. Examining the raw count data, either with the
<code>BBC<em>nnn</em></code> commands, or from logged multicast data, can help
identify the problem.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_legacy_noncontinuous_calibration">9.2.2. Legacy (noncontinuous) calibration</h4>
<div class="paragraph">
<p><em>Legacy</em> calibration refers to explicitly turning the noise diode on
and off to make calibration measurements. Incorrect values (negative,
infinity, and overflow) and for BBCs or LOs not configured are
displayed as dollar signs, <code>$</code>. If the T<sub>cal</sub> is not defined, <code>Ntcal</code>
is shown in inverse video. If no measurement has been made yet,
<code>N&#160;cal</code> is shown in inverse video.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When legacy calibration is set (<code>cont_cal=off,&#8230;&#8203;</code>), the
polarity is forced to <code>0</code> to make sure the TPI data will populate the
expected fields in DBBC3 command responses and multicast data. A
warning is issued if this is different than the user requested
polarity.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In FS <em>10.1</em>, information for legacy calibration T<sub>sys</sub> is not
displayed in <em>monit7</em> and the polarity is not forced to <code>0</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_commands">9.3. Commands</h3>
<div class="paragraph">
<p>The T<sub>sys</sub> display accepts several one character commands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><strong>a</strong></code>-<code><strong>h</strong></code>&#8201;&#8212;&#8201;show only that IF, up to the maximum defined in <em>dbbc3.ctl</em></p>
<div class="paragraph">
<p>This might be useful, for example, when troubleshooting a single IF.</p>
</div>
</li>
<li>
<p><code><strong>n</strong></code>&#8201;&#8212;&#8201;next IF, wrapping at the end. Single IF display is entered if not previously selected.</p>
</li>
<li>
<p><code><strong>p</strong></code>&#8201;&#8212;&#8201;previous IF, wrapping at the end. Single IF display is entered if not previously selected.</p>
</li>
<li>
<p><code><strong>1</strong></code>-<code><strong>9</strong></code>&#8201;&#8212;&#8201;seconds of display time for each IF (default is 2)</p>
</li>
<li>
<p><code><strong>i</strong></code>&#8201;&#8212;&#8201;toggle display of IF or RF frequency for BBCs (default is RF if the LO is defined; IF, if not)</p>
<div class="paragraph">
<p>If no LO is defined for an IF, it will not be possible to display the
RF frequencies for the corresponding BBCs.</p>
</div>
</li>
<li>
<p><code><strong>l</strong></code>&#8201;&#8212;&#8201;toggle between <code>All</code> and <code>Rec</code><strong>/</strong><code>Def</code> modes (see the <a href="#_modes">Modes</a> subsection above for defaults)</p>
</li>
<li>
<p><code><strong>0</strong></code>&#8201;&#8212;&#8201;reset to all defaults</p>
</li>
<li>
<p><code><strong>?</strong></code> or <code><strong>/</strong></code>&#8201;&#8212;&#8201;show help summary</p>
</li>
<li>
<p><span class="keyseq"><kbd>Ctrl</kbd>+<kbd>c</kbd></span>&#8201;&#8212;&#8201;exit</p>
</li>
<li>
<p>Any other key (e.g., <kbd>space</kbd>)&#8201;&#8212;&#8201;resume cycling</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In FS <em>10.1</em>:</p>
</div>
<div class="ulist disc">
<ul class="disc">
<li>
<p><kbd>Esc</kbd> can also be used to exit. Some key combinations, e.g.,
<span class="keyseq"><kbd>Ctrl</kbd>+<kbd>Alt</kbd>+<kbd>&downarrow;</kbd></span> generate escape sequences. Thus, if they
are used while <em>monit7</em> has the focus, they will probably cause it to
exit.</p>
</li>
<li>
<p>If one IF is manually selected before the IF and BBC configuration
was defined (or at startup of the display window before any IF had
been displayed), it is not be possible to toggle between display
modes until cycling has been restarted.</p>
</li>
<li>
<p>In some cases, no longer active BBC T<sub>sys</sub> fields are not cleared.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_checking_dbbc3_time">10. Checking DBBC3 time</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>mcast_time</code> command should be placed in the local <code>midob</code>
procedure to monitor the time in the DBBC3 for each scan. An error
will be reported if the multicast data is more than 20 seconds old.
For DDC_V firmware, <code>mcast_time</code>, cannot report the time, but will
still report the <code>pps_delay</code>. For non-DDC_V firmware, an error will be
reported if any Core3H board&#8217;s time differs from the FS time.</p>
</div>
<div class="paragraph">
<p>For DDC_V firmware, the <code>dbbc3=time</code> command can be used. However, the
output can be difficult to interpret because the boards may be sampled
in different seconds.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
We expect that future firmware versions, possibly beginning with
<em>v130</em>, will report the VDIF epoch in the multicast. In that case,
<code>mcast_time</code> will report if there is a VDIF epoch mismatch between the
boards. Other checks may also be added in the future.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setting_fs_time">11. Setting FS time</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is expected that normally the FS computer will be using NTP and the
FS time model will be set to <code>computer</code> (see <em>/usr2/fs/misc/ntp.txt</em>
for more information). If good NTP servers are available, that should
give the best time in the FS. The <em>setcl</em> program should not be used
with DBBC3 and NTP. The best way to monitor DBBC3 time is with the
<code>mcast_time</code> command, which should at least be placed in <code>midob</code> and
can of course be used manually as well.</p>
</div>
<div class="paragraph">
<p>No suitable NTP servers may be available either because network
connectivity is poor and/or there are no local functioning NTP
servers. In that case the FS program <em>setcl</em> can be used with
non-DDC_V versions to set and adjust FS time (see <em>misc/fstime.txt</em>
for the general information).</p>
</div>
<div class="paragraph">
<p>The implementation of <em>setcl</em> for the DBBC3 depends on two values from the
<em>dbbc3.ctl</em> control file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The delay of the multicast</p>
<div class="paragraph">
<p>This is the delay for when the multicast arrives after the 1 PPS. It
seems to be fairly stable for a given configuration. It does vary with
the number of Core3H boards installed, the firmware loaded, and the
DBBC3 CPU speed.</p>
</div>
<div class="paragraph">
<p>The value in <em>dbbc3.ctl</em> can be adjusted as appropriate. It should be
easy to measure it for a given system when NTP <em>is</em> available, using
the output of the <code>mcast_time</code> command. The system will need to be
synced to NTP and the <code>computer</code> model selected in <em>time.ctl</em>. In this
case, the last parameter, <code><em>hsecs</em></code> (centiseconds), on the
<code>mcast_time/0</code> output is the value to put in the file; it may vary at
the few centisecond level. (If <em>setcl</em> it being used, it will probably
work to subtract the last value on the <code>#setcl#model/old</code> from
<code><em>hsecs</em></code> before putting it in the file.) You can also get the value
from the timestamps of logged multicast data or the <code>Arrival</code> value of
the T<sub>sys</sub> monitor display (<em>monit7</em>).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
You will not be able to get a suitable value for the delay if the
multicast packet generation is overrunning the next 1 PPS as described
in the <a href="#_multicast_time_outs">Multicast time-outs</a> section above. If setting the FS time
is needed in such a case, please contact Ed, a patch can be provided.
If you only get multicast time-outs rarely, you probably don&#8217;t have
this problem.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In FS <em>10.1</em>, the <code>Arrival</code> value is not available in <em>monit7</em>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The board number to use for measuring the time.</p>
<div class="paragraph">
<p>There can be up to eight to choose from. Board <code>1</code> will be in all systems and
should be adequate for the purpose, but which board is used can be changed in
the control file if need be.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<em>setcl</em> will only be able to get a useful time from the selected
board if it is synced. <em>setcl</em> detects a lack of sync when the Core3H
board&#8217;s time in the multicast is <code>00:00:00</code> or <code>00:00:01</code> on the first
day of the current VDIF epoch. As a result, twice a year for about two
seconds each, <em>setcl</em> can incorrectly think the board is not synced.
Each run of <em>setcl</em> tries to get the time for up to four attempts,
each for a different second, so even if the first two tries
incorrectly show the board as unsynced, a subsequent attempt should be
okay. A lack of sync will also be shown as <code>unsynced</code> in the
<code>core3h_mode</code> command monitor output.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using <em>setcl</em> to set the FS time this way will only be useful to level
of stability of the delay of the multicast. Network congestion may
also cause variations, but hopefully will be minimal in situations
where this method is needed.</p>
</div>
<div class="paragraph">
<p>Even if there are significant variations, even a significant fraction
of a second (which seems unlikely), in the arrival of the multicast,
the clock model determined should be useful. Individual offset
measurements should be fairly accurate. If the clock model is
determined over a significant amount of time, a day or more, the
fractional error in the model rate should be small. The use of
<code>adjust</code> option of <em>setcl</em> in each <code>midob</code> should keep the FS close to
the correct time. In any event, it should be good enough to run a
schedule. It should be better than any other approach without NTP.
Since the DBBC3 will be running on the correct time, small errors in
the FS time should not cause problems unless the scans are very short.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_multicast_logging">12. Multicast logging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Logging of DBBC3 multicast recording is controlled by the <code>tpicd</code>
command. It will automatically be enabled by <em>drudg</em> generated setup
procedures. When logging is enabled, for each multicast message
received (nominal 1 Hz rate), the following information, shown with
their log entry labels, is logged:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The arrival time of the message&#8201;&#8212;&#8201;represented by the time-tag of
the log entry with centisecond precision</p>
<div class="paragraph">
<p>The fractional seconds should agree with the last value, <code><em>hsecs</em></code>
(centiseconds), on the <code>mcast_time/0</code> line with small variations at
the centisecond level.</p>
</div>
</li>
<li>
<p><code>time</code>&#8201;&#8212;&#8201;for each Core3H board in the system</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In FS version <em>10.1</em> for DDC_V firmware versions after v124, the
time is incorrectly logged as <code>00:00:01</code> on the first day of the
current VDIF epoch, except for board <code>5</code> for which the arrival time of
the message will be logged. Normally for DDC_V firmware no time would
be available. There was a misunderstanding about whether it would be
included for these later versions.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>pps2dot</code>&#8201;&#8212;&#8201;(<code>pps_delay</code>) in nanoseconds for each Core3H board</p>
</li>
<li>
<p><code>tpcont</code> &#8201;&#8212;&#8201;only if continuous calibration <em>is</em> in use&#8201;&#8212;&#8201;TPI counts for each BBC and IF configured for recording</p>
<div class="paragraph">
<p>The counts are given in the order of diode <em>on</em> then <em>off</em></p>
</div>
</li>
<li>
<p><code>tpi</code> &#8201;&#8212;&#8201;only if continuous calibration is <em>not</em> in use&#8201;&#8212;&#8201;TPI counts for each BBC and IF configured for recording</p>
</li>
<li>
<p><code>tsys</code>&#8201;&#8212;&#8201;only if continuous calibration <em>is</em> in use&#8201;&#8212;&#8201;T<sub>sys</sub> for each BBC and IF configured for recording</p>
<div class="paragraph">
<p>The T<sub>sys</sub> values are calculated using the averaging (and filtering)
method described in <code><strong>help=cont_cal</strong></code>. They are logged every
<code><em>samples</em></code> (from the <code>cont_cal</code> command) iterations of the <code><em>cycle</em></code>
period for the <code>tpicd</code> command (see <code><strong>help=tpicd</strong></code>). In other words,
the T<sub>sys</sub> logging interval is the product of <code><em>samples</em></code> times
<code><em>cycle</em></code>. Normally, the value of <code><em>cycle</em></code> should be <code>100</code>
centiseconds (one second), resulting in T<sub>sys</sub> being logged every
<code><em>samples</em></code> seconds.</p>
</div>
<div class="paragraph">
<p>When averaging is turned off, invalid (overflow, infinity, and &#8220;on&#8221;
and/or &#8220;off&#8221; zero TPIs) and out-of-range values are logged as dollar
signs, <code>$</code>. When averaging is turned on, the same invalid values are
logged as dollar signs only if no valid in-range values have occurred.
Negative values indicate that the <code><em>polarity</em></code> selected with the
<code>cont_cal</code> command is wrong.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For FS <em>10.1</em>, negative T<sub>sys</sub> values are recorded as dollar
signs, <code>$</code>, and averaging (and filtering) is not implemented.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Even when not being logged, multicast data is normally being received.
A subset can be seen in the T<sub>sys</sub> monitor display. For continuous
calibration, the current values can be displayed in the log display
window (and logged) at anytime by using the command <code><strong>tpicd=tsys</strong></code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
By default, the <em>plog</em> utility will push both reduced logs, with
the multicast data squeezed out, and compressed full logs. Please see
<code><strong>plog -h</strong></code> for more information.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_drudg_support">13. drudg support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The DBBC3 related <em>drudg</em> features include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Support for up to eight IFs (<code>a</code>-<code>h</code>) with up to 16 dual side-band
BBCs each (overall <code>001</code>-<code>128</code>) for VEX (<em>.vex</em>) schedule files.</p>
</li>
<li>
<p>Support for up to two IFs (<code>a</code> and <code>b</code>) with up to eight dual
side-band BBCs (<code>001</code>-<code>008</code>) on IF <code>a</code> and up to eight dual side-band
BBCs (<code>009</code>-<code>016</code>) on IF <code>b</code> for Mark IV (<em>.skd</em>) schedule files.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For a <em>.skd</em> schedule that would normally have a number of
channels for an IF that is not a power of two, the channels for that
IF will need to be increased to the next power of two. For example,
for <em>S</em>/<em>X</em>: <em>X</em>-band using 10 channels will need to be expanded to
use 16 (or reduced to eight); <em>S</em>-band using six channels will need to
be expanded to eight. The different set of channels to be recorded can
flow from the catalog, so their use could be automatic for the
scheduler and the station. These are just examples that will allow
recording. Other adjustments may be needed for efficient media use,
data transfer, and correlation.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The appropriate <a href="#_dbbc3_related_commands">DBBC3 related commands</a> are used in setup
procedures.</p>
</li>
<li>
<p>New <em>skedf.ctl</em> options <code>setup_proc</code> and
<code>vdif_single_thread_per_file</code> as described in the
<a href="#_minimizing_the_use_of_setup_procedures">Minimizing the use of setup procedures</a> and the
<a href="#_thread_procedure">Thread procedure</a> appendices.</p>
</li>
<li>
<p><em>drudg</em> inserts a <code>mk5c_config</code> or <code>fb_config</code> procedure call into
the setup procedures when the selected recorders are Mark 5C or
FlexBuff, respectively. Please see the <a href="#_recorder_tuning">Recorder tuning</a> appendix
for the details.</p>
</li>
<li>
<p>The following previously DBBC2 specific <em>skedf.ctl</em> options can also
now be used for DBBC3s:</p>
<div class="ulist">
<ul>
<li>
<p><code>cont_cal</code></p>
</li>
<li>
<p><code>cont_cal_polarity</code></p>
</li>
<li>
<p><code>dbbc_if_targets</code></p>
</li>
<li>
<p><code>dbbc_bbc_target</code></p>
</li>
<li>
<p><code>default_dbbc_if_inputs</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The full syntax for these options can be found in the example
<em>/usr2/fs/st.default/control/skedf.ctl</em> file.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_the_fs_for_use_with_a_dbbc3">Appendix A: Configuring the FS for use with a DBBC3</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This appendix provides the steps needed to configure the FS to support
a DBBC3. You must have version FS <em>10.1</em>, or later, installed before
using these directions. All steps, except as noted, are to be executed
as <em>oper</em>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update <em>equip.ctl</em>.</p>
<div class="paragraph">
<p>Change your rack type to <code>dbbc3_ddc_e</code>, <code>dbbc3_ddc_u,</code> or
<code>dbbc3_ddc_v</code>, as appropriate.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For FS <em>10.1</em>, <code>dbbc3_ddc_e</code> is not available.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Update <em>dbbc3.ctl</em>.</p>
<div class="paragraph">
<p>Update the <em>dbbc3.ctl</em> control file for the details of your DBBC3. The
comments in the <em>/usr2/fs/st.default/control/dbbc3.ctl</em> file may be
helpful for determining what values to use. You can also refer to the
<a href="#_dbbc3_ctl">dbbc3.ctl</a> subsection above.</p>
</div>
</li>
<li>
<p>Update <em>dbbad.ctl</em>.</p>
<div class="paragraph">
<p>Insert the correct IP address and port for your DBBC3 in the (only)
non-comment line. Add additional fields to increase the number to six,
using the correct information for the multicast data. Please see the
<a href="#_dbbad_ctl">dbbad.ctl</a> subsection above, or
<em>/usr2/fs/st.default/control/dbbad.ctl</em>, for an example. The example&#8217;s
multicast address and port may be correct. The multicast interface
used is usually your primary interface, typically <em>eno1</em> or <em>eth0</em>.</p>
</div>
</li>
<li>
<p>Update <em>/usr2/control/skedf.ctl</em>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>You should probably add <code>use_setup_proc yes</code>.</p>
<div class="paragraph">
<p>This is recommended because the setup for a DBBC3 may be long enough
to interfere with timely schedule execution. This feature is described
in the <a href="#_minimizing_the_use_of_setup_procedures">Minimizing the use of setup procedures</a> appendix.</p>
</div>
</li>
<li>
<p>Consider whether to add the <code>vdif_single_thread_per_file</code> option
and how to set it.</p>
<div class="paragraph">
<p>This probably depends on what correlators you are sending your data to
and how they want the threads organized. The option and how to use it
are described in the <a href="#_thread_procedure">Thread procedure</a> appendix.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you are using a <em>jive5ab</em> version before <em>v3.1.0-rc1</em> and use
the single-thread-per-file option, you should remove the <code>scan_check</code>
command from your <code>checkmk5</code> and/or <code>checkfb</code> procedure as described
in the <a href="#_thread_procedure">Thread procedure</a> appendix. Upgrading to <em>v3.1.0-rc1</em> or
later is recommended to eliminate this complication.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Consider adding or updating other DBBC3 related options.</p>
<div class="paragraph">
<p>They are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cont_cal</code></p>
</li>
<li>
<p><code>cont_cal_polarity</code></p>
</li>
<li>
<p><code>dbbc_if_targets</code></p>
</li>
<li>
<p><code>dbbc_bbc_target</code></p>
</li>
<li>
<p><code>default_dbbc_if_inputs</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Consider copying the new or updated explanatory comments for the
new and updated parameters from the example file
(<em>/usr2/fs/st.default/control/skedf.ctl</em>) to your local copy.</p>
<div class="paragraph">
<p>This may help if you need to make more changes later.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Update your <code>station</code> procedure library.</p>
<div class="paragraph">
<p>To make a comprehensive update will require some care and time. Both
quick start and more complete options are presented below:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the short-term, with <em>pfmed</em>, you should:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Add the <code>mcast_time</code> command to the <code>midob</code> procedure.</p>
</li>
<li>
<p>If you have not already done so, add <code>mk5c_config</code> and/or
<code>fb_config</code> procedures, depending on what recorders you will be using.</p>
<div class="paragraph">
<p>Initially, these procedures can be empty, but you can add commands as
appropriate. This is described in more detail in the
<a href="#_recorder_tuning">Recorder tuning</a> appendix.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>In the long run you will need to think about how to handle updating
the <code>station</code> library in a more systematic way. There are two basic
methods as described below:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Continue what was started with the short-term solution above and
modify your <code>station</code> library to use the DBBC3.</p>
<div class="paragraph">
<p>You will probably want to update many other procedures or replace them
with DBBC3 versions. The example/default DBBC3 <code>station</code> procedure
library is <em>/usr2/fs/st.default/proc/d3fbstation.prc</em>. You can place a
copy in your <em>/usr2/proc/</em> directory with (adjusting the target file
name appropriately to avoid overwriting an existing file; use 18 (in
FS <em>10.1</em>: eight) characters or less for the part before <code>.prc</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd /usr2/proc
cp /usr2/fs/st.default/proc/d3fbstation.prc d3fbstat.prc</pre>
</div>
</div>
<div class="paragraph">
<p>You can the use <code>pu</code> commands in  <em>pfmed</em> to remove old procedures in
your <code>station</code> library and <code>st</code> to copy replacements (or additional
procedures) from <code>d3fbstat</code> (or whatever name you used). These might
include <code>iread</code> and <code>bread</code>. In other cases, you may need to make a
detailed comparison to determine how to modify the version in your
<code>station</code> library. You should use <em>pfmed</em> commands <code>ed</code>, <code>emacs</code>, or
<code>vi</code> to edit procedures.</p>
</div>
</li>
<li>
<p>Replace your <code>station</code> library with the DBBC3 version.</p>
<div class="paragraph">
<p>This method is particularly well suited for installing a new system
but can be useful for updating an existing system as well. If the FS
is running, <code>terminate</code> it first. Then use the commands (adjusting the
target filename in the <code>mv</code> command appropriately to avoid overwriting
an existing file; use 18 (in FS <em>10.1</em>: eight) characters or less for
the part before <code>.prc</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd /usr2/proc
mv station.prc statold.prc
cp /usr2/fs/st.default/proc/d3fbstation.prc station.prc</pre>
</div>
</div>
<div class="paragraph">
<p>If there are any procedures you want from your old <code>station</code> library.
You can copy them from <code>statold</code> (or whatever name you used) with the
<code>st</code> command in <em>pfmed</em>. You should use <em>pfmed</em> commands <code>ed</code>,
<code>emacs</code>, or <code>vi</code> to edit procedures.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Setup the DBBC3 T<sub>sys</sub> display window (<em>monit7</em>)</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Update <em>clpgm.ctl</em>.</p>
<div class="paragraph">
<p>Compare your local copy to the example</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd /usr2/control
diff clpgm.ctl /usr2/fs/st.default/control/ | less</pre>
</div>
</div>
<div class="paragraph">
<p>and consider whether and what changes you should make. Typically, the new line
for <em>monit7</em> would be added to your local copy.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
If you are familiar with <em>vimdiff</em>, you may find it a more convenient way
to compare files and update your local copy. Like <em>vim</em>, <em>vimdiff</em> may be
challenging to use until you are familiar with it. Some help is available from
web searches. Don&#8217;t use it if you aren&#8217;t comfortable with it.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Update <em>stpgm.ctl</em>.</p>
<div class="paragraph">
<p>If you are using the display server and you want to have T<sub>sys</sub>
display (<em>monit7</em>) start automatically with each client (including at
FS start up), add a line for it to <em>stpgm.ctl</em>. The easiest way to do
this is to make a copy of the line for <em>monit2</em> and update for
<em>monit7</em> (changing <code>2</code>s to <code>7</code>s). If you don&#8217;t have a line for
<em>monit2</em> in your <em>stpgm.ctl</em>, you can use the one in the example file,
<em>/usr2/fs/st.default/control/stpgm.ctl</em>, as a guide.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Add the <code>erchk</code> window (optional)</p>
<div class="paragraph">
<p>If you aren&#8217;t already using the <code>erchk</code> window, its use is recommended
to make it easier to identify error messages. This can be particularly
helpful with a DBBC3 to make it easier to see any errors in the mode
configuration checking for the Core3H boards.</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Update <em>/usr2/control/clpgm.ctl</em>.</p>
<div class="paragraph">
<p>The easiest way to accomplish this is to copy the corresponding line
in <em>/usr2/fs/st.default/control/clpgm.ctl</em> to your <em>clpgm.ctl</em>.</p>
</div>
</li>
<li>
<p>Update <em>/usr2/control/stpgm.ctl</em>.</p>
<div class="paragraph">
<p>If you are using the display server and you want to have the <code>erchk</code>
window start automatically with each client (including at FS start
up), add a line for it to <em>stpgm.ctl</em>. It is recommended. The easiest
way to accomplish this is to copy the corresponding line in
<em>/usr2/fs/st.default/control/stpgm.ctl</em> to your <em>stpgm.ctl</em>.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Update your local <em>rc</em> files:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Update <em>~/.Xresources</em>.</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Add the needed lines</p>
<div class="paragraph">
<p>Compare your local file to the default:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd ~
diff .Xresources /usr2/fs/st.default/oper | less</pre>
</div>
</div>
<div class="paragraph">
<p>The new lines for <em>monit7</em>, and optionally <code>erchk</code> if you are adding
it, should be added to your local file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The default geometry resource in
<em>/usr2/fs/st.default/oper/.Xresources</em> for <em>monit7</em> handles having up
to 16 BBCs per IF. If you have fewer, you might want to adjust the
resources in your local file according to the <a href="#geometry">Tsys monitor
display geometry values</a> table below.</p>
</div>
<table id="geometry" class="tableblock frame-all grid-all" style="width: 50%;">
<caption class="title">Table 1. Tsys monitor display geometry values</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">BBCs/IF</th>
<th class="tableblock halign-center valign-top">width-by-height</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>24x13</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>24x17</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>24x21</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
If you vary the number of BBCs per IF in your configuration, you
can setup the geometry for the most you use and can resize the window
to a smaller size after it is opened or leave it as is, whatever you
prefer.
</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Adjust the position of the windows.</p>
<div class="paragraph">
<p>Fine tuning the positions in the <code>geometry</code> values is probably best
done with the windows open while the FS is running. So you may want to
defer the tuning until you restart the FS.</p>
</div>
<div class="paragraph">
<p>You can find an effective strategy to help with setting the geometry
values for an <em>xterm</em> window (and others with a <code>name</code> property) in
the
<a href="../../misc/install_reference.html#_setting_geometry_values_in_xresources">Setting
geometry values in .Xresources</a> section of the
<a href="../../misc/install_reference.html">Installation Reference</a> document.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>If you use the default window manager for the console, update <em>~/.fvwm2rc</em>.</p>
<div class="paragraph">
<p>Compare your local file to the default:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd ~
diff .fvwm2rc /usr2/fs/st.default/oper | less</pre>
</div>
</div>
<div class="paragraph">
<p>The new lines for <em>monit7</em>, and optionally <code>erchk</code> if you are adding
it, should be added to your local file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If your file uses <code>Style&#160;"monit*"&#160;NeverFocus</code> to
prevent the <em>monit&lt;n&gt;</em> windows from getting the focus (it is
recommended), you will need to add the
<code>Style&#160;"monit7"&#160;ClickToFocus</code> line (or
<code>Style&#160;"monit7"&#160;MouseFocus</code>, if you prefer) in order to be
able use the T<sub>sys</sub> display monitor commands on the console.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Log out and back in to put these changes into effect.</p>
</li>
<li>
<p>You should  make the corresponding changes for <em>prog</em> while logged
in as <em>prog</em>. Unless <em>prog</em>'s <em>rc</em> files have special customizations,
this might be done by copying <em>oper</em>'s updated files.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Start the FS, or restart it if it was already running.</p>
</li>
<li>
<p>Determine what DBBC3 specific environment variables need to be set.</p>
<div class="paragraph">
<p>A reasonable first approach would be to not set any at this point, but
you should revisit this issue once you have the FS otherwise working
with the DBBC3. A full discussion of the variables can be found in the
<a href="#_dbbc3_specific_environment_variables">DBBC3 specific environment variables</a> appendix below. In
particular, the section <a href="#_determining_what_values_to_use">Determining what values to use</a> may be
helpful.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dbbc3_specific_environment_variables">Appendix B: DBBC3 specific environment variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Several environment variables are defined for use with the DBBC3.
These are generally broken into two groups, described in sections
<a href="#_swaps_of_tpi_and_gain_values">Swaps of TPI and gain values</a>, and <a href="#_other_options">Other options</a>. These
environment variables exist to help the end user adapt to variations
in DBBC3 behaviour between different firmware releases. Several
variables are provided to give flexibility for handling different
situations.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In FS <em>10.1</em>, none of these environment variables are available.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>While some firmware releases may require setting a subset of these
variables, we have set the default values so that the end user should
not typically need to define them. We have verified that they should
not need to be defined for the firmware releases in the
<a href="#releases">Tested DBBC3 releases</a> table below.</p>
</div>
<table id="releases" class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 2. Tested DBBC3 releases</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Personality</th>
<th class="tableblock halign-center valign-top">Version</th>
<th class="tableblock halign-center valign-top">Release date</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">DDC_E</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>v126</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2022-10-25</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">DDC_U</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>v125</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2021-04-29</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">DDC_U</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>v125</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2021-08-19</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">DDC_U</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>v126</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2022-11-03</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">DDC_V</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>v124</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2021-09-26</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">DDC_V</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>v125</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2022-09-12</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Other releases may require setting some environment variables. In
particular, some earlier releases of DDC_V <em>v124</em> may require
<code>FS_DBBC3_MULTICAST_BBC_ON_OFF_SWAP</code> to be set to <code>1</code>, when the
continuous calibration polarity is <code>2</code>.</p>
</div>
<div class="paragraph">
<p>If you have experience with releases other than those listed in the
<a href="#releases">Tested DBBC3 releases</a> table above, please email Ed with
the polarity you are using, which environment variables you needed to
define, and their values, or if you did not need to define any. What
is needed (or if nothing is needed) for that release will be added to
this document. To the extent possible, we will build those settings
into the FS, but we are only able to do that per personality and
version, not release date.</p>
</div>
<div class="paragraph">
<p>For all these environment variables, if they have been set to a
non-default value, the actual value set, followed by the default in
parentheses, will be included in the log header each time a log is
opened or reopened.</p>
</div>
<div class="sect2">
<h3 id="_determining_what_values_to_use">B.1. Determining what values to use</h3>
<div class="paragraph">
<p>A reasonable first approximation is to not set any of these
environment variables. Then some can be set as needed. For information
on how to set environment variables, please see
<a href="../../../misc/env_vars.html#_setting_environment_variables">Setting
environment variables</a> in <a href="../../../misc/env_vars.html">FS
environment Variables</a> document.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
What needs to be set may vary by firmware personality, version, and
release date. If you only use one release, you can set the values in
your <em>~/.profile</em> or <em>~/.login</em> file, as appropriate. If you use more
than one release, you may want to set the values that need to be
changed between releases in either a script or an alias that you use
to run the FS for that release.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It should not be necessary at this time to change any of the USB/LSB
swaps from the default. So far, our experience is that all
personalities and versions need these swaps. If there is any question
about this, please verify it using, for example,
<a href="#_usblsb_tpi_swap_status">USB/LSB TPI swap status</a> in the
<a href="#_verifying_polarity_and_usblsb_tpi_swaps">Verifying polarity and USB/LSB TPI swaps</a> appendix.</p>
</div>
<div class="paragraph">
<p>You can detect if additional cal-on/cal-off TPI swaps are needed from
results without any of the environment variables set. Assuming you are
using the correct polarity (see <a href="#_continuous_calibration_polarity">Continuous calibration polarity</a> in
the <a href="#_verifying_polarity_and_usblsb_tpi_swaps">Verifying polarity and USB/LSB TPI swaps</a> appendix), then if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>T<sub>sys</sub> for the BBCs in the monitor display window is negative, you
may need to define <code>FS_DBBC3_MULTICAST_BBC_ON_OFF_SWAP</code> as <code>1</code>.</p>
</li>
<li>
<p>T<sub>sys</sub> for the IFs in the monitor display window is negative and
your polarity is <code>0</code>, you may need to define
<code>FS_DBBC3_MULTICAST_CORE3H_POLARITY0_ON_OFF_SWAP</code> as <code>1</code>.</p>
</li>
<li>
<p>T<sub>sys</sub> for the IFs in the monitor display window is negative and
your polarity is <code>2</code>, you may need to define
<code>FS_DBBC3_MULTICAST_CORE3H_POLARITY2_ON_OFF_SWAP</code> as <code>0</code>.</p>
</li>
<li>
<p>T<sub>sys</sub> for the BBCs from <em>onoff</em> is negative (or an overflow,
<code>$</code>s), you may need to define <code>FS_DBBC3_BBCNNN_ON_OFF_SWAP</code> as <code>1</code>.</p>
</li>
<li>
<p>T<sub>sys</sub> for the IFs from <em>onoff</em> is negative (or an overflow, <code>$</code>s)
and your polarity is <code>0</code>, you may need to define
<code>FS_DBBC3_IFTPX_POLARITY0_ON_OFF_SWAP</code> as <code>1</code>.</p>
</li>
<li>
<p>T<sub>sys</sub> for the IFs from <em>onoff</em> is negative (or an overflow, <code>$</code>s)
and your polarity is <code>2</code>, you may need to define
<code>FS_DBBC3_IFTPX_POLARITY2_ON_OFF_SWAP</code> as <code>0</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For FS <em>10.1</em>, the monitor display window shows <code>$$$$$</code> for
negative T<sub>sys</sub> values, but DBBC3 specific environment variables,
including these, are not available.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_swaps_of_tpi_and_gain_values">B.2. Swaps of TPI and gain values</h3>
<div class="paragraph">
<p>Two general types of swaps may be needed: (i) USB/LSB swaps, and (ii)
cal-on/cal-off swaps. Generally, USB/LSB swaps are always needed (and
are enabled by default). They can be adjusted separately for the TPIs
in the <code>bbc<em>NNN</em></code> commands, gains in the <code>bbc<em>NNN</em></code> commands, the
<code>bbc_gain</code> command, and the multicast.</p>
</div>
<div class="paragraph">
<p>Typically, cal-on/cal-off swaps are only needed in two situations (and
are enabled in those two cases by default). They can be adjusted
separately for the <code>bbc<em>NNN</em></code> commands, the <code>iftp<em>X</em></code> commands,
the BBCs in the multicast, and the IF (Core3H) values in the
multicast. Additionally for the <code>iftp<em>X</em></code> command and IF values in
the multicast, separate control is provided for polarity <code>0</code> (and <code>1</code>)
versus polarity <code>2</code> (and <code>3</code>).</p>
</div>
<div class="paragraph">
<p>The variables, along with their default values, are given in the
<a href="#variables">DBBC3 TPI swap environment variables</a> table below. The
table is sorted by USB/LSB verses cal-on/cal-off swaps. Their names
are verbose to make their applicability clear. The <code>CORE3H</code> values for
the multicast refer to the IF TPI values. A value of <code>0</code> for the
variable disables its effect; a value of <code>1</code> enables it. If the
variable is not defined in the session before the FS is started, the
behavior will be that of the default value. If need be, the variable
can be defined as <code>1</code> to enable, or <code>0</code> to disable it, <em>before
starting the FS</em>. Any other defined value is interpreted as <code>0</code>.</p>
</div>
<table id="variables" class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 3. DBBC3 TPI swap environment variables</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Environment variable</th>
<th class="tableblock halign-center valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FS_DBBC3_BBCNNN_GAIN_USB_LSB_SWAP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FS_DBBC3_BBCNNN_TPI_USB_LSB_SWAP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FS_DBBC3_BBC_GAIN_USB_LSB_SWAP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FS_DBBC3_MULTICAST_BBC_TPI_USB_LSB_SWAP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FS_DBBC3_BBCNNN_ON_OFF_SWAP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FS_DBBC3_IFTPX_POLARITY0_ON_OFF_SWAP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FS_DBBC3_IFTPX_POLARITY2_ON_OFF_SWAP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FS_DBBC3_MULTICAST_BBC_ON_OFF_SWAP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FS_DBBC3_MULTICAST_CORE3H_POLARITY0_ON_OFF_SWAP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FS_DBBC3_MULTICAST_CORE3H_POLARITY2_ON_OFF_SWAP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_other_options">B.3. Other options</h3>
<div class="paragraph">
<p>A few other environment variables can be used to control other
options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FS_DBBC3_MULTICAST_CORE3H_TIME_ADD_SECONDS</code></p>
<div class="paragraph">
<p>This variable can be used to adjust the timestamp in the multicast
packets. Normally it does not need to be set and defaults to <code>0</code>. If
the multicast packets being received have a fixed offset from the
correct time, this variable can be set to correct the values. Any
32-integer value can be used. Any non-integer value is interpreted as
<code>0</code>. The value is added to the timestamps. This does not correct the
time that the DBBC3 is using internally and in the VDIF packets sent
to the recorder. This can only be used to eliminate FS indications of
incorrect time in the DBBC3. Please see the warning immediately below.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Having the wrong timestamps may be an indication that the
DBBC3 was not properly synchronized. It may be that the DBBC3 needs to
be rebooted to resynchronize it properly.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>FS_DBBC3_MULTICAST_CORE3H_TIME_INCLUDED</code></p>
<div class="paragraph">
<p>This variable controls whether time is expected in the multicast
packets. Normally it does not need to be set. It defaults to <code>0</code> for
DDC_V and <code>1</code> for others. Setting it to <code>1</code> means that time in the
multicast packet is expected. Any other value is interpreted as <code>0</code>,
i.e., time is not expected and no attempt will be made to use it.</p>
</div>
</li>
<li>
<p><code>FS_DBBC3_MULTICAST_VERSION_ERROR_MINUTES</code></p>
<div class="paragraph">
<p>This variable controls the error reporting interval, in minutes, if
the DBBC3 firmware (<code>DDC<em>_X</em></code>) or version (<code>v<em>NNN</em></code>) in the
multicast does not agree with the FS control files. The default is
<code>1</code>.  It can be set to any value <code>1</code>-<code>10</code>. Any other values are
interpreted as <code>1</code>.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_verifying_polarity_and_usblsb_tpi_swaps">Appendix C: Verifying polarity and USB/LSB TPI swaps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This appendix provides methods for verifying the
<a href="#_continuous_calibration_polarity">Continuous calibration polarity</a> and the
<a href="#_usblsb_tpi_swap_status">USB/LSB TPI swap status</a>. You should verify the polarity before
checking the USB/LSB swap status.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In FS <em>10.1</em>, these procedures can be used without the
environment variables, which are not available,  to check the related
aspects of the system.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_continuous_calibration_polarity">C.1. Continuous calibration polarity</h3>
<div class="paragraph">
<p>A polarity of <code>0</code> corresponds to the noise diode in the receiver being
active for the low TTL output level of the DBBC3 continuous
calibration signal; <code>2</code>, active for the high TTL output level. The
best case is to know what the polarity should be from the design of
your system. If that is not practical, or to verify it, you can use
the methods in this section.</p>
</div>
<div class="paragraph">
<p>Generally the easiest way to verify, or empirically determine, your
calibration polarity is from the T<sub>sys</sub> monitor display. Hopefully,
one setting of the polarity, <code>0</code> or <code>2</code>, will produce usable T<sub>sys</sub>
values. If so, that is probably the correct polarity. However, if
there is an issue with the order of the cal-on and cal-off values in
the multicast, you may get the wrong result. In that case, <em>fivpt</em>
won&#8217;t work and <em>onoff</em> will not return usable T<sub>sys</sub> values.</p>
</div>
<div class="paragraph">
<p>A more reliable, but also not perfect, way to determine the correct
polarity is with the output of a <code>bbc<em>NNN</em></code> command. The following
procedure should normally work. If the results do not agree with your
expected polarity, please contact Ed.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure the environment variable <code>FS_DBBC3_BBCNNN_ON_OFF_SWAP</code> is
<em>not</em> set, or if it is set, that it is set to <code>0</code>.</p>
</li>
<li>
<p>Start the FS.</p>
</li>
<li>
<p>Configure the system for an observing mode.</p>
</li>
<li>
<p>Set the polarity to <code>0</code>:</p>
<div class="literalblock">
<div class="content">
<pre>cont_cal=on,0</pre>
</div>
</div>
</li>
<li>
<p>For a BBC that is configured for observing, maybe BBC001, sample its
state:</p>
<div class="literalblock">
<div class="content">
<pre>bbc001</pre>
</div>
</div>
</li>
<li>
<p>Examine the last four numbers of the output. They are, in order:</p>
<div class="openblock">
<div class="content">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>USB TPI<sub>on</sub> (cal-on)</p>
</li>
<li>
<p>LSB TPI<sub>on</sub> (cal-on)</p>
</li>
<li>
<p>USB TPI<sub>off</sub> (cal-off)</p>
</li>
<li>
<p>LSB TPI<sub>off</sub> (cal-off)</p>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p>If the TPI<sub>on</sub> values, per side-band, were higher than the TPI<sub>off</sub>
values, you should use polarity <code>0</code>. You may want to sample a few
times to make sure the results are consistent. If the TPI<sub>off</sub> values
are higher than the TPI<sub>on</sub> values, proceed to the next step.</p>
</div>
</li>
<li>
<p>If in the previous step, the TPI<sub>off</sub> values, per side-band, were
higher than the TPI<sub>on</sub>, you should try:</p>
<div class="literalblock">
<div class="content">
<pre>cont_cal=on,2</pre>
</div>
</div>
<div class="paragraph">
<p>and re-sample the BBC. If the TPI<sub>on</sub> values are now higher than the
TPI<sub>off</sub> value, you should use <code>2</code> as your polarity.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_usblsb_tpi_swap_status">C.2. USB/LSB TPI swap status</h3>
<div class="paragraph">
<p>To verify your USB/LSB TPI swap status you need a strong test signal
in one side-band of a BBC. This could either be a phase calibration
test tone, or an astronomical source such as a Maser, that makes a
strong signal in only one side-band of one BBC.</p>
</div>
<div class="paragraph">
<p>Follow the steps below. If the results do not show that the test
signal is in the expected side-band, please contact Ed.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verify the <a href="#_continuous_calibration_polarity">Continuous calibration polarity</a> in the previous
section.</p>
</li>
<li>
<p>Make sure the environment variable
<code>FS_DBBC3_MULTICAST_BBC_TPI_USB_LSB_SWAP</code> is <em>not</em> set, or if it is
set, that it is set to <code>1</code>.</p>
</li>
<li>
<p>Start the FS.</p>
</li>
<li>
<p>Configure the system for an observing mode.</p>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph">
<p>You must use an observing mode that at least has a nominal <em>.rxg</em> file
that supports it. If there isn&#8217;t one, you can use the output of the
<code>bbc<em>NNN</em></code> command (with <code>FS_DBBC3_BBCNNN_USB_LSB_SWAP</code> not set or
else set to <code>1</code>) for the BBC where the test signal is expected to
appear and hand calculate the \(\mathit{T_{sys}}\) value for each
side-band using (see the
<a href="#_continuous_calibration_polarity">Continuous calibration polarity</a> section for the
\(\mathit{TPI}\) variable meanings, use a nominal value for
\(\mathit{T_{cal}}\)):</p>
</div>
<div class="paragraph text-center">
<p>\(\mathit{T_{sys}=0.5(TPI_{on}+TPI_{off})\frac{T_{cal}}{TPI_{on}-TPI_{off}}}\)</p>
</div>
<div class="paragraph">
<p>Verify that the side-band that is expected to have the test signal has
the higher \(\mathit{T_{sys}}\) value.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>In the \(\mathit{T_{sys}}\) monitor display, verify that the
\(\mathit{T_{sys}}\) value of the side-band of the BBC where the
test signal is expected to be is in fact higher than the other
side-band.</p>
</li>
<li>
<p>We have not seen it, but it might be possible for the multicast and
<code>bbc<em>NNN</em></code> commands to have different USB/LSB swaps. So in principle
both the T<sub>sys</sub> monitor display and <code>bbc<em>NNN</em></code> commands should be
checked (see the <strong>CAUTION</strong> above for the latter). It is also possible
to verify the USB/LSB swaps status for both the gains in the
<code>bbc<em>NNN</em></code> command and those in <code>bbc_gain</code> command. Separate
environment variables are provided for each case to allow them to be
adjusted independently.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_minimizing_the_use_of_setup_procedures">Appendix D: Minimizing the use of setup procedures</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This can be used for any system, not just those with DBBC3s.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Normally, the FS sets the mode for each scan (unless there is continuous
recording). If this takes too long (as is the case for the DBBC3) or makes the
equipment unstable, the <em>drudg</em> option <code>use_setup_proc yes</code> in <em>skedf.ctl</em> can
be used to minimize the execution of the setup procedure.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Not executing the setup each scan may not be robust if the
equipment sometimes loses its configuration. Each station will need to
determine for its particular situation whether minimizing its use is
better than always using it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With this option enabled, <em>drudg</em> will replace the calls to setup
procedures (e.g., <code>setup01</code>) in the <em>.snp</em> file with, e.g.:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>setup_proc=setup01</pre>
</div>
</div>
<div class="paragraph">
<p>When the FS encounters this command, it will conditionally execute the setup
procedure if either of the following is true:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>This is the first setup since the schedule was last started.</p>
<div class="paragraph">
<p>This will make sure the setup is run at the start and any restart of
the schedule. There should be sufficient time for the setup procedure
in these cases as long as the schedule is started as little as even
just a few minutes before the first scan. The schedule may need to be
started even earlier to allow enough time for the antenna to slew to
the first source.</p>
</div>
</li>
<li>
<p>If there was a mode change, i.e., the name of the setup procedure changed.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Mode changes within schedules is not supported yet for DBBC3s.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>use_setup_proc</code> option in <em>skedf.ctl</em> has three possible
settings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>yes</code>&#8201;&#8212;&#8201;use the <code>setup_proc</code> command</p>
</li>
<li>
<p><code>no</code> &#8201;&#8212;&#8201;do not use the <code>setup_proc</code> command</p>
</li>
<li>
<p><code>ask</code>&#8201;&#8212;&#8201;to prompt for <code>yes</code> or <code>no</code> for each schedule</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the option is not used, it defaults to <code>no</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <em>fesh</em> program was expanded to support an environment
variable, <code>FESH_GEO_USE_SETUP_PROC</code>, and a command line option, <code>-u</code>,
to set the answer for an interactive prompt for whether or not to use
<code>setup_proc</code> commands when <em>drudg</em>ing geodesy schedules. Please see
<code><strong>fesh -h</strong></code> for more information.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Thanks to Jon Quick (HartRAO) and Marjolein Verkouter (JIVE) for
suggesting this approach. They also suggested that it may be utilized
as part of future features for additional checking and resetting of
the system.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_thread_procedure">Appendix E: Thread procedure</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This can be used for any system with a Mark 5C or FlexBuff
recorder, not just one with a DBBC3.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When a Mark 5C or FlexBuff recorder is in use, <em>drudg</em> can optionally
insert a <code>thread<em>suffix</em></code> procedure in each setup procedure (where
<code><em>suffix</em></code> is a mode specific suffix, e.g., <code>01</code>). This can be used
to control whether the recording for a mode is multi-threaded or
single-thread-per-file. As generated by <em>drudg</em>, the contents of the
procedure is the same for every mode in the schedule. If it needs to
be different for some modes, the corresponding <code>thread<em>suffix</em></code>
procedures can be edited.</p>
</div>
<div class="paragraph">
<p>This feature is controlled by the <code>vdif_single_thread_per_file</code> option
in the <em>skedf.ctl</em> control file. The option only needs to be used by
stations that need to record a single-thread-per-file, at least some
of the time; the default for <em>jive5ab</em> after being restarted is
multi-threaded. If the option is not present, no <code>thread<em>suffix</em></code>
procedure is inserted. If it is present, the possible settings are
(where <code><em>command</em></code> is <code>mk5</code> or <code>fb</code> depending on the type of
recorder):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>yes</code>&#8201;&#8212;&#8201;to store a single-thread-per-file, in which case, the
<code>thread<em>suffix</em></code> procedure contents are:</p>
<div class="literalblock">
<div class="content">
<pre><em>command</em>=datastream=clear
<em>command</em>=datastream=add:ds{thread}:*
<em>command</em>=datastream=reset</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ds</code> is passed (case preserved) to <em>jive5ab</em> to be used as part of
the lowercase datastream label portion of the filename. This results
in filenames like <em>ev024g_mc_no0009_dsds1</em>. The double <em>ds</em> is
intentional.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
If you are using a <em>jive5ab</em> version before <em>v3.1.0-rc1</em> and
you select storing a single-thread-per-file, the <code>scan_check</code> command
will not work properly. You should comment it out or remove it from
your <code>checkfb</code> and/or <code>checkmk5</code> procedure. Alternately, if you only
select single-thread-per-file sometimes, you may want to edit the
procedure depending on your choice. Upgrading to <em>v3.1.0-rc1</em> or later
is recommended to eliminate this complication.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In FS <em>10.1</em>, the <code>add</code> command is
<code><em>command</em>=datastream=add:{thread}:*</code> and there is no double <em>ds</em>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>no</code>&#8201;&#8212;&#8201;for normal multi-threaded recording, in which case, the
<code>thread<em>suffix</em></code> procedure contents are:</p>
<div class="literalblock">
<div class="content">
<pre><em>command</em>=datastream=clear
<em>command</em>=datastream=reset</pre>
</div>
</div>
</li>
<li>
<p><code>ask</code>&#8201;&#8212;&#8201;to be prompted once per schedule for what to do</p>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
If you are using single-thread-per-file, see the <strong>CAUTION</strong>
about <code>scan_check</code> for the <code>yes</code> setting above.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <em>fesh</em> program was expanded to support an environment
variable, <code>FESH_GEO_VDIF_SINGLE_THREAD_PER_FILE</code>, and a command line
option, <code>-T</code>, to set the answer for an interactive prompt for whether
or not to use a single-thread-per-file when <em>drudg</em>ing geodesy
schedules. Please see <code><strong>fesh -h</strong></code> for more information.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recorder_tuning">Appendix F: Recorder tuning</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This can be used for any system with a Mark 5C or FlexBuff
recorder, not just one with a DBBC3.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This appendix describes the default recorder configuration used by the
FS and how to make changes in your SNAP procedures to tune some
aspects of the configuration of your Mark 5C and/or FlexBuff
recorders.</p>
</div>
<div class="sect2">
<h3 id="_mk5c_configfb_config_procedure">F.1. mk5c_config/fb_config procedure</h3>
<div class="paragraph">
<p>Each mode SNAP setup procedure produced by <em>drudg</em> for Mark 5C and
FlexBuff recorders includes a call to a <code>mk5c_config</code>/<code>fb_config</code> SNAP
procedure, depending on the type of recorder. This procedure call is
inserted immediately after the <code>mk5c_mode</code>/<code>fb_mode</code> command (and
after the optional <a href="#_thread_procedure">Thread procedure</a> call, if present). The
procedure is mode independent, i.e., the same procedure is used for
all modes.</p>
</div>
<div class="paragraph">
<p>This procedure is a local <code>station</code> library procedure to allow tuning
some aspects of the configuration of <em>jive5ab</em> for the specifics of
the recorder, including overriding the &#8220;default&#8221; FS configuration,
described next below, given by the <code>mk5c_mode</code>/<code>fb_mode</code> command in
the setup procedure.</p>
</div>
</div>
<div class="sect2">
<h3 id="_default_fs_configuration">F.2. Default FS configuration</h3>
<div class="paragraph">
<p>The <code>mk5c_mode</code>/<code>fb_mode</code> command sends configuration information,
beyond what is set with <em>jive5ab</em> <code>mode</code> command. What is sent depends
on which recorder is selected in <em>equip.ctl</em>, <code>mk5c</code> or <code>flexbuff</code>,
and the total data rate. It does <em>not</em> depend on which command is
used; <code>fb_mode</code> is just an alias for <code>mk5c_mode</code>. The commands sent
also depend on the data type, VDIF or 5B/Ethernet. All the cases are
listed below.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
You can see the full details of the FS setup of the recorder by
the <code>mk5c_mode</code>/<code>fb_mode</code> command by using <code><strong>echo=on</strong></code> before the
command and <code><strong>echo=off</strong></code> afterwards.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_flexbuff_recorder">F.2.1. FlexBuff recorder</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Default <code>mtu</code> setting:</p>
<div class="paragraph">
<p>The <code>mtu</code> command sent to the recorder depends on the data type:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>VDIF data</p>
<div class="literalblock">
<div class="content">
<pre>mtu = 9000 ;</pre>
</div>
</div>
</li>
<li>
<p>5B/Ethernet data</p>
<div class="literalblock">
<div class="content">
<pre>mtu = 6000 ;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Default <code>net_protocol</code> setting:</p>
<div class="paragraph">
<p>There is a variable field <code><em>socketbuffer</em></code> in the <code>net_protocol</code> command sent
to the recorder. Its value is independent of the data type.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>net_protocol = udpsnor : <em>socketbuffer</em> : 256000000 : 4 ;</pre>
</div>
</div>
<div class="paragraph">
<p>Where the <em>socketbuffer</em> field depends on the total data rate:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>32000000&#8201;&#8212;&#8201;data rate &lt; 1 Gbps</p>
</li>
<li>
<p>64000000&#8201;&#8212;&#8201;1 Gbps &lt; data rate &#8656; 4 Gbps</p>
</li>
<li>
<p>128000000&#8201;&#8212;&#8201;data rate &gt; 4 Gbps</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <em>socketbuffer</em> parameter is an important setting for trying to minimize
risk of packet loss when starting the recording. For (very) high data rates,
the <code>mk5c_config</code>/<code>fb_config</code> procedure can be used to increase the
<em>socketbuffer</em> size to values appropriate for that. This assumes that the
FlexBuff has been tuned (especially the kernel network buffer sizes) along the
lines of the FlexBuff tuning documentation at
<a href="https://www.jive.eu/~verkout/flexbuff/flexbuf.recording.txt" class="bare">https://www.jive.eu/~verkout/flexbuff/flexbuf.recording.txt</a>.</p>
</div>
</li>
<li>
<p>Default <code>record = nthread</code> setting:</p>
<div class="paragraph">
<p>There is a variable field <code><em>nWriters</em></code> in the <code>record = nthread</code> command sent
to the recorder. Its value is independent of the data type.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>record = nthread : : <em>nWriters</em> ;</pre>
</div>
</div>
<div class="paragraph">
<p>where <code><em>nWriters</em></code> is calculated as <code>max( <em>data_rate</em> / 6 + 1, 2)</code> and
<code><em>data_rate</em></code> is the total data rate in Gbps.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_mark_5c_recorder">F.2.2. Mark 5C recorder</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Default <code>net_protocol</code> setting:</p>
<div class="paragraph">
<p>The <code>net_protocol</code> command sent to the recorder is independent of the data
type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>net_protocol = : 128k : 2M : 4;</pre>
</div>
</div>
</li>
<li>
<p>Default <code>packet</code> setting:</p>
<div class="paragraph">
<p>The <code>packet</code> command sent to the recorder depends on the data type:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>VDIF data</p>
<div class="literalblock">
<div class="content">
<pre>packet = 36 : 0 : 8032 : 0 : 0 ;</pre>
</div>
</div>
</li>
<li>
<p>5B/Ethernet data</p>
<div class="literalblock">
<div class="content">
<pre>packet = 36 : 0 : 5008 : 0 : 0 ;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_overriding_the_defaults">F.3. Overriding the defaults</h3>
<div class="paragraph">
<p>You can override the commands sent by the <code>mk5c_mode</code>/<code>fb_mode</code>
command or add more by putting them in your local
<code>mk5c_config</code>/<code>fb_config</code> procedure. This works because
<code>mk5c_config</code>/<code>fb_config</code> is called after <code>mk5c_mode</code>/<code>fb_mode</code>
command (<em>and</em> after the call to the optional <a href="#_thread_procedure">Thread procedure</a>, so
it can overridden by the same mechanism) in the setup procedure. An
example of a local customization is shown in the
<a href="#_changing_net_protocol">Changing net_protocol</a> subsection below.</p>
</div>
<div class="paragraph">
<p>Some suggestions for recoder turning, both for <em>jive5ab</em> commands in
<code>mk5c_config</code>/<code>fb_config</code> and more generally, can be found at:
<a href="https://www.jive.eu/~verkout/flexbuff/flexbuf.recording.txt" class="bare">https://www.jive.eu/~verkout/flexbuff/flexbuf.recording.txt</a>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
If you put any commands in <code>mk5c_config</code>/<code>fb_config</code> that depend on
the data type, VDIF or 5B/Ethernet, you would need to change them if there is a
change in the data type. This is not a concern for most stations.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_changing_net_protocol">F.3.1. Changing net_protocol</h4>
<div class="paragraph">
<p>If you use different values for <code>net_protocol</code>, you can leave any field blank
that your don&#8217;t need to change from what the FS has already sent. For example
to only set the <em>socketbuffer</em> size to <code>64000000</code>, use:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>net_protocol = : 64000000</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_alternate_core3h_board_configuration_method">Appendix G: Alternate Core3H board configuration method</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It <em>may</em> be possible to configure the Core3H broads from the FS, but
at this time it is not considered safe to do so. This appendix
describes a method for this in case it is determined to be safe to
use. Currently, this should be viewed as a &#8220;bleeding edge&#8221;
engineering test method. It may be that this approach can be adapted
for use when new DBBC3 features that make it safe become available.</p>
</div>
<div class="paragraph">
<p>The fundamental issue is that it is not considered safe to re-sync the
boards except by booting the DBBC3. Most of the changes in Core3H
board configuration that depend on the observing mode require a
re-sync afterwards. Consequently, these features should only be set
from the boot configuration.</p>
</div>
<div class="paragraph">
<p>As a result, during a schedule the configuration of the Core3H boards
is not set; it is only checked. A mechanism is provided to force the
setting of the mode configuration. In principle, this can be used
before the experiment starts to place the Core3H boards in the correct
configuration without having to decode the schedule configuration and
set the Core3H boards up as part of the boot configuration. However,
this mechanism is not currently recommended.</p>
</div>
<div class="sect2">
<h3 id="_configure_core3h_boards">G.1. Configure Core3H boards</h3>
<div class="paragraph">
<p>To configure the Core3H boards for the schedule mode:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>drudg</em> the schedule to make the <em>.prc</em> (and <em>.snp</em>) file</p>
</li>
<li>
<p>Start the FS</p>
</li>
<li>
<p>Open the experiment procedure library, e.g.:</p>
<div class="literalblock">
<div class="content">
<pre>proc=r5012kk</pre>
</div>
</div>
</li>
<li>
<p>Execute the normal Core3H board configuration procedure, perhaps
<code>core3h01</code>, with the <code>force</code> parameter, e.g.:</p>
<div class="literalblock">
<div class="content">
<pre>core3h01=force</pre>
</div>
</div>
<div class="paragraph">
<p>This command will generate an error when it tries to start data
transmission without the boards being re-synced. This is normal and
can serve as a reminder that re-syncing is needed.</p>
</div>
</li>
<li>
<p>Set the Core3H output <code>destination</code>s</p>
<div class="paragraph">
<p>The FS does not set the <code>destination</code>s for the Core3H boards. When
checking the configuration, it does verify that outputs that are not
expected to be recorded have their <code>destination</code> set to <code>none</code> and
outputs that are to be recorded do not. You will have to verify that
that the outputs that are being recorded have the correct
<code>destination</code> addresses set.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
For DDC_V, you do not have to set <code>destination 1 none</code>. It is
disabled by the firmware regardless of how it is set and the FS
ignores it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can check that the <code>destination</code>s are set to <code>none</code> in the
correct places with, e.g.:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>core3h01</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This will also check the other aspects of the Core3H board
setup. Any non-<code>destination</code> related errors should also be resolved at
this time.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If any <code>destination</code> related errors are reported, you must correct
them. You can use commands similar to those in the example in the
<a href="#_ethernet_configuration">Ethernet configuration</a> subsection above, as needed. It is not
necessary to reboot the DBBC3 to fix this.</p>
</div>
<div class="paragraph">
<p>You can display the <code>destination</code>s that are set for the <code><em>n</em></code><sup>th</sup>
board with:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  core3h=<em>n</em>,destination 0
  core3h=<em>n</em>,destination 1</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Depending on your site&#8217;s IT rules, you may need to be
careful to avoid recording public IP addresses in your experiment
logs.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Continue to the <a href="#_sync_time">Sync time</a> and then the
<a href="#_start_data_transmission">Start data transmission</a> subsections below for the steps to
complete the setup.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_the_configuration_details">G.1.1. The configuration details</h4>
<div class="paragraph">
<p>For each Core3H that is in use, the following information/commands
will be sent when using <code>force</code>, in this known-to-work order:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Decimation</p>
</li>
<li>
<p>Splitmode</p>
</li>
<li>
<p>Bitmask</p>
</li>
<li>
<p><code>reset</code></p>
</li>
<li>
<p><code>vdif_frame &#8230;&#8203;</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>core3h=1,vsi_samplerate 128000000 2
core3h=1,splitmode on
core3h=1,vsi_bitmask 0xcccccccc
core3h=1,reset
core3h=1,vdif_frame 2 8 8000 ct=off</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The FS hard codes a VDIF frame payload size of <code>8000</code>. If a
different size is needed, please see the
<a href="#_handling_other_vdif_frame_payload_sizes">Handling other VDIF frame payload sizes</a> appendix.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sync_time">G.2. Sync time</h3>
<div class="paragraph">
<p>After the Core3H boards are configured, the operator needs to sync the
PPS, sync each Core3H, and sync the PPS a final time. In principle,
this would consist of:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dbbc3=pps_sync
!+1s
core3h=1,timesync
core3h=2,timesync
core3h=3,timesync
core3h=4,timesync
core3h=5,timesync
core3h=6,timesync
core3h=7,timesync
core3h=8,timesync
!+1s
dbbc3=pps_sync</pre>
</div>
</div>
<div class="paragraph">
<p>It may be necessary to increase the delays after/before the <code>pps_sync</code>
commands to achieve reliable results. If you have fewer than eight
boards, only include the <code>timesync</code> commands for the boards you have.</p>
</div>
<div class="paragraph">
<p>It may take the boards a few tens of seconds to stabilize after the
commands. During that the period, the times reported for the boards
may vary. When the times have stabilized, continue to the
<a href="#_start_data_transmission">Start data transmission</a> subsection below to complete the setup.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The above commands <em>may</em> work for syncing. The following conditions
are required, but may not be sufficient, to verify that the sync
worked:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There were no errors in the execution of the commands.</p>
</li>
<li>
<p>All boards have the same, correct, time.</p>
</li>
<li>
<p>All boards have the same, correct, VDIF epoch.</p>
</li>
<li>
<p>All boards have <code>pps_delay</code> values of no more than a few tens of
nanoseconds and are not drifting. However, if a GPS 1 PPS is used as
input, some drift may be unavoidable.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The best way to check the time for non-DDC_V firmware is with the
<code>mcast_time</code> command. For DDC_V firmware and versions before <em>v124</em>
the <code>dbbc3=time</code> command can be used, but the output can be difficult
to interpret because the boards may be sampled in different seconds.</p>
</div>
<div class="paragraph">
<p>The VDIF epoch and the time can be checked per board with
<code>core3h=<em>board</em>,time</code>, where <code><em>board</em></code> is the board number.</p>
</div>
<div class="paragraph">
<p>The <code>pps_delay</code> values can be viewed with the <code>mcast_time</code> command.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
All the Core3H boards in the system need to be synced, even
those not sending data. For now, the only safe way to configure a
DBBC3 is with the boot configuration. A new DBBC3 feature is being
developed to allow syncing the PPS and then syncing, in parallel, the
Core3H boards without needing to reboot.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_start_data_transmission">G.3. Start data transmission</h3>
<div class="paragraph">
<p>After the boards are synced, data transmission needs to be started or
stopped for each board, as appropriate for the mode. Assuming the
setup procedure for the mode has been used previously with the <code>force</code>
parameter as described in the <a href="#_configure_core3h_boards">Configure Core3H boards</a> subsection
above, this can be accomplished with the command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>core3h_mode=end,force</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>After the boards have been synced, data transmission can be freely started and
stopped on individual boards as needed. For example to start transmission on
board <code>1</code>, you can use:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>core3h=1,start vdif</pre>
</div>
</div>
<div class="paragraph">
<p>To stop transmission, use:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>core3h=1,stop</pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Using these commands may make whether the board is transmitting data
inconsistent with the FS configuration and may lead to problems.
</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_check_the_mode">G.4. Check the mode</h3>
<div class="paragraph">
<p>After the Core3H boards have been configured, you should check the
mode as described in the <a href="#_checking_the_mode">Checking the mode</a> subsection above in the
main document. That step will also implicitly set the non-Core3H
configuration for the mode, which is necessary for a complete setup.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_handling_other_vdif_frame_payload_sizes">Appendix H: Handling other VDIF frame payload sizes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The value of <code>8000</code> for the VDIF frame payload size is hard coded in
the FS for the DBBC3 and <em>jive5ab</em> (and DBBC2/FiL10G as well).
Currently this is the correct value, but some day in the future,
different values may be needed. If that occurs before the FS is
updated to accommodate other values, this section gives a recipe for
handling it for the DBBC3 and <em>jive5ab</em> in the meantime. It is a
little complicated, but should work. Hopefully, the FS will be updated
before it is necessary.</p>
</div>
<div class="paragraph">
<p>After you command a different VDIF payload size, the FS will complain
that the DBBC3 <code>vdif_frame</code> payload is not correct when you check the
DBBC3 configuration (i.e., using the setup procedure without the
<code>force</code> parameter), but if that is the only complaint, there should
not be a problem. The display of these errors can suppressed with the
<code>tnx</code> command.</p>
</div>
<div class="paragraph">
<p>If you are using the boot configuration method of configuring the
Core3H boards, there is a <a href="#note">NOTE</a> in the
<a href="#_setting_the_boot_configuration_for_the_mode">Setting the boot configuration for the mode</a> subsection above that
explains what to do.</p>
</div>
<div class="paragraph">
<p>This remainder of this appendix is only useful of you are using the
<a href="#_alternate_core3h_board_configuration_method">Alternate Core3H board configuration method</a> appendix. As such, it
continues the examples of that appendix.</p>
</div>
<div class="paragraph">
<p>The basic strategy is to <a href="#_determine_the_other_settings">Determine the other settings</a> needed in
the DBBC3 <code>vdif_frame</code> and <em>jive5ab</em> <code>mode</code> commands,
<a href="#_update_the_snap_procedures">Update the SNAP procedures</a> to include the new payload size, and
then <a href="#_command_the_devices">Command the devices</a> with the new value. These are all
described in the following subsections.</p>
</div>
<div class="sect2">
<h3 id="_determine_the_other_settings">H.1. Determine the other settings</h3>
<div class="paragraph">
<p>The settings can be calculated from first principles. However, another
way to determine them is to use the <code>echo</code> output from the FS for what
would otherwise be the correct setup:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>proc=r5012kk
echo=on
setup01=force
echo=off</pre>
</div>
</div>
<div class="paragraph">
<p>You will need to identify the <code>#dbbcn#[core3h=<em>n</em>,vdif_frame &#8230;&#8203;</code> and
<code>#mk5cn#[mode = VDIF_8000-&#8230;&#8203;</code> records in the output and use the
displayed values as shown in the next subsection.</p>
</div>
</div>
<div class="sect2">
<h3 id="_update_the_snap_procedures">H.2. Update the SNAP procedures</h3>
<div class="paragraph">
<p>This example uses <code>8200</code>, which is not an allowed value, as a
different payload size.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
The examples below do not necessarily contain correct values.
They are just offered to show the form of the commands.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new SNAP procedure, perhaps called <code>vdif_8200</code>, that
contains all the other values in the <code>core3h=<em>n</em>,vdif_frame&#160;&#8230;&#8203;</code>
commands recorded in the previous section, but with the new payload
size. For example, insert:</p>
<div class="literalblock">
<div class="content">
<pre>dbbc3=core3h=1,vdif_frame 2 8 8200 ct=off
dbbc3=core3h=2,vdif_frame 2 8 8200 ct=off
dbbc3=core3h=3,vdif_frame 2 8 8200 ct=off
dbbc3=core3h=4,vdif_frame 2 8 8200 ct=off
dbbc3=core3h=5,vdif_frame 2 8 8200 ct=off
dbbc3=core3h=6,vdif_frame 2 8 8200 ct=off
dbbc3=core3h=7,vdif_frame 2 8 8200 ct=off
dbbc3=core3h=8,vdif_frame 2 8 8200 ct=off</pre>
</div>
</div>
</li>
<li>
<p>In the same procedure, add a <code>jive5ab=mode=VDIF_&#8230;&#8203;</code> command that
contains all the other values from the <code>mode&#160;=&#160;VDIF_&#8230;&#8203;</code>
command recorded in the previous section, but with the new payload
size. For example, add the command:</p>
<div class="literalblock">
<div class="content">
<pre>jive5ab=mode=VDIF_8200-8192-64-2</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Not putting this command directly into your
<code>mk5c_config</code>/<code>fb_config</code> procedure allows it to be mode specific. If
you want to apply this change universally, you can put it into your
<code>mk5c_config</code>/<code>fb_config</code> procedure instead, but be wary of other
modes.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_command_the_devices">H.3. Command the devices</h3>
<div class="paragraph">
<p>Continuing the example, enter:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>proc=r5012kk
setup01=force
vdif_8200</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The order of the last two commands above is critical to
avoid having the overall setup procedure overwrite the new payload
value.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Afterwards, you need to re-sync the time as described in the
<a href="#_sync_time">Sync time</a> subsection and start the data transmission as
described in the <a href="#_start_data_transmission">Start data transmission</a> subsection, both in the
<a href="#_alternate_core3h_board_configuration_method">Alternate Core3H board configuration method</a> appendix.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The reason for setting the new Core3H payload size <em>outside</em> of
the overall setup procedure is so that when using that procedure
without <code>force</code> to check the DBBC3 configuration (and/or to configure
the non-Core3H parts of the system), the added
<code>core3h=<em>n</em>,vdif_frame &#8230;&#8203;</code> commands won’t trigger a requirement
to re-sync the boards.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-06-29 19:38:04 -0400
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>