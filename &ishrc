FTN4,A
C@ISHRC 
C 
        FUNCTION ISHRC(ITYPE,IXCOL,I1,I2,I3,I4,I5)
     .,C#870115:05:47    FORM SCREEN LINE V=1.1#
C 
C     ISHRC 
C 
C 1.  NAME PROGRAM SPECIFICATION
C 
C 1.1.   ISHRC
C               THIS ROUTINE FORMATS DISPLAYS FOR 264x TERMINALS USING
C       INVERSE VIDEO WHEN REQUESTED.  THIS ROUTINE HANDLES COLUMN POSITIONING
C       AND WILL DISPLAY ASCII,CONVERTED BINARY INTEGERS, CONVERTED REAL
C       NUMBER USING A FORM OF THE FORTRAN Fn.m DISPLAY.  ASTONOMICAL 
C       ANGLES CAN ALSO BE FORMATTED AND DISPLAYED.  AN ENTRY IS ALSO PROVIDED
C       TO CALL A FUNCTION TO FORMAT AND CONVERT OTHER SYSTEM PARAMETERS. 
C               THE VALUE OF ISHRC AT THE COMPLETION OF A CALL WILL 
C       BE THE NUMBER OF REMAINING CHARACTERS IN THE BUFFER FOR 
C       DISPLAYING MORE INFORMATION ON THE SCREEN.
C 
C 
C 1.2.   RESTRICTIONS - limits on use of routine
C 
C 1.3.   REFERENCES - document cited
C 
C 2.  NAME INTERFACE
C 
C 2.1.   CALLING SEQUENCE: NLEFT=ISHRC(ITYPE,IXCOL,I1,I2,I3,I4,I5)
C 
C     INPUT VARIABLES:
C 
C       GLOBAL DEFS REFERENCED: "name'(local name if different)' ...
C 
      INCLUDE #SHOW::FS 
C 
C     OUTPUT VARIABLES: 
C 
C       GLOBAL DEFS REFERENCED: "name'(local name if different)' ...
C 
C       ISHRC   - THE NUMBER OF CHARACTER AVAILABLE FOR USE IN THE
C                 BUFFER IN CONSTRUCTING THE CURRENT DISPLAY LINE 
C                 (NOTE 0 MEANS INTERNAL BUFFER IS FULL AND NEW 
C                 REQUESTS OTHER THAN WRITTING THE BUFFER OR RESETING 
C                 WILL BE IGNORED)
C 
C 2.2.   COMMON BLOCKS USED 
C 
C 2.3.   DATA BASE ACCESSES 
C 
C 2.4.   EXTERNAL INPUT/OUTPUT
C 
C 2.5.   SUBROUTINE INTERFACE:
C 
C     CALLING SUBROUTINES: SUB1, SUB2, ... (not required for utilities) 
C 
C     CALLED SUBROUTINES: SUB1, SUB2, ... (includes segments scheduled) 
C 
C 3.  LOCAL VARIABLES 
C 
C       GLOBAL DEFS REFERENCED: "name'(local name if different)' ...
C 
        LOGICAL IBLNK 
C 
        DIMENSION LINE(85),IMTCH(26,22) 
C 
C       LINE    - INTERNAL BUFFER FOR SCREEN DISPLAY
C       IRGA    - CONTENTS OF A REG WHERE REG WAS RETURNED FROM FUNCTION
C                 CALL TO A ROUTINE 
C 
C       IRGB    - CONTENTS OF B-REG WHERE REG WAS RETURNED FROM FUNCTION
C                 CALL TO A ROUTINE 
C 
        DIMENSION IREG(2) 
C 
C       IREG    - DUMMY REGISTER RETREIVAL AID
C 
        EQUIVALENCE (REG,IREG(1),IRGA),(IREG(2),IRGB) 
C 
C 4.  CONSTANTS USED
C 
        DATA IBLIM/160/,IFRM0/0/,IMTCH/504*0/ 
C 
C       IBLIM   - THE MAXIMUM NUMBER OF CHARACTERS THAT MAY BE WRITTEN INTO 
C                 BUFFER LINE AT ONE TIME 
C 
C 5.  INITIALIZED VARIABLES 
C 
C 6.  PROGRAMMER: LEE N. FOSTER 
C     LAST MODIFIED:
C       LASTED EDITED ON <820506.2012>
C# LAST COMPC'ED  870115:05:47urrent date) #
C 
C     PROGRAM STRUCTURE 
C 
C               6.1  INITIALIZE VARIABLES 
C 
        INP=IGNPS(IND,IFRM) 
C 
C               SKIP ON IF NOT TYPE = 0 WITH RESET
C 
        IF(             INP .LT. 2
     .          .OR.    ITYPE .NE. 0
     .          .OR.    I1 .NE. 100000B)GO TO 20
C 
C               RESET INTERNAL LINE COUNTER 
C 
        NLN=0 
C 
C               CLEAR SCREEN IF ASKED TO AT THIS POINT  
C 
      IF(INP .GE. 4 .AND. I2 .EQ. 100000B)CALL EXEC(2,IXCOL,6000B,-1) 
20      CONTINUE
C 
C               ISOLATE IGO, INVERSE VIDEO AND COLUMN POSITIONS 
        IGO=IAND(ITYPE,77B) 
        IVID=IAND(ITYPE/100B,77B) 
        ICOL=IABS(IXCOL)
C 
C               HELD FINAL CALL IF THAT CASE NOW
C 
        IF(IGO .EQ. 63)GO TO 63000
C 
C               IF NOT INITIAL CALL SKIP ON 
C 
        IF(IGO .NE. 0)GO TO 100 
C 
C               SKIP INITIALIZATION IF LU NOT GIVEN 
C 
        IF(INP .LT. 2)GO TO 99990 
        CALL IFILL(LINE,1,160,2H  ) 
        NCHAR=1 
        NCHO=1
        IOCOL=1 
        IICOL=1 
        IMODE=0 
        NLN=NLN+1 
        LLN=NLN 
        ILU=IXCOL 
        ISHRC=IBLIM 
        GO TO 99999 
100    CONTINUE 
C 
C               CHECK FOR OFF SCREEN OR BUFFER FILLED 
C 
        IF(             ICOL .LE. 80
     C          .AND.   NCHAR .LT. IBLIM)GO TO 110
C 
        ISHRC=MAX0(IBLIM-NCHAR+1,0) 
C 
        GO TO 99999 
C 
110     CONTINUE
C 
C               FIND COLUMN POSITION FOR THIS ENTRY 
C 
        IF(IXCOL .GT. 0)IICOL=IXCOL 
        IF(IXCOL .LE. 0)IICOL=IICOL+NCHAR-1+IABS(IXCOL) 
C 
C               SAVE COLUMN POSITION START BUFFER AT BEGINNING  
C 
        IDCOL=IICOL 
        NCHAR=1 
C 
C               PICK THE ROUTE FOR THE TYPE OF CALL 
C 
        IG1=IGO-18
        GO TO (999,19999),IG1 
999   CONTINUE
        IF(IAND(IVID+1,2) .NE. 0)IMODE=1
        GO TO (99999,2000,3000,4000,5000),IGO 
2000   CONTINUE 
        IIS=1 
        ICNT=I2 
2010    CONTINUE
2020    CONTINUE
        NCHAR=ICHMV(LINE,NCHAR,I1,IIS,ICNT) 
        GO TO 19000 
3000   CONTINUE 
        NCHAR=IB2AS(I1,LINE,NCHAR,I2)+NCHAR 
        GO TO 19000 
4000   CONTINUE 
        NCHAR=IR2AS(I1,LINE,NCHAR,I2,I3)+NCHAR
        GO TO 19000 
5000   CONTINUE 
        NCHAR=IFAMS(LINE,NCHAR,I1,I2,I3,I4,I5)
        GO TO 19000 
19000   CONTINUE
        GO TO 64000 
19999   CONTINUE
        IF(IGO .NE. 20)GO TO 99990
        NCHAR=I1(I2,I3,LINE,NCHAR,IBLIM)
        GO TO 64000 
63000   CONTINUE
        DO 63800 I=LLN,14,7 
        ND=IMTCH(2,I)-IMTCH(1,I)
        IF(ND)63300,63700,63500 
63300   CONTINUE
        CALL IFILL(LINE,1,-ND,2H  ) 
        CALL IFILL(IMTCH(3,I),IMTCH(2,I)+1,-ND,0) 
        CALL IDLRC(LINE,-ND,IMTCH(3,I),42,IMTCH(2,I)+1,ILU,I,0) 
        CALL IFILL(IMTCH(3,I),IMTCH(2,I)+1,-ND,0) 
63500   CONTINUE
        IMTCH(1,I)=IMTCH(2,I) 
63700   CONTINUE
        IMTCH(2,I)=0
63800   CONTINUE
        GO TO 99990 
64000   CONTINUE
C 
C               FIND ENDING COLUMN OF THIS ENTRY
C 
        INCOL=IDCOL+NCHAR-1 
C 
C               IF USER IS WRITING INVERSE VIDEO RESULT IS BLINKING 
C 
        IBLNK = ICHCM(LINE,1,4HS2,1,4) .EQ. 0 
C 
C               IF BLINKING END COLUMN IS 5 POSITIONS EARLIER 
C 
        IF(IBLNK)INCOL=INCOL-5
C 
C               IF START COLUMN IS PAST 40 USE ONLY ALTERNATE LINE
C 
        IF(IDCOL .GT. 40)GO TO 64300
C 
C               FIND LENGTH TO WRITE ON THIS LINE NOW 
C 
        IOUT=MIN0(INCOL,41)-IDCOL 
C 
C               FOR BLINKING WRITE 5 MORE CHARACTERS
C 
        IF(IBLNK)IOUT=IOUT+5
C 
C               WRITE OUT THE INFORMATION FOR THIS LINE NOW 
C 
        IMTCH(2,LLN)=IDLRC(LINE,IOUT,IMTCH(3,LLN),40,IDCOL, 
     C  ILU,LLN,IMODE)
C 
C               IF END ON THIS LINE QUIT NOW
C 
        IF(INCOL .LE. 41)GO TO 64999
C 
C               SQUEEZE OUT INFO ON THIS LINE NOW 
C 
        NCHAR=ICHMV(LINE,1,LINE,IOUT+1,INCOL-41)
C 
C               SET START OF THIS LINE AND LAST LINE IN DISPLAY USED
C 
        IICOL=41
        IDCOL=41
64300   CONTINUE
C 
C               IF ENDING NOT ON ALTERNATE LINE QUIT NOW
C 
        IF(INCOL .LE. 41)GO TO 64999
C 
C               CORRECT COLUMN POSITION FOR THIS LINE NOW 
C 
        IDCOL=IDCOL-40
C 
C               COMPUTE ALTERNATE LINE NUMBER NOW 
C 
        N7=LLN+7
C 
C               WRITE THE INFORMATION ON THIS LINE NOW
C 
        IMTCH(2,N7)=IDLRC(LINE,NCHAR-1,IMTCH(3,N7),40,IDCOL,
     C  ILU,N7,IMODE) 
64999   CONTINUE
C 
C               TURN OFF INVERSE VIDEO MODE NOW IF REQUESTED  
C 
        IF(IAND(IVID,1) .EQ. 1)IMODE=0
99990   CONTINUE
        ISHRC=IBLIM-NCHAR+1 
99999   CONTINUE
C 
        RETURN
        END 
        END$
