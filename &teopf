FTN4,X
C@TEOPR 
        SUBROUTINE TEOPR(NAMEC,IP,NAMUS,MCNTL,NCNTL,IBUF,NAMEI) 
C 
      INCLUDE #FSCOM::FS
C 
      DIMENSION NAMEC(32,20),NAMEI(14,15),NAMUS(3),MCNTL(13),NCNTL(9) 
        DIMENSION IBUF(60)
C 
C       NAMEC   - PROGRAMS ACTIVATED BY CNTRL-CHARACTER BY OPERATOR 
C                 THE FOLLOWING INFORMATION IS IN THIS LIST;
C 
C               NAMEC(1-3,IX)   - ASCII NAME OF PROGRAM TO BE ACTIVATED 
C 
C               NAMEC(4,IX)     - PARTITION TO RUN PROGRAM IN 
C 
C               NAMEC(5,IX)     - PARTITION SIZE FOR RUNNING PROGRAM
C 
C               NAMEC(6-10,IX)  - DEFAULT PARAMETERS P1-P5 FOR PROGRAM
C 
C               NAMEC(11,IX)    - NUMBER OF DEFAULT PARAMETERS DEFINED
C 
C               NAMEC(12,IX)    - NUMBER OF COMMENT CHARARACTERS PRESENT
C 
C               NAMEC(13-32,IX) - COMMENT FOR USER 40 CHARACTERS MAX 
C 
C       NAMEI   - INITIALIZATION LIST FOR OPRIN OF PROGRAMS IT MUST 
C                 GET A FRESH COPY OF FOR THIS RUNNING OF THE FIELD SYSTEM. 
C                 THE INFORMATION IN THIS LIST IS AS FOLLOWS: 
C 
C               NAMEI(1-3,IX)   - ASCII NAME OF PROGRAM TO BE INITIALIZED 
C 
C               NAMEI(4,IX)     - SIZE OF PARTITION TO USE WHEN RUNNING(RTE-M)
C 
C               NAMEI(5,IX)     - PARTITION TO USE FOR RUNNING THIS PROGRAM 
C                                 (RTE-M). 0 IMPLIES LOAD INTO SYSTEM.
C 
C               NAMEI(6,IX)     - PRIORITY TO BE SET TO IF NOT=0
C 
C               NAMEI(7,IX)     - =IO1*400B+ISOP
C 
C                       IO1     - THE OFFING OPTION PRIOR TO START UP 
C                                 THIS SHOULD BE 0,1,2,8.  SEE HP SYSTEM
C 
C                       ISOP    - THE OPRIN INTERFACE EXEC OPTION 
C                                 THIS SHOULD BE 9,10,23, OR 24.
C                                 SEE HP EXEC CALLS OF THESE NUMBERS
C 
C               NAMEI(8,IX)     - =ISP*400+IIST+IOOP
C 
C                       ISP     - SPECIAL PROGRAM DESIGNATION WILL
C                                 MAKE CROSS REFERENCE IN NCNTL WHEN
C                                 NOT EQUAL TO 0. 
C                                       0 - NO SPECIAL FUNCTION 
C                                       1 - SEGMENT 
C                                       2 - FS MANAGER
C                                       3 - CHECKING MANAGER
C                                       4 - LOG SYSTEM MANAGER
C                                       5 - ASSIST LOG SYSTEM MANAGER 
C                                       10-15 - USER OPTIONS
C 
C                       IIST    - INITIAL STATUS OF PROGRAM AFTER INITIAL 
C                                 OFF IF REQUESTED.  0 - NOT PRESENT ORIGINALLY 
C                                 1 - PRESENT INIALLY(LEAVE UNLESS OFF
C                                 REQUESTED AT TERMINATION) 
C 
C                       IOOP    - OFFING OPTION AT COMPLETION 
C                                 VALUES SHOULD BE 0,1,2,8
C                                 NOTE 0 IMPLIOES NO ACTION 
C 
C               NAMEI(9-13,IX)  - INPUT PARAMETERS TO CALLING PROGRAM 
C                                 IF OPRIN INPUT REQUESTED IT WILL HAVE 
C                                 BEEN SUBSTITUTED HERE FROM IP.
C 
C               NAMEI(14,IX)    - THE NUMBER OF PARAMETERS TO BE PASSED 
C                                 TO THE CALLED PROGRAM, FROM (FSPGM LIST.
C 
C       MCNTL   - BRANCH CONTROL ARRAY
C 
C       IBUF   - BUFFER FOR GENERAL USE 
C 
        DIMENSION IP(11)
C 
C       IP      - INPUT PARAMETERS OBTAINED THROUGH RMPAR 
C 
C       NAMUS   - OUR NAME FROM IDSEG 
C 
C 4.  CONSTANTS USED
99000   CONTINUE
C 
C               CLEAR IRNPRC
C 
        IF(IRNPRC .NE. 0)CALL RNRQ(100040B,IRNPRC,ISTAT)
C 
C               CHECK IRNPRC
C 
        IF(ISTAT .NE. 0)GO TO 99001 
C 
99001   CONTINUE
C 
99200   CONTINUE
C 
C               GET 'DDOUT' INDX
C 
        INDX=NCNTL(8) 
C 
C               CHECK DEFINED 
C 
        IF(INDX .EQ.0)GO TO 99800 
C 
C               START DDOUT IF NEEDED(it wwill terminate itself)
C 
        ISTAT=IPGST(NAMEI(1,INDX))
C 
C               TELL USER WE ARE TERMINATING IF DDOUT PRESENT 
C 
      IF(ISTAT .NE. -1)CALL LOGIT(24H*FIELD SYSTEM TERMINATED,24,2H:: 
     .,NAMUS,-1)
C 
        IF(ISTAT .EQ. 0)
     .CALL EXEC(23,NAMEI(1,INDX),ICLBOX)
C 
99800   CONTINUE
C 
C               DISARM CONTROL FUNCTIONS
C 
        CALL EXEC(3,3500B+LU,-1)
C 
C               REARM SUSPEND ON BREAK
C 
        CALL EXEC(3,2700B+LU,-1)
C 
C               CHECK FOR CHEKR NO ABORTED
C 
        IF(NOFST .LE. 3)GO TO 99820 
C 
C               RESET ALL CHECK INDICATORS
C 
        CALL IFILL(ICHECK,1,36,0) 
C 
C               GET 'CHEKR' INDX
C 
        INDX=NCNTL(7) 
C 
C               CHECK DEFINED 
C 
        IF(INDX .EQ. 0)GO TO 99820
C 
C               WAIT FOR CHEKR TO FINISH WHAT EVER IT MAY BE DOING NOW
C 
        CALL EXEC(IAND(NAMEI(7,INDX),37B),NAMEI(1,INDX))
C 
C               GET 'CHEKR OFFING OPTION
C 
        IOFF=IAND(NAMEI(8,INDX),37B)
C 
C               NOW GET RID OF CHEKR CLEANLY
C 
        IF(IOFF .LT. 20B)CALL IDOFF(NAMEI(1,INDX),IOFF) 
C 
99820   CONTINUE
C 
C               SKIP IF INCOMPLETE START
C 
        IF(NCNTL(5) .EQ. 0)GO TO 99900
C 
C               OFF ALL PROGRAM ASSOCIATED WITH FIELD SYSTEM
C 
        DO 99899 I=1,NCNTL(5) 
C 
C               GET TERMINATION OFF OPTION
C 
        IOFF=IAND(NAMEI(8,I),37B) 
C 
C               LOG ENTRY SYSTEM SPECIAL CASE 
C               IF THIS PROGRAM IS AN ASSISTANT IN THE LES
C               AND IF THE MANAGER OF THE LES WAS JUST RUN TO 
C               COMPLETION THEN USE THE IOFF/2 NOW
C 
        IF(             IAND(ICHAR(NAMEI(8,I),1),376B) .EQ. 5 
     .          .AND.   ISTAT .EQ. 0
     .          .AND.   IOFF .GE. 16)   IOFF=IOFF-16
C 
C               REMOVE IF PRESENT 
C 
        IDAD=IGID(NAMEI(1,I)) 
C 
C               REMOVE IF PRESENT 
C 
        IF(             IDAD .NE. 0 
     .         .AND.    IOFF .LT. 20B)CALL IDOFF(IDAD,IOFF) 
C 
99899   CONTINUE
C 
C               OFF QR SEGMENT PRESENT
C 
        NCH=ICHMV(IBUF,1,2HQR,1,2)
        NCH=ICHMV(IBUF,NCH,NAMQR,3,4)-1 
C 
        CALL IDOFF(IBUF)
C 
C               CLEAR OPTIONAL LIST AS NEEDED 
C 
        DO 99900 I=1,NCNTL
C 
C               REMOVE IF NOT ORIGINALLY PRESENT
C 
        IF(             IGID(NAMEC(1,I)) .NE. 0 
     C    .AND.   NAMEC(4,I) .GE. 0)CALL IDOFF(NAMEC(1,I),8)
C 
99900   CONTINUE
C 
C               CONSTRUCT NEW TIMEOUT 
C 
        IF(IOTO .NE. 0 .AND. IOTO .LT. 12000)IOTO=32767 
C 
C               RESTORE TIME-OUT VALUE
C 
        CALL ITO(LU,IOTO) 
C 
        RETURN
        END 
        END$
