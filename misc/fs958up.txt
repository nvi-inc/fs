File: /usr2/fs-9.5.8/misc/fs958up.txt  Version: 1.0  Date: 020513

I. Introduction

This memo is divided into 4 sections:
   I.   Introduction.
   II.  Changes Since Version 9.5.3
   III. Installation
   IV.  Transferring The Update Archive By DOS Floppy

Please print this notice and read it carefully before installing the
new version. The intended audience for this version is EVN stations
participating the in the May EVN sessions. There are several new
features that will be useful or these stations including: mode
independent Tsys, periodic TPI, and onsource flagging. Otherwise there
are no critical updates. There is an improvement in the handling of
reproduce by DRUDG for double speed recordings with VLBA and VLBA4
recorders.

This version includes all features of 9.5.7, specially the Mark V
piggyback recording mode.

II. Changes Since Version 9.5.3

The sections is divided into three sub-sections: A. Change in the FS,
B. Changes in DRUDG, and C. Known Bugs. Each sub-section starts with a
summary of the items covered followed by a more detailed description.

			 A. Changes in the FS

The following is a summary of the changes. More detailed text follows
the summary. New features since 9.5.7 start at number 18.

1. VLBA42 recorder support
2. Improved error reporting in chekr
3. Mark V preliminary support
4. mcbad.ctl can now have comments
5. Assigning non-zero lag tracks for VLBA fan in Mark IV causes error
6. "help" now works for device independent commands when 2 drives are used
7. mark IV tracks= command accepts "*"
8. Monit i3/rx no-check display fixed
9. Mark IV barrel-rolling supported
10. GPIB support for NI driver fixed
11. K4 rec_mode and st commands re-organized
12. Reduced debug output for Mark IV formatter
13. pdplt has some presentation improvements
14. logpl has some presentation improvements
15. tacd error message improved
16. Data modulation supported for Mark IV
17. Other new Mark IV firmware features supported
18. TPI improvements
19. Periodic TPI measurements
20. Antenna onsource flagging
21. "inject_snap" returns command results

A more detailed discussion of these changes follows.

1. VLBA42 recorder support - Support has been added for a new recorder
   type: "VLBA42", which is a P&G recorder configured for Mark IV two
   head recording. The only know instance of this is at Torun. Some
   details still remain to be worked out and some revisions of the
   recorder firmware may still be required. This version contains what
   has been developed so far.
 
2. Improved error reporting in chekr - Error reports in chekr have
   been improved so that when a low-level communication error with a
   device occurs, the details of that error are reported.

3. Mark V preliminary support - Initial support to Mark V recorders is
   included. Currently Mark V recorders are only supported for
   experiments in so called "piggyback" mode. Please see
   /usr2/fs/misc/m5/readme.txt for a detailed description of currently
   available support for Mark V recorders.
 
4. mcbad.ctl can now have comments - Due to an oversight several years
   ago, comments (lines starting with asterisk, "*") could not not be
   included in the file. This has been fixed. Thanks to Dave Graham
   (MPIfR) for reporting this.

5. Assigning non-zero lag tracks for VLBA fan in Mark IV causes error
   - The FS now complains when standard VLBA fan-outs (1:2 and 1:4)
   are used with a Mark IV formatter and data has been assigned to a
   track used for a non-zero lag data and no data has been assigned to
   the associated zero lag track. Data may only be assigned to the
   zero lag channel. The error detection was already catching cases
   where data had been assigned to both non-zero and zero lag tracks
   in a fan-out group. Thanks to Dan Smythe (Haystack) who was
   unfortunate enough to discover the need for this improvement.

6. "help" now works for device independent commands when 2 drives are
   used - an error in the implementation of the help command prevented
   equipment independent commands from having their help files
   displayed. This was also corrected in fsvue.

7. Mark IV tracks= command accepts "*" - This feature was added to
   facilitate Mark V piggyback mode and may be removed at a latter
   date. When the track command is used without an asterisk, "*", as
   the first parameter only the tracks mentionde are enabled. If an
   asterisk is used, the mentioned tracks are enabled in addition to
   any already enabled.

8. Monit i3/rx no-check display fixed - An error in monit caused the
   check/no-check status of rx and i3 to be incorrectly
   displayed. Thanks to Richard Strand (Gilcreek) and Guiseppe
   Maccaferri (Medicina) for reporting this problem.

9. Mark IV barrel-rolling supported - The FS now support
   barrel-rolling with the Mark IV formatter. This requires the new
   firmware version, number greater than or equal to 40. Please see
   the Mark IV form and rollform commands for details.

10. GPIB support for NI driver fixed - A bug in IBCON which interacted
    with the NI driver to limit only one device per invocation of the
    FS to be read from. This has been fixed. Thanks to Jay Redmond
    (MV-3) for discovering this.

11. K4 rec_mode and st commands re-organized - The rec_mode command
    now includes settable control of the time-stamp insertion
    parameters for K-4 type 2 (DFC-2100) recorders. The defaults for
    these parameters are adjusted appropriately depending on the
    recording bandwidth. The rec_mode command now must be executed
    before a st=record for K-4 type 2 recorders.

12. Reduced debug output for Mark IV formatter - Due to the improved
    communications reliability of the new Mark IV formatter firmware,
    the amount logged debug information has been reduced. There are
    still formatters with the old firmware in the field, but as far as
    we know the old debug output was not actually found to be useful
    and so will probably not be missed greatly. The log file looks
    cleaner as a result of this change.

13. pdplt has some presentation improvements - The size of the pdplt
    window is now sensitive to the size of the display. This should
    allow the entire window to be displayed even on some lower
    resolution monitors. Thanks to Kokee park for reporting this
    problem. The labels in the table on the right hand side for the
    information on the point under the pointer have be
    re-aligned. Thanks to Andrey Mikhailov (IAA) for noting this
    issue.

14. logpl has some presentation improvements - The size of the logpl
    window is now sensitive to the size of the display. This should
    allow the entire window to be displayed even on some lower
    resolution monitors. Thanks to Kokee park for reporting this
    problem. Manual scaling now works. Thanks to Andrey Mikhailov
    (IAA) for noting this issue.

15. tacd error message improved - Some of the tacd error messages have
    been modified to make it clearer that they are coming from tacd.

16. Data modulation supported for Mark IV - The FS supports user
    control of data modulation with the Mark IV formatter.  This
    requires the new firmware version, number greater than or equal to
    40. Please see the Mark IV form command for details.

17. Other new Mark IV firmware features supported - The new version of
    the Mark IV formatter firmwares, numbers 40 or greater are now
    supported. In addition to barrel-rolling and data modulation
    control, some of the detailed interaction with the formatter has
    changed. Some of the later parameters in the form command have
    been modified. Please see the Mark IV form command documentation
    for more information.

18. TPI improvements. The TPI, TPICAL, TPZERO, and TSYSx commands have
    been overhauled. These changes are intended to make all use of
    these commands to be mode independent so that they do not have to
    be revised for different set-ups. In addition they are intended to
    compliment the new periodic TPI measurement scheme and to
    facilitate delogging of Tsys data to generate ANTAB files. There
    are several changes: (1) Two new detector types for each rack type
    can now be specified. For Mark III/IV racks: "formvc" and "formif"
    can be used. These specify the VCs that are currently having data
    formatted by the formatter and the IFs that feed these VCs
    respectively. For VLBA/VLBA4 racks the corresponding parameters
    are "formbbc" and "formif". The "formbbc" parameter will select
    all side-bands being recorded. For Mark III/IV, selection of
    sidebands depends on DRUDG which will select detectors "ul", "l"
    or "u" for each VC depending on which sidebands from that VC are
    being recorded. (2) The output format has been revised so that the
    detector readings are displayed paired with a preceding parameter
    that identifies the VC (or BBC) and which side-band or the IFD
    channel. The output is organized so that all detectors are
    displayed grouped by IF channel. All entries for the first IF
    channel are displayed, possibly on multiple lines if the output
    would be very long, followed by the second IF channel, and so
    on. The VCs (or BBCs) that haven't been commanded to an IF, either
    by the PATCH command or the BBCnn setup command are displayed
    before the other channels. The detector identifiers are all two
    characters. For the VCs/BBCs the first character is the hex
    converter number; the second character is the sideband
    (d=dual,l=lower,u=upper). For IF distributors, the first character
    is "i", followed by 1, 2, or 3 for the Mark III/IV and a, b, c,
    and d for VLBA/VLBA4 IF channels. The output TSYS5 and TSYS6 is
    still in the old format. (3) The TSYSx commands, where "x" is the
    IF channel, have been replaced, except for "x=5,6", with a single
    TSYS command that determines which Cal Diode value to use for
    calculations based on the IF set-up. Use of station detectors "u5"
    and "u6" in Tsys commands still require the use of TSYS5 and TSYS6
    to associate the detectors with the correct Cal Diode value. (4)
    The TPIC, TPICAL, and TPZERO commands will now not give up if one
    or more devices times-out or has some other communication
    error. Instead, detectors for which an error occurred will have
    their reading displayed as a negative value and all detectors that
    had their values read successfully will be displayed normally. (5)
    For VLBA and VLBA4 racks, a new command TPGAIN has been added that
    samples the BBC channel gains. The syntax, behavior, and output of
    this command is completely parallel to the TPI, TPICAL, and TPZERO
    commands. It displays the gain levels in the gain counts used by
    BBC. This command is needed to support the periodic TPI
    measurements for the VLBA and VLBA4 racks. It should be used to
    record the gain levels during the period when the gain is locked
    during PREOB. (6) To reflect the new mode independent nature of
    Tsys measurements, the "sxcts" standard SNAP procedure has been
    renamed "caltsys". (7) To allow plotting of the new format Tsys
    data, the "logpl" program has been modified to accept "-1" as a
    parameter number. This value means that the parameter occurring
    immediately after the "string" in the log entry is taken as the
    value.
 
19. Periodic TPI measurements. A new daemon, "tpicd" has been added to
    record TPI levels periodically during observations. The current
    implementation is preliminary, but is fully functional. It may be
    necessary to revise how the measurements are made, particularly in
    case of VLBA/VLBA4 racks, in the future. However, these changes
    will be essentially transparent to users, except perhaps for
    control file changes.

    The set-up of the periodic measurements is controlled by DRUDG
    which can be set-up to never use them, always use, or prompt the
    operator on an experiment by experiment basis for what to
    do. DRUDG adds the commands to the set-up procedures. We plan in
    the future to able to control this directly from the schedule to
    eliminate any need to prompt for this value.

    The periodic recording is turned on and off by the "data_valid=on"
    and "data_valid=off" commands. The sampling interval can be fixed
    or adjusted experiment by experiment. For Mark III/IV (and
    VLBA/VLBA4) racks all the VCs (and BBC sidebands) and IFs that
    were set-up for recording in the set-up procedure are sampled at
    the specified interval and recorded in #tpicd#tpi/ (and
    #tpicd#tpgain/) log entries. For VLBA/VLBA4 racks the IF channel
    TPI levels are reported in tpgain/ entries even though strictly
    speaking they aren't gains. The log entries use the same
    formatting style, and communications problem handling as the TPI
    and TPGAIN commands. To reduce the amount of clutter in the
    information presented to the operator, these log entries are not
    displayed. They are only added to the log.

20. Antenna onsource flagging. A new daemon, "flagr" is provided to
    report onsource status periodically. The interval is set in a new
    control file "flagr.ctl". The interval may need to be adjusted
    depending on the behavior of a station's antcn. In extreme cases
    it may need to be disabled by setting the interval to a
    non-positive integer. The "flagr" program puts out four different
    records depending on the situation:

    #flagr#flagr/antenna,new-source
    #flagr#flagr/antenna,acquired
    #flagr#flagr/antenna,off-source
    #flagr#flagr/antenna,re-acquired

    The "flagr" determines which is appropriate by comparing the
    currently commanded source to the previous one running antcn in
    mode "5" to test the onsource status. It is important that antcn
    mode "5" not produce any log output. Besides checking at the
    specified interval, "flagr" is forced to check for each
    "source=.." and "onsource" command. Stations that implement their
    sidereal tracking loop in the FS computer can probably achieve
    better resolution (and are encouraged to do so) by disabling
    "flagr" and outputting the log entries "flagr/antenna,..." as
    appropriate from their own programs (the #flagr# field will be
    replaced by the name of the local program). A post processing
    script will be developed to generate a flagging table from this
    data for AIPS and other possible users.

21. "inject_snap" returns command results. The "inject_snap" command
    has been expanded to accept a single additional argument, "-w"
    ("w" for "wait") before the command to send to the FS. If this
    flag is set, "inject_snap" will wait for the command to complete
    and print the results to standard output. If any error is
    encountered, either the FS not being active or if the executed
    SNAP command produces an error, "inject_snap" will return an
    non-zero status, which can be tested for. The output is the terse,
    "no-news is good news", "xdisp=on" format that is usually
    displayed to the operator. In the future there might be a switch
    to enable extended display. For certain "soft" errors, such as
    parity and synch error thresholds being exceeded in the "parity"
    command, the formatter synch test failing and the not enough zeros
    in the rack ID in the Mark IV "form" command are not reported. The
    "date" command does not produce any output for "inject_snap
    -w". The error messages are in a slightly different, but easier to
    parse format if they contain an addition string or number. All of
    these short-comings can be addressed in future versions depending
    on interest. If a SNAP procedure is executed or an external
    program is started by using "inject_snap -w", the "inject_snap"
    program will return immediately after the procedure or program is
    initiated, not when it is finished.

    This change is preliminary and it is expected that it will be
    expanded in the future. The basic concept is broader than
    providing the ability to enter and see the results of SNAP
    commands on text terminals. This facility can be used to provide a
    "FS" server which can be used in scripting language (Tcl, Perl,
    Python, etc.) to send commands to the FS and retrieve results
    without having to tail the log. In some sense this solves the
    conundrum of which scripting language should be built into
    SNAP. Any user is allowed to pick the scripting language they
    prefer. They can form SNAP commands in that language, pass them to
    the FS, and retrieve the results. Several expansions of this
    facility can be made depending on users needs. For example instead
    of just printing the results to standard out, they could
    optionally (by use of another command line switch) be returned by
    a different mechanism or in a format suitable for a particular
    scripting language. For example for Tcl, there might be option to
    place response parameters into a list. Another expansion that is
    seen as likely is to include a program that might be called
    "fs_state", to return the status of some programs such as "fivpt"
    and "onoff" or information that is stored in shared memory.

                         B. Changes in DRUDG

drudg opening message date is 020510. The following areas in DRUDG were
modified. Changes since version 9.5.7 start with item 6.

1. S2 experiment corrections
2. REPRO command additional parameter.
3. Barrel roll support.
4. Mark5 piggyback support.
5. Data modulation. 
6. Control file addition.
7. New command in setup procedures.
8. VC command changes.
9. REPRO command changes.

A more detailed discussion of these changes follows.

1. S2 experiment corrections. Thanks to sleuthing by Jonathan Quick
several problems with generating .snp files for S2 recorders were
fixed. Schedules for next Syowa session (NASA sked format file input)
and a recent LBA session (NRAO VEX file input) now work properly.

2. REPRO command additional parameter. The setup procedures for
stations with Mk4 and VLBA4 recorders were changed so that the
REPRO command now has the track bitrate parameter explicitly given.
This should remove problems with the decoder misbehaving during
bypass reproduce.

3. Barrel roll support. The barrel roll parameter on the FORM
command is provided for stations with Mk4 formatters when barrel
roll is turned on in the schedule file. Two "canned" rolls are
recognized: rolling by 8 and 16. In the FORM command the roll
parameter will be "8" or "16". Stations with VLBA formatters using 
barrel roll will have "8:1" and "16:1" as the two possible rolls.

A procedure with ROLLFORM commands is written for cases where the 
barrel roll is specified but is not equal to one of the two canned 
modes. In this case the roll type on the FORM command is "M". The
feature of arbitrary roll tables is only available when using a
VEX file as input because the older sked-format file does not have
this capability.

4. Mark5 piggyback support. The use of Mark5P systems in piggyback
mode is support in procedure files (.prc) and SNAP files (.snp)
generated by drudg. In this mode the normal tape recording is done
and the Mark5 disc recording is done simultaneously using the same 
data bits. Stations with VLBA formatters use the second recorder 
output to feed the Mark5 and stations with Mk4 formatters use the 
second head output. 

To invoke the Mark5 mode in drudg, use new Option 13 which toggles
the mode on and off.

The .snp file has the following new disc control commands located
adjacent to the normal commands:
  READY          followed by READY_DISC
  TAPE           followed by DISC_POS
  DATA_VALID=ON  followed by DISC_START
  DATA_VALID=OFF followed by DISC_END 
  TAPE           followed by DISC_POS and DISC_CHECK

The .prc file for stations with VLBA formatters is identical to the
non-Mark5 file.

The .prc file for stations with Mk4 formatters has additional commands
to specify the tracks and data source on the second head. 
Example for the Intensive at Wettzell:
normal:  tracks=v0,v1,18,19,20,21,22,23,24,25,26,27,28,29
add:     tracks=*,v4,v5,118,119,120,121,122,123,124,125,126,127,128,129
normal:  trackform=2,1us,6,2us,10,3us,14,4us,18,5us,22,6us,26,7us,3,8us
normal:  trackform=7,9us,11,10us,15,11us,19,12us,23,13us,27,14us
add:     trackform=102,1us,106,2us,110,3us,114,4us,118,5us,122,6us,126,7us,
add:     trackform=103,8us trackform=107,9us,111,10us,115,11us,119,12us,
add:     trackform=123,13us,127,14us


NOTE: The Mk5 mode is intended for use with the geodetic Intensive
sessions as a test series. This mode should not be used for general
Mk5 recording because there are special conditions that have to be
met that might not exist appropriately for every schedule.

5. Data modulation. If data modulation is ON, then "ON" is added 
as a parameter on the FORM command. This feature is available only
when a VEX file is used as input because the older sked-style
format does not have the ability to specify data modulation.

6. Control file addition. Parameters for the new TPI daemon may
be specified in the control file. Extensive comments in the 
fs/st.default/control/skedf.ctl file show the legal values for 
parameters on the "tpicd" line in the $misc section. Default 
values within drudg are set to not use the daemon if you do 
not enter the new line in the control file. 

7. New command in setup procedures. The TPICD commands are output
in the setup procedures. If the control file specifies that the
user is to be prompted for the period, then a prompt is issued and 
the default value for the period is displayed. If the control file
specifies that no prompt is wanted, then the default value in
the control file is always used. If the daemon is not in use,
the command is tpicd=no,0.

8. VC command changes. The TPI monitor for video converters (either
u, l, or ul) is explicitly listed in the VC commands. 

9. REPRO command changes. For VLBA and VLBA4 drives, the bitrate
parameter was moved to the 7th command parameter.



			    C. Known Bugs

The following is a summary list of known bugs. They are described in
more detail after the list.

1. There are communication problems with the Mark IV formatter. 
2. Do not run "fmset" for extended periods.
3. "odd" and "even" head types not supported for Mark IV & VLBA4.
4. "odd"/"even" head types not supported for VLBA style tapeforms.
5. CHEKR does not check the status of the Mark IV formatter.
6. DRUDG almost always generates IF3 commands for Mark III/IV racks.
7. Extraneous errors when tape is stopped by low tape sensor.
8. "Comm=" command in logex extracts only the first command.
9. S2 error scheme clumsy.
10. No extra spaces allowed in "ibad.ctl" file.
11. ONOFF and FIVPT programs hang.
12. FS SNAP command pages don't list tape drive suffix numbers.
13. Tk/tcl problems

A more detailed discussion of these bugs follows.

1. There are communication problems with the Mark IV formatter.  It
apparently misses some characters that are sent to it and time-outs on
occasion.  It appears that this is related to the 1 PPS interrupt
service routine in the formatter.  In spite of this problem, we have
managed to make formatter communications fairly robust.  It is
important that the (extra) time-out parameter for the formatter in the
"matad.ctl" file be set to 200 centiseconds.  The FS will try all the
communications up to three times if an unrecognized command response
(formatter error "7") or time-out occurs.  Debug information about
communication errors are logged in the log file, but are not displayed
in the log display window.

A further problem which may or may not be related is that very rarely
(although one case was repeatable and therefore was coded around) the
formatter A/D assignments (sent with the "/ASS" command) do not appear
to take.

The formatter is not using the correct line protocol for the MAT bus.
It is using one rather than two stops bits at 9600 BAUD.  The main
manifestation of this is that occasionally the formatter reports
communication errors in the "error word".  Whether or not this
contributes to the other communication problems is unclear.

Another problem related to using the Mark IV formatter on the MAT bus
has been noticed both on the development system at Haystack and at
Effelsberg.  After switching to version 9.3.1, both systems had
occasional headstack controller MAT hangs.  It is unclear how the FS
could cause this to happen.  It may be a problem generic to the head
controller.  This problem has happened very rarely: three or four
times at Haystack over one particular week and we don't know how many
times it occurred at Effelsberg.  Recovery is possible by just
reseting the head controller MAT.  If this happens to you please let
Ed know.

Another problem is that occasionally the formatter "stutters" the
first character of its response.  In the case the first character is
repeated and the second characters are omitted.  This is fairly benign,
but may appear to cause intermittent problems.

Another formatter problem is that it occasionally responds incorrectly
with a NAK.  However this version of the Field System is able to handle
this case completely.

Improved formatter firmware has made its way into the field. The next
revision of the FS will contain improvements in the formatter's
behavior.

2. Do not run "fmset" for extended periods. For stations that have
VLBA, Mark IV back-ends and/or an S2 recorder, the "fmset" program
should not be run for extended periods of time.  The "fmset" program
should be used only to set or briefly verify that the formatter time
is correct.  Do not leave "fmset" running after completing either of
these tasks, especially during an experiment.

The "fmset" program dominates the Field System when it is running and
this is likely to interfere with the running of an experiment or other
activities.  The only way to detect the time from the VLBA formatter
with greater precision than one second it to wait for the seconds
response from the formatter to change.  This requires the FS to
communicate with the formatter almost continuously.  A similar problem
exists for the S2 recorder.  This problem is less severe for the Mark
IV formatter, but extended use of "fmset" in this case should be
avoided as well.  In a future revision, this will be made more robust
so that there will probably be less danger if "fmset" is left running.
However, even in the future "fmset" should only be left running for as
short a time as possible.  A reminder about this is included in the
"fmset" menu.


3. "odd"/"even" head types not supported for Mark IV & VLBA4. The
Mark IV and VLBA4 rack version of the "form" command and the Mark IV
and VLBA4 recorder versions of the "repro" and "parity" commands do
not support the "odd" and "even" parameters for the read and write
head types and reproduce electronics in the "head.ctl" control file.
This means that automatic substitution of odd or even head in passes
that use only even or odd heads respectively does not occur.  The only
correct settings for the read and write head parameters and reproduce
electronics is "all".  This will be fixed in a future revision.
Please let Ed know if you are missing some tracks and need to work
around this limitation.

4. "odd"/"even" head types not supported for VLBA style tapeforms. For
any mode recorded with VLBA style tapeform (14 index positions), the
only correct setting of the read and write head types on the
"head.ctl" is "all".  This will be fixed in a future revision.  Please
let Ed know if you are missing some tracks and need to work around
this limitation.

5. CHEKR does not check the status of the Mark IV formatter.
Implementation of this has been deferred until the formatter
communication problems have been resolved.

6. DRUDG almost always generates IF3 commands for Mark III/IV racks.
This always occurs for experiments run from .DRG and non-VEX .SKD
files regardless of whether they are needed or not.  This occurs
because it is impossible to know whether IF3 is needed or not.

7. Extraneous errors when tape is stopped by low tape sensor. When a
tape drive has been commanded to move the tape and then stops because
it hit the low tape sensor (or when S2 recorders hit the BOT or EOT),
"CHEKR" will complain periodically that the tape drive is not in the
correct state.  In principle the FS should be smarter about this.
However, if the tape is managed correctly by the schedule this error
message should never occur.  If it does, then it it an indication that
there is either a problem with: (1) the schedule, (2) the check
procedures, (3) the recorder, or (4) the tape is too short.  If any of
these cases apply they should be corrected.  It is more likely that
this error message will occur when the tape is being controlled
manually.  In this case, issuing an "ET" command will convince the FS
that the tape drive should be stopped and the error message will
cease.

8. "Comm=" command in logex extracts only the first command. The
"comm=" command in "logex" extracts only the first command commanded
and displayed.  This problem was noted by Giuseppe Maccaferri
(Medicina).

9. S2 error scheme clumsy. The error and status response number
reporting scheme for S2 recorders is clumsy.  FS errors that have
mnemonic "rl" are mostly error responses from the recorder or the RCL
interface library that is used to communicate with the recorder.  If
the numeric part of an "rl" error is greater than -130, then it is the
error code returned by the recorder.  If the numeric part is less than
-130, but greater than -300, then add 130 to the value, the absolute
value of the result is the error response code from the RCL library.
For values less than or equal to -300, a FS error has been detected.
Status response codes are all reported with mnemonic "rz" and the
numeric value is the negative of the status response code.  In all
cases an appropriate error or status message is displayed.  These
messages are retained in the log.

10. No extra spaces allowed in "ibad.ctl" file. The format of the
"ibad.ctl" must not contain any leading or embedded spaces.  In system
that use the LLP AT-GPIB driver (pre-FS Linux 4), if either the option
"no_untalk/unlisten_after" is misspelled or an incorrect device name
is supplied, the driver will cause a segmentation violation when it is
initialized and the FS will terminate.  Unfortunately there is no way
to prevent this problem in a general way; it reflects a limitation in
the driver.

11. ONOFF and FIVPT programs hang. The ONOFF and FIVPT programs have
been known to "hang" mysteriously.  This seems to be caused by some
problem with the "go" mechanism that is used to restart the program
when it pauses to allow a SNAP procedure, such as CALON or CALOFF to
execute.  The "go" that is used to restart the program fails for some
reason.  This has been exceedingly difficult to debug because it is
intermittent and fairly rare.  There is however a good work around for
it.  The CALON and CALOFF procedures are called by procedures CALONFP
and CALOFFFP for FIVPT and CALONNF and CALOFFNF for ONOFF.  FIVPT or
ONOFF may hang during (or actually just after) the execution of one
these procedures that FIVPT and ONOFF will typically hang.  If this
happens, you will have to terminate the FS to recover.  You can
prevent it from happening again (for this procedure) by adding the
lines:

!+1s
sy=go fivpt &

to the end of CALONFP or CALOFFFP.  For CALONNF and CALOFFNF, please
add:

!+1s
sy=go onoff &

If you see other situations where FIVPT or ONOFF hang, please let Ed
know.

12. FS SNAP command pages don't list tape drive suffix numbers. The FS
SNAP manual pages and the help pages available through the "help="
command do not reflect when multiple versions are available with
different suffixes depending on the number of drive specified in the
control files. For example, there is only a "tape" page, no "tape1" or
"tape2" page. However, the help facility will display the version of
the command with no suffix when an available command with a suffix is
used. For example, if two drives are defined, then "help=tape1" and
"help=tape2" will work, but "help=tape" will not and vice-versa if
only one drive is defined.

13. Tk/tcl problems. Please note the following problems with Tk/tcl
applications in the FS: (1) defining the plot limits manually in
"logpl" does not work, i.e., only "autoscale" works, (2) the labels
for point information in the upper right corner of "pdplt" does not
line up with the data for all versions of Tk, (3) the windows of the
"msg" and "logpl" utilities are too large to work with comfortably on
some smaller resolution displays, particularly 1024x768.

III. Installation

If you are installing FS9 for the first time with this version, please
follow the installation instructions in Section 4.5 of the FS9
"Computer Reference" manual or the "nfsload.txt" memo.  In this case
you should also get a copy of the current FS9 "Control Files and Field
System Initialization" manual.

If you are upgrading from 9.5.7, please follow steps (0)-(11) and then
skip to and follow steps (15)-(19).

The steps in section describe how to install this version as an
upgrade from 9.5.3. Please follow all the steps.

If you are upgrading from an different version that wasn't mention
here, please contact Ed for additional instructions.

(0) Before you begin the upgrade make sure you have a current back-up
of your system in case something goes wrong.  Please refer to the
directions for making disk-to-disk back-ups in Section 5.8 of the FS9
"Computer Reference" manual.  If you are running one of the Debian
distribution kernels and do not have documentation on how to make a
back-up, please contact Ed.  Section 5.7 of the FS9 "Computer
Reference" manual has a discussion of drive ID numbers if you are
unsure about these.  You may choose to install the FS on your back-up
disk for testing and then later copy the back-up onto the primary once
you are satisfied with the new version.  In any event, please be sure
to make a fresh back-up before continuing with the installation.

(1) Please be sure that you have at least 20 MB of free space (use the
"df" UNIX command to check free space) on your "/usr2" partition
before starting the upgrade.  This would probably only be a problem
for stations with 200 MB disks.  If you are tight on space, you may
want to delete old log files and old versions of the FS (except your
most recent one of course).  Since you should have backed-up your
system, you even can delete the "*.[oas]" and executable files of your
most recent version.  You might want to keep the source of the previous
version around for reference if you have room.  You can eliminate the
unnecessary files by "cd"-ing to the old FS directory as "prog" and
doing a "make rmdoto rmexe".  If you have any questions about how to
do this, please contact Ed.

(2) Log-in as prog.

(3) Place a copy of the fs-9.5.8 archive in your "/tmp" directory. For
example you might do the following:

    cd /tmp
    ncftp -u atri.gsfc.nasa.gov
    (enter your account name for the server at prompt)
    (enter your password for the server at prompt)
    cd /home/ftp/fs/test
    get fs-9.5.8.tar.gz
    quit

Please note "ncftp" will automatically get this file in binary mode.
If you use "ftp" you may have to enable binary mode manually.

If you need to transfer the archive using DOS floppies, please see the
section "IV. Transferring The Update Archive By DOS Floppy" below.

(4) Log-out as prog and log-in as root.

(5) Extract the source from the archive:

    cd /
    tar -xzpf /tmp/fs-9.5.8.tar.gz

(6) Set the link for the new FS vesion:

    cd /usr2
    ln -sfn fs-9.5.8 fs

(7) VERY IMPORTANT: Log-out as root, and log-in prog.

(8) Make the FS:

    cd /usr2/fs
    make

(9) Remake your local software. To remake the software if you have
    standard station software "Makefile" configuration, the following
    steps should do the trick:

      cd /usr2/st
      make rmdoto rmexe all

(10) Reboot the computer.

(11) Log in as oper

(12) Add the Mark IV formatter firmware version number to the
     equip.ctl file. This should be the new last line of the
     file. You can use /usr2/fs/st.default/control/equip.ctl as a
     guide. If you don't have a Mark IV Formatter or don't know what
     version of the firmware you have you can use "40" for now. If you
     have Mark IV formatter and did not know the firmware version, you
     can query the formatter with the "form" command to find the
     correct value and then modify your control file. The version in
     the control file must agree with the version in the formatter and
     the FS will complain if it doesn't.

(13) Set-up the "mk5ad.ctl" control file. As oper:

       cd /usr2/control
       cp /usr2/fs/st.default/control/mk5ad.ctl .

     If you have a Mark V recorder, edit the file
     "/usr2/control/mk5ad.ctl" and enter the address, port, and
     time-out for the Mark 5 recorder. Using the IP address instead of
     the host name is strongly recommended. If you only have the host
     name, it is easy to look-up its address with "nslookup". The
     initial port number is 2620. It is unknown what the correct
     time-out should be.  Initially, 100 is recommended if the Mark 5
     is on the local network; 500 for a remote device. If time-outs
     occur these values can be increased.

(14) Append "ready_disc" to your station.prc file. As "oper":

       cd /usr2/proc
       cat /usr2/fs/st.default/proc/m5.prc >> station.prc

(15) Set-up "flagr.ctl" control file. Please copy the default version
     to your control file directory:

       cd /usr2/control
       cp /usr2/fs/st.default/control/flagr.ctl flagr.ctl

     Please edit this file to set the onsource status checking
     interval. The first non-comment record in the file is the number
     centiseconds for the interval. It is recommended that this be set
     to 200 (2 seconds) under normal conditions. However, if your
     "antcn" proram" takes a longtime to run, you may prefer to set it
     to a longer interval to avoid tying up the program. In addition,
     if "flagr" returns incorrect results or seems to be causing other
     problems with your system, it is recommended that you disable it,
     by setting the interval to zero, "0", until the problem is
     resolved.

(16) Modify your procedure files for the new TPI, TPICAL, TPZERO,
     TSYS, and TPGAIN commands. These changes are probably confined
     entirely to procedures in your "station.prc" file, but a check of
     other procedure files is recommended. For the standard
     procedures, you can compare your procedures to the defaults in
     /usr2/fs/st.default/proc. Handling for Mark III/IV (steps with
     labels starting with "M") and VLBA/VLBA4 (steps with labels
     starting with "V") provided separately.

     Please note that support periodic TPI measurement, it is
     necessary that PREOB be set-up as described.

     Please also note that it would be more correct to measure TPZERO
     in PREOB. If you can do this without having PREOB run over the 10
     second limit, it is recommended that you do that. In this case
     you can remove the TPZERO measurements from the MIDTP procedure.

     For Mark III/IV systems:

       M1. Please make the section of your PREOB procedure that
           handles TPI measurements look like this:

             calon
             !+2s
             tpical=formvc,formif
             caloff

           or if you can include TPZERO:

             calon
             !+2s
             tpical=formvc,formif
             caloff
             ifd=max,max,*,*
             if3=max,*,*,*,*,*
             !+2s
             tpzero=formvc,formif
             ifd=old,old,*,*
             if3=old,*,*,*,*,*


       M2. Please make the section of your MIDOB procedure that
           handles TPI measurements look like this:
 
             tpi=formvc,formif
             caltemps
             tsys=formvc,formif

           If this gives erratic Tsys results, please add a two second
           wait before the "tpi=formvc,formif". If the commands before
           this take two or more seconds to complete, this shouldn't
           be necessary.

       M3. Please rename your SXCTS procedure to CALTSYS and make its
           contents look like:

             tpi=formvc,formif
             ifd=max,max,*,*
             if3=max,*,*,*,*,*
             !+2s
             tpzero=formvc,formif
             ifd=old,old,*,*
             if3=old,*,*,*,*,*
             calon
             !+2s
             tpical=formvc,formif
             caloff
             caltemps
             tsys=formvc,formif

       M4. Change all uses of "sxcts" in your procedure libraries to
           "caltsys".

       M5. Please make the section of your MIDTP procedure that
           handles TPI measurements look like this:

             ifd=max,max,*,*
             if3=max,*,*,*,*,*
             !+2s
             tpzero=formvc,formif
             ifd=old,old,*,*
             if3=old,*,*,*,*,*

           or if you have placed TPZERO measurements in PREOB, you can
           delete these lines.

     For VLBA/VLBA4 systems:

       V1. Please make the section of your PREOB procedure that
           handles TPI measurements look like this:

             bbcman
             calon
             !+2s
             tpical=formbbc,formif
             tpgain=formbbc,formif
             caloff

           or if you can include TPZERO:

             bbcman
             calon
             !+2s
             tpical=formbbc,formif
             tpgain=formbbc,formif
             caloff
             ifdab=20,20,*,*
             ifdcd=20,20,*,*
             !+2s
             tpzero=formbbc,formif
             ifdab=0,0,*,*
             ifdcd=0,0,*,*

       V2. Please make the section of your MIDOB procedure that
           handles TPI measurements look like this:
 
             tpi=formbbc,formif
             bbcagc
             caltemps
             tsys=formbbc,formif

           If this gives erratic Tsys results, please add a two second
           wait before the "tpi=formbbc,formif". If the commands
           before this take two or more seconds to complete this
           shouldn't be necessary.

       V3. Please rename your SXCTS procedure to CALTSYS and make its
           contents look like:

             bbcman
             tpi=formbbc,formif
             ifdab=20,20,*,*
             ifdcd=20,20,*,*
             !+2s
             tpzero=formbbc,formif
             ifdab=0,0,*,*
             ifdcd=0,0,*,*
             calon
             !+2s
             tpical=formbbc,formif
             tpgain=formbbc,formif
             bbcagc
             caloff
             caltemps
             tsys=formbbc,formif

       V4. Change all uses of "sxcts" in your procedure libraries to
           "caltsys".

       V5. Please make the section of your MIDTP procedure that
           handles TPI measurements look like this:

             bbcman
             ifdab=20,20,*,*
             ifdcd=20,20,*,*
             !+2s
             tpzero=formbbc,formif
             bbcagc
             ifdab=0,0,*,*
             ifdcd=0,0,*,*

           or if you have placed TPZERO measurements in PREOB, you can
           delete these lines.

(17) Update your skedf.ctl file. Please add a tpicd line to the end of
     your sked.ctl control file for DRUDG. At this time, we have the
     following recommendations: (i) stations that do only geodesy or
     do not have VLBA BBCs or Mark III/IV VCs should set the line for
     "no" prompt and not to run the daemon, period "0", (ii) stations
     that do only astronomy and have VLBA BBCs or Mark III/IV VCs
     should set the line for "no" prompt and the period to 15 seconds,
     "1500" (centisecods), and (iii) stations with VLBA BBCs or Mark
     III/IV VCs and do both geodesy and astronomy, should set it for
     "yes" prompt" and a default interval of 15 seconds, "1500"
     centiseconds. For case (iii), when DRUDG-ing geodesy schedules, a
     value of "0" can be provided to the prompt to disable periodic
     measurements; for astronomy, the default can be accept enable
     periodic measurements. Perhaps some more convenient means can be
     worked out locally at stations in this class until this can be
     controlled by the schedule.

(18) Update your logpl.ctl control file and scripts. The parameters
     used to plot value from the tsys/ lines will need to be changed
     to reflect the change in the format of these commands. The
     commands TSYSx, where "x" is one of "1,2,3,a,b,c,d" have been
     combined into one TSYS command. You will need to change the name
     of the commands accordingly. You should use "-1" as the parameter
     number. Provide the detector label for the detector's whose value
     you want to plot. Some examples are:

     Label    Detector
     "ia"     VLBA IFD A
     "ib"     VLBA IFD B
     "ic"     VLBA IFD B
     "1u"     VLBA BBC  1 Upper Sideband
     "1l"     VLBA BBC  1 Lower Sideband
     "eu"     VLBA BBC 14 Upper Sideband
     "i1"     Mark III/IV IFD 1
     "i2"     Mark III/IV IFD 2
     "i3"     Mark III/IV IFD 3
     "1d"     MArk III/IV VC 1  Dual Sideband 
     "1u"     MArk III/IV VC 1 Upper Sideband 
     "1l"     MArk III/IV VC 1 Lower Sideband 

(19) Test the FS.  Generally speaking a fairly thorough test is to run
     a test experiment: start with DRUDG-ing a schedule, executing
     part of it (preferably at least a tape change and a parity check
     in each direction), do any normal post-experiment plotting and
     clean-up that you do.  The idea here is to verify that everything
     works as you expect for normal operations.  It also is a good
     idea to (at least) briefly try any calibration procedures that
     you use the FS for, such as pointing and narrow track head
     calibration.


VII. Transferring The Update Archive By DOS Floppy

In order to assist sites that need to transfer the FS archive by DOS
floppy, "split" files of the fs-9.5.8.tar.gz archive have been placed
in the /fs/dist directory on atri.gsfc.nasa.gov.  These files are
small enough to each fit on 1.44 MB 3.5" floppy.  The files are:

fs958tg.aa
fs958tg.ab

If you need to use DOS floppies to get files to the FS computer,
please copy these files to some directory such as /tmp on the FS
computer and then execute the command:

cat fs958tg.* >fs-9.5.8.tar.gz

This will create an exact image of the original fs-9.5.8.tar.gz
archive on your computer.  Please be sure to use binary transfer when
getting the files from atri or kurp-ftp.
