File: /usr2/fs/misc/fs9116up.txt        Version:4.7  Date: 140805

I. Introduction

This memo is divided into three sections:

   I.   Introduction.
   II.  Changes Since Version 9.10.4
   III. Installation

Please print this notice and read it carefully before installing the
new version.

This update is intended for all stations.  This version is required
for any station running (or upgrading to) the FSL9 Linux distribution.
It is not required, but it is strongly recommended for stations that
either have a DBBC and use TPICD to collect TPI data periodically or
use jive5ab to control a Mark 5B for recording.  We encourage all
stations to upgrade now because doing so will make future upgrades
easier.  The upgrade from versions 9.11.3-9.11.5 is particularly quick
and easy (see section "III. Installation").

The most significant changes in version 9.11.6 are:

  (i) Fix for a bug that caused TPICD to crash if there was
      a communication error with a DBBC.

 (ii) Improvements in FMSET including changes to make it more
      compatible with jive5ab for Mark 5B recorders.

(iii) Improvements in FLAGR including to provide an error message if
      during a schedule a new source is commanded before the previous
      one was reached.

 (iv) The Mark 5B clock rate can be set from the equip.ctl file for
      unusual equipment set-ups.  This must be used with caution, see
      item 46 in the FS Changes below.

  (v) A time-out feature for the "onsource" command to facilitate
      local test operations (only).

 (vi) Support for the new FS Linux distribution, FSL9, based on Debian
      Wheezy.

The full list of changes in all 9.11.x versions, by version number, is
given in the "Changes Since Version 9.10.4" section below.

As always, we are deeply indebted to Jonathan Quick (HartRAO) for his
various and significant contributions.

The remaining material in this "Introduction" section relates to
changes in previous versions of 9.11.x.  This may be interest to those
who have not installed 9.11.5 already.

The most significant changes in prior version 9.11.5 were (i) to allow
FS stations to DRUDG schedules that have RDBE and Mark 5C equipment at
other stations and (ii) to allow Tsys to work correctly for systems
with Mark 5B (and Mark 5A) recorders during eVLBI by selecting "none"
as the recorder type in DRUDG.  Item (ii) should have removed the need
to run a script to "fix" the .snp and .prc files for eVLBI. i.e., the
operator can just select "none" in DRUDG as the recorder type.
Additionally, a new interlock was introduced in the "schedule=..."
command to prevent changing schedules (or changing to a different line
number in the current schedule) when disk recording has been
commanded.

In prior version 9.11.4, most of the changes were related to DRUDG
with some minor bug fixes in the FS itself.  The changes to DRUDG are
needed to enable handling of upcoming EVN and LBA schedules.

The most significant changes in DRUDG in 9.11.4 include:

    i. Different BWs at different stations are handled (different BWs
       cannot be used at one station in one mode).
   ii. Some improvement in the handling of schedules with unsupported
       rack and recorder types at other stations, reducing the number
       of cases where DRUDG to fails (they are converted to type
       "none").
  iii. More than 16 phase-cal tones in a channel will not cause DRUDG
       to fail (only the first 16 are supported for now).

The most significant changes in the FS in 9.11.4 include:

    i. For DBBC DDC v104, date code "August 01 2013" is accepted as
       valid.
   ii. The "plotlog" script was fixed to work again for normal Tsys
       data.

In the prior version 9.11.3 there were a few small bugs fixes, but the
major change was support for DBBC DDC personality version v104.  This
version of the DDC personality supports "astro2" formatter mode and
provides more precision for TPI measurements with the BBC sideband
detectors.  If you are using DDC version v104, it is very strongly
recommended that your read the section "V104 Support" in
/usr2/fs/misc/dbbc.txt; it provides details on a gain issue with v104
and how to fix it using the "BBC_LEVEL" procedure.

An additional important change for DBBC support was that if the
"cont_cal" keyword is not used in skedf.ctl, the default will be
"cont_cal=off", whereas in previous versions it was "cont_cal=on".  If
you have a DBBC and want any continuous cal configuration other than
"off", you must use the "cont_cal" keyword in skedf.ctl.

We would like to acknowledge the significant contributions that
Jonathan Quick made to this version (and many others) of the FS
including sharing his experience operating DBBCs, methods of
organizing operations, and testing.  However to be clear, Ed Himwich
and John Gipson take responsibility for any remaining shortcomings.

In the prior version 9.11.2, four significant problems were fixed
from previous versions of 9.11.x:

(1) MAT serial I/O problems (described in FS update item 11 below)

(2) Extraneous garbage characters were displayed in Tsys/monit3 window
    (see FS update item 20 below)

(3) Stations with non-standard racks, such as the KVAZAR stations had
    trouble DRUDG-ing schedules that use non-VSI4 track maps with
    non-VSI4 racks (see DRUDG update item 15).

(4) The "bank_check" command did correctly detect a full pack for
    Mark 5B recorders.

Please note that despite a significant amount of pre-release testing,
the new version of gnplt has been found to have some bugs.  The two
that have been discovered so far, poor scaling if only the DPFU or
Tcal is updated from the gain data (adjusting the DPFU and the gain
curve together seems to be okay) has been fixed for 9.11.2.  However,
there may be other problems, particularly if your station uses ALTAZ
(vs ELEV) gain curves.  If there is any doubt that you are getting
good results (and probably if you use ALTAZ gain curves at all),
please use the old gnplt, which is available as gnplt1.  (However,
there are rumors of long standing problems with ALTAZ in gnplt1 as
well.)  The FS 9.11.x version of gnplt1 supports two Trec values per
RXG file so it can be used with 9.11.x RXG files without modification.
The new gnplt will be more thoroughly debugged later this year.  This
is a very complex program and it is difficult to test it completely.
If you notice particular problems, please be sure to inform Ed so that
we can make sure they are addressed.

All stations should be aware that experiment procedure generated with
previous FS versions may not work with the new one.  In particular
set-up procedures for Mark 5 and VLBA5 racks may not work because of
changes in the handling of the TPICD command.  You should always DRUDG
the .snp and .prc files for an experiment with the version of DRUDG
that came with the version of the FS you will be using to run the
experiment.

Prior version 9.11.2, was a minor update to 9.11.1.  The only
significant change in the installation procedure is that if you have a
VSI4 device (typically for Mark5 and VLBA5 racks) you should make sure
that you have a "vsi4" read back command at the start of "initi".
Please see FS update item (11) and installation step (14D) for more
details.  The installation instructions identify the sub-set of steps
need to bring everything up to date from 9.11.1.

If you have version 9.11.0 installed, in addition to the information
above about upgrading from 9.11.1, the following information is
relevant to updating to 9.11.2.  There is one significant change and
some update instruction corrections and improvements.  The change in
the new version is that both Mark 5 and DBBC communications will now
reconnect to the device on the next attempted transaction if the
device is restarted while the FS is running.  This is described more
fully as FS change (19) below.  There is also now a DRUDG change (14),
the default_dbbc_if_inputs parameter in skedf.ctl.  The description of
which was omitted from the 9.11.0 update notice (but the feature was
in DRUDG).  The update instruction improvements are the addition of
step (13F) for updating skedf.ctl, if needed, and step (14E) to
correct for errors in default DBBC station procedure libraries in
9.11.0.  Installation step (14E) also details the changes in the DBBC
default procedure libraries from 9.11.0.  Other typographic errors
were also corrected.  The installation instructions identify the
sub-set of steps need to bring everything up to date from 9.11.0.

II. Changes Since Version 9.10.4

This section is divided into three sub-sections: A. Changes in the FS,
B. Changes in DRUDG, and C. Known FS Bugs.  Each sub-section starts
with a summary of the items covered followed by a more detailed
description.

			 A. Changes in the FS

The following is a summary of FS changes since 9.10.4.  Item 19 was
added for 9.11.1.  Items 3 and 11 was expanded and items 20-23 were
added for 9.11.2.  Item 1 was changed and items 24-31 were added for
9.11.3.  Items 32-36 were added for 9.11.4.  Items 37-42 were added
for 9.11.5.  Items 43-51 were added for 9.11.6

1.  Support for DBBC DDC personality added.
2.  The "day 49 bug" is fixed.
3.  New gnplt.
4.  The FS and gain calibration tools support two Trec values in .rxg
    files.
5.  Protection from issuing "problematic" commands during Mark 5B
    recording.
6.  New SATELLITE command.
7.  New HOLOG command for antenna holography.
8.  Pointing data analysis programs now support X-EL ("Cross-EL")
    analysis plotting and formal error constants.
9.  New SNAP procedure based acquisition feature for ONOFF.
10. Improved metserver/metclient software.
11. MATCN serial-I/O problem workaround.
12. Change in mk5cn handling of input from Mark 5 recorders.
13. Special source names have source coordinates set to zero.
14. Antenna= command bug with antenna device /dev/null fixed.
15. New pointing model term 23.
16. The obsolete "calrx" command was removed.
17. Installation and customization documents for FSL8 are included in
    /usr2/fs/misc.
18. New example station procedure files for DBBCs.
19. Improved Mark 5 and DBBC processing if Mark 5 or DBBC is restarted.
20. Fix Tsys/monit3 display problem for Mark III/IV/5 racks.
21. The fivpt "xoffset" record now includes the source name.
22. Fix autoftp for DBBC racks.
23. Fix bug in bank_check for Mark 5B recorders.
24. Support for DBBC DDC version v104, including astro2 format mode
    and the BBC_GAIN command.
25. Improved error messages for mismatches of DBBC DDC version numbers.
26. plotlog support for plotting tpicd data.
27. Bug fix for LCP Tcal frequency table exactly equal to detector center
    frequency.
28. Bug fix for fivpt program output.
28. Fixed parameters definitions in params.h
30. Display of power for DBBC IF modules now consistent.
31. Improved error messages about the need to use the fmset 's'
    option.
32. Accepts DBBC DDC v104 date code August 01 2023 without an error.
33. Script "dbbc_ifx" provided to help change DBBC IF inputs in .prc
    files.
34. The "plotlog" Tsys plotting was fixed to handle Tsys data again.
35. The "pdplt" program now handles comment lines in XTR files with
    dollar signs ('$') in them.
36. The Makefiles for oprin and pfmed were corrected to be backward
    compatible with the behavior in 9.10.4.
37. The bit_streams command was added.
38. Mark 5/DBBC error messages about a lost connection have been
    improved.
39. Include statements in poclb/logit.c were improved.
40. PFMED and procedure library documentation improvements.
41. Improvement in 'xtrac' program for handling incomplete FIVPT
    scans.
42. Prevent "schedule=..." command when disk recording has been
    commanded.
43. Fix for a bug that caused TPICD to crash if there was a
    communication error with a DBBC.
44. The FMSET program was improved to make it more compatible with
    jive5ab use on Mark 5B recorders.
45. An error message was added to FLAGR for the case of a new source
    being commanded before the previously commanded one was reached.
46. The Mark 5B clock rate is now set from the equip.ctl file.
47. A time-out feature for the "onsource" command to facilitate local
    test operations (only).
48. Support for the new FS Linux distribution, FSL9, based on Debian
    Wheezy.
49. Removal of some debug output in TPICD for DBBC continuous cal.
50. Improvement to the disk_pos command help page.
51. Removal of sleeping bug in the disk_serial command.

A more detailed discussion of these changes follows.

1.  Support for DBBC DDC personality added.  The PFB personality is
    not supported at this time.  The new support includes commands:
    bbcNN, ifX, cont_cal, and form commands to control and monitor the
    DBBC.  Tsys, pointing, and gain measurements are supported with
    both continuous (low) cal and non-continuous (high) cal.  The
    fmset program supports the DBBC 1 PPS sync. Only versions v100,
    v101, v102, and v104 of the DBBC DDC personality are supported.
    Version v103 is not supported.  If you are using v104, it is very
    strongly recommended that your read the section "V104 Support" in
    /usr2/fs/misc/dbbc.txt; it provides details on a gain issue with
    v104 and how to fix it using the "BBC_LEVEL" procedure.  Support
    for DDC version v104, including the "astro2" mode and the
    "bbc_gain" command were added in FS version 9.11.3 and is
    discussed in FS change #24.

    To enable DBBC support the rack type in the equip.ctl file must be
    selected as "dbbc".  New lines were added to equip.ctl to specify:
    (1) the firmware versions (DDBC and PFB) of the DBBC, (2) the
    number of IF conditioning modules present, and (3) IF conditioning
    module detector conversion factors used for the conversion from
    counts to power for each conditioning module.  Please see
    /usr2/fs/st.default/control/equip.ctl for details on the new lines
    in equip.ctl.

    The new commands for the DBBC: bbcnn (nn=01-16), ifx (x=a-d),
    cont_cal, form, and dbbc are documented in the SNAP help command.
    To see this documentation use "help=..." command in the FS when
    DBBC is selected as the rack type.

    A fuller discussion of the DBBC support is available in
    /usr2/fs/misc/dbbc.txt.

2.  The "day 49 bug" is fixed.  This fix works around a change in the
    kernel times() system call that caused the FS to lose track of the
    time after about 49 days.  The work around should allow the FS
    time to be correct for up to about 248 days ("the end of time")
    before a reboot is required.  It is expected that the system will
    be rebooted at least that often, but just in case it isn't, for a
    30 days prior to "the end of time", the setcl program will issue a
    warning that a reboot is needed every time it is run. ("setcl"
    should be run in "midob" for every scan to track for formatter
    time offset.)  After "the end of time" it will complain every time
    it is run for up to about another 248 days that a reboot is
    required (timing may not be reliable during this period).  There
    is also a small chance that if the FS is running at the "end of
    time", a false error return by the times() call will cause the FS
    to abort. This possibility exists for 0.01 seconds.

    This work around is not completely safe, particularly if more than
    496 days have passed since the last boot or if the time is sampled
    in the critical 0.01 seconds after 248 days since the last boot
    when the false error is returned, but it is fairly comprehensive
    and nothing is completely safe.

3.  New gnplt. A new version of gnplt is included in this version of
    the FS.  It is written in Python and is much quicker than the
    previous version, especially for large data sets.  Its operation
    is similar to the old version which is available also as gnplt1 in
    case any serious bugs are discovered.  The two that have been
    discovered, poor scaling if only the DPFU or Tcal is updated from
    the gain data (adjusting the DPFU and the gain curve together
    seems to be okay) has been fixed for 9.11.2.  However, there may
    be other problems, particularly if your station uses ALTAZ (vs
    ELEV) gain curves.  If there is any doubt that you are getting
    good results (and probably if you use ALTAZ gain curves at all),
    please use the old gnplt: gnplt1. (However, there are rumors of
    long standing problems with ALTAZ in gnplt1 as well.)

    The new gnplt will be more thoroughly debugged later this year.
    This is a very complex program and it is difficult to test it
    completely.  If you notice particular problems, please be sure to
    inform Ed so that we can make sure they are addressed.

    The new version was written by an intern at GSFC, Tomas Gille,
    from Chalmers University in Sweden.  Another intern, Hans
    Salomonsson, also from Chalmers, adding a simulation capability to
    validate the program.  Pablo de Vicente (Yebes) fixed a bug in the
    parsing of space delimited fields in the data files.  Andrea
    Orlati (Medicina) and Jonathan Quick (HartRAO) tested the program
    in the field.  Initial results indicate that the new version is
    working correctly.  However, due to the complexity of the program
    and the data it is used on, it is hard to be sure there are no
    serious problems.  Please use it with care and make sure the
    results are reasonable before using them.  If you notice any
    problems, large or small, please report them to
    Ed.Himwich@nasa.gov so that we can fix them.  Documentation is
    available in /usr2/fs/gnplt/gnplt2_documentation.pdf,

4.  The FS and gain calibration tools support two Trec values in .rxg
    files.  Values can now be specified for up to two polarizations
    per file.

5.  Protection from issuing "problematic" commands during Mark 5B
    recording.  There are now inter-locks to make it more difficult to
    accidently send a Mark 5B command that may cause problems while it
    is recording.  Specifically, the "mk5b_mode" command and "fmset"
    sync and time-setting functions require over-rides if the Mark 5B
    is recording.  In the case of the "mk5_mode" command, the user
    must supply an additional parameter to override the inter-lock
    (much like the over-ride needed for the "terminate" command if a
    Mark 5 is recording).  See the output of "help=mk5b_mode" for more
    details.  For "fmset", the user must answer an extra query to
    override the interlock.  The approach of allowing the interlocks
    to be overridden is intended to give the operator full
    functionality if it is needed while discouraging accidental use of
    these functions while recording since they can cause problems.  It
    is recommended to NOT override the inter-locks.

    An important point to understand is that these interlocks depend
    on the last commanded recording state given by "disk_record=..."
    command. In particular this means that if a FS re-start occurs,
    e.g., after a crash, the FS will not know whether the Mark 5B is
    recording.  In such cases it would be prudent to stop Mark 5B
    recording if it is active when the FS is re-started.  This will be
    handled more gracefully in the next FS release.

6.  New SATELLITE command.  This is a new command to support pointing
    the antenna at satellites.  It is based on the amateur radio
    program, predict, which uses the SGP4 propagation model.  The
    provided "satellite" command is useful for pointing the antenna at
    a satellite in R.A./Dec. coordinates of date, or fixed Az/El
    coordinates.  The former may be useful if the satellite is moving
    slowly relative to the celestial sphere and the latter if it is
    moving slowly in local frame (e.g. a geostationary satellite).
    This command cannot by itself be used to track an arbitrary
    satellite trajectory.  However, it does internally generate a one
    second ephemeris for the next 24 hours for a satellite so it can
    be tracked by antcn if that capability has been implemented.
    There is also a "satoff" command that allows the tracking to be
    offset with a time-like offset. Documentation for these features,
    including installation instructions, is available in
    /usr2/fs/satellites.txt.

    It is expected that this capability will be expanded in the next
    FS releases.  Specific improvements that are expected include: (1)
    a capability to periodically re-command the antenna pointing in
    R.A./Dec. mode and Az/El mode to simulate tracking of slow moving
    satellites, (2) an "overpass" function (in recognition of Michael
    Moya Espinosa's contributions in developing a similar tool,
    SATTRACK, for satellite tracking with the FS at Onsala) that will
    show the next rise, set, and highest elevation of a satellite's
    next pass, (3) a listing function to show the Az-El of the
    satellite's next pass with one minute intervals, (4) a capability
    to read an ephemeris from a disk file, (5) ability to run FIVPT to
    peak on a satellite using along and cross track offsets, and (6) a
    software toolbox to assist in implementing direct satellite
    tracking in antcn.

7.  New HOLOG command for antenna holography.  This command can be
    used to implement data acquisition for antenna holography using a
    Boustrophedon ("as the ox plows") scan.  Please see "help=holog"
    for more information.

8.  Pointing data analysis programs now support X-EL ("Cross-EL")
    analysis plotting and formal error constants for AZEL antennas.
    This is also true for "Cross-Y" and "Cross-Dec" for XY and HADC
    antenna types.

    In this approach for plotting, offsets of the first antenna
    coordinate (which is longitude-like) is corrected by the cosine of
    the second antenna coordinate (which is latitude-like) to give the
    "Cross" coordinate.  This results in the size of offsets for the
    first coordinate at different positions of the second antenna
    coordinate being directly comparable.  This is useful for
    evaluating the solution residuals.  However it does not change the
    pointing model or the results of the pointing analysis (the model
    expressed in "cross" coordinates gives identical result to the
    model in "non-cross" coordinates), just the visual presentation of
    the results has changed.

    The formal error constants (for modeling the misfit of the data)
    can now be determined for the first antenna coordinate as a
    constant divided by 1/cosine(second antenna coordinate).  This has
    the effect of making the first antenna coordinate formal error
    constant representative of the angular resolution on the sky
    rather than the encoder resolution.

    Preliminary tests indicate that these changes give superior
    results for at least some antennas: (1) it is easier to identify
    outliers because the scatter of the displayed cross coordinate
    offsets are more second coordinate independent and (2) the
    statistical results for the compensated first coordinate formal
    error constant give a more uniform residual distribution over the
    second coordinate.

    However, it is not clear that these changes will improve results
    for all antennas.  Consequently, the use of these features can be
    controlled on a data set by data set basis from the parpo.ctl
    file.  The selected state is retained in the generated XTRAC
    output file (and can be changed there as well) for subsequent
    analysis of that data set.  It is recommended that all stations
    turn these features on initially.  Making this change is covered
    in the installation notes.

9.  New SNAP procedure based acquisition feature for ONOFF.  This
    feature allows a SNAP procedure to be used to collect other data
    during the first on source and off source points during ONOFF
    execution.  This might for example be used to trigger a GPIB
    controlled spectrum analyzer to collect power spectra.  Please see
    "help=onoff" for more details.  A script used during the FS
    installation procedure adjusts existing ONOFF= commands in local
    SNAP procedures libraries for this change.

10. Improved metserver/metclient software. These sample programs for
    serving and recording MET3/4 have been improved.  They now report
    current (and correctly time-tagged) data and the error reporting
    is better and more uniform.  The epoch for recording data in
    metclient is now modulo the recording interval, e.g,. if the
    interval is 60 seconds, the data are sampled and recorded on whole
    minutes.  The socket for TCP/IP is now more easily adjusted and a
    parameter in equip.ctl can used to indicate to the FS what socket
    is in use.  The latter change is covered in the FS installation
    instructions.  Please see the /usr2/fs/st.default/met* directories
    for more information on metserver/metclient.

11. MATCN serial-I/O problem workaround.  A problem with MATCN for
    certain kernels (at least Lenny) can occur causing MAT serial
    communication to fail.  A work around for this has been
    implemented.  It will be used on the first MAT communication after
    each FS start, but only if it is needed.  If used it will cause a
    30 second pause in FS execution.  Appropriate warning messages are
    printed in this case.  Please be aware that this pause will be
    frustrating if occurs during an attempt to quickly start (or
    restart) the FS.  Please make allowances for this if possible.  As
    unpleasant as it is, this is the only solution we have been able
    to find.

    In order for the work around to work correctly, the first MAT
    communication must be a read.  Practically speaking the only MAT
    based command that does not read is the "vsi4=..." set-up command.
    Therefore stations with a VSI4 device (typically ones with Mark 5
    and VLBA5 racks) it is recommend that they put a "vsi4" read back
    command as the first command in "initi".  This is covered in
    installation step 14D below.

    After the work around is executed (or if it is not needed on the
    first MAT read communication) it will not be needed again until
    the next FS start.  The problem seems to occur only on systems
    that are using another serial line for some other communication.
    If you find that the workaround is ever being executed on your
    system, please contact Ed (Ed.Himwich@ansa.gov).  It may be that
    this problem can be avoided by recoding MAT serial I/O to use
    termios.h structures rather than termio.h structures.  That may
    also obviate the need for a serial I/O work-around previously
    implemented in MCBCN.  These issues will be investigated for a
    future release.

12. Change in mk5cn handling of input from Mark 5 recorders.  The use
    fgets() calls to read from Mark5 devices was changed to use
    getch(), which should be more reliable if responses are for some
    reason split between two or more packets.  The error messages for
    time-outs for opening and for reading from the device were
    improved as well.

13. Special source names have source coordinates set to zero. If one
    of the special source names that don't allow coordinates to be
    commanded (see help=source) is used, the command coordinates are
    automatically set to zero.  There is now a new special source name
    in this category, "boresight" as well.  Please see help=source for
    details.

14. Antenna= command bug with antenna device /dev/null fixed.  This
    bug caused class numbers to be exhausted, causing a FS crash, if
    the antenna= command was used while the antenna device was
    /dev/null.  Thanks to Minttu Uunila at Metashovi for reporting
    this bug.

15. New pointing model term 23. This term matches the M.P. Godwin
    controller "excess refraction" elevation term, going as cot(el).

16. The obsolete "calrx" command was removed.  A script used during FS
    installation adjusts local SNAP procedure libraries for this
    change.

17. Installation and customization documents for FSL8 are included in
    /usr2/fs/misc.  All the relevant files have names starting with
    FSL8.

18. New example station procedure files for DBBCs.  New example
    procedure files dstation.prc (DBBC/Mk5B) and dstationcc.prc (DBBC
    with continuous cal/Mk5B) were added to /usr2/fs/st.default/proc.
    In addition, the previous 5station.prc file (Mk5 rack/Mk5B
    recorder) was renamed m5station.prc for consistency.

19. Improved Mark 5 and DDBC processing if Mark 5 or DBBC is
    restarted.  One of the changes made in mk5cn for 9.11.0 was to
    remove the automatic re-trying of commands if there is a failure;
    it was felt that this did more harm than good.  An unintended
    consequence of this change was that if the Mark 5 control program
    is restarted, the next transaction would fail.  The code was
    changed so that the closure is detected, a new connection is
    attempted, and then the transaction is tried.  This transaction
    should succeed.  Of course any transaction attempted before the
    Mark 5 has completed restarting will fail.  Since dbbcn is modeled
    on mk5cn, the changes were made to both programs, so they behave
    the same way in this situation.

20. Fix Tsys/monit3 display problem for Mark III/IV/5 racks.  For
    these rack types, some extraneous garbage characters were printed
    in the display window.  Thanks goes to Michael Lindqvist at Onsala
    for reporting this.

21. The fivpt "xoffset" record now includes the source name.  This
    change makes it easier to select pointing data results by source,
    for example using "grep".

22. Fix autoftp for DBBC racks.  Versions 9.11.0 and 9.11.1 broke the
    autoftp feature of disk2file for stations with DBBCs.  This has
    been fixed.

23. Fix bug in bank_check for Mark 5B recorders. Versions 9.11.0 and
    9.11.1 broke the automatic bank switching for a full disk pack for
    Mark 5B recorders by bank_check.  This has been fixed.

24. Support for DBBC DDC version v104, including "astro2" format mode
    and the BBC_GAIN command.  This version supports the DDC version
    v104.  The main features of this change are support for "astro2"
    format mode and the BBC_GAIN to control BBC sideband gain levels.
    There were additional changes to standard procedures and FIVPT and
    ONOFF.  It is very strongly recommended that your read the section
    "V104 Support" in /usr2/fs/misc/dbbc.txt; it provides details on a
    gain issue with v104 and how to fix it using the "BBC_LEVEL"
    procedure.
 
25. Improved error messages for mismatches of DBBC DDC version
    numbers.  These error messages are generated when the version
    number in the equip,ctl does not agree with the version read back
    from the DBBC by the form=....  The error messages were expanded
    to recognize some intermediate versions that are known to have
    problems.  Thanks to Jonathan Quick for suggesting this.

26. plotlog support for plotting tpicd data.  The plotlog utility was
    expanded to allow plotting data logged by the tpicd daemon. The
    options -s and -2 were expanded/added.  Thanks to Michael Lindqvist
    for requesting this. Please see 'plotlog -h' for more information.

27. Bug fix for LCP Tcal frequency table exactly equal to detector
    center frequency.  A fix was made for a bug in the code preventing
    the correct Tcal value being found when the detector center
    frequency fell exactly on a tabular point in the rxg file.  This
    was only a problem for LCP.  Thanks to Jonathan Quick for
    reporting this bug.

28. Bug fix for fivpt program output.  The number of steps was not
    displayed correctly for values less than -9.  Thanks to Andrey
    Mikhailov for reporting this bug and a fix.

29. Fixed parameters definitions in params.h.  There was an error in
    formation of calculated parameters that caused them to generate
    incorrect values.  This was fixed by placing the calculations
    within parentheses.  The only apparent impact of this was that
    station specific detector support was broken.  Thanks to Mamuro
    Sekido for reporting this bug.

30. Display of power for DBBC IF modules is now consistent.  In 9.11.x
    versions before 9.11.3 the reporting of the IF values in the log
    was not uniform with respect to being power or counts.  In the
    previous versions "ifX", TPI, and TPICAL commands, and the tpicd
    TPCONT output raw counts were reported; in the TPDIFF command and
    the ONOFF output, the units were power.  The averaged tpicd TPI
    values were not correct for any usage.  For consistency as of
    9.11.3, power values are used in all cases except for the "ifX"
    command, which still reports raw counts.  The "ifX" command is the
    command conceptually closest to hardware and this provides a way
    to check the operating level, which is specified in raw counts,
    for the IF modules.

31. Improved error messages about the need to use the fmset 's'
    option. Several error messages related to need to re-sync with
    fmset were revised to merely suggest the that the operator
    "CONSIDER" re-syncing.  This change was made because in many cases
    the correct action is to NOT re-sync and the messages seemed to
    recommending re-syncing too strongly.  This was leading to
    unnecessary re-syncs which were causing confusion and other
    problems.

32. Accepts DBBC DDC v104 date code August 01 2023 without an error.

33. Script "dbbc_ifx" provided to help change DBBC IF inputs in .prc
    files.  In FS Version 9.11.3, the behavior of the
    "default_dbbc_if_inputs" keyword in skedf.ctl for DRUDG was
    changed to only apply if the rack type was not "DBBC" or "none".
    This script is provided to compensate somewhat for this change.
    It provides a way to override the selected DBBC inputs in the .prc
    file if the schedule file did not specify any when the rack type
    is "DBBC" or "none".  In that case the inputs would not be
    specified in the commands.  The script will substitute the
    supplied arguments as values for missing inputs.  It can also be
    used to change the inputs even if they are specified values in the
    .prc file (use the "-f") option.  Please note that the IF inputs
    for all modes in the .prc file are modified by this script. To use
    this script, copy it to the /usr2/oper/bin directory (as "oper"):

      cd /usr2/oper/bin
      cp -a /usr2/fs/misc/dbbc_ifx .
      rehash

    Execute the script with no arguments for help output:

      dbbc_ifx

34. The "plotlog" Tsys plotting was fixed to handle Tsys data again.
    In FS Version 9.11.3, a change was introduced to allow plotting of
    tpicd data.  Unfortunately this broke the normal Tsys data
    plotting.  This has been fixed.

35. The "pdplt" program now handles comment lines in XTR files with
    dollar signs ('$') in them.  Previously these were mis-interpreted
    as starting a new data section.

36. The Makefiles for oprin and pfmed were corrected to be backward
    compatible with the behavior in 9.10.4.  In FS Version 9.11.0, the
    Makefiles for these two programs were changed to work for some
    systems they did not work for before.  Unfortunately, this lost
    the previous behavior of 9.10.4.  The change was made backward
    compatible.

37. The bit_streams command was added.  This command can be used to
    set the Mark 5B bit-stream mask within the FS without
    communicating with a Mark 5B.  Except for not communicating with a
    Mark 5B, this command is identical in all respects to the
    mk5b_mode command.  This command is useful to allow Tsys data to
    be collected normally when a Mark 5B that would normally be used
    is not being used, for example for eVLBI.  DRUDG uses this command
    in place of the mk5b_mode command when the operator selects a rack
    type (Mark5, VLBA5, DBBC or as a special case none) that would
    normally use a Mark 5B recorder, but selects "none" for the
    recorder.

38. Mark 5/DBBC error messages about a lost connection have been
    improved.  The error messages that included the phrase 'probably
    crashed' referring to the Mark 5 or DBBC now say 'may have
    crashed'.  Hopefully, this is clearer.  This change was suggested
    by Dan Smythe.  The errors that include this phrase are for cases
    where there was an existing connection to the device, but a
    closure was detected when attempting to access it.

39. Include statements in poclb/logit.c were improved.  The include
    statements for the FS include files erroneously included "../fs" in
    the path.  While not breaking the FS itself, this inclusion
    defeated one of the features of the source, which is that
    different versions of the FS (9.11.4, 9.11.5, etc) can be
    compiled even if the current /usr2/fs link does not point to that
    version.  Thanks to Zhang Ming (Urumqi) who found this error.  It
    was verified that this problem does not occur anywhere elsewhere
    in the includes (or FS library references in Makefiles) in the FS.
    Note that the local station software in the /usr2/st directory
    must include explicit use of "../fs" in paths in includes and
    Makefiles to reference the current version of the FS when it is
    compiled.

40. PFMED and procedure library documentation improvements.  A help
    page (accessed by help=...) was added for PFMED even though it is
    not a SNAP command in order to explain its basic operation.  The
    help page for the 'proc' command was updated to explain the
    difference between schedule and station procedure libraries.  The
    help page for the 'schedule' command was updated to explain the
    relationship between the 'exper_initi' and 'sched_initi'
    procedures.

41. Improvement in 'xtrac' program for handling incomplete FIVPT
    scans.  The program now initializes the source name to all
    underscores ('_') so that it is printable in case the scan
    encountered is incomplete and does not include a source name.

42. Prevent "schedule=..." command when disk recording has been
    commanded.  A new interlock was introduced in the "schedule=..."
    command to prevent changing schedules (or changing to a different
    line number in the current schedule) when disk recording has been
    commanded.  Note that the current schedule (if any) will continue
    to execute if the disk recording was commanded.  If the
    "disk_record=off" command is executed, a "schedule=..."  command
    can then be executed.  Note also that the FS does not check
    whether disk recording is occurring, only whether it has been
    commanded.  Consequently if recording is already occurring when
    the FS is started, the interlock will not operate.  No override
    was provided for the interlock, so using the "disk_record=off"
    command is the only way to release it.

43. Fix for a bug that caused TPICD to crash if there was a
    communication error with a DBBC.  Thanks to Michael Lindqvist and
    Roger Hammargren at Onsala for reporting this.

44. The FMSET program was improved to make it more compatible with
    jive5ab use on Mark 5B recorders.  The main change was to make it
    not abort on an error from the device, since jive5ab does return
    some error codes in the process of setting the time.  Not aborting
    was also added on device errors for Mark IV formatter and DBBCs.
    The contents of the error messages are reported in the log file.
    Progress messages were also added when the program is waiting for
    either or both a DBBC or Mark 5B to sync so that it does not
    appear unresponsive.  Please note that if the last communication
    with the Mark 5B or Mark IV formatter before exiting failed, it
    will print a message, asking the user to manually reset the FS
    time, both in the log and the window that FMSET was running in.
    Thanks to J Quick for suggesting and helping test these changes.

45. An error message was added to FLAGR for the case of a new source
    being commanded before the previously commanded one was reached.
    This error is only used if the condition occurs during a
    schedule. Other FLAGR changes include:

    a. A feature was added so that if the same source is commanded
       again, a "new-source" message is logged.

    b. Several somewhat rare race conditions related to messages
       logged around in the time of a new source command were
       eliminated.

    c. Errors from ANTCN reported to FLAGR are now reported.
       Previously, these errors were not reported.  Because fixing
       this bug may change the apparent behavior of FLAGR, especially
       during experiments, FLAGR now checks for an environment
       variable: "FS_FLAGR_SUPPRESS_ANTCN_ERRORS".  If this variable
       is defined, FLAGR will suppress these error messages.  This is
       intended only as a way to temporarily restore the previous
       behavior if error messages occur until the ANTCN program can be
       fixed.  If you find you are getting unexpected errors reported,
       please contact Ed (Ed.Himwich@nasa.gov) for information on the
       error reporting philosophy in this case.

    Thanks to J. Quick for suggesting and testing these changes and
    helping to work out what the correct error reporting philosophy
    should be.

46. The Mark 5B clock rate is now set from the equip.ctl file.  This
    change is only intended to allow the FMSET program to be used to
    set-up the timing for Mark 5B recorders when they are being used
    with devices with clock rates other than 32 MHz.  This is
    primarily for testing by experts, particularly with the DBBC PFB
    personality.  Setting values other than 32 MHz is dangerous for
    normal use particularly because DRUDG calculates the decimation
    ratio for the "mk5B_mode" command on the assumption that the clock
    rate is 32 MHz.  Consequently, the mk5b_mode command will need to
    be adjusted of non-32 MHz clock rates are used for
    experiments. The next release will fix this issue.

    Allowed values for the clock rate are 2, 4, 8, 14, 32, and 64 MHz.
    Additionally a non-numeric value "none" means that FMSET should
    not set the clock rate.  Another non-numeric value: "nominal"
    causes the appropriate clock rate to be used based on the type of
    rack select.  This is 32 MHz for Mark5, VLBA5, and DBBC.  The
    value "nominal" may not be used for rack type "none".  Currently
    for all other rack types the "nominal" value is "none".  However
    in the future it is expected that more rack types will have
    "nominal" values.

    The actual numerical clock value is recorded in "equip" log header
    time every time a log is opened.  If the value is "0" it means the
    clock rate is "none" and will not be set by FMSET.  The message
    that FMSET logs when it sets the clock rate now includes the
    (non-zero) value.

47. A time-out feature for the "onsource" command to facilitate local
    test operations (only).  The "onsource" command now accepts
    arguments that include the maximum time to allow the antenna to
    come on source and the names of a SNAP procedures to execute if
    the source is reached, or is not reached, before time-out expires.
    This command should not be used during schedules.  It is intended
    as a way to make local test procedures that involve antennas to
    made more efficient by not having to use the worst case slewing
    time for each step in a process.  Instead the process can be held
    just until the antenna reaches the source.  If it is not reached
    the process can be aborted.  Please see the "onsource" command
    help page ("help=onsource") for more information.

48. Support for the new FS Linux distribution, FSL9, based on Debian
    Wheezy. The main visible change in FSL9 for users is that the
    /home directory is now a symbolic link to /usr2 and by default
    user home directories are placed in /usr2.  This allows contents
    of user directories to not impact on space available on the root
    partition.

    Several small changes were needed in the FS to support FSL9:

    a. "fsinstall" modified to respect the new user home directory
       structure

    b. New FSL9* documentation files in misc/ were created, including
       updating and renaming "RAID.pdf" to "FSL9_RAID.pdf".
  
    c. New refresh_secondary.sd* scripts were created and the
       "refresh_spare_usr" script was updated. 

    d. The misc/rc.fs boot script was updated for Wheezy.

    e. A problem was discovered with at least one serial card under
       FSL9 that requires a work-around in the serial port open code
       in various programs. As of this writing the only card known to
       have this problem is the PCI-200LP.  The work around is to
       initially open a serial device with O_NONBLOCK and set it
       CLOCAL and close it before opening it normally.  This is
       necessary because the ports on this card are initially -CLOCAL
       after boot in FSL9 (but not FSL8) and this causes the FS to
       hang when trying to open the device if DCD is not asserted.
       The work-around causes problems with some other serial cards
       (PCI-800H for example) and should only be used if necessary.
       To enable the work-around the account that complies the FS and
       station software should set an environment variable
       "FS_SERIAL_CLOCAL" to a value of "1" at login. For the standard
       "prog" account that uses "tcsh" for its shell, this can be
       accomplished by uncommenting, or adding, the line:

         setenv FS_SERIAL_CLOCAL 1

       to the ".login" file in the user's home directory.  Thereafter
       when the account is logged in, this environment variable will
       be set automatically.

       As a result of this change, the error numbers from the
       portopen() routine changed slightly, so any station software
       that depends on the exact value of the error numbers may need
       to be adjusted.  Please see the port/portopen.c source file for
       a table with a (new) table of all the error numbers and the
       correspondence to numbers for previous versions.

       If you have local software that uses a local copy of the port
       library, specifically portopen() (for example in metserver),
       you may want to look at the code in Makefile and portopen.c in
       st.default/st-0.0.0/metserver/port for an example of how to
       implement this work-around.

49. Removal of some debug output in TPICD for DBBC continuous cal. Thank
    to Uwe Bach for reporting this.

50. Improvement to the disk_pos command help page. The description of
    the parameters for 5B were not accurate.  Thanks to Liza
    Rastorgueva-Foi for reporting this.

51. Removal of sleeping bug in the disk_serial command. The response
    from jive5ab was different from the response for MarkA/dimino for
    a query when no key switch was returned.  This revealed the
    sleeping bug.  Thanks to Jon Quick for reporting this.


			 B. Changes in DRUDG
				   
DRUDG opening message date is 2014Jul23.

The following is a summary of DRUDG changes since 9.10.4. Items 14-16
were omitted from the 9.11.0 update notice, but the features were in
the 9.11.0 release.  Items 11 and 14 were revised and items 17-18 were
added in 9.11.2.  Item 14 was revised and items 19-23 were added in
9.11.3.  Items 24-28 were added in 9.11.4.  Items 29-32 were added in
9.11.5. Items 33-34 were added in 9.11.6.

1.  Support for DBBC.
2.  AutoFTP_ABORT_TIME skedf.ctl parameter added to $MISC section.
3.  Better support for phase referencing.
4.  More scans allowed.
5.  Fixed 24:00:00 bug.
6.  Handling of smaller powers of two of tracks for Mark5B recording.
7.  Separating of skedf.ctl reading routines for DRUDG and SKED.
8.  Global read and write permission on all files DRUDG creates.
9.  Label first character bug.
10. VEX is now a default schedule file type.
11. TPICD bug fixed for various rack types
12. Bug in equipment override in 'command line mode'.
13. More forgiving behavior for unknown recorder types.
14. New skedf.ctl $MISC section parameter: default_dbbc_if_inputs.
15. Mixed sampling rates and bandwidths allowed in VEX schedules.
16  cont_cal skedf.ctl parameter added to $MISC section.
17. Mixed non-VSI4 modes error for non-VSI4 racks fixed.
18. Missing scans in option 5 listing for continuous recorder restored.
19. Support for DBBC DDC version v104 including astro2 mode and the
    BBC_GAIN command
20. DRUDG respects the IF configurations and inputs in the VEX file for 
    DBBCs if the rack type is "None" or "DBBC".
21. New skedf.ctl control file $MISC section parameter "dbbc_if_targets".
22. New skedf.ctl control file $MISC section parameter "dbbc_bbc_target".
23. The DRUDG "Shift a .SKD file" option (10) has been fixed and
    should work again.
24. Mixed bandwidth modes fixed.
25. DRUDG dies in fewer cases when there are unrecognized rack and
    recorders types for VEX schedules
26. DRUDG doesn't die if there are more than 16 phase-cal tones in a
    channel.
27. IF_CONFIG skedf.ctl option added for local "if_config" command
28. TARGET_TIME skedf.ctl option added for local "target_time" command.
29. Further improvements in the handling of unknown rack and recorder
    types.
30. Support for 'bit_streams' command.
31. IF3 command usage improvement.
32. Improvement in handling alternate IF input usage in VEX files.
33. Fix for rack=K4/M4 procedure files trackform procedure.
34. Fix for Mark III/IV/5 rack procedure to correct the patching and
    detectors for non-sequentially ordered VCs in schedule files.
35. Changes to support new requirements for VLBA CRD (pointing) files.

A more detailed discussion of these changes follows.  For most fixes
the files that were changed are listed.  Files are listed with respect
to the drudg/ source directory.

1.  Support for DBBC.  This version of DRUDG provides support for the
    DBBC in DDC mode.  The DBBC is now a valid rack type.  This
    involved changes to many DRUDG routines and some new routines.
    Affected files: procs.f
    New files: check_dbbc_freqs.f, check_dbbc_setup.f, proc_dbbc_bbc.f, 
    proc_lba_ifp.f, proc_lo.f, proc_mracks_vc.f, proc_vc.f,
    proc_vc_cmd.f, proc_vracks_bbc.f, 

2.  AutoFTP_ABORT_TIME skedf.ctl parameter added to $MISC section.
    The user can now specify a maximum time for disk2file operations
    to be aborted (in case they did not terminate on time).  Normally,
    the abort would be issued just before the next scan.  However, if
    the next scan would be a long time in the future, there may be a
    long delay before the abort.  With the new parameter, a maximum
    time can be set after which the abort will be guaranteed to be
    issued.  If the user does not specify an abort time DRUDG will use
    300 seconds.
    Affected files: drudg_rdctl.f, snap.f, ../skdrincl/data_xfer.ftni

3.  Better support for phase referencing.  When observing
    phase-reference scans, there should not be a setup procedure,
    PREOB, or POSTOB between the scans.  DRUDG has no way of
    explicitly knowing a session is phase-reference.  However, in
    phase referencing experiments the scheduler switches back and
    forth between two near-by sources without turning off recording.
    Hence DRUDG assumes that the scans are phase-referencing if 1) the
    recorder is running and 2) it is a VEX schedule.  Previously DRUDG
    would omit the setup procedure and PREOB procedure between the
    scans.  It now also omits the POSTOB procedure.  
    Affected files: snap.f.

4.  More scans allowed.  The limit on the number of scans in a
    schedule was increased to 20,000. 
    Affected files: skdrincl/skparm.ftni

5.  Fixed 24:00:00 bug.  There was a bug in SKED which would
    occasionally produce scans with a time-tag of 24:00:00 which is
    not a valid DRUDG time-tag.  SKED was modified so that this should
    not happen, and DRUDG was modified to handle this case correctly. 
    Affected files: unpsk.f     

6.  Handling of smaller powers of two of tracks for Mark5B recording.
    For Mark5A recorders the minimum number of tracks recorded is 8.
    For Mark5B this is not the case, and DRUDG was modified to handle
    recording for smaller powers of including 1, 2, 4.
    Affected files: proc_mk5b_tracks.f

7.  Separating of skedf.ctl reading routines for DRUDG and SKED.
    Previously DRUDG and SKED used the same routines to read the
    configuration file skedf.ctl.  This meant that if extra variables
    were put into skedf.ctl that either program needed, both programs
    needed to be modified even if they both did not require the data.
    This situation has been modified so that DRUDG and SKED now have
    their own routines. Both DRUDG and SKED will ignore items in
    skedf.ctl that they do not understand. 
    Affected files: fdrudg.f
    New file:  drudg_rdctl.f

8.  Global read and write permission on all files DRUDG creates.
    DRUDG now set's the permissions so all users can read and write
    the files that it produces.
    Affected files: drchmod.f 

9.  Label first character bug.  In some releases of DRUDG, DRUDG 'ate'
    the first character of the session name when it was producing
    labels.  This required users to write in the tape label command by
    hand. This has been fixed. 
    Affected files: lablog.f

10. VEX is now a default schedule file type.  The user no longer has
    to specify the '.vex' extension explicitly.  If no file extension
    is given DRUDG will try first to open a '.skd' file.  If it does
    not find one it will then try to open a '.vex' file.  Affected
    files: fdrudg.f

11. TPICD bug for fixed Mark 5 & VLBA5 rack types.  For 9.11.0 DRUDG
    write the TPICD commands for all rack types.  In 9.11.2 this was
    revised to only be for rack types Mark III, Mark IV, VLBA, VLBA4,
    LBA, LBA4 (with any recorder or none) and for the rack Mark 5,
    VLBA5, and DBBC, if the recorder type is Mark 5B.
    Affected files: snap.f

12. Bug in equipment override in 'command line mode'.  DRUDG has an
    undocumented 'command line mode' where you can give it a schedule, 
    filename, and command number and DRUDG will execute the appropriate
    command and stop. For example:   

       drudg r1453.skd tc 12

    Will produce the PRC files for TC and exit.  In previous releases
    DRUDG would ignore the equipment_override option in command line
    mode.  It now has the same behavior in interactive and command
    line mode.
    Affected files: fdrudg.f    

13. More forgiving behavior for unknown recorder types.  Previously 
    DRUDG would quit with an error if it doesn't recognize the 
    recorder type.  It now sets the recorder type to 'unknown' and
    continues on. 
    Affected files: fdrudg.f, equip_type.f, ../skdrut/ttape.f, 
    ../skdrut/check_rec_type.f, ../skdrut/unpvt.f 

14. New skedf.ctl $MISC section parameter: default_dbbc_if_inputs.
    This parameter can be used to define default IF input selections
    for a DBBC if the schedule specifies a rack type other than "None"
    and "DBBC" (and the user changes rack to DBBC in DRUDG).  The four
    values for this parameter are the inputs to be used.  If the
    parameter is not used, DRUDG leaves the IF input parameter in the
    IFx=... command blank in the setup procedure for the operator to
    edit.  If it is not edited to an allowed value it will generate an
    error when executed.

    In version 9.11.2, this parameter was used to specify a default
    DBBC IF input configuration for all schedules that did not contain
    an IF configuration.  This was found to be counterproductive.
    Prior to 9.11.2 this parameter specified the DBBC IFs when the
    schedule was originally written for a non-DBBC rack.  This case is
    the same as 9.11.3, except that it no longer applies to rack type
    "None".

15. Mixed sampling rates and bandwidths allowed in VEX schedules. This
    allows schedules that use different bandwidths and sample rates
    for other stations, including values that are not supported by
    DRUDG for the station that the files are being processed for, to
    exist in the schedule file without causing an error. For example,
    a different station can have a sample of 128 Mb/s even though for
    the station DRUDG is being run for it can't be supported.

16. cont_cal skedf.ctl parameter added to $MISC section.  This
    parameter controls how the cont_cal command is set in DRUDG
    generated setup procedures for DBBC racks, choices are "ON",
    "OFF", and "ASK" (to be prompted).  If the parameter is not
    present, it is assumed continuous cal should be off.

17. Mixed non-VSI4 modes error for non-VSI4 racks fixed.  This bug
    caused DRUDG to stop with no error message if a non-VSI4 track map
    was used with a non-VSI4 rack (something other than Mark 5 and
    VLBA5).

18. Missing scans in option 5 listing for continuous recorder restored.
    This bug caused the start and stop times scans other than the first
    and last in a continuous recording to omitted from the listing.

19. Support for DBBC DDC version v104 including "astro2" format mode
    and the BBC_GAIN command.  The "astro2" mode allows DBBCs that use
    IFA for BBCs 1-8 and IFB for BBCs 9-16 to support recording for
    two IFs (configuration #3 in DRUDG change item (20) below).  The
    BBC_GAIN command allows higher resolution from BBC TPI
    measurements.  The gains are set to AGC in the setup procedure
    with the command "bbc_gain=all,agc,target" at the end of the
    procedure.  The ",target" is omitted if there no "dbbc_bbc_target"
    parameter in the skedf.ctl file (see DRUDG change item (22)
    below).

20. DRUDG respects the IF configurations and inputs in the VEX file
    for DBBCs if the scheduled file rack type is "None" or "DBBC".
    This allows DRUDG to support the several varieties of DBBC
    configurations in the field (notation thanks to Jonathan Quick):

            BBCs on
            each IF
      #      ABCD            Total BBCs
      -      ----               --
      1.     4444               16
      2.     448                16
      3.     88                 16
      4.     44                  8


    For example in the second configuration, IFA->BBC01-04,
    IFB->BBC05-BBC08, and IFC->BBC09-16.

    The IF inputs In a schedule file must be in the form "cn", where
    "c" is "A", "B", "C", or "D" and the "n" is "1", "2", "3", "4", or
    blank.  If blank, DRUDG leaves the IF input parameter in the
    IFx=... command blank in the setup procedure for the operator to
    edit.  If it is not edited to an allowed value it will generate an
    error when executed.

    If the schedule file rack type is something other than "None" or
    "DBBC", DRUDG assumes configuration "4444" and uses the IF inputs
    defined by "dbb_default_if_inputs" if it is present in skedf.ctl.

21. New skedf.ctl control file $MISC section parameter
    "dbbc_if_targets".  Up to four target values may be provided.
    These define target levels for the DBBC
    "IFx=input,agc,filter,target" commands for up to four IFs in the
    mode setup procedures.  If the parameter is not present, the
    target levels in the "IFx=..."  commands are omitted.  Using a
    target value (and hence this parameter) for DDC versions less than
    v101 will generate an error on execution of the resulting SNAP
    command.

22. New skedf.ctl control file $MISC section parameter
    "dbbc_bbc_target".  This sets BBC TPI target level in the
    BBC_GAIN=all,agc,target command in the mode setup procedures. If
    the parameter is not present, the target level in the
    BBC_GAIN=... command is omitted.  Using a target value (and hence
    this parameter) for DDC version less than v103 will have no
    effect.

23. The DRUDG "Shift a .SKD file" option (10) has been fixed and
    should work again.  This feature is only intended to provide a way
    to use existing schedules to make test schedules in the field.  It
    is used at your own risk.  This feature still does not yet support
    VEX schedules.

    This feature only works for schedules that are 24 hours or longer.
    The user specifies: 1) a new file to hold the shifted schedule; 2)
    the desired time of the first observation; and 3) how long to make
    the new schedule.

    The fundamental idea is that if an observation can be observed
    today, it can be observed on another day at the same sidereal
    time.  The algorithm works by calculating the sidereal time of the
    start of the shifted schedule.  It then finds the first
    observation in the original schedule that has a sidereal time that
    occurs AFTER this.  DRUDG then writes out this observation,
    changing the absolute epoch, but keeping the same sidereal time.
    Subsequent observations are written out in the same fashion.  When
    it reaches the end of the original schedule it will begin taking
    observations that occur after that sidereal time from the
    beginning of the schedule until it has scheduled observations for
    a sufficient length of time (possibly multiple days).  The
    cable-wrap and slew-time may not match at the boundary (or
    boundaries) between the shifted ends of the original schedule, but
    this may only be a minor problem.  However, the uncertainty about
    this issue is what makes this feature one you use at your own
    risk.

    This feature has been used very rarely recently which is one of
    the reasons it fell into disrepair.  SKED no longer outputs all of
    the information for recording on tape.  However the subroutine
    that shifts the schedule searched for some of this information in
    the schedule file and when it did not find it exited with a
    warning message.

24. Mixed bandwidth modes fixed.  The changes that allow different
    bandwidths at different stations in a schedule were lost.  They
    have been restored.

25. DRUDG dies in fewer cases when there are unrecognized rack and
    recorders types for VEX schedules. Previously, they were only
    accepted for .skd files.  The unknown equipment is converted to
    type "none".  This allows stations with unrecognized equipment
    types to be included in schedules without causing DRUDG to fail.
    This is currently useful for schedules that include RDBE and Mark
    5C recorders. See also #29 for the continuation of this
    improvement in 9.11.5.

26. DRUDG doesn't die if there are more than 16 phase-cal tones in a
    channel.  This allows bandwidths wide enough to include more than
    16 phase-cal tones per channel to be used.  However, only the
    first 16 tones are included in the pcald setup for stations with a
    pcald implementation.  We believe the only stations that have this
    implemented (DSN) do not have more than 16 tones per channel.
    Phase-cal tones cannot be specified in .skd schedules.

27. LO_CONFIG skedf.ctl option added for local "lo_config" command.
    This option causes an "lo_config" command to be appended to the
    end of every IF set-up procedure generate by DRUDG.  This feature
    is intended for use by stations that have a local "lo" command for
    FS controlled of their LO system.  It provides a way to set all
    the LOs in one transaction rather then individual transactions for
    each "lo=..." command.  The "lo_config" command must be
    implemented as a local station command.  Please see
    /usr2/fs/misc/lo_config.txt for more information.

28. TARGET_TIME skedf.ctl option added for local "target_time"
    command.  This option causes a "target_time=TIME" command to be
    inserted in the .snp file between each "scan_name=..." and
    "source=..."  command pair.  The "TIME" is the time the antenna is
    expected to reach the source in FS time format
    (yyyy.ddd.hh:mm:ss).  This command provides information for the
    antenna interface so that it can adjust antenna slew speed to the
    minimum necessary to reach the source and settle on the source in
    time.  The "target_time" command must be implemented as a local
    station command and the antcn program must be implemented to
    support this.  Please see see /usr2/fs/misc/target_time.txt for
    more information.

29. Further improvements in the handling of unknown rack and recorder
    types.  This completes the previous effort in item #25 for 9.11.4.
    DRUDG was modified to not abort for unrecognized rack and recorder
    types, including RDBEs and Mark5Cs, which are currently used in
    schedules at non-FS stations.  Although the FS does not yet
    support RDBEs and Mark 5C recorders explicitly, FS station may run
    schedules that include stations that do have these pieces of
    equipment. As previously stated in item #25, the unrecognized rack
    and recorder types are set to none, but some other details needed to
    make this work were not included. This has been fixed.

30. Support for 'bit_streams' command.  DRUDG now substitutes the
    'bit_streams' command in place of the 'mk5b_mode' command when
    generating procedures for a rack that requires a Mark 5B for
    recording (rack types: Mark5, VLBA5, DBBC, and as a special case
    none), when the operator selects 'none' as the recorder type.
    This is intended to be useful for eVLBI where the recorder is
    controlled remotely and the FS just controls the rack.  The
    bit_streams command sets the Mark 5B bit-stream mask internally in
    the FS so that Tsys data can be recorded normally without
    requiring communication with the Mark 5B recorder.

31. IF3 command usage improvement.  For racks (Mark III, IV, and LBA4)
    that support use of a Mark III IF3 module, the IF3 command is only
    included in the setup for the rack if the frequencies of LO1 and
    LO3 are either same or LO3 is 500.1 MHz higher than LO1.
    Normally, these two configurations imply the usage of an IF3
    module.  Otherwise the station is probably providing its own IF
    for LO3.

32. Improvement in handling alternate IF input usage in VEX files.
    DRUDG no longer generates an (incorrect) warning if the alternate
    IF input is specified for a Mark III/IV/LBA4 rack in VEX file.

33. Fix for rack=K4/M4 procedure files trackform procedure.
    Previously, the trackform procedure was not included in the
    procedure files or called by the set-up procedure.  This rack type
    has not been used for many years. Consequently the bug was not
    noticed.

34. Fix for Mark III/IV/5 rack procedure to correct the patching and
    detectors for non-sequentially ordered VCs in schedule files.  The
    main issue was that DRUDG would check the properties of the
    channels by looping over the channels.  For channel #1 it would
    start the count at 1, for channel #2, it would start at 2, etc. If
    the channels are 'out of order' in the schedule file (channel 12
    appearing before channel 1) then DRUDG might not find the
    information it was looking for.
    
35. Changes to support new requirements for VLBA CRD (pointing) files.
    The VLBA is in the process of changing its hardware from analog to
    digital.  We made changes to the pointing files to accommodate
    these changes.


			   C. Known FS Bugs

(No changes have been made in this section since version 9.10.4,
although there are undoubtedly other bugs to report and some of the
ones listed below are no longer relevant.)

The following is a summary list of known bugs. They are described in more
detail after the list.

1. Do not run "fmset" for extended periods.
2. "odd" and "even" head types not supported for Mark IV & VLBA4.
3. "odd"/"even" head types not supported for VLBA style tapeforms.
4. CHEKR does not check the status of the Mark IV formatter or Mark 5
   recorder.
5. Extraneous errors when tape is stopped by low tape sensor.
6. "Comm=" command in logex extracts only the first command.
7. S2 error scheme clumsy.
8. No extra spaces allowed in "ibad.ctl" file.
9. ONOFF and FIVPT programs hang.
10. FS SNAP command pages don't list tape drive suffix numbers.
11. LBA rack TPI detector is not usable.

A more detailed discussion of these bugs follows.

1. Do not run "fmset" for extended periods.  For stations that have
   VLBA, Mark IV back-ends and/or an S2 recorder, the "fmset" program
   should not be run for extended periods of time.  The "fmset"
   program should be used only to set or briefly verify that the
   formatter time is correct.  Do not leave "fmset" running after
   completing either of these tasks, especially during an experiment.

   The "fmset" program dominates the Field System when it is running
   and this is likely to interfere with the running of an experiment
   or other activities.  The only way to detect the time from the VLBA
   formatter with greater precision than one second it to wait for the
   seconds response from the formatter to change.  This requires the
   FS to communicate with the formatter almost continuously.  A
   similar problem exists for the S2 recorder.  This problem is less
   severe for the Mark IV formatter, but extended use of "fmset" in
   this case should be avoided as well.  In a future revision, this
   will be made more robust so that there will probably be less danger
   if "fmset" is left running.  However, even in the future "fmset"
   should only be left running for as short a time as possible.  A
   reminder about this is included in the "fmset" menu.

2. "odd"/"even" head types not supported for Mark IV & VLBA4.  The
   Mark IV and VLBA4 rack version of the "form" command and the Mark
   IV and VLBA4 recorder versions of the "repro" and "parity" commands
   do not support the "odd" and "even" parameters for the read and
   write head types and reproduce electronics in the "head.ctl"
   control file.  This means that automatic substitution of odd or
   even head in passes that use only even or odd heads respectively
   does not occur.  The only correct settings for the read and write
   head parameters and reproduce electronics is "all".  This will be
   fixed in a future revision.  Please let Ed know if you are missing
   some tracks and need to work around this limitation.

3. "odd"/"even" head types not supported for VLBA style tapeforms.
   For any mode recorded with VLBA style tapeform (14 index
   positions), the only correct setting of the read and write head
   types on the "head.ctl" is "all".  This will be fixed in a future
   revision.  Please let Ed know if you are missing some tracks and
   need to work around this limitation.

4. CHEKR does not check the status of the Mark IV formatter or Mark 5
   recorder.  Now that most communication problems with the Mark IV
   formatter have been solved, this will be possible and will be done
   in the future.  CHEKR support will be implemented for Mark 5 despite
   communication problems, they will have to be ignored unless they
   extend beyond a certain amount of time.

5. Extraneous errors when tape is stopped by low tape sensor.  When a
   tape drive has been commanded to move the tape and then stops
   because it hit the low tape sensor (or when S2 recorders hit the
   BOT or EOT), "CHEKR" will complain periodically that the tape drive
   is not in the correct state.  In principle the FS should be smarter
   about this.  However, if the tape is managed correctly by the
   schedule this error message should never occur.  If it does, then
   it it an indication that there is either a problem with: (1) the
   schedule, (2) the check procedures, (3) the recorder, or (4) the
   tape is too short.  If any of these cases apply they should be
   corrected.  It is more likely that this error message will occur
   when the tape is being controlled manually.  In this case, issuing
   an "ET" command will convince the FS that the tape drive should be
   stopped and the error message will cease.

6. "Comm=" command in logex extracts only the first command.  The
   "comm=" command in "logex" extracts only the first command
   commanded and displayed.  This problem was noted by Giuseppe
   Maccaferri (Medicina).

7. S2 error scheme clumsy.  The error and status response number
   reporting scheme for S2 recorders is clumsy.  FS errors that have
   mnemonic "rl" are mostly error responses from the recorder or the
   RCL interface library that is used to communicate with the
   recorder.  If the numeric part of an "rl" error is greater than
   -130, then it is the error code returned by the recorder.  If the
   numeric part is less than -130, but greater than -300, then add 130
   to the value, the absolute value of the result is the error
   response code from the RCL library.  For values less than or equal
   to -300, a FS error has been detected.  Status response codes are
   all reported with mnemonic "rz" and the numeric value is the
   negative of the status response code.  In all cases an appropriate
   error or status message is displayed.  These messages are retained
   in the log.

8. No extra spaces allowed in "ibad.ctl" file.  The format of the
   "ibad.ctl" must not contain any leading or embedded spaces.  In
   systems that use the LLP AT-GPIB driver (pre-FS Linux 4), if either
   the option "no_untalk/unlisten_after" is misspelled or an incorrect
   device name is supplied, the driver will cause a segmentation
   violation when it is initialized and the FS will terminate.
   Unfortunately there is no way to prevent this problem in a general
   way; it reflects a limitation in the driver.

9. ONOFF and FIVPT programs hang.  The ONOFF and FIVPT programs have
   been known to "hang" mysteriously.  This seems to be caused by some
   problem with the "go" mechanism that is used to restart the program
   when it pauses to allow a SNAP procedure, such as CALON or CALOFF
   to execute.  The "go" that is used to restart the program fails for
   some reason.  This has been exceedingly difficult to debug because
   it is intermittent and fairly rare.  There is however a good work
   around for it.  The CALON and CALOFF procedures are called by
   procedures CALONFP and CALOFFFP for FIVPT and CALONNF and CALOFFNF
   for ONOFF.  FIVPT or ONOFF may hang during (or actually just after)
   the execution of one these procedures that FIVPT and ONOFF will
   typically hang.  If this happens, you will have to terminate the FS
   to recover.  You can prevent it from happening again (for this
   procedure) by adding the lines:

    !+1s
    sy=go fivpt &

  to the end of CALONFP or CALOFFFP.  For CALONNF and CALOFFNF, please
  add:

    !+1s
    sy=go onoff &

  If you see other situations where FIVPT or ONOFF hang, please let Ed
  know.

10. FS SNAP command pages don't list tape drive suffix numbers.  The
    FS SNAP manual pages and the help pages available through the
    "help=" command do not reflect when multiple versions are
    available with different suffixes depending on the number of drive
    specified in the control files.  For example, there is only a
    "tape" page, no "tape1" or "tape2" page.  However, the help
    facility will display the version of the command with no suffix
    when an available command with a suffix is used.  For example, if
    two drives are defined, then "help=tape1" and "help=tape2" will
    work, but "help=tape" will not and vice-versa if only one drive is
    defined.

11. LBA rack TPI detector is not usable.  The Australian LBA Data
    Acquisition System currently lacks a functional total power
    detector though support has been included.  To allow approximate
    system temperature calibration, all the setup commands and the TPI
    detectors of the modules of a co-existing Mark IV rack are
    currently also available when the rack type is specified to be
    LBA4.

III. Installation

Detailed instructions are provided below for installing 9.11.6.  The
immediately following paragraphs describe the necessary steps for each
possible starting base installation to be upgraded, working backwards
in terms of already installed version numbers.  All cases make use of
the numbered steps (0-17) in this section.  The complete set of steps
was developed for upgrading from 9.10.4.

**NB: If you have local software that depends on the exact values of
  the error numbers returned from the portopen routine, you may need
  to make some adjustments.  Please item (48e) under FS changes for
  more details. Any actions that are needed to handle this are in
  addition to the steps below.

If you have version 9.11.5 installed, a subset of the installation
steps can be followed to update to 9.11.6.  In this case, please
follow steps (0)-(6), (8)-(9), (10) but only the two commands at the
end should be needed for step 10, (11), (13H) and at least some basic
testing in step (16) to make sure there were no unexpected
complications.  This shortened process omits most of the detailed
control and procedure file updates that were needed for the update to
previous versions of 9.11.

If you have version 9.11.4 installed, a subset of the installation
steps can be followed to update to 9.11.6.  In this case, please
follow steps (0)-(6), (8)-(9), (10) only the two commands at the end
should be needed for step 10, (11), (13H) and at least some basic
testing in step (16) to make sure there were no unexpected
complications. .  This shortened process omits most of the detailed
control and procedure file updates that were needed for the update to
previous versions of 9.11.

If you have version 9.11.3 installed, a subset of the installation
steps can be followed to update to 9.11.6.  In this case, please
follow steps (0)-(6), (8)-(9), (11), (13H), and at least some basic testing
in step (16) to make sure there were no unexpected complications. .
This shortened process omits most of the detailed control and
procedure file updates that were needed for the update to previous
versions of 9.11.

If you have version 9.11.2 installed, a subset of the installation
steps can be followed to update to 9.11.6.  In this case, please
follow steps (0)-(6), (8)-(9), (10) only the two commands at the end
should be needed for step 10, (11)-(12), (13G), (13H), (14F), and at
least some basic testing in step (16) to make sure there were no
unexpected complications.  Steps (13G & 14F) are only for stations
that have a DBBC.  This shortened process omits most of the detailed
control and procedure file updates that were needed for the update to
9.11.0.

If you have version 9.11.1 installed, a subset of the installation
steps can be followed to update to 9.11.6.  In this case, please
follow steps (0)-(6), (8)-(9), (10) only the two commands at the end
should be needed for step 10, (11)-(12), (13G), (13H), (14D), (14F),
and at least some basic testing in step (16) to make sure there were
no unexpected complications.  Step (14D) is only for stations that
have MAT devices.  Steps (13G & 14F) are only for stations that have a
DBBC.  This shortened process omits most of the detailed control and
procedure file updates that were needed for the update to 9.11.0.

If you have version 9.11.0 installed, a subset of the installation
steps can be followed to update to 9.11.6.  In this case, please
follow steps (0)-(6), (8)-(9), (10) only the two commands at the end
should be needed for step 10, (11)-(12), (13F-H), (14D-F) and at least
some basic testing in step (16) to make sure there were no unexpected
complications.  Step (14D) is only for stations that have MAT devices.
Steps (13G, 14E, & 14F) are only for stations that have a DBBC.  This
shortened process omits most of the detailed control and procedure
file updates that were needed for the update to 9.11.0.

If you have a post 9.10.4 and pre 9.11.0 version (either 9.10.5 or
9.10.6) the full instructions below should also work, but you will not
need some of the control (Step 13) and procedure (Step 14) file
updates (in this case, please contact Ed, Ed.Himwich@nasa.gov, for
more details).

To upgrade from 9.10.4, please follow all numbered steps below.

If you have an older version than 9.10.4, please upgrade to 9.10.4
first (see fs9104up.txt). 

If you are installing FS9 for the first time with this version, please
follow the installation instructions in Section 4.5 of the FS9
"Computer Reference" manual.  In this case you should also get a copy
of the current FS9 "Control Files and Field System Initialization"
manual.

For reference, the list of the most recent "critical updates" is given
below.  These are updates that must be applied sequentially.  Please
start with the next update with a later version number than what you
have and apply it and the following listed versions before upgrading
to 9.11.6.  You can find the latest versions of installation notes for
these FS versions in the "/usr2/fs/misc" directory.  The list of
critical updates is:

  9.4.0
  9.5.3
  9.5.12
  9.6.9
  9.7.7
  9.9.2
  9.10.4

If you have a version older than 9.4.0, please contact Ed
(Ed.Himwich@nasa.gov).

For reference purposes the naming convention for the default station
libraries for different equipment configurations is listed here.  The
files are found in /usr2/fs/st.default/proc.  They can be referred to
and compared to what you have in "/usr2/proc/station.prc".  **ONLY**
for new installations (or completer re-installs), you can copy the
default version for your equipment to "/usr2/proc" renaming it to
"station.prc" in the process, e.g.:

  cd /usr2/proc
  cp -i /usr2/fs/st.default/proc/3station.prc station.prc
  chmod a+rw station.prc

The "-i" option will prompt before overwriting an existing
"station.prc" to give you a chance to recover if you did not realize
you already had a station.prc file.  The table of correspondence
between equipment types and default library names is given next.

      Equipment        Prefix letters  Station Library
      Rack/Drive1/Drive2

      K42/K42              k42         k42station.prc
      K42K3/VLBA           k42k3v      k42k3vstation.prc
      K42MK4/VLBA          k42mk4v     k42mk4vstation.prc
      K42MK4/VLBAB/VLBAB   k42mk4vb    k42mk4vstation2.prc
      K42/K5               k42k5       k42k5station.prc
      LBA/S2               ls2         ls2station.prc
      LBA4/S2              l4s2        l4s2station.prc
      Mk3/Mk3A             3           3station.prc
      Mk4/Mk4              4           4station.prc
      Mk4/Mk5A             45          45station.prc
      Mk4/VLBA4            4v4         4v4station.prc
      Mk5/Mk5B             5           5station.prc
      NONE/S2              s2          s2station.prc
      VLBA/S2              vs2         vs2station.prc
      VLBA/VLBA            v           vstation.prc
      VLBA/VLBA2           v2          v2station.prc
      VLBA/VLBA/VLBA       v           vstation2.prc
      VLBA4/VLBA4          v4          v4station.prc
      VLBA4/MK5A           v45         v45station.prc
      VLBA4/VLBA42         v42         v42station.prc
      VLBA5/Mk5B           v5          v5station.prc
      DBBC/Mk5B            d           dstation.prc
      DBBC(cont.cal)/Mk5B  d           dstationcc.prc

If your equipment type is missing, please let Ed (Ed.Himwich@nasa.gov)
know so that it will be added.

You can use cut-and-paste to reduce the amount of typing involved in
the installation.  This reduces the chances of missing required spaces
and other easily missed characters (like ".") in the commands.  The
basic idea is to have two different terminals open, either two
different VT text terminals (Control-Alt-F*, where * is 1-6) on the FS
computer you are upgrading or two different xterm terminals either on
the local X display or remotely logged in.  You can then switch back
and forth between the terminals, reading the instructions as you
scroll through them (with "more" or "less") on one terminal and
entering commands on the other.  You can cut-and-paste complicated
commands from the terminal with the instructions to the terminal where
you are entering commands as needed.  For VT text terminals you can
log in and out to change users as needed on the terminal where you are
executing commands.  With xterms, you can use "ssh" or "su" to
'switch' to users as needed on the terminal where you are entering
commands. For example, you can change to being 'prog' by executing:

 ssh -X prog@localhost

or

 su - prog

Please don't forget to log back out when you need to change users
again or you may develop a series of 'nested' logins.  The steps that
require rebooting will of course completely log out all of your
terminals; you will need to re-login again from scratch to continue.
At the end of the update, it is recommended that you login as "oper"
on the local X display for the final testing.  Please also note that
in order to paste into the X display login shell window for "oper" and
"prog", you typically must use Shift-Insert.  If you have any
questions about how to cut-and-paste please contact Ed
(Ed.Himwich@nasa.gov).

(0) Before you begin the upgrade make sure you have a current back-up
    of your system in case something goes wrong.  If you are use FS
    Linux 5 (FSL5), we recommend you use the tar based back-up that is
    part of the rotating disk back-up scheme.  A draft document that
    describes this method is available in the docs sub-directory on
    the FS FTP servers as backups2.pdf.  If you have an older FS Linux
    distribution, please use the disk-to-disk back scheme described in
    Section 5.8 of the FS9 "Computer Reference" manual.  If you have
    an FSL6 (sarge), FSL7 (etch) or FSL8 (lenny) system configured to
    run a RAID, please see /usr2/fs/misc/RAID.txt section APPLYING AN
    UPDATE for backup directions for applying an update.  If you are
    running one of the FSL distributions and do not have documentation
    on how to make a back-up, please contact Ed.  If you have SCSI
    disks, Section 5.7 of the FS9 "Computer Reference" manual has a
    discussion of drive ID numbers if you are unsure about these.

    Normally you should choose to install the update on your primary
    disk after having made and verified your back-up.  Once the
    installation is complete, has been tested, and used for a little
    while, you can copy over your back-up with the upgraded primary.
    If the upgrade fails, you should restore the back-up to the
    primary for operations.  You can then try to make the upgrade
    again when it is convenient.  In a desperate situation, you can
    use the back-up for operations.  You may choose to install the FS
    on your back-up disk for testing and then later copy the back-up
    onto the primary once you are satisfied with the new version.  In
    any event, please be sure to make a fresh back-up before
    continuing with the installation.

(1) Please be sure that you have at least 40 MB of free space (use the
    "df" UNIX command to check free space) on your "/usr2" partition
    before starting the upgrade.  This would probably only be an issue
    for stations with 200 MB disks.  If you are tight on space, you
    may want to delete old log files and old versions of the FS
    (except your most recent one if you can avoid it of course).
    Since you should have backed-up your system, you can even delete
    the "*.[oas]" and executable files of your old versions with no
    risk.  You might want to keep the source of the previous versions
    around for reference if you have room.  You can eliminate the
    non-source files by "cd"-ing to each of the old FS directories in
    turn as "prog" and doing a "make rmdoto rmexe".  If you have any
    questions about how to do this, please contact Ed.

(2) Log-in as prog.

(3) Place a copy of the fs-9.11.6 archive in your "/tmp" directory.
    For example you might do the following:

      cd /tmp
      ftp atri.gsfc.nasa.gov
      (enter your FS FTP account name at the prompt)
      (enter your FS FTP password at the prompt)
      binary
      cd dist
      get fs-9.11.6.tgz
      quit

    Another FS server is also available at:
    http://www.metsahovi.fi/fs/.

    The instructions for transferring the archive using DOS floppies
    are no longer included in this notice.  If you need to do this,
    please contact Ed (Ed.Himwich@nasa.gov).

(4) Log-out as prog and log-in as root.

(5) Extract the source from the archive:

      cd /
      tar xzpf /tmp/fs-9.11.6.tgz

(6) Set the link for the new FS version:

      cd /usr2
      ln -sfn fs-9.11.6 fs

(7) It is recommended that your local files operations (control, proc,
    log, and sched directories) have the default ownership
    ("oper.rtx") and permissions ('rw-rw-rw').  To force this, please
    execute the script:

      /usr2/fs/misc/fix_perm

    Answer "y" to the prompt if you wish to proceed.  It is good idea
    to do this, unless you have purposely changed the ownerships and
    permissions to some other values.  If you don't want to restore
    the defaults, answer "n" (this is the last chance to abort the
    execution of the script).

(8) VERY IMPORTANT: Log-out as root, and log-in as prog.

(9) Make the FS:

      cd /usr2/fs
      make 

(10) Recompile your station software.  This is necessary to pick-up
     changes to common blocks, shared memory, and library routines.

     When updating from 9.10.4, it may be necessary to make some
     changes before you will be able to successfully compile your
     station code.  The only known change that is expected is that if
     your C language source code includes the FS header files
     "params.h" and "fs_types.h", you will need to make sure that the
     "params.h" include occurs before the "fs_types.h" include.

     A workable, but tedious, way to discover if these changes are
     necessary and then make them is to try the instructions for
     "make"-ing below and seeing if any modules fail with an error
     like:

In file included from ../../fs/include/fs_types.h:46,
                 from ancom.c:12:
../../fs/include/tpicd_ds.h:7: error: 'MAX_DET' undeclared here (not in a function)
In file included from ../../fs/include/fs_types.h:47,
                 from ancom.c:12:
../../fs/include/onoff_ds.h:22: error: 'MAX_ONOFF_DET' undeclared here (not in a function)

     If so, the error in the module is probably due to the order of
     the "fs_types.h" and "params.h" includes.  After moving the
     "params.h" include to before the "fs_types.h" include in the
     source module, the next attempt to recompile may reveal another
     module that needs to be fixed.  The tedious part is that only one
     module per source directory will be discovered per "make".

     In any event, to recompile and reload your station software, the
     following steps should work if you have the "standard"
     configuration for station software:

       cd /usr2/st
       make rmdoto rmexe all

(11) Reboot the computer.  This is important for re-initializing
     shared memory.

(12) Log in as oper

(13) Modify your control files.  Up to seven changes are needed: (A)
     Update your stcmd.ctl file for the increased number of supported
     devices, (B) update your dual polarization .rxg files to have two
     Trec values, (C) update your equip.ctl for new additional lines
     and the metserver port number, (D) create a dbbad.ctl file with
     the DBBC network communication parameters, (E) update your
     parpo.ctl file to include the new third non-comment line, (F)
     update your skedf.ctl file if you want to use the new parameters
     AutoFTP_ABORT_TIME and/or default_dbbc_if_inputs with DRUDG, and
     (G) update your skedf.ctl file if you want to use the new
     keywords cont_cal, dbbc_if_targets, and/or dbbc_bbc_target with
     DRUDG.  If you have a DBBC and want any continuous cal
     configuration other than "off", you must use the "cont_cal"
     keyword with the appropriate setting in skedf.ctl.  Step (H) is
     only for stations that are not doing step (C) in this update.

     (A) Update your stcmd.ctl file with:

           cd /usr2/control
           /usr2/fs/misc/cmdctlfix5 stcmd.ctl

         The procedure will save the original version of stcmd.ctl as
         stcmd.bak.  If the script complains that you already have a
         stcmd.bak file, you need to either delete or rename ("mv") it
         before re-running cmdctlfix5.

     (B) Update your .rxg files with:

           cd /usr2/control/rxg_files
	   mv *.bak /tmp
           /usr2/fs/misc/rxgfix2 *.rxg

         The procedure will save the original versions of .rxg files
         that it updates with the a ".bak" extension.  The "mv" step
         will move any already existing "*.bak" files to "/tmp".  They
         can be recovered from there if they are needed.

     (C) Update your equip.ctl file:

           cd /usr2/control
           tail -12 /usr2/fs/st.default/control/equip.ctl >>equip.ctl 

         You may need to edit the equip.ctl to adjust met sensor type
         (if you use a MET3 or MET4), and the contents of the (just
         added) non-comment lines for DDC version, number of
         conditioning modules, and the IF power conversion factors.

         If you are using metserver to support a MET3 or MET4 sensor,
         you will need to change the met sensor field from "met3" to
         the port number to be used to communicate with the server.
         If you are using a prior version of metserver, the default
         port number was 30384.  For the new metserver, the default is
         50001.  A few stations already have the new version
         installed.  This can be checked by listing
         /etc/init.d/metserver.sh to see if there is a line
         PORT=... in the file.  If there is, you have the new version
         and this line gives the port number.

         If you don't have a DBBC, no further changes to equip.ctl are
         needed.

         If you have a DBBC, it is critical to update the DBBC DDC
         version number (one of v100, v101, v102, or v104) and the
         number of conditioning modules to the correct number (if you
         don't have the typical number of four). The IF power
         conversion factor line must have the same number of entries
         as the number of conditioning modules.  If you do not know
         the actual IF power conversion factors for your DBBC, it
         should be fine to use the default value of 15000 for each.
         This will only impact the accuracy of the power and Tsys for
         the IF power detectors.  The IF Tsys values will probably
         still be close to being reasonable.  The readings for
         individual BBC sidebands are unaffected.

         Please see the discussion at the end of step (13H), after the
         "tail" command, about setting the value for the 5B clock rate
         line.

     (D) Create a dbbad.ctl file:

           cd /usr2/control
           cp -a /usr2/fs/st.default/control/dbbad.ctl .
           chmod a+rw dbbad.ctl

         If you have a DBBC, you will need to edit the file, uncomment
         the last line, and update the address of the DBBC. Other
         fields in the file should not require modification.

     (E) Update your parpo.ctl file:

           cd /usr2/control
           tail -7 /usr2/fs/st.default/control/parpo.ctl >>parpo.ctl 

         The added lines include comments explaining the effect of
         this change.  If you want to recover the previous behavior of
         the pointing analysis programs, you change the value of "3"
         in the last line to "0".  However, "3" is the recommended
         value.

     (F) Update your skedf.ctl file if you want to use the new
         parameters AutoFTP_ABORT_TIME and/or default_dbbc_if_inputs
         with DRUDG (the latter for stations with DBBCs only).

         The AutoFTP_ABORT_TIME parameter will be useful for stations
         that make DRUDG controlled disk2file transfers (typically in
         EVN astronomy schedules) and have large gaps between scans.
         This parameter will allow a station to have the transfer
         abort (in case the transfer is going too slowly) after some
         reasonable interval after it is started rather waiting what
         may be many minutes until the next scan.  The single value
         for the parameter is in seconds.

         The default_dbbc_if_inputs parameter will be useful for
         stations that receiver schedules written for a different rack
         type and have a fixed, or nearly fixed, DBBC IF input
         configuration.  DRUDG will insert the specified configuration
         if the scheduled is not written for a "None" or "DBBC" rack.
         This can reduce the amount of procedure file editing that is
         needed after DRUDG generates the file for a schedule written
         for a different type of rack.  Although this parameter was
         available in 9.11.0, the installation instructions were
         omitted in 9.11.0; however some stations may have already
         started using it.

         To enable either or both of these parameters, you will need
         to edit:

           /usr2/control/skedf.ctl

         and add either or both as appropriate. Please see:

           /usr2/fs/st.default/control/skedf.ctl

         for more information about the format of these parameters.

     (G) Update your skedf.ctl file if you have a DBBC and want to use
         the new parameters cont_cal, dbbc_if_targets and/or
         dbbc_bbc_target with DRUDG.  If you have a DBBC and want any
         continuous cal configuration other than "off", you must use
         the "cont_cal" keyword with the appropriate setting in
         skedf.ctl.

         This cont_cal parameter controls how the cont_cal command is
         set in DRUDG generated setup procedures for DBBC racks,
         choices are "ON", "OFF", and "ASK" (to be prompted).  If the
         parameter is not present, it is assumed continuous cal should
         be off.  Although this parameter was available in 9.11.0, the
         installation instructions were omitted from the instructions
         before 9.11.3; however some stations may have already started
         using it.  If you have a DBBC and want any continuous cal
         configuration other than "off", you must use the "cont_cal"
         keyword with the appropriate setting in skedf.ctl.

         The dbbc_if_targets parameter is useful for specifying
         default IF targets levels for the DBBC.  Up to four values
         may be specified, one for each IF: A, B, C, and D in order.
         If the parameter is omitted, no target is used, which causes
         the last commanded values to be used.  A target level will
         generate an error, invalidating the IF set-up, for DDC
         versions before v101, which will probably be a serious
         problem; be careful to avoid this.

         The dbbc_bbc_target parameter is useful for specifying
         default BBC TPI targets levels for the DBBC.  One value is
         specified.  If the parameter is omitted, no target is used,
         which causes the last commanded value to be used.  A target
         level for DDC versions before v103 will have no effect.

         To enable any or all of these parameters, you will need
         to edit:

           /usr2/control/skedf.ctl

         and add either or both as appropriate. Please see:

           /usr2/fs/st.default/control/skedf.ctl

         for more information about the format of these parameters.

     (H) If you have not already done setp 13.C above, please update
         your equip.ctl file with:

           cd /usr2/control
           tail -4 /usr2/fs/st.default/control/equip.ctl >>equip.ctl 

         The default update sets "32" as the clock rate since that was
         the old value.  You may want to change that to one of the
         other allowed values shown in the comments as appropriate for
         your equipment.  In particular, "nominal" may be the best
         choice unless your rack type is "none".  Using values other
         than 32 are intended only or testing by experts.  Please note
         that DRUDG only produces "mk5b_mode" commands correctly for a
         clock rates of 32.  If you use a value other than 32, you
         will need to modify the "mk5b_mode" command in experiment
         procedures appropriately.

(14) Modify your procedure files.  Up to six changes may be needed:
     (A) update "onoff=..." set-up commands in your procedure for the
     added parameter (this step also removes any instances of the
     obsolete "calrx" command), (B) if you have a DBBC: create a
     version of station.prc for that device, C) if you want to use a
     DBBC for FIVEPT and ONOFF measurements, you will need to update
     your pointing procedure library, probably point.prc, and (D) if
     you use MAT devices, make sure there is an initial read of a MAT
     device in "initi".  Step (E) is only for stations upgrading from
     9.11.0.  Step (F) is only for stations upgrading from 9.11.x,
     x=0, 1, or 2.  Please note that before making these changes, you
     should make sure that the FS is not running.

     (A) Update your procedure files with:

           cd /usr2/proc
           /usr2/fs/misc/onoff_fix *.prc

         The procedure will save the original versions of procedure
         files that it updates with a .bak extension.  If the script
         complains that you already have .bak files, you will need to
         delete or rename them before re-running onoff_fix.

     (B) Stations without DBBC's can skip this sub-step.  If you have
         a DBBC, you will need to make, one or more versions, of your
         station.prc file for use with the DBBC.  You may want a
         version for receivers that use non-continuous cal and one for
         receiver that use continuous cal since the contents of the
         procedures are different (or you may prefer to have a
         different version for every receiver anyway).  In any event
         you should save a copy of your original station.prc before
         you begin, perhaps with:

           cd /usr2/proc
           cp -a station.prc stationold.prc

         There are many ways to make the new station.prc.  Two
         approaches you might follow are described here, which will be
         easier will depend on the details of your station.

         Please note that regardless of which approach is used, the
         biggest single change for DBBCs in existing procedures is
         that the structure of PREOB is quite different.  For
         continuous cal, there is no CALTSYS in PREOB.  In fact there
         should be no Tsys related commands in PREOB at all.  For
         non-continuous cal, a different procedure, CALTSYS_MAN, is
         used in PREOB.  This procedure is not executed until four
         seconds after PREOB starts.  For this case, any other
         commands needed in PREOB should be placed in the four second
         gap in PREOB.  Please see the PREOB in
         /usr2/fs/st.default/proc/dstation.prc for a sample PREOB and
         CALTSYS_MAN procedures..

         One approach for updating station.prc you might use is to
         start with the existing station.prc and modify it to agree
         with the example dstation.prc or dstationcc.prc, as
         appropriate, from /usr2/fs/st.default/proc.  You can place a
         copy of the example procedure library in /usr2/proc to
         facilitate copying of procedures from example to the station
         procure library. For example:

           cd /usr2/proc
           cp -a /usr2/fs/st.default/proc/dstation.prc .

         or

           cd /usr2/proc
           cp -a /usr2/fs/st.default/proc/dstationcc.prc .

         Then the pfmed "st" command can be used to copy procedures
         from the example file.  As an example, to copy the ifman
         procedure from the dstation.prc example, you could use:

           pfmed
            pf,station
            st,ifman::dstation,ifman
            ex

         A second approach is to copy an example DBBC procedure file,
         either dstation.prc (non-continuous cal) or dstationcc.prc
         (continuous cal) from /usr2/fs/st.default/proc to
         /usr2/proc/station.prc. For example, either:

           cd /usr2/proc
           cp -a /usr2/fs/st.default/proc/dstation.prc station.prc

         or

           cd /usr2/proc
           cp -a /usr2/fs/st.default/proc/dstationcc.prc station.prc

         You can then customize the new station.prc possibly using
         your old station.prc file (hopefully saved previously as
         suggested above) as a guide, possibly copying procedures you
         need to add from your back-up copy of the original .prc file
         using the PFMED, e.g. to replace the default initi procedure
         with the your original initi procedure, you might use:

           pfmed
            pf,station
            pu,initi
            st,initi::stationold,initi
            ex

     (C) Stations without DBBC's can skip this sub-step.  If you have
         a DBBC and wish to use FIVPT and ONOFF with it, you will need
         to make sure you modified your set-up in your pointing
         procedure library.  This will probably consist of two
         changes:

         (i)  changing the detector device(s) you want to use in the
              "fivept=..."and "onoff=..." commands (probably only for
              the "fivept=... though). See /usr2/fs/misc/dbbc.txt for
              a description of DBBC detector names.

         (ii) if you are using continuous cal and want to get good
              Tsys and Tcal values from ONOFF, you will need to
              increase the number of integration seconds to a large
              enough number to give stable measurements at the level
              of accuracy you want.

     (D) This change supports the MAT serial problem work around
         discussed in FS update item 11 given above.  This step is
         only for stations that use MAT devices and only for stations
         with an MAT device that is accessed with a command that only
         writes to, i.e. does not do read-back,. Typically this is only
         VSI4 devices (typically at stations with Mark 5 or VLBA5
         racks).  These stations should put a "vsi4" as the first
         command in their "initi" procedures.

         If a station has other, local, MAT based command that does
         not read, they should put some command that does read as the
         first command in "initi".  If there is no command available
         for this case, please contact Ed.

     (E) This step is only for stations that are updating from 9.11.0
         and have a DBBC.  Please note the following changes have been
         made to the default versions dstation.prc and dstationcc.prc
         procedure libraries since 9.11.0 and should be made in your
         local copies:

         (i)   The first "ifd" command in MIDOB was changed to "ifb".

         (ii)  The command:

                 sy=run setcl &

               at the end of MIDOB was replaced with:

                 " the shown order of the commands from here to the end of this procedure is
                 " strongly recommended
                 mk5b_mode
                 !+1s
                 mk5=dot?
                 sy=run setcl adapt &

         (iii) The procedure MK5PANIC:
  
                 "mk5panic - dls - 5 december 2003
                 disk_record=off
                 mk5=bank_set=inc;
                 !+3s
                 disk_serial
                 mk5=bank_set?
                 mk5=vsn?

               was added.

         Please make the corresponding changes to any versions of
         station.prc that you have made at your station based on the
         examples libraries.  The first two changes, (i) and (ii), can
         be made with relatively easy edits in PFMED of your existing
         DBBC versions of MIDOB.  The third change, (iii), can be made
         either by creating a new procedure in your DBBC station.prc
         libraries with the shown contents or copying this procedure
         from some existing local .prc file that includes it, e.g.:

           pfmed
            pf,station
            st,mk5panic::stationold,mk5panic
            ex

     (F) This step is only for stations with DBBCs that are updating
         from previous version of 9.11.x, x=0, 1, or 2. Three changes
         are needed to the station.prc library:

         (i) Please insert the command "bbc_gain=all,agc" at the end
               of your SETUPA procedure.  This command is a "no-op"
               for DDC version less than v103, but including it is
               recommended for future compatibility.  For stations
               with v104 or higher, as additional parameter specifying
               the target count level can be added if it is desired,
               e.g., "bbc_gain=all,agc,16000"

         (ii)  Add the procedure "BBC_LEVEL" to your station.prc
               library.  This can probably done most easily with the
               following commands:

                 cd /usr2/proc
                 cp /usr2/fs/st.default/proc/bbc_level.prc .
                 pfmed
                   st,bbc_level::bbc_level,bbc_level
                   ex
                 rm bbc_level.prc

         (iii) This step is only for stations with non-continuous cal and has
               two parts.

               (a) Edit the CALTSYS_MAN procedure and insert the command
                   "bbc_gain=all,man" right after the "IFMAN" command.

               (b) Edit the CALTSYS procedure and insert the command
                   "bbc_gain=all,agc" right after the "IFAGC" command.

(15) If you have a DBBC, you will need to update your .Xresources
     file. Please edit the ~oper/.Xresources. File the line:

       monit3*geometry:      32x17-0+120

     and change the 17 to 19:

       monit3*geometry:      32x19-0+120

     and save the file.  You may need to make other changes to this
     line if you are using non-default values for any of the
     parameters and/or want to make other changes in the default
     position or size of the monit3 (Tsys) window.

     After you have saved the file, if you are logged-in on the
     X-display on the machine, you should either log-out and log back
     in or just reload the X Resources Data Base. You can do the latter
     with the alias commanded, if you have it defined:

       xrdb

     or if not:

       xrdb -merge ~/.Xresources

     Logging out and logging back in again is simple and safe.

     You should also update the ~prog/.Xresources file (as "prog"). Be
     sure to log out as "prog" when done.
     
(16) Test the FS as "oper". Generally speaking a fairly thorough test
     is to run a test experiment: start with DRUDG-ing a schedule,
     making listings, and any other pre-experiment preparation you
     normally do, then execute part of schedule, and perform any
     normal post-experiment plotting and clean-up that you do.  The
     idea here is to verify that everything works as you expect for
     normal operations.  In particular for this upgrade you should
     test that Mark 5 operations work as expected.

(17) Consider when to update your back-ups.  You certainly should not
     update them until you have performed the tests described above.
     It would be prudent to wait until you have successfully run an
     experiment or two and preferably received word that the
     experiment(s) produced good data.  The chances of needing your
     back-up before you update it is fairly small.  If something does
     happen, you can copy the pre-FS update back-up it to the (now
     assumed bad) FS updated disk.  You can then either run the
     recopied disk or apply the FS update again.  Handling this will
     be a lot safer if you have a third disk.
