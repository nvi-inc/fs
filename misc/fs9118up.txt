File: /usr2/fs/misc/fs9118up.txt        Version: 6.5  Date: 150920

I. Introduction

This memo is divided into three sections:

   I.   Introduction.
   II.  Changes Since Version 9.11.6
   III. Installation

Please print this notice and read it carefully before installing the
new version.

This update is intended for all stations.  New in this version is
support for DBBC/FiLa10G racks and single FlexBuff (or Mark 6)
recorders running "jive5ab" and partial support for VLBAC and CDAS
racks.  Stations must use jive5ab version 2.6.2 or later for Mark 5C
and FlexBuff (including Mark 6) recorders.

We encourage all stations to upgrade now because doing so will make
future upgrades easier.  Upgrading from 9.11.7 is fairly easy.
Upgrading from 9.11.6 may require one more step.

The most significant changes in version 9.11.8 are:

  (i) Support for DBBC/FiLa10G racks when using the DBBC DDC
      personality beginning with version v105x_1.  At this time,
      Mark5B output over Ethernet is not supported, nor do we expect
      to support it in future.  VSI-H output and VDIF output, the
      latter over Ethernet, are supported.

 (ii) Support for a single FlexBuff (and Mark 6) recorder that is
      running the "jive5ab" control program, version 2.6.2 or later.
      Some Mark 5 functions are not yet supported by FlexBuff, these
      include: data_check, bank_check, and disk_pos.  Needed support
      for automated bank swapping is not provided by "jive5ab" for the
      Mark 6 at this time and so is not available.

(iii) Support for DBBC continuous calibration control signal
      "polarity" for DBBC versions v105x_1 and later.  This allows
      both the sign of the control signal voltage to be changed and/or
      to swap which parts of the cycle are "on" and "off".

 (iv) Partial support for the VLBAC and CDAS racks.  This consists of
      support for automatic detector selection with detector names
      "formbbc" and "formif" for format codes "geo" and "vlba" in
      ONOFF and for Tsys measurements and in tpicd for background TPI
      measurements.  It is necessary to provide a local "vsi4" SNAP
      command to set the sampler format code for these racks.  That
      command will be integrated into the FS in a later release.
      Until then, the automatic detector selection will not support
      format codes "geo_t", "geo_r", "vlba_u", and "vlba_l".

  (v) A new "termination mode" for ANTCN.  This mode can be used to
      implement a graceful shutdown for the antenna and/or other local
      systems when the FS is terminated cleanly.  This is triggered by
      the use of an environment variable FS_ANTCN_TERMINATION.

 (vi) After successful field testing of the "mk5_status" from 9.11.7,
      it is now used in place of "mk5=status?" in POSTOB.

(vii) A bug that prevented error messages for non-zero missing bytes
      from Mark 5 recordings from being reported was fixed.

      However, please note that the Mark 5C (and possibly FlexBuff)
      recorders are in fact losing bytes on some, possibly all,
      recordings.  There is a real error and the FS is correctly
      reporting it.  The cause of this is under investigation.  In the
      meantime if this problem occurs at your station, it is
      recommended that this be handled by using the "tnx=5k,-602"
      command after the first instance of this error.  This command
      will suppress this error message from the operator display (it
      will still go in the log for the record).  This command must be
      entered interactively and must be renewed after the first
      instance of the error following each FS restart.

The remainder of this section describes the most significant changes
in the previous update, 9.11.7, which were:

  (i) Support for DBBC DDC firmware versions 105, 105E, and 105F,
      particularly for the 32 MHz BW option in the E/F versions.  At
      this time, firmware version E/F is intended _only_ for use with
      32 MHz BW channels.  Users should change between the non-E/F and
      E/F versions depending on the BW of the channels, using the
      non-E/F version if the BW is 16 MHz or less.  Note that DRUDG
      will only select among DBBC IF input filters 1-4, so if a wider
      input IF band is needed for 105F, it will have to be selected by
      the user manually.
      
 (ii) Support for operational use of 64 MHz Mark 5B clock rates.

(iii) Support for a single Mark 5C recorder running "jive5ab" as its
      control program.  This allows use of a Mark 5C as a substitute
      for a Mark 5B, if the FiLa10G feeding it is configured manually
      (this is superceeded by FS 9.11.8 which also does the FiLa10G
      configuration).

 (iv) New "mk5_status" command.  This command, developed by Harro
      Verkouter (JIVE), correctly reads the status message and returns
      any pending error messages.  This feature is necessary for
      correct monitoring of the Mark 5 status and has heretofore being
      missing from the FS.  At this time this command is considered
      experimental and should not be used for normal operations.
      However, we expect that sufficient testing will occur before the
      next FS release, so it is included in this version to allow
      field testing and inclusion in normal operations once sufficient
      testing has occurred.  Please use "help=mk5_status" for more
      details on the operation of this command.

The full list of changes in 9.11.8 version, by version number, is
given in the "Changes Since Version 9.11.6" section below.

As always, we are deeply indebted to Jonathan Quick (HartRAO) for his
various and significant contributions.

II. Changes Since Version 9.11.6

This section is divided into three sub-sections: A. Changes in the FS,
B. Changes in DRUDG, and C. Known FS Bugs.  Each sub-section starts
with a summary of the items covered followed by a more detailed
description.

			 A. Changes in the FS

The following is a summary of FS changes since 9.11.6.  Changes
numbered 10 and below occurred in 9.11.7.

 1. Support for DBBC DDC firmware versions 105, 105E, and 105F.
 2. Support for operational use of 64 MHz Mark 5B clock rates.
 3. The "mk5b_mode" command was enhanced to accept the target sample
    rate as an additional parameter.
 4. Support for a single Mark 5C recorder.
 5. Upgraded support for DBBC DDC version numbers.
 6. Fix for a sleeping bug in Mark IV formatter support.
 7. Support for the current Digiboard serial driver.
 8. New "mk5_status" command.
 9. CHEKR re-enabled for VLBA4/5 racks.
10. Fixed benign bug in procedure logging when the year wraps.
11. Support for FiLa10G with DBBC in DDC mode.
12. Support for a single FlexBuff (and Mark 6) recorder that is
    running the "jive5ab" control program.
13. Support for DBBC continuous calibration control signal
    "polarity".
14. Partial support for the VLBAC and CDAS racks.
15. A new "termination mode" for ANTCN
16. Improved information for errors in equip.ctl lines.
17. The "mk5_status" command is now used in place of "mk5=status?" in
    POSTOB procedures.
18. Non-zero missing byte error messages for Mark 5 scan_check
    commands are now reported.
19. CHEKR error messages for VLBA module IC (IFDCD) have been
    corrected.
20. Storing of the IF attenuator settings when only one half of a VLBA
    module was being used in ONOFF was fixed.
21. In the monitor form of the TNX command, if an error doesn't have
    an assigned error string in fserr.ctl or sterr.ctl, a null string
    is display for the string parameter.

A more detailed discussion of these changes follows.

 1. Support for DBBC DDC firmware versions 105, 105E, and 105F. In
    particular, this provides support for the 32 MHz BW option in the
    E/F versions.  Users should change between non-E/F and E/F
    versions depending on the BW of the channels, using the non-E/F
    version if 16 MHz BW or less.  For the E/F DDC versions, only odd
    BBCs can be used.  The E/F DDC firmware only accepts the "astro3"
    and "test" format codes.

 2. Support for operational use of 64 MHz Mark 5B clock rates. If the
    "nominal" value is used for the Mark 5B clock rate in equip.ctl,
    the value 64 MHz will be used from DBBC DDC letter E/F versions.
    In combination with the existing support for "nominal" meaning 32
    MHz clock rate for non-E/F firmware, this allows the FS to switch
    automatically between 32 and 64 MHz clock rate for non-E/F and E/F
    versions respectively by just changing the DDC firmware version in
    equip.ctl and restarting the FS.

 3. The "mk5b_mode" command was enhanced to accept the target sample
    rate as an additional parameter.  This new parameter is added
    after the "decimation" parameter and before the "fpdp" parameter.
    DRUDG now uses this sample rate parameter instead of the
    decimation factor for mode set-up.  The FS now calculates the
    correct decimation factor for the configured Mark 5B clock rate.
    Consequently, DRUDG does not need to know the clock rate.

 4. Support for a single Mark 5C recorder.  The recorder must be
    running "jive5ab" as its control program.  This is designed to
    make a Mark 5C usable as a substitute for a Mark 5B, if the
    FILA10G feeding it is configured manually.  Support for FILA10G is
    expected later this year (and is included in FS 9.11.8).  Support
    for the Mark 5C is identical to the Mark 5B support except for
    three things:
  
    (1) FMSET does not support the Mark 5C. It will instead support
        the FiLa10G in due course (added in FS 9.11.8).

    (2) Similarly, SETCL does not support the Mark 5C.  Unfortunately,
        SETCL will not be useful for systems with Mark 5C recorders
        until the FILA10G is supported by the FS, in due course (added
        in FS 9.11.8).

    (3) The new SNAP "mk5c_mode" command is used with the Mark 5C,
        instead of "mk5b_mode".  The Mark 5C version of the command is
        essentially identical to the Mark 5B version, except that it
        always commands the decimation factor as "1" and it issues a
        "clock_set" command to the Mark 5C with the target sample rate
        as the clock rate.  Due to the features of "jive5ab" (which
        are a superset of those of "DIMino"), this allows the recorder
        "rtime?" command to return useful information which then
        enables automated back switching using the SNAP command
        "bank_check" as with the Mark 5B.

 5. Upgraded support for DBBC DDC version numbers. Starting with
    version v105, the use of E/F after the version number, as well as
    an possible trailing "_x", where "x" is an integer representing a
    release, is supported.  Any three digit version number larger than
    104 will be accepted so that new firmware versions (when properly
    set in equip.ctl) will not generate "warning" errors when the
    "form=..."  command is used.  Of course problems may occur if
    there is some incompatibility between some future firmware version
    and the FS.  Note that for v104 and below, there can be no "_x" in
    the version number in the control file.

 6. Fix for a sleeping bug in Mark IV formatter support.  This bug in
    MATCN prevented FMSET from working.

 7. Support for the current Digiboard serial driver. Systems with the
    old driver, which should be very rare if they exist at all, will
    need to have a link created, as described in the installation
    instructions, to be able to compile the FS.

 8. New "mk5_status" command.  This command, developed by Harro
    Verkouter (JIVE), correctly reads the status message and returns
    any pending error messages.  This feature is necessary for correct
    monitoring of the Mark 5 status and has heretofore being missing
    from the FS.  At this time this command is considered experimental
    and should not be used for normal operations.  However, we expect
    that sufficient testing will occur before the next FS release, so
    it is included in this version to allow field testing and
    inclusion in normal operations once sufficient testing has
    occurred.

 9. CHEKR re-enabled for VLBA4/5 racks. Previously CHEKR did not check
    the VLBA rack modules even though it did for the VLBA rack type.
    This was oversight that has been corrected.  Checking of the
    VLBA/4/5 BBC LO lock was added as part of this change.  Checking
    of the _VLBA_ formatter was disabled altogether.  This latter
    change was made because that formatter is no longer used in
    systems that are supported by the FS.  This allows VLBA formatter
    to be set-up (with "vform=...") to support rack timing for VLBA45
    systems without having to set the formatter time to avoid getting
    a bad time complaint from CHEKR.

10. Fixed benign bug in procedure logging when the year wraps.  This
    bug caused extra logging of procedures when a log was open across
    the change in year.

11. Support for FiLa10G with DBBC in DDC mode.  This requires v105x_1
    or later.  At this time, Mark5B output over Ethernet is not
    supported.  VSI-H output and VDIF output, the latter over
    Ethernet, is supported.  There are several aspects to this change.

      The support is enabled by specifying "dbbc/fila10g" for the rack
      type in equip.ctl.

      For correct operation, whenever the FiLa10g is restarted, two
      actions are required:

       (i) The "fila10g_cfg" SNAP procedure must be executed to
           configure the "static" configuration.  Steps for installing
           this procedure are included in the installation
           instructions.  In the future the FiLa10G will be able to
           set the static configuration automatically.

      (ii) The FMSET program nust be run and the 's'ync command used
           to set the FiLa10G input selection, the VSI input clock
           rate, and the time.

      The second step (ii) is also required whenever the input sample
      rate is changed (due for example to a change in the DBBC firmware
      version) even if the FiLa10G is not restarted.

      NOTE THAT AT THIS TIME THE FS DOES NOT VERIFY THAT THE INPUT
      SELECTION AND INPUT CLOCK RATE ARE SET CORRECTLY. IT IS
      IMPERATIVE THAT FMSET BE USED TO SET THESE WITH 'S' OTHERWISE
      DATA MAY NOT BE RECORDED PROPERLY.

      There is a new "fila10G_mode" command that covers enough of the
      FiLa10G configuration parameter space to enable VDIF output on
      the configured Ethernet port for the DDC mode.  VSI-H output on
      the VSI_H ports will be available as well if the FiLa10G is
      configured for this by default.

      The existing "mk5c_mode" command was expanded to support
      "vdif" as a "source" value.

      The FMSET and SETCL programs were expanded to support the
      FiLa10G as a formatter "clock".  Note that as is generally the
      case for FS support of the FilA10G, this requires v105x_1 or
      later .  The response time of the FiLa10G via the DBBC is
      typically a few tens of milliseconds and causes some variation
      in results, but it is quite usable for this purpose.  Use of
      both the "computer" and "rate" time models works with the
      FiLa10G.

      There is a new "fila10g" command to provide direct low-level
      communication with the device through the DBBC.  All the output
      from the FiLa10G is multi-line.  All lines before the final
      prompt are logged by DBBCN program and the terminating prompt of
      the FiLa10G response is logged by the "fila10g" command itself.
      This allows display of responses of an arbitrary number of
      lines.  For internal use, the FS handles FiLa10G responses up to
      1024 characters, including the terminating prompt.

12. Support for a single FlexBuff (and Mark 6) recorder that is
    running the "jive5ab" control program.  This was implemented with
    the existing "mark5c_mode" and "disk_record" commands.  The former
    was modified to handle the FlexBuff for VDIF input only.  Several
    Mark 5 functions are not yet supported by FlexBuff, these include:
    data_check, bank_check, and disk_pos. Needed support for automated
    bank swapping is not provided by "jive5ab" for the Mark 6 at this
    time and so is not available.
     
13. Support for DBBC continuous calibration control signal "polarity".
    This is available in DDC versions v105x_1 and later.  This allows
    both the sign of the control signal voltage to be changed and/or
    to swap which parts of the cycle are "on" and "off".  The
    parameter to control this was inserted between the existing
    "state" and "samples" parameters.  Please see "help=cont_cal" for
    more details.  A script has been provided,
    "/usr2/fs/misc/cont_cal" to update existing .prc files if the
    "sample" parameter was being given a non-default value.

14. Partial support for the VLBAC and CDAS racks.  This consists of
    support for "nominal" for the Mark 5B clock rate in equip.ctl and
    automatic detector selection with detector names "formbbc" and
    "formif" for format codes "geo" and "vlba" in ONOFF and for Tsys
    measurements and in tpicd for background TPI measurements.  It is
    necessary to provide a local "vsi4" SNAP command to set the
    sampler format code for these racks.  That command will be
    integrated into the FS in a later release.  Until then, the
    automatic detector selection will not support format codes
    "geo_t", "geo_r", "vlba_u", and "vlba_l".

    Support for these racks is selected by specifying "vlbac" or
    "cdas" as the rack type in equip.ctl.  The "nominal" Mark 5B clock
    rate for "vlbac" is 32 MHz; for "cdas" it is 64 MHz.

15. A new "termination mode" for ANTCN.  This mode can be used to
    implement a graceful shutdown for the antenna and/or other local
    systems when the FS is terminated cleanly.  This is triggered by
    the use of an environment variable FS_ANTCN_TERMINATION.

    The existence and value of this variable is inspected by the FS
    when the FS "terminate" command is executed.  If the varible is
    not defined, the FS termination behavior is as before, i.e., no
    ANTCN termination action it taken.

    If the variable exists, but the contents are empty or don't
    decoder as a non-negative integer, ANTCN will be run in mode 10,
    which is the standard termination mode (see /usr2/fs/antcn/antcn.c
    for more details).  If the contents decode as a non-negative
    integer, that value is used for the mode in ANTCN.  Other values
    than 10 should not normally be used, but this option is provided
    to help implementers deal with non-standard featrues of their
    ANTCN programs in the short term.  It is recommended that any
    non-standard use of ANTCN modes should be corrected as soon as it
    is reasonable to do so.

    The ANTCN termination mode (normally 10) must complete execution
    promptly.  If it does not, termination of the FS may be delayed,
    which can cause difficulties as well as frustration for the
    operator.  It is recommended that if execution will take more than
    a fraction of second, execution should be passd to another process
    that persists after FS termination.  It may be necessary to
    coordinate with that other process in the ANTCN initialization
    mode to make sure there is no conflict when the FS is restarted.

16. Improved information for errors in equip.ctl lines.  In addition
    to, as previously, printing the number of the non-comment line
    that had a value that was not accepted, the FS now also prints the
    contents of the line.  This should make it easier to identify the
    line that needs to be corrected.  The previous behaviour of only
    printing the line number made it tedious to identify the errant
    line.  Also now there are interactions between lines, most notable
    between the rack type, DBBC firmware version, and the 5B clock
    rate. As a result it may not have been transparent that, for
    example, a change on the rack line was causing a problem with 5B
    clock rate since since that line had not been changed.  Hopefully
    the new information will make it easier to correct detectable
    errors in the equip.ctl line contents.

17. The "mk5_status" command is now used in place of "mk5=status?" in
    POSTOB procedures.  This command was introduced in 9.11.7 for
    trial use.  After successful filed testing it is now ready for
    normal use.  The installation instructions provides step for
    changing to the new command. The "mk5_status" should be the last
    command in all POSTOB procedures.

18. Non-zero missing byte error messages for Mark 5 scan_check
    commands are now reported.  The bug that caused these messages to
    not be reported appeared in version 9.9.3 in Septemebr 2007.  It
    is now fixed.

19. CHEKR error messages for VLBA module IC (IFDCD) have been
    corrected.  Previously although the module "ic" was correctly
    reported, the error numbers were the same as for the errors from
    module IA (IFDAB) and as a result, the text was incorrect for four
    of the five messages.  This bug has existed since at least
    November 1992 and was in the initial implementation of chekr for
    the VLBA reack.  Thanks to the station at Kokee Park for reporting
    this.

20. Storing of the IF attenuator settings when only one half of a VLBA
    module was being used in ONOFF was fixed.  The IF attenuation for
    channels being used in ONOFF is set to the maximum as part of the
    Tsys measurment and then must be returned to normal.  The
    attenuation value stored by the FS for the unused IF in the module
    was being overwritten.  Typically this bug was benign.  However in
    cases where the one of the IFs in a module was being used for
    ONOFF before an experiment and that module was not used in the
    experiment itself, the FS store value was not being reset
    properly.  This would in turn cause CHEKR to issue an unexpected
    error message.  This was discovered at Kokee Park where IFC was
    being used for ONOFF and then in a T2 experiment the IFDCD module
    was not being used.  This bug has been present since March 2003
    and was in the re-implementation of ONOFF made at that time.
    Thanks to Kokee Park for reporting this.

21. In the monitor form of the TNX command, if an error doesn't have
    an assigned error string in fserr.ctl or sterr.ctl, a null string
    is display for the string parameter.  This includes cases where
    the programmer has supplied an error string along with the error
    number in a call to logite().  That is done sometimes to allow for
    an error message that varies.  Previously, the TNX command display
    a fixed "Xono" string for these errors.

			 B. Changes in DRUDG
				   
DRUDG opening message date is 2015Aug31.

The following is a summary of DRUDG changes since 9.11.6.  Changes
numbered 5 and below occurred in 9.11.7.

 1. Mark5C support added.
 2. LSB first LO support bug fix.
 3. Astro3 mode support added.
 4. Number of modes has been increased from 20 to 40.
 5. Support for VEX files that do not define PASS_ORDER.
 6. Better handling if DRUDG does not recognize the rack or the
    recorder.
 7. Fixed bugs in handling phase-referencing that were introduced in
    going from FS 9.11.4 to 9.11.5
 8. Support for DBBC/FiLa10G racks.
 9. Support for Chinese VLBAC and CDAS racks.
10. Support for FlexBuff (and Mark 6) recorders.
11. Added "cont_cal_polarity" as an option for setting the second
    parameter ("polarity") of the "cont_cal=" command. for DBBCs.
12. Rack set-up comments for rack "none" were expanded.
13. Handling of ad hoc VDIF fanout_defs.
14. Schedules starting with letter "q" no longer cause DRUDG to end.

A more detailed discussion of these changes follows.

 1. Mark5C support added.  Previous versions of DRUDG would set the
    recorder to "none" if the schedule file indicated a Mark5C
    recorder.  This version recognizes Mark5C as a valid recorder type
    and will generate appropriate .snp and .prc files.  The only
    change from Mark 5B support is that the name of the "mk5b_mode"
    commands put in the .prc file is "mk5c_mode".

 2. LSB first LO support bug fixed.  Previous versions of DRUDG
    supported LSB first LOs only for non-Mark 5B recorder systems.
    The current version extends this support to Mark 5B/5C.  This was
    a very old bug.  Thanks to Jamie McCallum at AuScope for reporting
    it.

    As a result of this change DRUDG will no longer produce .prc files
    for non-"astro" format modes ("geo") for VSI4/DBBC DDC systems
    when a LSB first LO is in use. It will stop with an error message
    instead.  Previously it produced .prc files with an incorrect bit
    masks).  However, to accommodate stations with a LSB first LO that
    have been using DRUDG to produce incorrect .prc files and then
    fixing them (specifically SESHAN), a new keyword is provided in
    the skedf.ctl control file:

      ignore_mark5B_bad_mask

    This keyword must be followed by "yes" or "no" to indicate that
    DRUDG should not stop for a bad mask or should stop, respectively.
    If this keyword is not present, it will stop.  If "yes" is used, a
    warning message will still be printed.  Use this feature at your
    own risk because if it is not needed, there will be no forced stop
    of DRUDG for an impossible observing mode. Please see

      /usr2/fs/st-default/control/skedf.ctl

    for an example of its use.  Note that the selection of channels
    for Tsys measurements in the FS will be wrong if the warning
    message is printed.

 3. Astro3 mode support added.  This version of DRUDG supports DBBC
    DDC E/F firmware` which uses format mode "astro3". Thanks to
    Jonathan Quick for this code.  Note that DRUDG will only select
    among DBBC input filters 1-4, so if a wider input band is needed
    for 105F, it will have to be selected by the operator.

    The support for the E/F firmware in DRUDG is triggered by the
    absence of any even numbered BBCs in the requested mode, or
    alternatively by combinations of BBC and sideband that are not
    available in the geo/astro/astro2 bitstream patterns.  However
    some common astronomy modes, specifically those utilizing only one
    BBC per polarization, also use only odd BBCs, namely 1 and/or 5 or
    9 with either astro or astro2 respectively.  Hence DRUDG will
    assume that E/F firmware is _not_ being used for such modes,
    unless the bandwidth of the BBCs being greater than 16 MHz
    indicates that it must be in use.  Since there should be no
    operational modes that use other combinations of odd BBCs besides
    1, 1+5 and 1+9 this should be safe for operations, but will allow
    other combinations to used for testing for BWs smaller than 32 MHz
    with the E/F firmware.

 4. Number of modes has been increased from 20 to 40.  This allows
    more modes in schedules.

 5. Support for VEX files that do not define PASS_ORDER.  DRUDG was
    written in the era when we recorded on tapes.  Overtime most of
    the code that assumes the schedules use tapes has been removed,
    but occasionally some is still discovered.  This happened most
    recently when someone tried using a VEX file that did not define
    PASS_ORDER which resulted in DRUDG trying to address an invalid
    array element.  This bug has been fixed.

 6. Better handling if DRUDG does not recognize the rack or the
    recorder. In the previous versions of DRUDG, if DRUDG did not
    recognize the rack or the recorder for a station, it would change
    them both to "UNKNOWN", regardless of whether one of them (the
    rack or the recorder) was a valid equipment type.  Now if DRUDG
    does not recognize the rack or the recorder types, it will
    independently set them to none.  That is, if it recognizes the
    rack, but not the recorder, the rack type will be preserved, but
    the recorder set to "none".

 7. Fixed bugs in handling phase-referencing that were introduced in
    going from FS 9.11.4 to 9.11.5.  This happened when the logic
    related to when to issue various commands, and at what times, was
    simplified.  These are now fixed.

 8. Support for DBBC/FiLa10G racks.  For the DBBC/fila10g rack DRUDG
    recognizes the same modes as the DBBC rack: "geo", "astro",
    "astro2", and "astro3".  The command "fila10g=version" was added
    to "exper_initi"

 9. Support for Chinese VLBAC and CDAS racks. For the VLBAC rack
    recognizes "vlba" and "geo" modes for use in the "vsi4=.." command
    and the Mark 5B bit mask.  The VLBAC "geo" modes is not the same
    as the usual VSI4 "geo" mode.  For the Chinese CDAS racks, DRUDG
    recognize the following modes: "geo", "vlba", "geo_t", "geo_r",
    "vlba_l", and "vlba_u" for use in the "vsi4=.." command and the
    Mark 5B bit mask.  

10. Support for FlexBuff (and Mark 6) recorders using "jive5ab".  The
    current implementation treats the Mark 6 as a Flexbuff and all
    changes apply that apply to FlexBuff also apply Mark 6..  These
    changes treat the recorder the same as Mark 5C recorder except
    that the disk_pos and bank_check commands are not used.  For
    FluxBuff (and Mark 6), the "mk5=ss_rev?" command was removed from
    "exper_initi".

11. Added "cont_cal_polarity" as an option for setting the second
    parameter ("polarity") of the "cont_cal=" command. for DBBCs.
    This is a new keyword in the "$MISC" section of the "skedf.ctl"
    file.  Valid are values are: "0", "1", "2", "3", "ASK", and "NONE"
    (the latter two are case insensitive).  The default value is
    "NONE".  This keyword has an effect only if rack is DBBC or
    DBBC/FILA10G and continuous cal is selected to be on.  If both
    conditions are met, the behavior is as follows. If a numeric value
    is specified, it will be used as the "polarity" of all
    "cont_cal=on,..."  commands.  If the value "NONE" is specified,
    the second parameter of "cont_cal=" command is never used.  If the
    value is "ASK" DRUDG will prompt the user, per mode, when
    generating a .prc file to enter a value.  Valid values are "0",
    "1", "2", "3", and "NONE".  Please see the provided example file:

      /usr2/fs/st.default/control/skedf.ctl

    for more information.

12. Rack set-up comments for rack "none" were expanded.  DRUDG
    includes comments in the set-up procedures when the rack is "none"
    to provide information to help the operator set-up racks that
    aren't supported by the FS.  These comments have been expanded to
    include more complete information about the LO, video channels,
    and sampling.

13. Handling of ad hoc VDIF fanout_defs.  VEX1 does not support VDIF.
    However, certain work arounds in VEX1 have been used to assist
    with handling VDIF in VEX1, specifically using the same track for
    sign and magnitude bits.  Previous versions of DRUDG assumed that
    if you had two bit sampling, each bit would be recorded on a
    different track, sign on one track, magnitude on another.  This
    was a requirement of formats that predate VDIF.  In contrast, VDIF
    records both sign and magnitude on a single "channel" (the rough
    equivalent of the previous "track").  The first time that DRUDG
    encountered a schedule with sign and magnitude on the same track,
    it produced incorrect procedures.  This version of DRUDG allows
    both sign and magnitude data to be written to the same track, and
    the resulting procedure files are correct.

14. Schedules starting with letter "q" no longer cause DRUDG to end.
    Previously DRDDG would interprete a schedule name starting with
    the letter "q", provided either on the command line or response to
    a prompt, as a request to terminate. This is no longer the case;
    schedules starting with "q" can be used.

			   C. Known FS Bugs

(The only change in this section since the previous version is the
addition of item #12.)

The following is a summary list of known bugs. They are described in more
detail after the list.

1. Do not run "fmset" for extended periods.
2. "odd" and "even" head types not supported for Mark IV & VLBA4.
3. "odd"/"even" head types not supported for VLBA style tapeforms.
4. CHEKR does not check the status of the Mark IV formatter or Mark 5
   recorder.
5. Extraneous errors when tape is stopped by low tape sensor.
6. "Comm=" command in logex extracts only the first command.
7. S2 error scheme clumsy.
8. No extra spaces allowed in "ibad.ctl" file.
9. ONOFF and FIVPT programs hang.
10. FS SNAP command pages don't list tape drive suffix numbers.
11. LBA rack TPI detector is not usable.
12. mk5b_mode and bit_stream commands only report the expected sample
    rate.

A more detailed discussion of these bugs follows.

1. Do not run "fmset" for extended periods.  For stations that have
   VLBA, Mark IV back-ends and/or an S2 recorder, the "fmset" program
   should not be run for extended periods of time.  The "fmset"
   program should be used only to set or briefly verify that the
   formatter time is correct.  Do not leave "fmset" running after
   completing either of these tasks, especially during an experiment.

   The "fmset" program dominates the Field System when it is running
   and this is likely to interfere with the running of an experiment
   or other activities.  The only way to detect the time from the VLBA
   formatter with greater precision than one second it to wait for the
   seconds response from the formatter to change.  This requires the
   FS to communicate with the formatter almost continuously.  A
   similar problem exists for the S2 recorder.  This problem is less
   severe for the Mark IV formatter, but extended use of "fmset" in
   this case should be avoided as well.  In a future revision, this
   will be made more robust so that there will probably be less danger
   if "fmset" is left running.  However, even in the future "fmset"
   should only be left running for as short a time as possible.  A
   reminder about this is included in the "fmset" menu.

2. "odd"/"even" head types not supported for Mark IV & VLBA4.  The
   Mark IV and VLBA4 rack version of the "form" command and the Mark
   IV and VLBA4 recorder versions of the "repro" and "parity" commands
   do not support the "odd" and "even" parameters for the read and
   write head types and reproduce electronics in the "head.ctl"
   control file.  This means that automatic substitution of odd or
   even head in passes that use only even or odd heads respectively
   does not occur.  The only correct settings for the read and write
   head parameters and reproduce electronics is "all".  This will be
   fixed in a future revision.  Please let Ed know if you are missing
   some tracks and need to work around this limitation.

3. "odd"/"even" head types not supported for VLBA style tapeforms.
   For any mode recorded with VLBA style tapeform (14 index
   positions), the only correct setting of the read and write head
   types on the "head.ctl" is "all".  This will be fixed in a future
   revision.  Please let Ed know if you are missing some tracks and
   need to work around this limitation.

4. CHEKR does not check the status of the Mark IV formatter or Mark 5
   recorder.  Now that most communication problems with the Mark IV
   formatter have been solved, this will be possible and will be done
   in the future.  CHEKR support will be implemented for Mark 5 despite
   communication problems, they will have to be ignored unless they
   extend beyond a certain amount of time.

5. Extraneous errors when tape is stopped by low tape sensor.  When a
   tape drive has been commanded to move the tape and then stops
   because it hit the low tape sensor (or when S2 recorders hit the
   BOT or EOT), "CHEKR" will complain periodically that the tape drive
   is not in the correct state.  In principle the FS should be smarter
   about this.  However, if the tape is managed correctly by the
   schedule this error message should never occur.  If it does, then
   it it an indication that there is either a problem with: (1) the
   schedule, (2) the check procedures, (3) the recorder, or (4) the
   tape is too short.  If any of these cases apply they should be
   corrected.  It is more likely that this error message will occur
   when the tape is being controlled manually.  In this case, issuing
   an "ET" command will convince the FS that the tape drive should be
   stopped and the error message will cease.

6. "Comm=" command in logex extracts only the first command.  The
   "comm=" command in "logex" extracts only the first command
   commanded and displayed.  This problem was noted by Giuseppe
   Maccaferri (Medicina).

7. S2 error scheme clumsy.  The error and status response number
   reporting scheme for S2 recorders is clumsy.  FS errors that have
   mnemonic "rl" are mostly error responses from the recorder or the
   RCL interface library that is used to communicate with the
   recorder.  If the numeric part of an "rl" error is greater than
   -130, then it is the error code returned by the recorder.  If the
   numeric part is less than -130, but greater than -300, then add 130
   to the value, the absolute value of the result is the error
   response code from the RCL library.  For values less than or equal
   to -300, a FS error has been detected.  Status response codes are
   all reported with mnemonic "rz" and the numeric value is the
   negative of the status response code.  In all cases an appropriate
   error or status message is displayed.  These messages are retained
   in the log.

8. No extra spaces allowed in "ibad.ctl" file.  The format of the
   "ibad.ctl" must not contain any leading or embedded spaces.  In
   systems that use the LLP AT-GPIB driver (pre-FS Linux 4), if either
   the option "no_untalk/unlisten_after" is misspelled or an incorrect
   device name is supplied, the driver will cause a segmentation
   violation when it is initialized and the FS will terminate.
   Unfortunately there is no way to prevent this problem in a general
   way; it reflects a limitation in the driver.

9. ONOFF and FIVPT programs hang.  The ONOFF and FIVPT programs have
   been known to "hang" mysteriously.  This seems to be caused by some
   problem with the "go" mechanism that is used to restart the program
   when it pauses to allow a SNAP procedure, such as CALON or CALOFF
   to execute.  The "go" that is used to restart the program fails for
   some reason.  This has been exceedingly difficult to debug because
   it is intermittent and fairly rare.  There is however a good work
   around for it.  The CALON and CALOFF procedures are called by
   procedures CALONFP and CALOFFFP for FIVPT and CALONNF and CALOFFNF
   for ONOFF.  FIVPT or ONOFF may hang during (or actually just after)
   the execution of one these procedures that FIVPT and ONOFF will
   typically hang.  If this happens, you will have to terminate the FS
   to recover.  You can prevent it from happening again (for this
   procedure) by adding the lines:

    !+1s
    sy=go fivpt &

  to the end of CALONFP or CALOFFFP.  For CALONNF and CALOFFNF, please
  add:

    !+1s
    sy=go onoff &

  If you see other situations where FIVPT or ONOFF hang, please let Ed
  know.

10. FS SNAP command pages don't list tape drive suffix numbers.  The
    FS SNAP manual pages and the help pages available through the
    "help=" command do not reflect when multiple versions are
    available with different suffixes depending on the number of drive
    specified in the control files.  For example, there is only a
    "tape" page, no "tape1" or "tape2" page.  However, the help
    facility will display the version of the command with no suffix
    when an available command with a suffix is used.  For example, if
    two drives are defined, then "help=tape1" and "help=tape2" will
    work, but "help=tape" will not and vice-versa if only one drive is
    defined.

11. LBA rack TPI detector is not usable.  The Australian LBA Data
    Acquisition System currently lacks a functional total power
    detector though support has been included.  To allow approximate
    system temperature calibration, all the setup commands and the TPI
    detectors of the modules of a co-existing Mark IV rack are
    currently also available when the rack type is specified to be
    LBA4.

12. mk5b_mode and bit_streams_commands only report the expected sample
    rate.  The value of the actual clock rate is not read back from
    the recorder in order to calculate the actual effective sample
    rate.  Consequently, the query log output includes parenthesis
    around the sammple rate as indication that it is not read, but
    expected.  The mk5c_mode command does report the actual sample
    sample rate.


			  III. Installation

Detailed instructions are provided below for installing 9.11.8.  This
version is intended to be installed as upgrade to 9.11.7 or 9.11.6.
To upgrade from 9.11.6, please follow all numbered steps below.  To
upgrade from 9.11.7, please follow all numbered steps below, but you
can omit step (8), which should have already been taken care of, if it
was needed, for the upgrade to 9.11.7.  If you have an older version
than 9.11.6, please upgrade to 9.11.6 first (see fs9116up.txt).

If you are installing FS9 for the first time with this version, please
follow the installation instructions in Section 4.5 of the FS9
"Computer Reference" manual.  In this case you should also get a copy
of the current FS9 "Control Files and Field System Initialization"
manual.

For reference, the list of the most recent "critical updates" is given
below.  These are updates that must be applied sequentially.  Please
start with the next update with a later version number than what you
have and apply it and the following listed versions before upgrading
to 9.11.7.  You can find the latest versions of installation notes for
these FS versions in the "/usr2/fs/misc" directory.  The list of
critical updates is:

  9.4.0
  9.5.3
  9.5.12
  9.6.9
  9.7.7
  9.9.2
  9.10.4
  9.11.6

If you have a version older than 9.4.0, please contact Ed
(Ed.Himwich@nasa.gov).

For reference purposes the naming convention for the default station
libraries for different equipment configurations is listed here.  The
files are found in /usr2/fs/st.default/proc.  They can be referred to
and compared to what you have in "/usr2/proc/station.prc".  **ONLY**
for new installations (or completer re-installs), you can copy the
default version for your equipment to "/usr2/proc" renaming it to
"station.prc" in the process, e.g.:

  cd /usr2/proc
  cp -i /usr2/fs/st.default/proc/3station.prc station.prc
  chmod a+rw station.prc

The "-i" option will prompt before overwriting an existing
"station.prc" to give you a chance to recover if you did not realize
you already had a station.prc file.  The table of correspondence
between equipment types and default library names is given next.

      Equipment        Prefix letters  Station Library
      Rack/Drive1/Drive2

      K42/K42              k42         k42station.prc
      K42K3/VLBA           k42k3v      k42k3vstation.prc
      K42MK4/VLBA          k42mk4v     k42mk4vstation.prc
      K42MK4/VLBAB/VLBAB   k42mk4vb    k42mk4vstation2.prc
      K42/K5               k42k5       k42k5station.prc
      LBA/S2               ls2         ls2station.prc
      LBA4/S2              l4s2        l4s2station.prc
      Mk3/Mk3A             3           3station.prc
      Mk4/Mk4              4           4station.prc
      Mk4/Mk5A             45          45station.prc
      Mk4/VLBA4            4v4         4v4station.prc
      Mk5/Mk5B             5           5station.prc
      NONE/S2              s2          s2station.prc
      VLBA/S2              vs2         vs2station.prc
      VLBA/VLBA            v           vstation.prc
      VLBA/VLBA2           v2          v2station.prc
      VLBA/VLBA/VLBA       v           vstation2.prc
      VLBA4/VLBA4          v4          v4station.prc
      VLBA4/MK5A           v45         v45station.prc
      VLBA4/VLBA42         v42         v42station.prc
      VLBA5/Mk5B           v5          v5station.prc
      DBBC/Mk5B            d           dstation.prc
      DBBC(cont.cal)/Mk5B  d           dstationcc.prc

If your equipment type is missing, please let Ed (Ed.Himwich@nasa.gov)
know so that it will be added.

You can use cut-and-paste to reduce the amount of typing involved in
the installation.  This reduces the chances of missing required spaces
and other easily missed characters (like ".") in the commands.  The
basic idea is to have two different terminals open, either two
different VT text terminals (Control-Alt-F*, where * is 1-6) on the FS
computer you are upgrading or two different xterm terminals either on
the local X display or remotely logged in.  You can then switch back
and forth between the terminals, reading the instructions as you
scroll through them (with "more" or "less") on one terminal and
entering commands on the other.  You can cut-and-paste complicated
commands from the terminal with the instructions to the terminal where
you are entering commands as needed.  For VT text terminals you can
log in and out to change users as needed on the terminal where you are
executing commands.  With xterms, you can use "ssh" or "su" to
"switch" to users as needed on the terminal where you are entering
commands. For example, you can change to being "prog" by executing:

 ssh -X prog@localhost

or

 su - prog

Please don't forget to log back out when you need to change users
again or you may develop a series of "nested" logins.  The steps that
require rebooting will of course completely log out all of your
terminals; you will need to re-login again from scratch to continue.
At the end of the update, it is recommended that you login as "oper"
on the local X display for the final testing.  Please also note that
in order to paste into the X display login shell window for "oper" and
"prog", you typically must use Shift-Insert.  If you have any
questions about how to cut-and-paste please contact Ed
(Ed.Himwich@nasa.gov).

(0) Before you begin the upgrade make sure you have a current back-up
    of your system in case something goes wrong.  If you are use FS
    Linux 5 (FSL5), we recommend you use the tar based back-up that is
    part of the rotating disk back-up scheme.  A draft document that
    describes this method is available in the docs sub-directory on
    the FS FTP servers as backups2.pdf.  If you have an older FS Linux
    distribution, please use the disk-to-disk back scheme described in
    Section 5.8 of the FS9 "Computer Reference" manual.  If you have
    an FSL6 (sarge), FSL7 (etch) FSL8 (lenny) or FSL9 (wheezy) system
    configured to run a RAID, please see /usr2/fs/misc/RAID.pdf (for
    FSL9, see /usr2/fs/misc/FSL9_RAID.pdf) section APPLYING AN UPDATE
    for directions for applying an update.  If you are running one of
    the FSL distributions and do not have documentation on how to make
    a back-up, please contact Ed.  If you have SCSI disks, Section 5.7
    of the FS9 "Computer Reference" manual has a discussion of drive
    ID numbers if you are unsure about these.

    Normally you should choose to install the update on your primary
    disk after having made and verified your back-up.  Once the
    installation is complete, has been tested, and used for a little
    while, you can copy over your back-up with the upgraded primary.
    If the upgrade fails, you should restore the back-up to the
    primary for operations.  You can then try to make the upgrade
    again when it is convenient.  In a desperate situation, you can
    use the back-up for operations.  You may choose to install the FS
    on your back-up disk for testing and then later copy the back-up
    onto the primary once you are satisfied with the new version.  In
    any event, please be sure to make a fresh back-up before
    continuing with the installation.

(1) Please be sure that you have at least 40 MB of free space (use the
    "df" UNIX command to check free space) on your "/usr2" partition
    before starting the upgrade.  This would probably only be an issue
    for stations with 200 MB disks.  If you are tight on space, you
    may want to delete old log files and old versions of the FS
    (except your most recent one if you can avoid it of course).
    Since you should have backed-up your system, you can even delete
    the "*.[oas]" and executable files of your old versions with no
    risk.  You might want to keep the source of the previous versions
    around for reference if you have room.  You can eliminate the
    non-source files by "cd"-ing to each of the old FS directories in
    turn as "prog" and doing a "make rmdoto rmexe".  If you have any
    questions about how to do this, please contact Ed.

(2) Log-in as prog.

(3) Place a copy of the fs-9.11.8 archive in your "/tmp" directory.
    For example you might do the following:

      cd /tmp
      ftp atri.gsfc.nasa.gov
      (enter your FS FTP account name at the prompt)
      (enter your FS FTP password at the prompt)
      binary
      cd dist
      get fs-9.11.8.tgz
      quit

    Another FS server is also available at:
    http://www.metsahovi.fi/fs/.

    (The instructions for transferring the archive using DOS floppies
    are no longer included in this notice.  If you need to do this,
    please contact Ed (Ed.Himwich@nasa.gov).)

(4) Log-out as prog and log-in as root.

(5) Extract the source from the archive:

      cd /
      tar xzpf /tmp/fs-9.11.8.tgz

(6) Set the link for the new FS version:

      cd /usr2
      ln -sfn fs-9.11.8 fs

(7) It is recommended that your local files operations (control, proc,
    log, and sched directories) have the default ownership
    ("oper.rtx") and permissions ("rw-rw-rw").  To force this, please
    execute the script (as "root"):

      /usr2/fs/misc/fix_perm

    Answer "y" to the prompt if you wish to proceed.  It is good idea
    to do this, unless you have purposely changed the ownerships and
    permissions to some other values.  If you don't want to restore
    the defaults, answer "n" (this is the last chance to abort the
    execution of the script).

(8) If you are using the old Digiboard serial driver, you should
    create a symbolic link to the header file:

      ln -fsn /usr/src/linux/drivers/char/digi.h /usr/src/linux/include/digi.h

    Do NOT create this link if the file
    
      /usr/src/linux/drivers/char/digi.h

    does not exist on your system.  If this file does not already
    exist, you are not using the old Digiboard serial driver.

(9) VERY IMPORTANT: Log-out as root, and log-in as prog.

(10) Make the FS:

       cd /usr2/fs
       make 

(11) Reboot the computer.  This is important for re-initializing
     shared memory.

(12) Log in as oper
     
(13) Two updates to the local control files are needed.  Tne first
     (A.)  to equip.ctl is required for all stations.  The second (B.)
     is only required for stations that need to adjust the polarity of
     DBBC continuous calibration control signal.

     A. All stations need to update their equip.ctl file to add the
        FiLa10G VSI input select line:

          cd /usr2/control
          tail -2 /usr2/fs/st.default/control/equip.ctl >>equip.ctl

        If you use a FiLa10G, you may need to edit the new last line
        in your updated equip.ctl if you use an input other than the
        default: "vsi1".

     B. Stations that need adjust the polarity of the DBBC continuous
        calibration control should modify their skedf.ctl file to use
        the "cont_cal_polarity" keyword.  Use of this feature requires
        v105x_1 or later.  The syntax and examples can be found in the
        example file:

          /usr2/fs/st.default/control/sked.ctl

(14) Five updates are needed in the local .prc files.  The first (A.)
     is for stations that use Mark 5 or FlexBuff (including Mark 6)
     recorders.  The second (B.) is only for station using a DBBC with
     continuous cal.  The third (C.) is only for stations using
     a"jive5ab" to run their Mark 5, FlexBuff, or Mark 6 recorder.
     The fourth (D.) is only for stations using a FiLa10G.  The fifth
     (E.)  is for stations that were using a Mark 5B recorder, but
     have now switched to using a Mark 5C, FlexBuff, or Mark 6
     recorder.

     A. If you use a Mark 5 or FlexBuff (including Mark 6) recorder,
        please change the use of "mk5=status?" to "mk5_status" in your
        .prc files.  You can make this change in place with the
        commands:

          cd /usr2/proc
          perl -i -pe's/mk5=status\?/mk5_status/' *.prc

        If you get a permission error, please follow step (7) above
        and try again.  If you want to be cautious about this, you can
        replace the second command with:

          perl -i.bak -pe's/mk5=status\?/mk5_status/' *.prc

        which will save the original files with the added extension
        ".bak".  If you take this approach, please be sure to remove
        the ".bak" versions once you have verified the changes.

        Please note that you should now have the "mk5_status" command
        in all your POSTOB procedures, preferably as the last command.
        If you do not, probably because you did not have 'mk5=status?"
        there before this step, this would be a good time to add it.

     B. If you are using a DBBC with continuous cal, please update
        your .prc files for the new "cont_cal" command syntax.  This
        step is only necessary if you have been using a non-default
        value for the number of continuous calibration samples
        (formerly the second argument of "cont_cal=on,...") to use for
        Tsys calculations.  Otherwise you can skip this step.

        It is probably not necessary to update old experiment
        procedure libraries created by DRUDG, unless you plan to use
        them again for other purposes.  You would probably want to
        update any non-experiment procedure libraries that are used
        for testing or other activities, including "station.prc".  To
        use the script as "oper", enter:

          cd /usr2/proc
          /usr2/fs/misc/cont_cal_fix <files>

        where "<files>" is a list of files to be fixed (wild cards can
        be used).  If you get a permission error, please follow step
        (7) above and try again.

     C. If you using "jive5ab" to run your Mark 5, FlexBuff, or Mark 6
        recorder, use PFMED to add the command:

          jive5ab=version?

        to your "sched_initi" procedure in your "station" procedure
        library.

     D. If you are using a FiLa10G, please copy the default
        fila10g.prc libary to your local /usr2/proc directory, and
        then copy the "fila10g_cfg" proceedure to your station.prc
        library:

          cd /usr2/proc
          cp -a /usr2/fs/st.default/proc/fila10g.prc .
          pfmed
            pf,station
            st,fila10g_cfg::fila10g,fila10g_cfg
            ex

        You will need to edit this proceure and modify it for your
        local configuration as indicated in the comments.

        The "fila10g_cfg" procedure must be run every time the
        FiLa10G is restarted to define its static configuration.  In
        the future, the FiLa10G will be able to set the static
        configuration automatically on boot.

     E. If you were using a Mark 5B recorder, but have now switched to
        using a Mark 5C, FlexBuff, or Mark 6 recorder, you should
        remove (or comment out) "mk5=dot?" commands from your
        procedures to eliminate extraneous error messages since this
        command is only useful for Mark 5B recorders.

        You can remove (or comment) the "mk5=dot?" commands by
        manually editing your procedures or using the folllowing
        commands to as "oper":

          cd /usr2/proc
          /usr2/fs/misc/comment_mk5_dot <files>

        where "<files>" is a list of files to be fixed (wild cards can
        be used).  If you get a permission error, please follow step
        (7) above and try again.

(15) Test the FS as "oper". Generally speaking a fairly thorough test
     is to run a test experiment: start with DRUDG-ing a schedule,
     making listings, and any other pre-experiment preparation you
     normally do, then execute part of schedule, and perform any
     normal post-experiment plotting and clean-up that you do.  The
     idea here is to verify that everything works as you expect for
     normal operations.  In particular for this upgrade you should
     test that Mark 5 operations work as expected.

(16) Consider when to update your back-ups.  You certainly should not
     update them until you have performed the tests described above.
     It would be prudent to wait until you have successfully run an
     experiment or two and preferably received word that the
     experiment(s) produced good data.  The chances of needing your
     back-up before you update it is fairly small.  If something does
     happen, you can copy the pre-FS update back-up it to the (now
     assumed bad) FS updated disk.  You can then either run the
     recopied disk or apply the FS update again.  Handling this will
     be a lot safer if you have a third disk.
