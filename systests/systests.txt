      SYSTESTS - System test measurements and analysis package

	       Ed Himwich, Brian Corey, and Dan Smythe

			   January 13, 2009

INTRODUCTION

This document describes how to install and use the "systests" tools
for measuring, plotting, analyzing system test data.  The tests
supported are: (1) band pass shapes, (2) baseband/video converter
image rejection, (3) phase-cal power measurements, (4) phase-cal
spurs, (5) sampler statistics, (6) "overnite" stability, (7)
short-term stability, (8) orientation dependent effects, and (9) Mark
5 tests.  Most of these tests require that you have a Mark IV
Formatter and Decoder with either a VLBA or Mark IV rack. However,
test (3) only requires a working "caltsys" procedure, and tests (6),
(7), and (8) can be modified to do a more limited test for other
configurations.

Once the tools are installed and set-up, each test requires only two
type-ins, one to make the measurement and one to produce the plots or
analysis results.  Some tests require manual intervention by the
operator to set switches or disconnect/reconnect cables.  Everything
else is automatic.  The remainder of this document describes the usage
and installation of the tools.  The "help" output from the data
processing scripts is provided for reference.

For stations that are upgrading to VSI4/Mark 5b configurations, a
"systvsi4.prc" procedure library that will work with the VSI4 board is
included in /usr2/fs/systests.  An existing installed "systests.prc"
library can be modified to support the VSI4 board by changing all
strings "pcalports=" to "vsi4=,".  No other changes are needed.

USAGE

With exception of the Mark 5 tests, after the tools have been
installed, you can make the measurements for any observing mode.  You
should set up the rack in the mode you want to test it in before doing
any tests.  For example, to use the RD mode at Gc, you could use:

     proc=rd0505gc
     setup8f

After the mode has been set-up, you can make any or all of the
measurements described below.

For Mark 5 tests, you need to use the chk1024.snp and chk1024.prc (for
Mark IV, use vchk1024.snp and vchk1024.prc for VLBA4) files developed
by Dan Smythe to make the measurements.  This discussed in more detail
below.

			BANDPASS MEASUREMENTS

The amplitudes of all the phase cal tones within a baseband channel
are measured and plotted to provide a power spectrum with coarse
frequency resolution.

1. To collect data for bandpass plots, make sure that the equipment is
   set-up in the mode you want to test in (see above under USAGE),
   then enter:

     log=<pick a convenient name, maybe something like "testNN">
     proc=systests
     pcalamp

   For "NN" in the log file name, you can use a two digit number,
   possibly sequential with other numbers used for other tests.

   When you see the output "pcalamp done" in the log display, the
   measurement is complete.  The procedure takes about two minutes to
   run.

2. Plot the results, from a shell prompt try:

     cd /usr2/log
     pcalamp testNN.log

   This will make a graphical display, if you are on X server.  If
   not, or if this is too big on your display, or you want hardcopy
   output for documentation, you can generate a printed version with:

      cd /usr2/log
      pcalamp -f pcalamp.ps/vps testNN.log
      lpr pcalamp.ps

   Other output formats are available besides PostScript, try:

      pcalamp -f \?

   for more information.

3. If you want to make additional measurements, you must open a new
   log for each measurement, e.g., after having modified the
   equipment.  The script will only plot the first amplitude results
   it finds in the log.

		     IMAGE REJECTION MEASUREMENTS

The amplitudes of the phase cal tones at the normal and image
frequencies in both the USB and LSB sidebands of each channel are
measured to provide estimates of the image rejection as a function
of frequency.

1. To collect data for image rejection plots, make sure that the
   equipment is set-up in the mode you want to test in (see above
   under USAGE), then enter:

     log=<pick a convenient name, maybe something like "testNN">
     proc=systests
     pcalimage

   For "NN" in the log file name, you can use a two digit number,
   possibly sequential with other numbers used for other tests.

   When you see the output "pcalimage done" in the log display, the
   measurement is complete.  The procedure takes about four minutes to
   run.

2. Plot the results, from a shell prompt try:

     cd /usr2/log
     pcalimage testNN.log

   The lowest level of image rejection that can be measured, the
   "sensitivity", is shown as dotted line in the graphs.  The
   sensitivity is calculated from the phase cal amplitudes in the
   sideband not under test.  The image rejection values measured are
   shown as points connected by lines.  The solid line may overlay the
   dotted line in many cases.  If the points plotted are not above the
   dotted line, no image rejection problem was found above this level,
   i.e., it is below the level that could be detected in this
   configuration.

   Other options for output are available as described above under
   "BANDPASS MEASUREMENTS".

3. If you want to make additional measurements, you must open a new
   log for each measurement, e.g., after having modified the equipment.
   The script will only plot the first amplitude results it finds in
   the log.

		     PHASE CAL POWER MEASUREMENTS

The fractional contribution of phase cal to the total system power in
each channel is measured.

1. How you make this measurement would normally depend on whether your
   station has FS control to turn your phase-cal signal on and off.
   If you have computer control of your phase-cal, use procedure
   "pcalpowera".  That procedure will alternate making measurements
   with the phase-cal on and off.  If you don't have computer control
   use the "pcalpowerb" procedure, which will make several
   measurements at a time in each state to reduce the number of manual
   steps that are necessary.

   For automatic switching, make sure that the equipment is set-up in
   the mode you want to test in (see above under USAGE), then use
   these commands:

     log=<pick a convenient name, maybe something like "testNN">
     proc=systests
     pcalpowera

   For "NN" in the log file name, you can use a two digit number,
   possibly sequential with other numbers used for other tests.

   When you see the output "pcalpowera done" in the log display, the
   measurement is complete.  The procedure should take about seven
   minutes to execute.

   For manual switching, make sure that the equipment is set-up in the
   mode you want to test in (see above under USAGE), then use these
   commands:

     log=<pick a convenient name, maybe something like "testNN">
     proc=systests
     pcalpowerb

   For "NN" in the log file name, you can use a two digit number,
   possibly sequential with other numbers used for other tests.

   When you see the output "pcalpowerb done" in the log display, the
   measurement is complete.  The procedure should take about seven
   minutes to execute plus however long it takes you to respond to the
   prompts.  There should be five prompts to respond to.  After taking
   the requested action, click the "continue" button on the prompt
   window to continue.

   For manual switching, when prompted to turn the phase-cal on, you
   should make sure the system is set-up normally.  This includes
   specifically that the phase-cal is on.  When prompted to turn the
   phase-cal, you should turn the phase-cal off, preferably without
   directly disconnecting the 5 MHz that runs to the receiver for the
   phase-cal.

2. Plot the results, from a shell prompt try:

     cd /usr2/log
     pcalpower testNN.log

   The average results for each detector in each state (pcal on and
   off) are printed followed by the differenced results including the
   fractional power due to the phase-cal signals. If you use the "-b"
   option of the script with the single-side band bandwidth of the
   video- or base-band converters (for example "pcalpower -b 16
   testNN.log", where "16" is the channel bandwidth), the script will
   also print the approximate amplitude that should be seen for
   individual pcal tones in Mark IV decoder units. This is convenient
   for comparison with the bandpass measurements described above.

   The "noisy" columns in the output contains an asterisk, "*", if the
   raw data for that device had a spread of six or more times its RMS
   scatter between the largest and smallest values.  This gives some
   suggestion about whether the data are too noisy to be useful, but
   the presence or absence of an asterisk is no guarantee that the
   data are bad or good, respectively.

   If you want to save the results in a file or print them, then you
   can redirect them to file, for example:

     pcalpower testNN.log >pcalpower.txt
     lpr pcalpower.txt

3. If you want to average additional measurements you can continue to
   take them in the original log.  The "pcalpower" script averages all
   the values for each state (pcal on and off) that it finds in the
   log or logs specified on the command line.  However, if want to
   make measurements to see the results of a hardware change you
   should start a new log.

		     PHASE CAL SPUR MEASUREMENTS

Evidence for spurious phase cal signals is sought by measuring the
amount by which the phase cal level drops when phase cal is turned off
and when the receiver LO is unlocked.

1. To collect data for phase cal spur plots, make sure that the
   equipment is set-up in the mode you want to test in (see above
   under USAGE), then enter:

     log=<pick a convenient name, maybe something like "testNN">
     proc=systests
     pcalspur

   For "NN" in the log file name, you can use a two digit number,
   possibly sequential with other numbers used for other tests.

   When you see the output "pcalspur done" in the log display, the
   measurement is complete.  The procedure should take about eight
   minutes to execute plus however long it takes you to respond to the
   prompts if any.  There may be up to five prompts to respond to.
   When you complete each requested action, click the "Continue"
   button in the prompt window to continue.

   If prompted to turn the phase-cal on, you should make sure the
   system is set-up normally.  This includes specifically that the
   phase-cal is on and all LOs are locked.  If prompted to turn off
   the phase-cal, you should turn the phase-cal off, preferably
   without physically disconnecting the 5 MHz reference that runs to
   the receiver for the phase-cal.  (At some stations, the reference
   is at some frequency other than 5 MHz, such as 500 MHz.)  For
   instance, if the 5 MHz comes from a Mark IV-style delay cal ground
   unit, use the front-panel switch on the ground unit to turn phase
   cal off.  If prompted to unlock the LO, you should unlock the
   receiver LO, possibly by disconnecting the 5 MHz (or other
   reference frequency) to which the LO is locked, but not by actually
   turning the LO off; make sure the phase-cal is turned back on again
   for this measurement.  If you are prompted to turn off the
   phase-cal 5 MHz, you should lock the receiver LO again and then
   physically disconnect the cable that carries 5 MHz (or whatever the
   phase-cal reference frequency is) to the receiver for the
   phase-cal.  If you had to disconnect the 5 MHz (or other reference
   frequency) when you turned off the phase-cal when prompted to do
   that, this is okay.  However, you should understand that you will
   not get different measurements for the two cases.  Lastly, if you
   are prompted to turn on the 5 MHz for the phase-cal, you should do
   that.  For this last prompt the system should be restored to
   normal.

2. Plot the results, from a shell prompt try:

     cd /usr2/log
     pcalspur testNN.log

   The lowest level of spur that can be measured, the "sensitivity",
   is shown as a dotted line in the graphs.  The sensitivity is
   calculated from the phase cal amplitude when the phase cal is on.
   The spur levels are shown as points connected by lines.  The solid
   line may overlay the dotted line in many cases.  If the points
   plotted are not above the dotted line, no spur was found above this
   level. There may be spurs below the line. The "-s" option of the
   "pcalspur" script will generate an additional plot of just the
   sensitivity.

   Other options for output are available as described above under
   "BANDPASS MEASUREMENTS".

3. If you want to make additional measurements, you must open a new
   log for each measurement, e.g., after modifying the equipment.  The
   script will only plot the first spur results it finds in the log.

		     SAMPLER STATISTICS MEASUREMENTS

The sampler statistics for each channel are recorded for comparison to
ideal values.

1. To collect data for sampler statistics plots, make sure that the
   equipment is set-up in the mode you want to test in (see above
   under USAGE), then enter:

     log=<pick a convenient name, maybe something like "testNN">
     proc=systests
     samplestat

   For "NN" in the log file name, you can use a two digit number,
   possibly sequential with other numbers used for other tests.

   When you see the output "samplestat done" in the log display, the
   measurement is complete.  The procedure should take about two
   minutes to execute..

2. Plot the results, from a shell prompt try:

     cd /usr2/log
     samplestat testNN.log

   The deviation from ideal percentages for each level is
   displayed. The levels are "--" (V < -0.2v), "-" (-0.2v < V < 0v),
   "+" (0v < V < +0.2v) and "++" (+0.2v < V).  The ideal levels are
   represented as dotted lines.  The actual measurements are
   represented by dots with solid lines connecting them.  The solid
   lines may overlay the dotted lines.  The raw percentages can be
   displayed by using the "-r" command line switch for the script.

   Other options for output are available as described above under
   "BANDPASS MEASUREMENTS".

3. If you want to make additional measurements, you must open a new
   log for each measurement, e.g., after having modified the
   equipment.  The script will only plot the first statistics results
   it finds in the log.

		   OVERNITE STABILITY MEASUREMENTS

The values of many parameters are recorded over an extended period to
look for stability problems.

1. To collect data for overnite stability plots, make sure that the
   equipment is set-up in the mode you want to test in (see above
   under USAGE), then enter:

     log=<pick a convenient name, maybe something like "testNN">
     proc=systests
     overnite

   For "NN" in the log file name, you can use a two digit number,
   possibly sequential with other numbers used for other tests.

   You should let the procedure continue to make measurements as long
   as possible, preferably over a 24 hour or longer period, but at
   least overnight (more than 8 hours).  When you want to stop the
   measurements, enter:

     onsample@
     log=station

2. Plot the results, from a shell prompt try:

     cd /usr2/log
     plotlog testNN.log

   The data plotted depends on what is in the log.  This will depend
   on what was sampled and whether there were errors that prevented
   some measurements from returning results.  Any and all of the
   following items found in the log are plotted: wx/, cable/, rx/ (or
   sx/ or sk/), fmout-gps/ (or gps-fmout/), tsys/, and for a single
   tone per upper sideband channel: the pcal amplitude and phase
   measurements. The difference in phase between channels on the same
   IF can be plotted by selecting the appropriate one of the '1anw'
   command line switches (see "plotlog -h" for more information).

   Other options for output are available as described above under
   "BANDPASS MEASUREMENTS".

3. If you want to make additional measurements, you would probably
   want to open a new log for each measurement.  All the data from a
   single log are plotted together, regardless of the time span.

		  SHORT-TERM STABILITY MEASUREMENTS

The values of many parameters are recorded very rapidly for a short
time to look for short term stability problems.

1. To collect data for short-term stability plots, make sure that the
   equipment is set-up in the mode you want to test in (see above
   under USAGE), then enter:

     log=<pick a convenient name, maybe something like "testNN">
     proc=systests
     rapid

   For "NN" in the log file name, you can use a two digit number,
   possibly sequential with other numbers used for other tests.

   You should let the procedure continue to make measurements for a
   reasonable amount of time, perhaps 30 minutes. When you want to
   stop the measurements, enter:

     stsample@
     log=station

2. Plot the results, from a shell prompt try:

     cd /usr2/log
     plotlog testNN.log

   The data plotted depends on what is in the log.  This will depend
   on what was sampled and whether there were errors that prevented
   some measurements from returning results.  Any and all of the
   following items found in the log are plotted: wx/, cable/, rx/ (or
   sx/ or sk/), fmout-gps/ (or gps-fmout/), tsys/, and for a single
   tone per upper sideband channel: the pcal amplitude and phase
   measurements. The difference in phase between channels on the same
   IF can be plotted by selecting the appropriate one of the '1anw'
   command line switches (see "plotlog -h" for more information).

   Other options for output are available as described above under
   "BANDPASS MEASUREMENTS".

3. If you want to make additional measurements, you would probably
   want to open a new log for each measurement.  All the data from a
   single log are plotted together, regardless of the time span.

	     ORIENTATION DEPENDENT STABILITY MEASUREMENTS

The values of many parameters are recorded very rapidly while antenna
is moved around its range of motion to look for orientation dependent
effects.

1. To collect data for orientation dependent plots, make sure that the
   equipment is set-up in the mode you want to test in (see above
   under USAGE), then enter:

     log=<pick a convenient name, maybe something like "testNN">
     proc=systests
     rapid

   For "NN" in the log file name, you can use a two digit number,
   possibly sequential with other numbers used for other tests.

   You should proceed to move the antenna around its range of motion
   either manually or using appropriate "source=azel,..." commands.
   As the antenna is moved, especially if this being done manually,
   please enter comments to describe what is happening, e.g. "now
   moving to el 0 to 90 along az 0".  It is desirable to at least
   travel along the perimeter of the antenna's range of motion,
   including the extremes of the cable wrap for AZEL antennas.
   Traveling along the entire range of at least one intermediate
   position for each axis is also be desirable.  If the
   "source=azel,..." (or "source=xy,...") command works for your
   antenna and your antenna's motions is predictable enough, you may
   be able to write a schedule to automate the motion.

   When you have finished moving the antenna, you can stop the
   measurements, by entering:

     stsample@
     log=station

2. Plot the results, from a shell prompt try:

     cd /usr2/log
     plotlog testNN.log

   The data plotted depends on what is in the log.  This will depend
   on what was sampled and whether there were errors that prevented
   some measurements from returning results.  Any and all of the
   following items found in the log are plotted: wx/, cable/, rx/ (or
   sx/ or sk/), fmout-gps/ (or gps-fmout/), tsys/, and for a single
   tone per upper sideband channel: the pcal amplitude and phase
   measurements. The difference in phase between channels on the same
   IF can be plotted by selecting the appropriate one of the '1anw'
   command line switches (see "plotlog -h" for more information).

   Other options for output are available as described above under
   "BANDPASS MEASUREMENTS".

3. If you want to make additional measurements, you would probably
   want to open a new log for each measurement.  All the data from a
   single log are plotted together, regardless of the time span.

			     MARK 5 TESTS

The quality of data sent to Mark 5 is analyzed for both idle and play
modes to look for problems. More than one set-up is used, including
the most stressful, 1 Gb/second.

1. To collect data, use the test schedule that is appropriate for your
   station's equipment, vchk1024.snp or chk1024.snp.  Other schedules
   with simialr structures, but using different set-ups can be used as
   well.  Before running the schedule, you should rename any existing
   log with the schedule's name.  For example, if you you are using
   chk1024.snp, then enter the shell commands:

     cd /usr2/log
     mv chk1024.log chk1024_yymmmdd.log

   Where "yymmmdd" is the date that the contents of the log were
   created.  You could instead use some mnemonic string that will help
   identify the contents of the log.

   Then enter the SNAP commands:

     schedule=chk1024,#1

   Wait for the schedule to complete, then close the log:

     log=station

   Now would be a good time to rename the log as desribed above,
   before it is accidently appended to with other data.  The
   suggestions for renaming described above can be used.

2. To analyze the results, enter the shell commands:

     cd /usr2/log
     chk1024 LOG

   where LOG is the name of the log file you want to analyze.  The
   results for each set-up found in the log are summarized.  The name
   of the analysis program is chk1024 regardless of whether your used
   the chk1024, vchk1024, or some other schedule.  The program chk1024
   has several options, try "chk1024 -h" for more information, of
   which the "-s" option is probably the most immediately useful, for
   example:

     chk1024 -s LOG
    

INSTALLATION

The installation of these tools are fairly easy. The process is
described in the INSTALLATION section for three possible scenarios:
"first time installation", "update to include stability tests", and
"update to include Mark 5 tests.".

		       FIRST TIME INSTALLATION

The steps to install for the first time are described below.

(1) Login as "oper".

(2) Check that you don't already have procedure libraries and SNAP
    schedules with the default names, enter:

      ls /usr2/proc/systests.prc
      ls /usr2/proc/*chk1024.prc
      ls /usr2/sched/*chk1024.snp

    If you do already have such files, you should either rename them
    or use different names in the next step for the target files to
    copy to.  In the latter case, you will have to appropriately
    modify the "proc=..." and "schedule=..." commands in the USAGE
    examples above to open the correct library.  It may also be that
    you already the current version of *chk1024.prc and/or
    *chk1024.snp; you can check this with "diff".

(3) Copy the default procedure libraries and schedules to "/usr2/proc"
    and "/usr2/sched", respectively and set their permissions and
    ownership.  You should copy the "vchk1024.snp" and "vchk1024.prc"
    files instead of "chk1024.snp" and "chk1024.prc", if you have a
    VLBA4 rack instead of a Mark IV rack.

      cd /usr2/proc
      cp -a /usr2/fs/systests/systests.prc .
      cp -a /usr2/fs/systests/chk1024.prc .         [or vchk1024.prc]
      chmod a+w systests.prc chk1024.prc            [or vchk1024.prc]
      chown oper.rtx systests.prc chk1024.prc       [or vchk1024.prc]

      cd /usr2/sched
      cp -a /usr2/fs/systests/chk1024.snp .         [or vchk1024.snp]
      chmod a+w chk1024.snp                         [or vchk1024.snp]
      chown oper.rtx chk1024.snp                    [or vchk1024.snp]

    If you have a VSI4/Mark 5B equipment configuration, you should
    replace the line above:

      cp -a /usr2/fs/systests/systests.prc .

    with:

      cp -a /usr2/fs/systests/systvsi4.prc systests.prc


(4) Customize the "systests.prc" (or whatever you named it) procedure
    library.  You should use PFMED to make the changes.  The
    procedures: "tpisamp", "bbcmanx", and "bbcagcx" are used only by
    the pcal power measurements.  The "pcalonsys" and "pcaloffsys"
    procedures are used by both the pcal power measurements and the
    spur measurements.  The "lounlocksys", "pcal5moffsys" and
    "pcal5monsys" procedures are used only for pcal spur
    measurements. The "onsample" and "stsample" procedures are used
    for the stability tests.

    The "tpisamp", "bbcmanx", and "bbcagx" procedures need to be
    modified depending on the type of rack: VLBA4 or Mark IV.  There
    are comments in the procedures describing which lines should be
    uncommented for each case.  In "tpisamp", the correct forms of the
    "tpi=..." and "tsys=..." commands must be uncommented.  The ones
    that aren't to be used have to be commented out.  For VLBA4 use
    the ones with "formbbc". For Mark IV uses the ones with "formvc".
    For station specific detectors use the ones with "u5".  For the
    "bbcmanx" and "bbcagcx" procedures, the "bbcmanz" command and
    "bbcagcz" commands should be uncommented for VLBA4, but Mark IV
    should have them commented out.

    The "pcalonsys", "pcaloffsys", "lounlocksys", "pcal5moffsys" and
    "pcal5monsys" procedures are used to control turning various
    signals on and off.  Each is set-up by default to prompt the user
    to manually make the necessary changes.  If your system can
    control any of these features, you can comment out the "sy=run
    fs.prompt ..." in the appropriate procedures and add commands
    where indicated to automate the control.  The feature most likely
    to have automatic control at a station is turning the phase-cal on
    and off.  You would edit the "pcalonsys" and "pcaloffsys"
    procedures to automate this for the tests.  If possible, turning
    off the phase-cal should not be implemented by physically
    disconnecting the 5 MHz that runs the antenna for the phase-cal.
    However, if that is the only way to do it please understand that
    the phase-cal off and phase-cal 5 MHz disconnected measurements
    will not give different results.  The "lounlocksys" procedure is
    intended to unlock the LO and turn the phase-cal on.  Manually
    unlocking the LO can often be accomplished by removing the 5 MHz
    signal that it is locked too. It should not be accomplished by
    actually turning the LO off.  The "pcal5moffsys" procedure should
    relock the LO and disconnect the phase-cal 5 MHz, as opposed to
    merely turning the phase-cal off.  Lastly, the "pcal5monsys"
    procedure should restore the phase-cal 5 MHz, and the phase-cal
    and LO should be on when it ends.

    The "onsample" and "stsample" procedures should be edited as
    described by their internal comments.  The issues are: (1) whether
    or not you have a Mark IV decoder, (2) the name of the procedure
    or SNAP command to make fmout-gps (or gps-fmout) measurements, and
    (3) the name of the procedure that records all of the receiver
    monitor points.

(5) In any session (usually an xterm) that you intend to run the
    analysis scripts from, you will either need to logout and login
    again or type "rehash".

(6) Install pgperl if your computer doesn't already have it.  Three
    cases are covered here: FS Linux 5 (FSL5), FSL6, and FSL7 (or
    later).  If you have a different distribution installed, you will
    need to determine how to do this yourself.  Ed may be able give
    you some advice if you need it.  Instructions for the three cases
    covered here follow:
    
    FSL5: Be sure that your "/etc/apt/sources.list" file does not
          mention "stable".  All web references should explicitly use
          "woody".  Since "woody" is no longer the "stable"
          distribution, you will need to to modify your web references
          to include the archive:

            deb http://archive.debian.org woody main contrib non-free
            deb http://non-us.debian.org woody/non-US main contrib non-free
            deb http://security.debian.org woody/updates main contrib non-free

          If you have any questions about this please contact Ed
          before attempting the install.  Once you have verified your
          "sources.list", as "root" please enter:

            apt-get update
            apt-get install pgperl
            apt-get clean

    FSL6: For these systems, it may still be possible to install
          pgperl in the normal way.  First, be sure that your
          "/etc/apt/sources.list" file does not mention "stable".  All
          web references should explicitly use "sarge".  Then please
          try:

            apt-get update
            apt-get install pgperl
            apt-get clean

          If that does not work, try the directions above for FSL5 for
          accessing the archive, but use "sarge" in place of "woody"
          for the web references.  If that also doesn't work, then a
          third alternative might be the procedure described for FSL7
          below.

    FSL7: For these (and later) systems, first be sure that your
          "/etc/apt/sources.list" file does not mention "stable".  All
          web references should explicitly use "etch" for FLS7 or
          another name as appropriate for later systems.  Once that is
          verified, enter the following commands as "root" (using
          cut-and-paste in a shell window will reduce the chances of
          making typing mistakes):

            cd /root
            apt-get update
            aptitude install pgplot5
            wget http://http.us.debian.org/debian/pool/main/libp/libpng/libpng10-0_1.0.18-1_i386.deb
            wget http://http.us.debian.org/debian/pool/contrib/p/pgperl/pgperl_2.18-5_i386.deb
            dpkg -i libpng10-0_1.0.18-1_i386.deb
            dpkg -i pgperl_2.18-5_i386.deb
            apt-get clean

         Over time these ".deb" files will probably move to
         "archive.debian.org", so you may need to retrieve them from
         there instead.
   
(7) Make sure that your print command will print PostScript
    files. This should already be set-up for FS Linux 5 systems with
    the command "lpr". If you can't print PostScript from your FS PC,
    you can always transfer the PostScript file to another machine
    that can or use a different output format (see step 2 above under
    "BANDPASS MEASUREMENTS" above in the "USAGE" section) that your
    printer supports.

(8) Installation of the vchk1024/chk1024 .snp and .prc files are
    straightforward.  If you already have the appropriate one for your
    configurations installed, you can skip this step.

		  UPDATE TO INCLUDE STABILITY TESTS

The steps to update your installation to include stability tests are
described below.  You can tell if the stability tests have already
been added by whether the procedures "stsample" and "onsample" are
already in your sysystests.prc library.

(1) Login as "oper".

(2) Copy the procedure library holding the new procedures to "/usr2/proc"

      cd /usr2/proc
      cp -a /usr2/fs/systests/systest2.prc .
      chmod a+rw systest2.prc

    If you have a VSI4/Mark 5B equipment configuration, you should
    replace the line above:

      cp -a /usr2/fs/systests/systest2.prc .

    with:

      cp -a /usr2/fs/systests/systvsi42.prc systest2.prc

(3) Customize the "systest2.prc" library on /usr2/proc.  You should
    use PFMED to make the changes.  Two procedures need to be edited
    and are both located at the start of the file: "onsample" and
    "stsample".  They should be edited as described by their internal
    comments.  The issues are: (1) whether or not you have a Mark IV
    decoder, (2) the name of the procedure or SNAP command to make
    fmout-gps (or gps-fmout) measurements, and (3) the name of the
    procedure that records all of the receiver monitor points.

(4) Append the new procedures to the existing "systests.prc" library
    (in "/usr2/proc").  The FS should not have the library open when
    this is done.  In fact, it is just safer to terminate the FS while
    doing this step.  Once it is safe to proceed, the procedures can
    be added with:

      cd /usr2/proc
      cat systest2.prc >>systests.prc

    If you named your library something other "systests.prc", you
    should use that name instead in the command above.

(5) Once step (4) is completed, you can delete the "systest2.prc"
    library you modified:

      cd /usr2/proc
      rm systest2.prc

(6) In any session (usually an xterm) that you intend to run the
    analysis scripts from, you will either need to logout and login
    again or type "rehash".

		    UPDATE TO INCLUDE MARK 5 TESTS

The steps to update your installation to include stability tests are
described below. You can tell if the Mark 5 tests have been added by
whether the chk1024.snp or vchl1024.snp SNAP schedule is in your
/usr2/sched directory.

(1) Login as "oper".

(2) Check that you don't already have procedure libraries and SNAP
    schedules with the default names, enter:

      ls /usr2/proc/*chk1024.prc
      ls /usr2/sched/*chk1024.snp

    If you do already have such files, you should either rename them
    or use different names in the next step as the target file to copy
    to.  In the latter case, you will have to appropriately modify the
    "schedule=..." commands in the USAGE examples above to open the
    correct library.   It may also be that you already the
    current version of *chk1024.prc and/or *chk1024.snp; you can check
    this with "diff".

(3) Copy the default procedure libraries and schedules to "/usr2/proc"
    and "/usr2/sched", respectively and set their permissions and
    ownership.  You should copy the "vchk1024.snp" and "vchk1024.prc"
    files instead of "chk1024.snp" and "chk1024.prc", if you have a
    VLBA4 rack instead of a Mark IV rack.

      cd /usr2/proc
      cp -a /usr2/fs/systests/chk1024.prc .         [or vchk1024.prc]
      chmod a+w chk1024.prc                         [or vchk1024.prc]
      chown oper.rtx chk1024.prc                    [or vchk1024.prc]

      cd /usr2/sched
      cp -a /usr2/fs/systests/chk1024.snp .         [or vchk1024.snp]
      chmod a+w chk1024.snp                         [or vchk1024.snp]
      chown oper.rtx chk1024.snp                    [or vchk1024.snp]
      
HELP OUTPUT

For reference the "help" output from each of the three scripts,
"pcalamp", "pcalimage", "pcalpower", "pcalspur", "samplestat",
"plotlog", and "chk1024" (listed last) is listed below.


			       PCALAMP

Usage: pcalamp  -c string -vhpi -u upper -l lower -f file/device logs
Synopsis: extracts and plots pcal amplitudes from log files

This script processes log files to produce plots of pcal amplitudes. The
default is pcal amplitudes for the first set of amplitudes that appear in the
file. This behavior can be modified with the '-c' option to plot the first
occurrence of amplitude data after a FS command that contains the specified
string.

Option explanations:
 -c string plot first set of amplitudes found after a command/procedure
    matching 'string' was recorded in the log, for this to work; the
    command/procedure matching 'string' must not be called from a procedure,
    unless the procedure is logged with 'xlog=on'
 -p plot using power units for comparison to autocorrelation plots
 -i autoscale each plot individually
 -l lower  eliminate points smaller than lower when auto-scaling plots
 -u upper  eliminate points larger  than upper when auto-scaling plots
 -v print program and PGPLOT version information and stop
 -h print this help information and stop
 -f file/device  send graphs to 'file' using PGPLOT 'device'
    if -f omitted and DISPLAY is defined, an xterm will be used
    if -f omitted and DISPLAY is not defined, 'pcalamp.ps/vps' will be used
    if '-f ?', you will be prompted for standard pgplot devices,
                be sure to quote '?', like \?
    'vps' (portrait PostScript) is a useful choice for 'device' for file output


			      PCALIMAGE

Usage: pcalimage -vhf file/device
Synopsis: extracts and plots image reject using pcal tones from log files

This script processes log files to produce plots of image rejection. The lowest
image rejection that can be detected is plotted as a dotted line, which may be
overlaid by the actual results.

Option explanations:
 -v print program and PGPLOT version information and stop
 -h print this help information and stop
 -f file/device send graphs to 'file' using PGPLOT 'device'
    if -f omitted and DISPLAY is defined, an xterm will be used
    if -f omitted and DISPLAY is not defined, 'pcalimage.ps/vps' will be used
    if '-f ?', you will be prompted for standard pgplot devices,
               be sure to quote '?', like \?
    'vps' (portrait PostScript) is a useful choice for 'device' for file output


			       PCALPOWER

Usage: pcalpower -bhv vc_bandwidth logs
Synopsis: tabulates pcal percentage of tsys data

This script will collect all tsys data in a log with pcal on and pcal off and
calculate the fractional power due to the pcal. The '-b' option can be used
to print the results in the Mark IV Decoders units for the (voltage) amplitude
of a single tone.

Whether the phase-cal is on or off for particular tsys measurements is
determined by whether the string 'pcalon' or 'pcaloff' was most recently
encountered in the log. Note that if 'pcalon' or 'pcaloff' is called from
a SNAP procedure, then it must be logged with 'xlog=on'.

Options explanation:
 -b vc_bandwidth (e.g., 2, 4, 8, 16) for single tone voltage (Mk4 decoder units)
 -h print this help information and stop
 -v print program and PGPLOT version information and stop


			       PCALSPUR

Usage: pcalspur -svhf file/device logs
Synopsis: extracts pcal data from logs and plots pcal spurs

The level of spurs is plotted for each of three states that may occur:
pcaloff, lounlock, and pcal5moff. These states are plotted relative to the
'pcalon' state. Data for each of these cases in the log must follow logged
commands that contain these strings. If the commands are called from
procedures, they must be logged with 'xlog=on'.

Options explanation:
 -s make sensitivity (only) plot also
 -v print program and PGPLOT version information and stop
 -h print this help information and stop
 -f file/device send graphs to 'file' using PGPLOT 'device'
    if -f omitted and DISPLAY is defined, an xterm will be used
    if -f omitted and DISPLAY is not defined, 'pcalspur.ps/vps' will be used
    if '-f ?', you will be prompted for standard pgplot devices,
               be sure to quote '?', like \?
    'vps' (portrait PostScript) is a useful choice for 'device' for file output

				   
			      SAMPLESTAT

Usage: samplestat -dvhf file/device logs
Synopsis: extracts and plots sampler statistics from log files

This script processes log files to produce plots of sample statistics. The
ideal values are plotted as a dotted line. The measured statistics appear
as points connected by lines.  The default mode is print the deviation from
ideal. The '-r' switch can used to plot the raw statistics instead.

Option explanations:
 -r plot raw statistics instead of deviation from ideal
 -v print program and PGPLOT version information
 -h print this help information and stop
 -f file/device send graphs to 'file' using PGPLOT 'device'
    if -f omitted and DISPLAY is defined, an xterm will be used
    if -f omitted and DISPLAY is not defined, 'samplestat.ps/vps' will be used
    if '-f ?', you will be prompted for standard pgplot devices,
               be sure to quote '?', like \?
    'vps' (portrait PostScript) is a useful choice for 'device' for file output


			       PLOTLOG

Usage:
   plotlog [options] logs
Synopsis: extracts and plots data from log files
Exit code is 0 for no error, -1 for no logs found, -2 for nothing to plot.

This script finds wx/, cable/, tsys/ rx/ (or sk/ or sx/), gps-fmout/ (or
fmout-gps/), setcl#time/, and the first encountered USB tone per channel for
Mark IV decoder pcal data in log files and generates time plots of the data.
The time axis of all the plots is the same. The data is plotted so that it fits
entirely inside the boxes. Points that appear along the top line of a plot did
not decode ($$$ for example) or were edited out by command line options.

The '1anw' switches can be used to select different IF arrangements for
calculating phase differences between pcal tones. Any combination of the '1anw'
switches can be used. No difference is plotted more than once.

The 'j' switch can be used to normalize pcal amplitudes by Tsys (per channel)
for time plots and amplitude versus phase plots. The minimum non-zero Tsys
(per channel) is used as the reference value for normalization. If this causes
problems, an explict global reference value can be specified with the 'k'
option. The 't' option may also be useful for removing bad Tsys values. By
default dual side-band Tsys is used for normalization if it is available, if
not then single side-band Tsys data is used. This is usually what is wanted
but if not, the 'b' option can be used to force use of single side-band Tsys
for channels that it is available for.

For the 'j1anw' switches a simple model is used to match different data from
the log. Points from different data types that are the nearest together in time
are matched. No epoch from one data type is matched to more than one epoch of
another type in this way. If the resulting matched epochs are within 60 seconds
of each other, the match is accepted. The tolerance of match can be adjusted
using the 'u' option.

The 'p' switch adds amplitude versus phase plots for each phase-cal tone after
all other plots. This option suppresses all other output except options -1anw.

Cable delay is plotted as one-way cable delay change unless the 'r' switch is
used.

Option explanations:
 phase-difference plot options (suppresses all other output, except -p):
  -1 all converters are on one IF
  -a odd converters are on one IF, even are on another (astronomy)
  -n converters 1-8 on one band, 9-16 on a second (narrow band geodesy),
     also useful for wide band geodesy
  -w converters 1-4 on one band, 5-8 on a second, 9-16 on a third
     (wide band geodesy)

 -b        force single-side-band Tsys normalization of pcal amp data
 -c value  cable cal edit, if greater than zero, delete points that much or
           more above lowest value, if less than zero, delete points that much
           or more below largest value; uses plot Y axis units, be careful of
           the -r option
 -e regexp include only plots with labels that DO NOT match 'regexp', where
           'regexp' is any Perl regular expression pattern, you will need to
           quote 'regexp' if it contains special characters, e.g., 'Temp|Hum'
           or spaces, this option can be combined with the 'g' option as well.
           The match is case insensitive.
 -g regexp include only plots with labels that DO match 'regexp', where
           'regexp' is any Perl regular expression pattern, you will need to
           quote 'regexp' if it contains special characters, e.g., 'Temp|Hum'
           or spaces, this option can be combined with the 'e' option as well.
           The match is case insensitive.
 -j        normalize phase-cal amp by Tsys per channel
 -k value  changes 'j' normalization from minimum non-zero Tsys per channel to
           'value' for all channels
 -p        plot amplitude versus phase for phase cal tones,
           suppresses all other output except -1anw
 -r        plot cable data in raw units
 -s string match commands with 'string' instead of 'tsys',
           option -t still applies for editing
 -t value  edit out tsys points less than or equal to zero or greater than or
           equal to 'value'
 -z value  edit out pcal data with amplitudes less than 'value'
 -u value  maximum distance in time (seconds) allowed for matching data for
           '1anwp' option plots is changed to 'value' instead of 60 seconds
 -v        print program and PGPLOT version information and stop
 -h        print this help information and stop
 -f file/device  send graphs to 'file' using PGPLOT 'device'
    if -f omitted and DISPLAY is defined, an xterm will be used
    if -f omitted and DISPLAY is not defined, 'plotlog.ps/vps' will be used
    if '-f ?', you will be prompted for standard pgplot devices,
               be sure to quote '?', like \?
    'vps' (portrait PostScript) is a useful choice for 'device' for file output


			       CHK1024

Usage: chk1024 -acdhlpsuv -b a|e|f -f frames -g a|e|f -r track -t track logs
Synopsis: analyzes results of Mark5 check schedule v/chk1024 logs

This script will summarize the results of v/chk1024 or other similar Mark5
test schedule. The modes are determined from presence of 'setupX' procedure
calls in the log. Where 'X' is a string. The mode is either 'play' or 'idle'
depending on whether or not 'recscan' has been called since the last
'setupX'.

By default, chk1024 prints only the overall summary results grouped by setup.
The number of tracks checked reflect those that were found in the log to have
been selected with the Mark5.

The checks for each track are:
  Aux:    considered good if decoded track number is correct
  Errors: considered good if synch, resynch, parity and CRC errors were zero
  Frames: considered good if more than the minimum frames were processed,
          minimum frames is settable, but defaults to 300 (0x12c)

Additional detail can be displayed by selecting command line options. The
next level of detail is selected by the -s option, which will print a table
of results for each check by setup and mode, also summarizing them by 'set'
and odd/even track number. The 'reported' tracks are those for which the
corresponding decoder output appears. If the 'Total' and 'reported' tracks
don't agree this usually means there were decoder communication errors. The
next level is shown with the -t option which shows the processed data for the
selected track. Finally, the -r option will print the raw log records for the
selected track.

Please note that the set (odd/even) statistics and summary results at the
end only report the total number of tracks found in the log, not the total
expected. The user must verify that total tracks are correct for each setup.
The 'Total Tracks' in the summary table is typically a good measure of the
expected number of tracks, but they are distributed over the sets.

If the scan_check fails for a setup the phrase 'ERROR: scan_check failed'
is included in the overall summary for the affected setup.

If the decoder firmware version is wrong or could not be determined a message
to that effect is printed.

If the same set-up occurs more than once, results from all but the last are
discarded. Note also that the 'Location' title line is printed once for each
time it is encountered in the log, with the corresponding log time stamp.
Typically, this happens for each time the schedule is started. Results from
previous runs are discarded only for set-ups with the same names. All
unique set-ups in the log are reported, even if they are from different runs.
For a given set-up and mode if a track or scan_check appears more than once,
the results for the last occurance is reported. A warning about 'Duplicate
DQA records' indicates either a track (or tracks) was checked more than once
or there was a decoder communication problem

Options explanation:
 -a        ignore aux data when calculating performance
 -b a|e|f  display  bad tracks for one of the Aux|Errors|Frames
           checks, cannot be used with -g, -t, or -r
 -c        show raw scan_check data
 -d        show raw decoder firmware version data
 -f frames sets the minimum level of required frames, default is 300 (0x12c)
 -g a|e|f  display good tracks for one if the Aux|Errors|Frames
           checks, cannot be used with -b, -t, or -r
 -h        print this help information and stop
 -l        lists each set-up as it is encountered, useful when a log contains
           more than one run, possibly on different dates
 -p        'permissive', handles some Mark IV decoder old firmware
           communication errors
 -r track  to display raw data for track, cannot be used with -b or -g
 -s        print summary statistics
 -t track  to display processed data for track, cannot be used with -b or -g
 -u        print tracks with duplicate dqa records
 -v        print program version information and stop
