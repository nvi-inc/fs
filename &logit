FTN4,X
C@LOGIT 
      SUBROUTINE LOGIT(LMESSG,NCHAR,LSOR,LPROCN,
     .           IERR,LWHO,LWHAT),MAKE LOG FILE ENTRIES C#890516:18:47 #
C 
C     LOGIT formats a buffer for the log file and puts it into a
C     mailbox for DDOUT.
C     Character messages are displayed as is, errors are formatted
C     in a standard format. 
C     For normal messages, only 4 parameters need be input. 
C     For the command which terminates Field System operation,
C     the error parameter (5) is used as a cue to CLOUT to clear the class
C     after the message is processed. 
C     The error parameter (5) is also used by DDOUT as a signal 
C     to start a new log file.
C     If only 2 parameters are input, the calling program's name
C     prefaces the message. 
C     For error messages, all 6 (7 if LWHAT is present) parameters are
C     required although the message and procedure name are ignored. 
C 
      INCLUDE #FSCOM::56
C 
C  INPUT: 
C 
      DIMENSION LMESSG(1) 
C      - the buffer holding the message 
C     NCHAR - length of the message, in characters
C     LSOR - source of the message, 1 character (determined by BOSS)
      DIMENSION LPROCN(1) 
C      - the procedure file from whence this message came, 12 chars 
C     IERR - error number, if this is an error. 
C            -999 indicates termination for CLOUT and DDOUT.
C     LWHO - source of the error, 2 chars, e.g. Qx for QUIKR or BO for BOSS.
C     LWHAT - what caused the error (usually a device name), 2 chars. 
C             If LWHAT is binary, it is converted to a 4-char ASCII number. 
C             Indicate that LWHAT is binary by setting LPROCN>0.
C             This parameter should be 0 or not present if not relevant.
C 
C  OUTPUT:  none
C 
C  LOCAL: 
C 
C     NCH - character counter in IBUF 
      DIMENSION IBUF(60)
C      - buffer in which log entry is formatted 
C     IBLEN - length of IBUF, characters
C     NARGS - number of arguments passed to us
C     IOPT2 - sent as optional parameter 2 on the class I/O.
C             "B1" appends a bell to the terminal display,
C                  normally used for error messages.
C 
C  INITIALIZED: 
C 
      DATA IBLEN/120/ 
C 
C 
C 
C     1. Get the number of parameters we were sent. 
C     Set up the class I/O option.
C 
      NARGS = NARG(IDUM)
      IOPT2 = 0 
      IF (NARGS.GT.5 .AND. IERR.LT.0) IOPT2 = 2HB1
      IF (NARGS.EQ.5) IOPT2 = IERR
C                   If there are exactly 5 arguments, then
C                   transfer the IERR parameter directly. 
C 
C 
C     2. Call LOGEN to format the message.  Call it with the appropriate
C     number of parameters, depending on NARGS. 
C 
      IF (NARGS.EQ.2) CALL LOGEN(IBUF,NCH,LMESSG,NCHAR) 
      IF (NARGS.EQ.3) CALL LOGEN(IBUF,NCH,LMESSG,NCHAR,LSOR)
      IF (NARGS.EQ.4) CALL LOGEN(IBUF,NCH,LMESSG,NCHAR,LSOR,LPROCN) 
      IF (NARGS.EQ.5) CALL LOGEN(IBUF,NCH,LMESSG,NCHAR,LSOR,LPROCN, 
     .                IERR) 
      IF (NARGS.EQ.6) CALL LOGEN(IBUF,NCH,LMESSG,NCHAR,LSOR,LPROCN, 
     .                IERR,LWHO)
      IF (NARGS.EQ.7) CALL LOGEN(IBUF,NCH,LMESSG,NCHAR,LSOR,LPROCN, 
     .                IERR,LWHO,LWHAT)
C 
C 
C     4. The buffer is formatted.  Pad with a blank for disk writing
C     purposes and put it into the mailbox.  That's all we do.
C 
400   NCH = ICHMV(IBUF,NCH,2H  ,1,1)-2
C                   Pad with a blank
      CALL EXEC(20,0,IBUF,-NCH,2HFS,IOPT2,ICLBOX) 
C 
      RETURN
      END 
