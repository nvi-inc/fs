FTN4,A
C@ISH4X 
C 
        FUNCTION ISH4X(ITYPE,IXCOL,I1,I2,I3,I4,I5)
     .,C#870115:05:47    FORM QUICK SCREEN LINE V=1.0#
C 
C     ISH4X 
C 
C 1.  NAME PROGRAM SPECIFICATION
C 
C 1.1.   ISH4X
C               THIS ROUTINE FORMATS DISPLAYS FOR 264x TERMINALS USING
C       INVERSE VIDEO WHEN REQUESTED.  THIS ROUTINE HANDLES COLUMN POSITIONING
C       AND WILL DISPLAY ASCII,CONVERTED BINARY INTEGERS, CONVERTED REAL
C       NUMBER USING A FORM OF THE FORTRAN Fn.m DISPLAY.  ASTONOMICAL 
C       ANGLES CAN ALSO BE FORMATTED AND DISPLAYED.  AN ENTRY IS ALSO PROVIDED
C       TO CALL A FUNCTION TO FORMAT AND CONVERT OTHER SYSTEM PARAMETERS. 
C               THE VALUE OF ISH4X AT THE COMPLETION OF A CALL WILL 
C       BE THE NUMBER OF REMAINING CHARACTERS IN THE BUFFER FOR 
C       DISPLAYING MORE INFORMATION ON THE SCREEN.
C 
C 
C 1.2.   RESTRICTIONS - limits on use of routine
C 
C 1.3.   REFERENCES - document cited
C 
C 2.  NAME INTERFACE
C 
C 2.1.   CALLING SEQUENCE: NLEFT=ISH4X(ITYPE,IXCOL,I1,I2,I3,I4,I5)
C 
C     INPUT VARIABLES:
C 
C       GLOBAL DEFS REFERENCED: "name'(local name if different)' ...
C 
      INCLUDE #SHOW::FS 
C     OUTPUT VARIABLES: 
C 
C       GLOBAL DEFS REFERENCED: "name'(local name if different)' ...
C 
C       ISH4X   - THE NUMBER OF CHARACTERS AVAILABLE FOR USE IN THE 
C                 BUFFER IN CONSTRUCTING THE CURRENT DISPLAY LINE 
C                 (NOTE 0 MEANS INTERNAL BUFFER IS FULL AND NEW 
C                 REQUESTS OTHER THAN WRITING THE BUFFER OR RESETTING   
C                 WILL BE IGNORED)
C 
C 2.2.   COMMON BLOCKS USED 
C 
C 2.3.   DATA BASE ACCESSES 
C 
C 2.4.   EXTERNAL INPUT/OUTPUT
C 
C 2.5.   SUBROUTINE INTERFACE:
C 
C     CALLING SUBROUTINES: SUB1, SUB2, ... (not required for utilities) 
C 
C     CALLED SUBROUTINES: SUB1, SUB2, ... (includes segments scheduled) 
C 
C 3.  LOCAL VARIABLES 
C 
C       GLOBAL DEFS REFERENCED: "name'(local name if different)' ...
C 
  
        LOGICAL KCLR
C 
C 
        DIMENSION LINE(100),IMTCH(100,10) 
C 
C       LINE    - INTERNAL BUFFER FOR SCREEN DISPLAY
C 
C       IMTCH   - THE INFORMATION CURRENTLY ON THE SCREEN FOR 
C                 COMPARISON ON NEXT ENTRY
C 
C       IRGA    - CONTENTS OF A REG WHERE REG WAS RETURNED FROM FUNCTION
C                 CALL TO A ROUTINE 
C 
C       IRGB    - CONTENTS OF B-REG WHERE REG WAS RETURNED FROM FUNCTION
C                 CALL TO A ROUTINE 
C 
        DIMENSION IREG(2) 
C 
C       IREG    - DUMMY REGISTER RETREIVAL AID
C 
        EQUIVALENCE (REG,IREG(1),IRGA),(IREG(2),IRGB) 
C 
C 4.  CONSTANTS USED
C 
        DATA IBLIM/185/ 
C 
C       IBLIM   - THE MAXIMUM NUMBER OF CHARACTERS THAT MAY BE WRITTEN INTO 
C                 BUFFER LINE AT ONE TIME 
C 
C 5.  INITIALIZED VARIABLES 
C 
C 6.  PROGRAMMER: LEE N. FOSTER 
C     LAST MODIFIED:
C       LASTED EDITED ON <860427.0921>
C# LAST COMPC'ED  870115:05:47urrent date) #
C 
C     PROGRAM STRUCTURE 
C 
C               6.1  INITIALIZE VARIABLES 
C 
        INP=IGNPS(INP,IFRM) 
C 
C               GET IGO, INVERSE VIDEO AND ABS COLUMN INFO
C 
        IGO=IAND(ITYPE,77B) 
        IVID=IAND(ITYPE/100B,77B) 
        ICOL=IABS(IXCOL)
C 
C               CHECK FOR END OF LINE CALL
C 
        IF(IGO .EQ. 63)GO TO 63000
C 
C               CHECK FOR OTHER THAN START OF LINE CALL 
C 
        IF(IGO .NE. 0)GO TO 100 
C 
C               CHECK FOR RESET INITIALIZATION CALL 
C 
        IF(INP .LT. 2 .OR. I1 .NE. 100000B) GO TO 50
        NLN=0 
50      CONTINUE
C 
C               INITIALIZE PARAMETERS 
C 
        CALL IFILL(LINE,1,160,2H  ) 
        NCHAR=1 
        NCHO=1
        NLN=NLN+1 
        IOCOL=1 
        ISH4X=IBLIM 
        GO TO 99999 
100    CONTINUE 
C 
C               CHECK FOR OFF SCREEN OR BUFFER FILLED 
C 
        IF(             ICOL .LE. 80
     C          .AND.   NCHAR .LT. IBLIM)GO TO 110
C 
        ISH4X=MAX0(IBLIM-NCHAR+1,0) 
C 
        GO TO 99999 
C 
110     CONTINUE
C 
C               CALCULATE NEW COLUMN POSITION 
C 
        IF(IXCOL .GT. 0)NCHAR=INPOS(LINE,ICOL,IOCOL,NCHO,NCHAR) 
        IF(IXCOL .LT. 0)NCHAR=NCHAR-ICOL
C 
C               PICK A ROUTE THROUGHT THE JUNGLE
C 
        IG1=IGO-18
        GO TO (999,19999),IG1 
999   CONTINUE
C 
C               TURN ON INVERSE VIDEO IF REQUESTED
C 
        IF(IAND(IVID+1,2) .NE. 0)NCHAR=IVON(LINE,NCHAR) 
        GO TO (1000,2000,3000,4000,5000),IGO
1000    CONTINUE
        CALL IFILL(LINE,NCHAR,NCHAR+I1-1,I2)
        NCHAR=NCHAR+I1
        GO TO 19000 
2000   CONTINUE 
        NCHAR=ICHMV(LINE,NCHAR,I1,1,I2) 
        GO TO 19000 
3000   CONTINUE 
        NCHAR=IB2AS(I1,LINE,NCHAR,I2)+NCHAR 
        GO TO 19000 
4000   CONTINUE 
        NCHAR=IR2AS(I1,LINE,NCHAR,I2,I3)+NCHAR
        GO TO 19000 
5000   CONTINUE 
        NCHAR=IFAMS(LINE,NCHAR,I1,I2,I3,I4,I5)
        GO TO 19000 
19000   CONTINUE
C 
C               TURN OFF INVERSE VIDEO IF REQUESTED 
C 
        IF(IAND(IVID,1) .EQ. 1)NCHAR=IVOFF(LINE,NCHAR)
C 
C               GO TO COMMON EXIT 
C 
        GO TO 64000 
19999   CONTINUE
        IF(IGO .NE. 20)GO TO 99990
        NCHAR=I1(I2,I3,LINE,NCHAR,IBLIM)
        GO TO 64000 
63000   CONTINUE
        IF(IGO .NE. 63)GO TO 99990
C 
C               IF I1 SET TO 100000B (TRUE) CLEAR LINE FIRST
C 
        IF(I2 .EQ. 100000B)CALL CLLIN(ICOL,0) 
C 
C               FOR CLEARED LINE RESET OLD BUFFER 
C 
        IF(I2 .EQ. 100000B)CALL IFILL(IMTCH(1,NLN),1,160,0) 
C 
C               GET NEW INFORMATION TO BE DISPLAYED 
C 
        LCHAR=IDLN(LINE,1,NCHAR,IMTCH(1,NLN),1,190)+1 
C 
C               CLEAR LINE IF ASKED TOO OR IF NEW INFO DIFFERENT
C               THAN OLD
C 
        KCLR = I2 .NE. 100000B  .AND. LCHAR .EQ. NCHAR
D       WRITE(1,6301) (LINE(I),I=1,LCHAR/2) 
D6301   FORMAT("QSH4X: LINE Y",85A2) 
D       WRITE(1,6303) 
D6303   FORMAT("Z_") 
C 
C               GET OUTPUT LU 
C 
        LOUT=IAND(ICOL,77B) 
C 
C               SUPPRESS <CR> <LF> IF REST TO BE CLEARED
C 
        IF(KCLR)LOUT=2000B+LOUT 
C 
C               WRITE INFORMATION OUT FINALLY 
C 
        CALL EXEC(2,LOUT,LINE,1-LCHAR)
C 
C               CLEAR LINE IF ASKED TO
C 
        IF(KCLR)CALL CLLIN(ICOL,1)
        GO TO 99990 
64000   CONTINUE
99990   CONTINUE
        ISH4X=IBLIM-NCHAR+1 
99999   CONTINUE
C 
        RETURN
        END 
        END$
