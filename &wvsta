FTN4,X
C@WVSTA 
      SUBROUTINE WVSTA(IP),WVR STATUS (JPL) C#870115:04:50#   
C 
C     WVSTA handles the WVSTAT command for JPL radiometers. 
C 
C 
C  MODIFICATIONS: 
C  830908 NRV CREATED 
C 
C   INPUT VARIABLES:
C 
      DIMENSION IP(1) 
C             -Parameters from QUIKR
C      IP(1)  -Class number of input buffer 
C      IP(2-5)-Not used 
C 
C   OUTPUT VARIABLES: 
C 
C      IP(1) - Class number 
C      IP(2) - Number of records
C      IP(3) - Error number 
C      IP(4) - Who we are 
C 
C  COMMON BLOCKS USED 
C 
      INCLUDE #FSCOM::FS
C 
C   SUBROUTINE INTERFACE
C 
C   CALLING SUBROUTINE: QUIKR 
C   CALLED SUBROUTINES: CHARACTER STRING UTILITIES
C                       WVSDS - format status response
C 
C   LOCAL VARIABLES 
C 
      DIMENSION IBUF(20)
C               - INPUT Class buffer
C     ILEN - length of IBUF, in chars 
      DIMENSION IREG(2) 
C               - Registers from EXEX calls 
      DIMENSION IPARM(2)
      EQUIVALENCE (PARM,IPARM(1)) 
C               - parameter for GTPRM call
      EQUIVALENCE (REG,IREG(1)) 
C 
C   INITIALIZED VARIABLES 
C 
      DATA ILEN/40/ 
C 
C 
C 
C     1. If class buffer contains command with "=", then process
C     the commanded unit ID. . If only command name 
C     is present, then read the current WVR status. 
C 
      ICLCM=IP(1) 
      IF(ICLCM.NE.0)GO TO 110 
      IERR=-1 
      GO TO 990 
  110 REG=EXEC(21,ICLCM,IBUF,-ILEN) 
      NCHAR=MIN0(IREG(2),ILEN)
      IEQ=ISCNC(IBUF,1,NCHAR,75B) 
C                  Scan for "=" 
      IF(IEQ.EQ.0)GO TO 500 
C                   If no parameters present, go read WVR status
      IF(ICHAR(IBUF,IEQ+1).NE.77B)GO TO 200 
      IP(4)=77B 
      CALL WVSDS(IP,ICLCM)
C                   If "?" display last commanded ID #  
      RETURN
C 
C 
C     2. Get command parameter. Only one is:
C                 WVSTAT=<id>     radiometer serial # 
C 
C 
200   ICH=IEQ+1 
      CALL GTPRM(IBUF,ICH,NCHAR,1,PARM,IERR)  
      IF(ICHAR(PARM,1).NE.52B.AND.ICHAR(PARM,1).NE.54B)GO TO 203
      IF(ICHAR(PARM,1).NE.52B)GO TO 201 
C                   Check for "*" indicating no change
      ID=IDWVR  
C                   Pick up last commanded ID 
      GO TO 300 
201   IERR = -104 
C                   There is no default for the ID
      GOTO 990
203   ID = IPARM
      IF (ID.GT.0.AND.ID.LE.9) GOTO 300 
      IERR = -204 
      GOTO 990
C 
C 
C     3. Format the command for the WVR controller. 
C 
300   IBUF(1) = 0 
      IBUF(2) = 2HWV
      CALL ICHMV(IBUF,5,3H U ,1,3)
      CALL IB2AS(ID,IBUF,8,1) 
      NREC = 1
      ICLASS = 0
      CALL EXEC(20,0,IBUF,-8,2HFS,0,ICLASS) 
      IERR = 0
C 
C 
C     4. Plant the ID into common.
C 
      IDWVR=ID
      GO TO 800 
C 
C 
C     5. Format the message requesting status from the WVR. 
C 
  500 CALL WVGST(IBUF,ILEN,ICLASS,NREC) 
C 
C 
C     8. All MATCN requests are scheduled here. 
C 
800   CALL EXEC(23,6HMATCN ,ICLASS,NREC)
      CALL RMPAR(IP)
      CALL WVSDS(IP,ICLCM)
      RETURN
C 
C     9. Error exit 
C 
  990 IP(1)=0 
      IP(2)=0 
      IP(3)=IERR
      IP(4)=2HQW
      RETURN
      END 
