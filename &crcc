FTN4,X
      SUBROUTINE CRCC(N,MASK,ISTATE,IDATA,IDBIT,NBITS,IBUF,ISBIT) 
C 
C     ROUTINE TO GENERATE A CRCC CODE SEQUENCE
C 
C     ARW 780917
C 
C     "N" IS THE # OF BITS IN THE CRCC GENERATOR. 
C     "MASK" HAS "1"'s IN ALL POSITIONS WHERE AN XOR GATE FOLLOWS THE 
C        CORRESPONDING D FLIP-FLOP. IF THE LEAST SIG BIT OF MASK IS "0",
C        IDATA IS NOT USED (I.E. THE EFFECT IS EXACTLY THE SAME AS IF 
C        THE LEAST SIG BIT OF MASK IS "1" AND IDATA IS ALL ZERO). 
C        ONLY THE N LSB POSITIONS OF MASK ARE USED. 
C        FOR EXAMPLE, A CRCC GENERATOR WITH POLYNOMIAL
C        1 + X + X**2 + X**3 + X**11 + X**12  WILL BE N=12, MASK=7003B. 
C     "ISTATE" IS THE INITIAL STATE OF THE CRCC FLIP-FLOPS (IN THE N LSB's).
C        ON RETURN, ISTATE IS SET TO THE FINAL STATE OF THE CRCC GENERATOR. 
C        ONLY THE N LSB's OF ISTATE ARE USED. 
C     "IDATA" IS THE DATA STREAM APPLIED TO THE D-INPUT OF THE CRCC 
C        GENERATOR. THE IDth BIT OF IDATA IS ASSUMED TO BE IN FORCE IN
C        THE INITIALIZED STATE SO THAT THE STATE OF THE CRCC IMMEDIATELY
C        AFTER THE FIRST CLOCK IS INFLUENCED BY THE IDth DATA BIT.
C     "IDBIT" IS THE BIT# OF IDATA FIRST APPLIED TO THE D-INPUT OF THE
C        CRCC GENERATOR.
C        ON RETURN, IDBIT=IDBIT+NBITS 
C     "NBITS" IS THE NUMBER OF BITS FOR WHICH THE CRCC SEQUENCE IS COMPUTED.
C     "IBUF" IS THE OUTPUT BIT STREAM (OF LENGTH NBITS) EMANATING FROM THE
C        Q-OUTPUT OF THE CRCC GENERATOR. THE FIRST BIT PLACED IN IBUF 
C        (AT IBUF BIT# ISBIT) REFLECTS THE Q-OUTPUT FOLLOWING THE FIRST 
C        CLOCKING OF THE CRCC GENERATOR.
C     "ISBIT" IS THE BIT# IN IBUF IN WHICH THE FIRST OUTPUT BIT OF THE CRCC 
C        IS PLACED. FIRST BIT IN IBUF IF BIT #1.
C        ON RETURN, ISBIT=ISBIT+NBITS.
C        IF ISBIT=0, NO OUTPUT IS PLACED IN IBUF. 
C 
C  NOTE!!!!!! ISTAT, IDBIT, AND ISBIT MAY BE MODIFIED ON RETURN.
C 
      INTEGER IBUF(1) 
C 
C     CREATE MASK OF N ONES.
50    NMASK=JSHFT(177777B,16-N) 
      ISTATE=IAND(ISTATE,NMASK) 
C     CREATE COMPLEMENT OF EXCLUSIVE-OR MASK
      NOTMSK=IXOR(NMASK,MASK) 
      DO 100 I=1,NBITS
C 
C     DETERMINE FEEDBACK PATTERN
      IPAT=0
      IF (IAND(MASK,1) .EQ. 0) GO TO 70 
C 
C     LEAST SIG BIT OF MASK IS SET
      JDATA=IGETB(IDATA,IDBIT)
      IDBIT=IDBIT+1 
      IF (IXOR(IAND(ISTATE,1),JDATA) .EQ. 1) IPAT=NMASK 
C     MODIFY LAST BIT OF IPAT TO CORRESPOND TO JDATA
      IPAT=IOR(IAND(IPAT,177776B),JDATA)
      GO TO 80
C 
C     LEAST SIG BIT OF MASK IS ZERO 
70    IF (IAND(ISTATE,1) .EQ. 1) IPAT=NMASK 
C 
C     XOR THE APPROPRIATE BITS
80    K1=IAND(IXOR(ISTATE,IPAT),MASK) 
C     MASK BITS WHICH ARE DIRECTLY TRANSMITTED
      K2=IAND(ISTATE,NOTMSK)
C 
C     CREATE NEW STATE OF GENERATOR BY "OR"ing K1 & K2 AND ROTATING 
C     LOWER N BITS RIGHT 1 BIT. 
      ISTATE=IROT(IOR(K1,K2),1) 
      IF (IAND(ISTATE,100000B) .EQ. 0) GO TO 90 
      ISTATE=IAND(ISTATE,NMASK) 
      ISTATE=IOR(ISTATE,JSHFT(100000B,16-N))
90    IF (ISBIT .EQ. 0) GO TO 100 
      CALL PUTB(IBUF,ISBIT,ISTATE)
      ISBIT=ISBIT+1 
100   CONTINUE
      RETURN
      END 
