Notes about visual Mark5  interface v. 1

Since I was not comfortable with Gigabyte numbers displayed at byte
resolution an because the loss of the "recording feel" given by a
moving tapes, I decided write a graphical tool to easily control the
Mark5 (MK5), and monitor its activity, among with disk usage.

Purpose

This application was developed to simplify and make more easy my Mark5
recording and data transfer test. I also intend to use it as monitor
of MK5 activity during a typical MK5 VLBI experiment.

Another possible use could be the control of many station's remote
Mark5 from correlator. The data streams from each station could be
easily started from correlator. That could be of some help in the
incoming PoC (Proof of Concept) eVLBI tests.

Requirements

This application is written in TCL/TK interpreted language, so to have
it running a TCL/TK interpreter must be present. The advantage in
TCL/TK use is the easily development of graphical application ready to
run on windows and linux.  Today there is a TCL/TK environment
practically for every operating system. The visualMark5 (vMk5.tcl)
program is compatible with TCL/TK v.8.3 and following.

Since the version running on a standard FS Linux 2 system is the 8.0
that has some minor incompatibilities with 8.3 there is a modified
version (vMk5FS.tcl) for FS machines. I had never test it with version
previous 8.0.


Structure

vMk5.tcl is practically the client side of Mark5A. Instead of using
the two pair programs Mark5A and tstMark5A developed at Haystack
observatory for the control of the new VLBI disks based recording
system, only the second one, Mark5A server program must be running on
Mk5. The client one is replaced by vMk5.tcl (even if it can be run
concurrently with tstMark5A).  The vMk5.tcl program could be run on
the same MK5 computer, under a graphical session, or on another
windows or linux remote machine. In second case be careful that the
remote computer may gain access to MK5 computer. A ping is a good
test. In case of problems check the presence of some firewall, or the
tcpwrapper settings.

Keep running only one occurrence of vMk5.tcl!

Run the program

The standard Mark5A server program must be running on MK5.

vMk5.tcl could be run as is, or with some runstring parameters such as
the IP number of MK5, the listen port of Mark5A server program
(usually 2620) and the total disks size. None of them is mandatory.

Under windows the best choice is a creation of a shortcut to the
program with the MK5 IP number and port specified. On linux a simple
script file with name of program and Mk5 ip number could simplify the
launch.

Once the graphical panel appears, user should press the connect button
to create the TCP link with Mark5A server program. If vMk5.tcl was run
without parameters, remember to fill the IP# and port fields before.

The total amount of disk space, used to compute the disk usage
percentage is determined automatically at the start, but only if Mk5
is not in recording, playing or transferring data, otherwise a
temporary size of 1000GB will be assumed unless a more precise value
is enter manually by the user in the total GByte filed. In any case,
at the first idle state of Mk5 a query for the real disk size will be
done and panel updated. This because there still not be a Mk5 command
able to give the total disks size while MK5 is busy.

If MK5 is not working (no data storage, play or transfer) the program
will scan the entire disk space showing a text list of all recorded
scan in the scan list window. Another graphical representation of
recorded scan is showed in disk usage bar.

The status of Mk5 is also queried, and the corresponded button are lit
on (status, rec,play,off).

If Mk5 is doing something, the disks could not be scanned, and only
the status is displayed

The panel is divided in two frame, one for disk operation and one for
data transfer operations. On the first is possible to start or stop a
recording or playing session. In recording mode the disk usage bar
will be updated among with percentage. Below this bar there are three
numbers representing the recorded, available and total Gbyte on the
disks.

The "force an update" button is used to refresh the scan list in case
it becomes corrupted and works only when Mk5 is in idle mode. Be
careful to use it because it requires an amount of time, especially if
there are many scans just recorded.

A scan could be selected by clicking on it in the disk usage bar. The
correspondent scan directory info in scan list window will be
highlighted. Vice-versa, if you select a scan in the scan list window
with a DOUBLE click of the mouse, the correspondent graphical
representation if disk usage bar will be highlighted. To unselect
click on the unused space of disk usage bar.

To start a new record simply press the rec button when MK5 is in idle
mode. Be careful to have formatter properly stetted otherwise the
record will be started but percentage number will be never increments
from its value.  A useful procedure to set MK4 formatter with both
headstacks enabled is bypass, included in the mark4 Dan Smithe test
procedures.

A play session can be started pressing play button after the scan
selection.  All this mode will be terminated with the stop button. In
case of early end (disk full while in recording, or scan finished in
play) the relative button became yellow.

Be careful to not interfere with FS scheduled activity.  The critical
reset= (erase, mount or dismount) command could be done only from FS
or tstMark5A program. This for safety reasons.

Data transfer

The data of a selected scan could be transferred from disk to local or
remote machine. Also the data coming from the input of Mk5 can be
forwarded directly by network to remote computer running a server
program such as Haystack Net2file server. This is possible when MK5 is
in idle mode.

Once the destination IP number field is filled, select the scan by
clicking on it in the scan list window or disk usage graph bar, then
press "disk to net" button. If a server program running at remote
machine is available the link status label became Connected, otherwise
an alarm windows will be shown. Except for the scan selection the same
steps are valid for the input to network data transfer mode, selected
with the in to net button. The data transfer is started for both the
modes by pressing the GO button. The link status became active and the
horizontal bar start to show the percentage of transfer. Another green
vertical bar will show the instantaneous throughput in Mbit/s. The
near field and the blue line show the average transfer rate, while the
red line keeps track of maximum.

The transfer will end automatically at the end of the scan in disk to net. The end button will terminate any transfer (disk to net or in to net). Please notice that each end close the remote server, so before start another transfer session remember to restart the server at remote location.

To be improved

Actually there is a strange behavior of the in to net command inside
the Mark5A server program. Until this will be patched I discourage it
use, because it could compromise the recording scans.

A command returning the whole disks size even if the MK5 is busy could
help.

The position command working with MK5 in play (as happen with record)
could make possible to graphically track the actual play position

Medicina, 14 February 2003           
Giuseppe Maccaferri
CNR IRA Italy. g.maccaferri@ira.cnr.it
